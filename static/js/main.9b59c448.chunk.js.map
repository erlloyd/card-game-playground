{"version":3,"sources":["../node_modules/peerjs/dist sync","serviceWorkerRegistration.ts","constants/app-constants.ts","store/localStorage.ts","features/cards-data/initialState.ts","store/global.actions.ts","features/game/initialState.ts","constants/card-constants.ts","features/game/game.slice.ts","features/cards-data/cards-data.slice.ts","features/cards/cards.actions.ts","utilities/geo.ts","features/cards-data/cards-data.selectors.ts","features/cards/cards.selectors.ts","constants/card-pack-mapping.ts","constants/game-type-properties-mapping.tsx","features/cards/cards.thunks.ts","features/cards/initialState.ts","features/cards/cards.slice.ts","features/counters/counters.actions.ts","features/counters/initialState.ts","features/counters/counters.slice.ts","store/rootReducer.ts","store/peer-js-redux-middleware.ts","store/configureStore.ts","RadialMenu.tsx","CardTokens.tsx","CardTokensContainer.tsx","constants/card-missing-image-map.ts","Card.tsx","CardStackCardSelector.tsx","CardStackCardSelectorContainer.tsx","FileUploader.tsx","ContextMenu.tsx","Counter.tsx","DeckLoader.tsx","EncounterLoader.tsx","EncounterLoaderContainer.tsx","FirstPlayerToken.tsx","features/counters/counters.selectors.ts","FirstPlayerTokenContainer.tsx","PeerConnector.tsx","features/game/game.selectors.ts","TopLayer.tsx","RadialMenuContainer.tsx","TokenValueModifier.tsx","TouchMenu.tsx","TouchMenuContainer.tsx","utilities/text-utils.ts","Game.tsx","generated/packsList.ts","generated/packsList_lotr.ts","features/cards-data/cards-data.thunks.ts","GameContainer.tsx","features/counters/counters.thunks.ts","utilities/marvel-txt-converter.ts","features/game/game.thunks.ts","App.tsx","AppContainer.tsx","index.tsx"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","onUpdate","onSuccess","catch","error","GameType","myPeerRef","uuidv4","possibleColors","loadState","key","serializedState","localStorage","getItem","baseState","JSON","parse","present","err","queryParamsGameType","URLSearchParams","search","get","localGameState","initialState","activeDataType","activeGameType","MarvelChampions","data","resetApp","createAction","receiveRemoteGameState","verifyRemoteGameState","localStorageState","playerColors","peerId","previewCard","menuPreviewCardJsonId","radialMenuPosition","StatusTokenType","CounterTokenType","stageZoom","x","y","stagePosition","gameSlice","createSlice","name","reducers","updateZoom","action","payload","updatePosition","connectToRemoteGame","setPlayerColor","ref","color","setPeerId","requestResync","setPreviewCardId","clearPreviewCard","setMenuPreviewCardJsonId","clearMenuPreviewCardJsonId","updateActiveGameType","quitGame","showRadialMenuAtPosition","hideRadialMenu","extraReducers","builder","addCase","game","actions","convertMarvelToCommonFormat","cardMarvelFormat","images","octgnId","octgn_id","quantity","doubleSided","double_sided","backLink","back_link","typeCode","type_code","subTypeCode","extraInfo","setCode","set_code","packCode","pack_code","factionCode","faction_code","convertLOTRToCommonFormat","encounterCard","cardLOTRFormat","cardBackImage","Back","ImagePath","frontImage","Front","frontImageWithoutExtension","split","slice","join","length","Slug","CardSet","replaceAll","RingsDbCardId","Title","front","back","OctgnGuid","Quantity","CardType","CardSubType","storeCardData","isPlayerPack","careAboutDups","cs","stateLocation","entities","encounterEntities","card","cardsDataSlice","loadCardsData","activeData","setData","SetData","forEach","set","setTypeCode","card_set_type_code","cardsInSet","LordOfTheRingsLivingCardGame","Scenarios","scenario","Product","loadCardsDataForPack","packType","isHeroPack","includes","pack","map","c","cards","loadCardsForEncounterSet","activeSet","concat","filter","cd","toLocaleLowerCase","indexOf","addCardStackWithId","pullCardOutOfCardStackWithId","drawCardsOutOfCardStackWithIds","startCardMoveWithSplitStackId","replaceCardStack","setStackShuffling","createDeckFromTextFileWithIds","cardConstants","getDistance","point1","point2","deltaX","deltaY","Math","sqrt","getCenter","p1","p2","getCurrentCardData","cardsData","getCardsData","getCardsDataEntities","createSelector","getCardsDataHeroEntities","getCardsDataHerosByName","cardsDataByName","Object","values","getCardsDataPlayerCardsByName","getCardsDataEncounterEntities","getCardsDataSetData","getCardsDataSetDataAsEncounterEntities","entries","value","cis","getCardsDataEncounterEntitiesBySetCode","herosData","setTypesEncounters","campaignCards","pc","push","sort","a","b","getCards","liveState","getCardMapById","reduce","getPanMode","panMode","getMultiselectMode","multiselectMode","getDropTargetCardsById","returnVal","dropTargetCards","ownerRef","CARD_PACK_REMAPPING","bkw","cap","drs","hlk","trors","twc","EXTRA_CARDS","doctor_strange","jsonId","ant","wsp","GamePropertiesMap","marvelchampions","deckSite","decklistApi","encounterUiName","backgroundImageLocation","process","tokens","stunned","tokenType","Stunned","touchMenuLetter","touchMenuIcon","fontSize","menuText","menuRemoveText","imagePath","confused","Confused","tough","Tough","damage","counterTokenType","Damage","isNumeric","threat","Threat","generic","Generic","lotrlcg","shuffleStack","dispatch","getState","cardsState","find","selected","controlledBy","s","cardStack","stackToShuffle","shuffling","shuffledStack","shuffle","newStack","setTimeout","drawCardsOutOfCardStack","possibleIds","Array","from","numberToDraw","_i","payloadWithIds","idsToUse","fetchDecklistById","createAsyncThunk","thunkApi","axios","gameType","decklistId","response","getMarvelCards","getLOTRCards","heroSetCode","investigator_code","encounterCardsData","heroObligationDeck","heroEncounterDeckData","heroEncounterDeck","extraCards","position","heroId","dataId","extraHeroCards","relatedEncounterDeck","encounterDeckId","relatedObligationDeck","obligationDeckId","heroCardsData","heroStack","heroes","cardDetails","newSlots","slots","cardData","array","temporaryValue","randomIndex","returnArray","stringify","currentIndex","floor","random","queryParamsCardsString","jc","attachTargetCards","ghostCards","outOfSyncWithRemote","getCardStackWithId","mutateCardWithId","callback","cardToUpdate","foreachSelectedAndControlledCard","actorRef","foreachUnselectedCard","getAttachDrawPos","baseCard","drawPos","takenSpace","i","xToDraw","yToDraw","unselectAllCardsReducer","ACTOR_REF","cardsSlice","selectCard","unselectOtherCards","unselectCard","toggleSelectCard","exhaustCard","exhausted","cardMove","movedCards","primaryCard","dx","dy","possibleDropTargets","distance","c1","c2","possibleAttachTargets","attachTarget","gc","attachGhostCard","movedCard","splice","endCardMove","attachTargetCardStacks","dragging","index","unshift","dropTargetCard","selectMultipleCards","ids","unselectAllCards","togglePanMode","toggleMultiselectMode","flipCards","faceup","reverse","resetCards","toggleToken","cardToToggle","undefined","statusTokens","adjustCounterToken","counterTokens","delta","clearCardTokens","isEqual","original","cardToReplaceStack","fill","cardJsonIds","cardStackToUse","cardStackId","newCardStack","newCard","assign","cardIndexToRemove","findIndex","cardToStartMoving","splitTopCard","cardToMove","topCard","shift","splitCardId","sourceCardStackId","topCardDetails","facedown","stackToUpdate","handleLoadDeck","fulfilled","potentialHeroCard","heroCardStack","heroCard","mainDeckStack","cardPadding","newDeck","encounterDeck","obligationDeck","addNewCounterWithId","queryParamsCountersString","counters","firstPlayerCounterPosition","countersSlice","updateCounterValue","counter","removeCounter","moveCounter","newPos","moveFirstPlayerCounter","updateCounterColor","newColor","pos","undoableState","combineReducers","rootReducer","undoable","limit","groupBy","groupByActionTypes","type","excludeAction","blacklistRemoteActions","setupConnection","conn","storeAPI","on","INITIAL_STATE_MSG","RESYNC","send","PING","REMOTE_ACTION","customizedMiddleware","getDefaultMiddleware","thunk","immutableCheck","serializableCheck","activeCon","cgpPeer","Peer","host","path","secure","debug","iceServers","urls","username","credential","remoteParamArray","href","remoteId","connect","metadata","stateToSend","cloneDeep","setPlayerColorAction","setInterval","currentState","peerConnection","onconnectionstatechange","ev","connectionState","next","MenuType","DrawMode","desiredWidth","desiredHeight","CardTokens","props","damageImg","threatImg","genericImg","unmounted","imagesLoaded","Image","tokenInfo","currentGameType","onload","setState","src","prevProps","prevState","this","damageX","damageY","showDamage","damageToken","scale","naturalWidth","naturalHeight","width","height","fillPatternImage","damageText","text","align","verticalAlign","threatX","threatY","showThreat","threatToken","threatText","genericX","genericY","showGeneric","Component","CardTokensContainer","CARD_ALREADY_ROTATED_MAP","MISSING_CARD_IMAGE_MAP","HORIZONTAL_TYPE_CODES","stringArraysEqual","array1","array2","every","Card","imgs","stunnedImg","confusedImg","toughImg","touchTimer","rect","shuffleToggle","initCardImages","imgUrls","img","imageLoaded","onerror","imageLoadFailed","imgUrl","getStrokeColor","dropTargetColor","selectedColor","renderUnanimatedCard","heightToUse","widthToUse","imgToUse","complete","getScale","offset","to","rotation","animatedProps","Rect","node","cornerRadius","stroke","strokeWidth","fillPatternRotation","shouldRenderImageHorizontal","fillPatternScaleX","fillPatternScaleY","shadowForStrokeEnabled","hitStrokeWidth","opacity","isGhost","draggable","onDragStart","handleDragStart","onDragMove","handleDragMove","onDragEnd","handleDragEnd","onDblClick","handleDoubleClick","onDblTap","handleDoubleTap","onClick","handleClick","onTap","handleTap","onMouseDown","handleMouseDown","onTouchStart","handleTouchStart","onTouchMove","handleTouchMove","onTouchEnd","handleTouchEnd","onMouseOver","handleMouseOver","onMouseOut","handleMouseOut","onContextMenu","handleContextMenu","cardStackOffset","numCardsInStack","shouldRenderStunned","cardState","tokenImagesLoaded","stunnedToken","getTokenInSlot","confusedToken","toughToken","cardTokens","renderCardName","event","target","handleTapOrClick","wasTouch","cancelBubble","clearTimeout","handleHover","handleHoverLeave","prevImgUrls","currentRotation","duration","renderCard","cardWidth","cardHeight","textOffset","shouldRender","slot","dimensions","stunnedOffset","native","typeCodes","plainCardBack","widthHorizontal","heightHorizontal","some","CardStackCardSelector","cardsDataInStack","handleHighlightChange","_event","option","reason","preview","clearPreview","handleSelected","cardSelected","stopPropagation","cardsDataEntities","onKeyPress","Autocomplete","options","getOptionLabel","style","onChange","onHighlightChange","renderInput","params","TextField","label","variant","CardStackCardSelectorContainer","FileUploader","hiddenFileInput","React","useRef","MenuItem","current","evt","document","createEvent","initEvent","dispatchEvent","files","fileUploaded","handleFile","display","ContextMenu","nestedRef","renderMenuItem","children","val","parentMenuOpen","menuOpen","parentElement","focus","nestedI","nestedIndex","fileUploader","file","reader","FileReader","readAsText","readerEvent","content","result","fileLoadedAction","hideContextMenu","handleContextItemClicked","handleMenuClosed","preventDefault","item","contextItemClicked","items","blur","Menu","keepMounted","open","onClose","anchorReference","anchorPosition","top","left","Counter","handleDecrement","updateCounterValueBy","handleIncrement","DeckLoader","inputValue","focusInputField","input","querySelector","handleKeyPress","loadDeckId","className","EncounterLoader","questCards","encounterCards","filteredCards","oc","totalCards","loadCards","encounterData","EncounterLoaderContainer","ownProps","FirstPlayerToken","updatePos","image","getCounters","getCurrentCounters","getFirstPlayerTokenPos","FirstPlayerTokenContainer","PeerConnector","inputRef","getGame","getPlayerColors","getPeerId","getActiveGameType","getRadialMenuPosition","getMenuPreviewCard","TopLayer","completed","offsetContent","containerStyle","trasparentBackground","backgroundColor","reactPieMenu","require","PieMenu","default","Slice","swallowClick","renderMenuSlices","visibleMenu","setVisibleMenu","currentDrawMode","setCurrentDrawMode","StatusTokenActions","renderStatusTokensMenu","CounterTokenActions","renderCounterTokensMenu","DrawActions","renderDrawMenu","DrawNumber","renderDrawNumberMenu","TopLevelActions","renderTopLevelMenu","onSelect","slices","replace","flatMap","selectedCardStacks","FaceUp","FaceDown","_","num","RadialMenu","useState","max","radius","centerRadius","RadialMenuContainer","peerRef","TokenValueModifier","newValue","updated","Button","marginLeft","TouchMenu","IconButton","anyCardsSelected","TouchMenuContainer","copyToClipboard","clipboard","writeText","Game","stage","doubleTapTimer","lastCenter","lastDist","componentWillUnmount","removeEventListener","handleResize","handleCounterValueUpdate","handleCounterDrag","noOp","renderEmptyMessage","renderContextMenu","showContextMenu","containerRect","container","getBoundingClientRect","pointerPosition","contextMenuPosition","contextMenuItems","clearContextMenu","renderPreviewCardModal","previewCardModal","renderTouchMenu","renderDeckImporter","showDeckImporter","deckImporterPosition","clearDeckImporter","handleImportDeck","getRelativePositionFromTarget","renderEncounterImporter","showEncounterImporter","encounterImporterPosition","clearEncounterImporter","handleLoadEncounter","renderCardSearch","showCardSearch","cardSearchPosition","cardStackForSearching","clearCardSearch","handleCardSelectedFromCardStack","renderPeerConnector","showPeerConnector","peerConnectorPosition","clearPeerConnector","handlePeerConnect","renderTokenModifier","showTokenValueModifier","tokenValueModifierPosition","tokenValueModifierProps","clearTokenValueModifier","addCardStack","pullCardOutOfCardStack","handleStageClickOrTap","mousePos","selectStartPos","handleWheel","oldScale","gameState","pointer","getPointerPosition","mousePointTo","newScale","handleCounterContextMenu","counterId","menuItems","handleCardContextMenu","cardId","currentStatusTokens","tokenInfoForGameType","handleCardClick","modifierKeyHeld","shiftKey","metaKey","ctrlKey","handleSelectAndExhaust","showOrToggleModalPreviewCard","handleCardDragStart","draggingCard","hasStack","upperRightPoint","startCardMove","modifier","intCode","parseInt","Number","isNaN","mySelectedCards","handleKeyDown","redo","undo","getRawPreviewCardPosition","horizontal","pointerPos","screenMidPointX","innerWidth","screenMidPointY","innerHeight","posParam","transform","getAbsoluteTransform","copy","invert","point","MouseEvent","button","TouchEvent","selecting","getSelectionRectInfo","selectRect","abs","handleMouseUp","drewASelectionRect","selectedCards","currSelectedCards","Intersects","touch1","touches","touch2","handleMultiTouch","handleMouseMove","isDragging","stopDrag","clientX","clientY","newCenter","dist","pointTo","currentTarget","txtContents","createDeckFromTxt","addNewCounter","origin","pathname","generateGameStateUrl","getCardType","getCardName","cardInQuestion","getCardCode","idToGrab","getImgUrls","topCardData","generateLCGCDNImageUrl","codeForMissingCheck","missingImageOverride","checkMissingImageMap","stageHeight","stageWidth","Konva","hitOnDragEnabled","playmatImage","playmatImageLoaded","allJsonData","addEventListener","activeElement","body","el","staticCards","dropTargetCardsById","movingCards","iAmDragging","possiblePreviewCards","menuPreviewCard","previewCards","_card","previewCardHeight","isHorizontal","rawPos","previewPos","previewCardWidth","min","url","playmatScale","tabIndex","onKeyDown","Consumer","store","onMouseUp","onMouseMove","onWheel","codeToUse","groupCode","substring","cardCode","toLocaleUpperCase","cardSuffix","packList","getSpecificMarvelPack","packName","res","getSpecificLOTRPack","getSpecificLOTRScenario","GameContainer","Promise","all","marvelPackList","status","lotrPackList","scenarioListLOTR","AllCards","payloadWithId","ActionCreators","heroCardsDataByName","playerCardsDataByName","heroDataByName","playerCardDataByName","nonEmptyLines","l","trim","heroName","packLineIndex","startsWith","hero","pattern","slotLines","sl","cardName","convertMarvelTxtToDeckInfo","_dispatch","currentStoreState","crushedCardsString","crushedCountersString","renderGamePicker","FormControl","InputLabel","Select","labelId","toUpperCase","App","clearQueryParams","useEffect","AppContainer","history","replaceState","title","rtkConfigureStore","reducer","middleware","devTools","subscribe","throttle","blacklistStateKeys","setItem","saveState","configureStore","ReactDOM","render","StrictMode","getElementById","URL","fetch","headers","contentType","ready","unregister","reload","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"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WAAWvZ,MAC7BC,OAAQ,EAAK1f,MAAMg5B,WAAWtZ,OAC9BsD,OAAO,SACPC,YAAa,mB,2CA6oCFzkB,GAA8B,IAAD,EACxD,iBAAOmiB,GAAuBniB,UAA9B,QAAuC,O,6CAGVsJ,EAAgBqP,GAA0B,IAAD,IACtE,IAAKrP,EACH,MAAM,8CAIR,IAAIy1B,EAAYz1B,EAAKtJ,MAEhB2Y,GAAYrP,EAAK3C,WACpBo4B,EAAYz1B,EAAK3C,UASnB,IANA,IAAMq4B,EAAS,UACbpwB,GAAmB,UAACtF,EAAKtC,UAAUG,gBAAhB,QAA4B,WADlC,QAEb43B,EAAUE,UAAU,EAAG,GACrBC,EAAWH,EAAUE,UAAU,GAGZ,MAAhBC,EAAS,IACdA,EAAWA,EAASD,UAAU,GAGhCC,EAAWA,EAASC,oBAEpB,IAAIC,EAAa,GAMjB,OAJM91B,EAAK7C,cACT24B,EAAazmB,EAAS,IAAM,KAGxB,wCAAN,OAA+CqmB,EAA/C,cAA8DE,GAA9D,OAAyEE,EAAzE,Y,GA/iDepd,aC5JNqd,GAAW,CACxB,WACA,qBACA,WACA,qBACA,WACA,qBACA,YACA,sBACA,YACA,sBACA,WACA,qBACA,WACA,qBACA,WACA,qBACA,qBACA,WACA,qBACA,WACA,qBACA,WACA,qBACA,qBACA,WACA,qBACA,YACA,sBACA,YACA,sBACA,uBACA,aACA,uBACA,qBACA,WACA,sBCpCaA,GAAW,CACxB,8BACA,wCACA,qCACA,4BACA,sCACA,wCACA,8BACA,uCACA,6BACA,yBACA,sCACA,4BACA,4BACA,yBACA,4CACA,sCACA,4BACA,mCACA,wBACA,yCACA,+BACA,gBACA,gCACA,+CACA,0CACA,gCACA,wCACA,iCACA,wCACA,8BACA,yBACA,iBACA,mCACA,mCACA,2CACA,iCACA,oCACA,+BACA,sCACA,4BACA,2BACA,6BACA,8BACA,+BACA,8BACA,uCACA,0CACA,qCACA,4CACA,qBACA,sBACA,mCACA,+CACA,0CACA,mCACA,yBACA,yCACA,oCACA,0BACA,mCACA,yBACA,6BACA,kCACA,wBACA,+BACA,wCACA,8BACA,oCACA,0BACA,2CACA,iCACA,2CACA,+BACA,8BACA,wBACA,yBACA,qCACA,2BACA,sCACA,4BACA,0BACA,8BACA,kCACA,wBACA,iCACA,uBACA,mCACA,yBACA,uCACA,6BACA,oCACA,kCACA,wBACA,+BACA,wCACA,8BACA,6BACA,mCACA,4BACA,8BACA,uBACA,wCACA,8BACA,mCACA,4CACA,qCACA,2BACA,oCACA,0BACA,0BACA,qCACA,+BACA,qBACA,sBACA,gCACA,0BACA,iCACA,uBACA,4BACA,sBACA,qCACA,2BACA,sBACA,4CACA,kCACA,wBACA,qCACA,wBACA,sCACA,6BACA,0BACA,mCACA,iCACA,0CACA,oCACA,0BACA,0BACA,yCACA,+BACA,kCACA,wBACA,0CACA,gCACA,8BACA,8BACA,6BACA,uCACA,6BACA,0CACA,gCACA,mCACA,8BACA,0BACA,0BACA,0BACA,iCACA,8BACA,oCACA,0BACA,0CACA,+BACA,wCACA,gDACA,uBCvFMC,GAAqB,yCAAG,WAC5BC,GAD4B,gBAAAzxB,EAAA,sEAGLkF,KAAM/P,IAC3B6M,mCAAyCyvB,GAJf,cAGtBpsB,EAHsB,yBAMrB,CACLqsB,IAAKrsB,EACLhM,SAAUo4B,EAASv3B,MAAM,SAAS,KARR,2CAAH,sDAYrBy3B,GAAmB,yCAAG,WAC1BF,GAD0B,gBAAAzxB,EAAA,sEAGHkF,KAAM/P,IAC3B6M,mCAAyCyvB,GAJjB,cAGpBpsB,EAHoB,yBAMnB,CACLqsB,IAAKrsB,EACLhM,SAAUo4B,EAASv3B,MAAM,SAAS,KARV,2CAAH,sDAYnB03B,GAAuB,yCAAG,WAC9Bv1B,GAD8B,gBAAA2D,EAAA,sEAGPkF,KAAM/P,IAC3B6M,6CAAmD3F,EAAW,SAJlC,cAGxBgJ,EAHwB,yBAMvBA,GANuB,2CAAH,sDCmBdwsB,GAzCOjhB,aAfE,SAACld,GACvB,MAAO,CACLqC,aAAcksB,GAAgBvuB,GAC9BoJ,MAAOoD,GAASxM,GAChB+K,UAAWE,GAAqBjL,GAChC6M,QAASD,GAAW5M,GACpB+M,gBAAiBD,GAAmB9M,GACpC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","file":"static/js/main.9b59c448.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 219;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://cra.link/PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://cra.link/PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://cra.link/PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { \"Service-Worker\": \"script\" },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import { v4 as uuidv4 } from \"uuid\";\n\nexport const myPeerRef = uuidv4();\n\nexport enum GameType {\n  MarvelChampions = \"marvelchampions\",\n  LordOfTheRingsLivingCardGame = \"lotrlcg\",\n}\n\nexport type PlayerColor =\n  | \"red\"\n  | \"cyan\"\n  | \"green\"\n  | \"blue\"\n  | \"magenta\"\n  | \"yellow\";\n\nexport const possibleColors: PlayerColor[] = [\n  \"red\",\n  \"cyan\",\n  \"green\",\n  \"blue\",\n  \"magenta\",\n  \"yellow\",\n];\n","import { RootState } from \"./rootReducer\";\n\nexport const loadState = (key: string) => {\n  try {\n    const serializedState = localStorage.getItem(key);\n    if (serializedState === null) {\n      return {};\n    }\n    const baseState = JSON.parse(serializedState || \"{}\");\n\n    return baseState.present ?? baseState;\n  } catch (err) {\n    console.error(\"problem parsing\");\n    return {};\n  }\n};\n\nexport const saveState = (state: RootState) => {\n  const blacklistStateKeys = [\"cardsData\"];\n  try {\n    Object.entries(state).forEach(([key, value]) => {\n      if (!blacklistStateKeys.includes(key)) {\n        const serializedState = JSON.stringify(value);\n        localStorage.setItem(key, serializedState);\n      }\n    });\n  } catch {\n    // ignore write errors\n    console.error(\"Error writing state to local storage\");\n  }\n};\n","import { GameType } from \"../../constants/app-constants\";\nimport { CardData } from \"../../external-api/common-card-data\";\nimport { loadState } from \"../../store/localStorage\";\nimport { IGameState } from \"../game/initialState\";\n\nexport interface ICardData {\n  [key: string]: CardData;\n}\n\nexport interface CardInSet {\n  code: string;\n  quantity: number;\n}\n\nexport interface Set {\n  name: string;\n  setTypeCode: string;\n  cardsInSet: CardInSet[];\n}\n\nexport interface ISetData {\n  [key: string]: Set;\n}\n\nexport interface ICardsDataState {\n  activeDataType: GameType;\n  data: { [key in GameType]?: IGameCardsDataState };\n}\nexport interface IGameCardsDataState {\n  entities: ICardData;\n  encounterEntities: ICardData;\n  setData: ISetData;\n}\n\nconst queryParams = new URLSearchParams(window.location.search);\nconst queryParamsGameType = queryParams.get(\"gameType\");\n\nconst localGameState: IGameState = loadState(\"game\");\n\nconst gameType = queryParamsGameType ?? localGameState.activeGameType;\n\nexport const initialState: ICardsDataState = {\n  activeDataType: (gameType as GameType) ?? GameType.MarvelChampions,\n  data: {},\n};\n","import { createAction } from \"@reduxjs/toolkit\";\nimport { RootState } from \"./rootReducer\";\n\nexport const resetApp = createAction(\"resetAction\");\n\nexport const receiveRemoteGameState = createAction<RootState>(\n  \"receiveRemoteGameState\"\n);\n\nexport const verifyRemoteGameState = createAction<RootState>(\n  \"verifyRemoteGameState\"\n);\n","import { Vector2d } from \"konva/lib/types\";\nimport {\n  GameType,\n  myPeerRef,\n  PlayerColor,\n} from \"../../constants/app-constants\";\nimport { loadState } from \"../../store/localStorage\";\n\nexport interface IPreviewCard {\n  id: string;\n}\n\nexport interface IGameState {\n  stageZoom: Vector2d;\n  stagePosition: Vector2d;\n  radialMenuPosition: Vector2d | null;\n  playerColors: { [key: string]: PlayerColor };\n  peerId: string;\n  previewCard: IPreviewCard | null;\n  menuPreviewCardJsonId: string | null;\n  activeGameType: GameType | null;\n}\n\nconst queryParams = new URLSearchParams(window.location.search);\nconst queryParamsGameType = queryParams.get(\"gameType\");\n\nconst localStorageState: IGameState = !!queryParamsGameType\n  ? { activeGameType: queryParamsGameType }\n  : loadState(\"game\");\n\nlocalStorageState.playerColors = {};\nlocalStorageState.playerColors[myPeerRef] = \"red\";\nlocalStorageState.peerId = \"\";\nlocalStorageState.previewCard = null;\nlocalStorageState.menuPreviewCardJsonId = null;\nlocalStorageState.radialMenuPosition = null;\n\nconst defaultState: IGameState = {\n  playerColors: {},\n  stageZoom: { x: 0.5, y: 0.5 },\n  stagePosition: { x: 0, y: 0 },\n  peerId: \"\",\n  previewCard: null,\n  menuPreviewCardJsonId: null,\n  activeGameType: null,\n  radialMenuPosition: null,\n};\nexport const initialState: IGameState = {\n  ...defaultState,\n  ...localStorageState,\n};\n","export const cardConstants = {\n  CARD_HEIGHT: 209,\n  CARD_WIDTH: 150,\n  CARD_PREVIEW_HEIGHT: 418,\n  CARD_PREVIEW_WIDTH: 300,\n};\n\nexport enum StatusTokenType {\n  Stunned = \"stunned\",\n  Confused = \"confused\",\n  Tough = \"tough\",\n}\n\nexport enum CounterTokenType {\n  Damage = \"damage\",\n  Threat = \"threat\",\n  Generic = \"generic\",\n}\n","import { CaseReducer, createSlice, PayloadAction } from \"@reduxjs/toolkit\";\nimport { Vector2d } from \"konva/lib/types\";\nimport { GameType, PlayerColor } from \"../../constants/app-constants\";\nimport { receiveRemoteGameState, resetApp } from \"../../store/global.actions\";\nimport { IGameState, initialState } from \"./initialState\";\n\n// Reducers\nconst updateZoomReducer: CaseReducer<IGameState, PayloadAction<Vector2d>> = (\n  state,\n  action\n) => {\n  state.stageZoom = action.payload;\n  return state;\n};\n\nconst updatePositionReducer: CaseReducer<IGameState, PayloadAction<Vector2d>> =\n  (state, action) => {\n    state.stagePosition = action.payload;\n    return state;\n  };\n\nconst connectToRemoteGameReducer: CaseReducer<\n  IGameState,\n  PayloadAction<string>\n> = () => {};\n\nconst setPlayerColorReducer: CaseReducer<\n  IGameState,\n  PayloadAction<{ ref: string; color: PlayerColor }>\n> = (state, action) => {\n  state.playerColors[action.payload.ref] = action.payload.color;\n};\n\nconst setPeerIdReducer: CaseReducer<IGameState, PayloadAction<string>> = (\n  state,\n  action\n) => {\n  state.peerId = action.payload;\n};\n\nconst setPreviewCardIdReducer: CaseReducer<IGameState, PayloadAction<string>> =\n  (state, action) => {\n    if (!state.previewCard) {\n      state.previewCard = { id: action.payload };\n    } else if (state.previewCard.id !== action.payload) {\n      state.previewCard.id = action.payload;\n    }\n  };\n\nconst clearPreviewCardReducer: CaseReducer<IGameState> = (state) => {\n  state.previewCard = null;\n};\n\nconst setMenuPreviewCardJsonIdReducer: CaseReducer<\n  IGameState,\n  PayloadAction<string>\n> = (state, action) => {\n  state.menuPreviewCardJsonId = action.payload;\n};\n\nconst clearMenuPreviewCardJsonIdReducer: CaseReducer<IGameState> = (state) => {\n  state.menuPreviewCardJsonId = null;\n};\n\nconst requestResyncReducer: CaseReducer<IGameState> = () => {};\n\nconst updateActiveGameTypeReducer: CaseReducer<\n  IGameState,\n  PayloadAction<GameType>\n> = (state, action) => {\n  state.activeGameType = action.payload;\n};\n\nconst quitGameReducer: CaseReducer<IGameState> = (state) => {\n  state.activeGameType = null;\n};\n\nconst showRadialMenuAtPositionReducer: CaseReducer<\n  IGameState,\n  PayloadAction<Vector2d>\n> = (state, action) => {\n  state.radialMenuPosition = action.payload;\n};\n\nconst hideRadialMenuReducer: CaseReducer<IGameState> = (state) => {\n  state.radialMenuPosition = null;\n};\n\n// slice\nconst gameSlice = createSlice({\n  name: \"game\",\n  initialState: initialState,\n  reducers: {\n    updateZoom: updateZoomReducer,\n    updatePosition: updatePositionReducer,\n    connectToRemoteGame: connectToRemoteGameReducer,\n    setPlayerColor: setPlayerColorReducer,\n    setPeerId: setPeerIdReducer,\n    requestResync: requestResyncReducer,\n    setPreviewCardId: setPreviewCardIdReducer,\n    clearPreviewCard: clearPreviewCardReducer,\n    setMenuPreviewCardJsonId: setMenuPreviewCardJsonIdReducer,\n    clearMenuPreviewCardJsonId: clearMenuPreviewCardJsonIdReducer,\n    updateActiveGameType: updateActiveGameTypeReducer,\n    quitGame: quitGameReducer,\n    showRadialMenuAtPosition: showRadialMenuAtPositionReducer,\n    hideRadialMenu: hideRadialMenuReducer,\n  },\n  extraReducers: (builder) => {\n    builder.addCase(receiveRemoteGameState, (state, action) => {\n      state.activeGameType = action.payload.game.activeGameType;\n    });\n    builder.addCase(resetApp, (state, action) => {\n      state.stagePosition = { x: 0, y: 0 };\n      state.stageZoom = { x: 0.5, y: 0.5 };\n      state.previewCard = null;\n    });\n  },\n});\n\nexport const {\n  updateZoom,\n  updatePosition,\n  connectToRemoteGame,\n  setPlayerColor,\n  setPeerId,\n  requestResync,\n  setPreviewCardId,\n  clearPreviewCard,\n  setMenuPreviewCardJsonId,\n  clearMenuPreviewCardJsonId,\n  updateActiveGameType,\n  quitGame,\n  showRadialMenuAtPosition,\n  hideRadialMenu,\n} = gameSlice.actions;\n\nexport default gameSlice.reducer;\n","import {\n  createSlice,\n  CaseReducer,\n  PayloadAction,\n  Draft,\n} from \"@reduxjs/toolkit\";\nimport {\n  initialState,\n  ICardsDataState,\n  IGameCardsDataState,\n} from \"./initialState\";\n\n// import * as PackData from \"../../generated/packs\";\n// import { CardData as CardDataLOTR } from \"../../external-api/beorn-json-data\";\nimport {\n  CardData as CardDataMarvel,\n  CardPack as CardPackMarvel,\n} from \"../../external-api/marvel-card-data\";\nimport SetData from \"../../external/marvelsdb-json-data/sets.json\";\nimport Scenarios from \"../../external/ringsteki-json-data/scenarios.json\";\nimport { CardData } from \"../../external-api/common-card-data\";\nimport { GameType } from \"../../constants/app-constants\";\nimport {\n  CardPack as CardPackLOTR,\n  CardData as CardDataLOTR,\n} from \"../../external-api/beorn-json-data\";\nimport { updateActiveGameType } from \"../game/game.slice\";\nimport { receiveRemoteGameState } from \"../../store/global.actions\";\n\n// Utilities\nconst convertMarvelToCommonFormat = (\n  cardMarvelFormat: CardDataMarvel\n): CardData => {\n  const mappedCardData: CardData = {\n    code: cardMarvelFormat.code,\n    name: cardMarvelFormat.name,\n    images: null,\n    octgnId: cardMarvelFormat.octgn_id ?? null,\n    quantity: cardMarvelFormat.quantity,\n    doubleSided: !!cardMarvelFormat.double_sided,\n    backLink: cardMarvelFormat.back_link ?? null,\n    typeCode: cardMarvelFormat.type_code,\n    subTypeCode: null,\n    extraInfo: {\n      setCode: cardMarvelFormat.set_code ?? null,\n      packCode: cardMarvelFormat.pack_code,\n      factionCode: cardMarvelFormat.faction_code,\n    },\n  };\n  return mappedCardData;\n};\n\nconst convertLOTRToCommonFormat = (encounterCard: boolean) => (\n  cardLOTRFormat: CardDataLOTR\n): CardData => {\n  // if (!cardLOTRFormat.RingsDbCardId) {\n  //   console.log(\n  //     `No RingsDB Id for ${cardLOTRFormat.Slug} from ${cardLOTRFormat.CardSet}`\n  //   );\n  // }\n\n  // if (cardLOTRFormat.Front && !cardLOTRFormat.Front.ImagePath) {\n  //   console.log(\n  //     `No Front Image Path for ${cardLOTRFormat.Slug} from ${cardLOTRFormat.CardSet}`\n  //   );\n  // }\n\n  let cardBackImage = cardLOTRFormat.Back?.ImagePath;\n\n  if (cardLOTRFormat.Back && !cardLOTRFormat.Back.ImagePath) {\n    const frontImage = cardLOTRFormat.Front.ImagePath;\n    const frontImageWithoutExtension = frontImage\n      .split(\".\")\n      .slice(0, -1)\n      .join(\".\");\n    if (\n      frontImageWithoutExtension[frontImageWithoutExtension.length - 1] !== \"A\"\n    ) {\n      console.log(\n        `No Non-B Back Image Path for ${cardLOTRFormat.Slug} from ${cardLOTRFormat.CardSet}`\n      );\n    } else {\n      cardBackImage = frontImage.replaceAll(\"A.\", \"B.\");\n    }\n  }\n\n  const mappedCardData: CardData = {\n    code: encounterCard ? cardLOTRFormat.Slug : cardLOTRFormat.RingsDbCardId,\n    name: cardLOTRFormat.Title,\n    images: {\n      front: cardLOTRFormat.Front.ImagePath,\n      back: cardBackImage ?? null,\n    },\n    octgnId: cardLOTRFormat.OctgnGuid ?? null,\n    quantity: cardLOTRFormat.Quantity ?? 1,\n    doubleSided: !!cardLOTRFormat.Back,\n    backLink: null,\n    typeCode: cardLOTRFormat.CardType,\n    subTypeCode: cardLOTRFormat.CardSubType,\n    extraInfo: {\n      setCode: cardLOTRFormat.CardSet ?? null,\n      packCode: \"TODO - lotr\",\n      factionCode: encounterCard ? \"encounter\" : \"player\",\n    },\n  };\n  return mappedCardData;\n};\n\n// Reducers\nconst loadCardsDataReducer: CaseReducer<ICardsDataState> = (state) => {\n  //This reducer is only intended to be called a single time each load.\n  state.data = {};\n  // const heroPacks = Object.entries(PackData)\n  //   .filter(([key, _value]) => !key.includes(\"_encounter\"))\n  //   .map(([key, value]) => (value as unknown) as CardPackMarvel);\n\n  // const encounterPacks = Object.entries(PackData)\n  //   .filter(([key, value]) => key.includes(\"_encounter\"))\n  //   .map(([key, value]) => (value as unknown) as CardPackMarvel);\n\n  // heroPacks.forEach((pack) =>\n  //   pack.map(convertMarvelToCommonFormat).forEach((card: CardData) => {\n  //     if (state.entities[card.code]) {\n  //       console.error(\"Found multiple cards with code \" + card.code);\n  //     }\n\n  //     // if (!card.octgn_id) {\n  //     //   console.error(`Card ${card.code} had no octgn_id!`);\n  //     // }\n\n  //     state.entities[card.code] = card;\n  //   })\n  // );\n\n  // encounterPacks.forEach((pack) =>\n  //   pack.map(convertMarvelToCommonFormat).forEach((card: CardData) => {\n  //     if (state.encounterEntities[card.code]) {\n  //       console.error(\"Found multiple cards with code \" + card.code);\n  //     }\n\n  //     // if (!card.octgn_id) {\n  //     //   console.error(`Card ${card.code}: ${card.name} had no octgn_id!`);\n  //     // }\n\n  //     state.encounterEntities[card.code] = card;\n  //   })\n  // );\n\n  let activeData = state.data[GameType.MarvelChampions];\n  if (!!activeData) {\n    activeData.setData = {};\n  } else {\n    state.data[GameType.MarvelChampions] = {\n      entities: {},\n      encounterEntities: {},\n      setData: {},\n    };\n    activeData = state.data[GameType.MarvelChampions];\n  }\n\n  SetData.forEach((set) => {\n    if (!!activeData) {\n      activeData.setData[set.code] = {\n        name: set.name,\n        setTypeCode: set.card_set_type_code,\n        cardsInSet: [],\n      };\n    }\n  });\n\n  activeData = state.data[GameType.LordOfTheRingsLivingCardGame];\n\n  if (!!activeData) {\n    activeData.setData = {};\n  } else {\n    state.data[GameType.LordOfTheRingsLivingCardGame] = {\n      entities: {},\n      encounterEntities: {},\n      setData: {},\n    };\n    activeData = state.data[GameType.LordOfTheRingsLivingCardGame];\n  }\n\n  Scenarios.forEach((scenario) => {\n    if (!!activeData) {\n      activeData.setData[scenario.Slug] = {\n        name: scenario.Title,\n        setTypeCode: scenario.Product,\n        cardsInSet: [],\n      };\n    }\n  });\n\n  return state;\n};\n\nconst storeCardData = (isPlayerPack: boolean, careAboutDups: boolean) => (cs: {\n  location: Draft<IGameCardsDataState> | undefined;\n  card: CardData;\n}) => {\n  const stateLocation = isPlayerPack\n    ? (cs.location as IGameCardsDataState).entities\n    : (cs.location as IGameCardsDataState).encounterEntities;\n\n  // if (!card.octgn_id) {\n  //   console.error(`Card ${card.code} had no octgn_id!`);\n  // }\n\n  if (!(cs.card.code[0] === \"0\" && cs.card.code[1] === \"0\")) {\n    if (stateLocation[cs.card.code]) {\n      if (careAboutDups) {\n        console.error(\n          \"Found multiple cards with code \" +\n            cs.card.code +\n            \" \" +\n            cs.card.name +\n            \" \" +\n            cs.card.extraInfo.setCode +\n            \" Existing card is \" +\n            stateLocation[cs.card.code].name +\n            \" \" +\n            stateLocation[cs.card.code].extraInfo.setCode\n        );\n      }\n    }\n    stateLocation[cs.card.code] = cs.card;\n  }\n};\n\nconst loadCardsForEncounterSetReducer: CaseReducer<\n  ICardsDataState,\n  PayloadAction<{\n    setCode: string;\n    cards: CardDataLOTR[];\n  }>\n> = (state, action) => {\n  const activeData = state.data[GameType.LordOfTheRingsLivingCardGame];\n  const activeSet = activeData?.setData[action.payload.setCode];\n\n  if (!action.payload.cards.map) {\n    console.log(\"No cards found for scenario \" + action.payload.setCode);\n    return;\n  }\n\n  action.payload.cards\n    .map(convertLOTRToCommonFormat(true))\n    .map((c) => {\n      return {\n        location: state.data[GameType.LordOfTheRingsLivingCardGame],\n        card: c,\n      };\n    })\n    .forEach(storeCardData(false, false));\n\n  if (!!activeSet) {\n    activeSet.cardsInSet = activeSet.cardsInSet.concat(\n      action.payload.cards\n        .filter(\n          (cd) => cd.CardSet.toLocaleLowerCase().indexOf(\"nightmare\") === -1\n        )\n        .map((cd) => {\n          return {\n            code: cd.Slug,\n            quantity: cd.Quantity,\n          };\n        })\n    );\n  }\n\n  return state;\n};\n\nconst loadCardsDataForPackReducer: CaseReducer<\n  ICardsDataState,\n  PayloadAction<{\n    packType: GameType;\n    pack: CardPackMarvel | CardPackLOTR;\n    pack_code: string;\n  }>\n> = (state, action) => {\n  if (!state.data[action.payload.packType]) {\n    state.data[action.payload.packType] = {\n      entities: {},\n      encounterEntities: {},\n      setData: {},\n    };\n  }\n\n  if (action.payload.packType === GameType.MarvelChampions) {\n    //This reducer is only intended to be called a single time each load.\n    const isHeroPack = !action.payload.pack_code.includes(\"_encounter\");\n\n    const pack = action.payload.pack as CardPackMarvel;\n\n    pack\n      .map(convertMarvelToCommonFormat)\n      .map((c) => {\n        return { location: state.data[action.payload.packType], card: c };\n      })\n      .forEach(storeCardData(isHeroPack, true));\n  } else if (\n    action.payload.packType === GameType.LordOfTheRingsLivingCardGame\n  ) {\n    const pack = action.payload.pack as CardPackLOTR;\n    if (!pack.cards) {\n      console.log(pack);\n    }\n    pack.cards\n      .map(convertLOTRToCommonFormat(false))\n      .map((c) => {\n        return { location: state.data[action.payload.packType], card: c };\n      })\n      .forEach(storeCardData(true, true));\n  }\n\n  return state;\n};\n\n// slice\nconst cardsDataSlice = createSlice({\n  name: \"cardsData\",\n  initialState: initialState,\n  reducers: {\n    loadCardsData: loadCardsDataReducer,\n    loadCardsDataForPack: loadCardsDataForPackReducer,\n    loadCardsForEncounterSet: loadCardsForEncounterSetReducer,\n  },\n  extraReducers: (builder) => {\n    builder.addCase(receiveRemoteGameState, (state, action) => {\n      state.activeDataType =\n        action.payload.game.activeGameType ?? GameType.MarvelChampions;\n    });\n    builder.addCase(updateActiveGameType, (state, action) => {\n      state.activeDataType = action.payload;\n    });\n  },\n});\n\nexport const {\n  loadCardsData,\n  loadCardsDataForPack,\n  loadCardsForEncounterSet,\n} = cardsDataSlice.actions;\n\nexport default cardsDataSlice.reducer;\n","import { createAction } from \"@reduxjs/toolkit\";\nimport { Vector2d } from \"konva/lib/types\";\nimport { ICardDetails } from \"./initialState\";\n\nexport interface AddCardStackWithIdPayload {\n  cardJsonIds: string[];\n  position: Vector2d;\n  id: string;\n}\n\nexport interface PullCardOutOfCardStackWithIdPayload {\n  cardStackId: string;\n  jsonId: string;\n  pos: Vector2d;\n  id: string;\n}\n\nexport interface StartCardMoveWithSplitStackIdPayload {\n  id: string;\n  splitTopCard: boolean;\n  splitCardId: string;\n}\n\nexport interface DrawCardsOutOfCardStackWithIdsPayload {\n  cardStackId: string;\n  numberToDraw: number;\n  facedown?: boolean;\n  idsToUse: string[];\n}\n\nexport interface ReplaceCardStackPayload {\n  id: string;\n  newStack: ICardDetails[];\n}\n\nexport interface CreateDeckPayload {\n  position: Vector2d;\n  heroId: string;\n  data: any;\n  dataId: string;\n  extraHeroCards: ICardDetails[];\n  relatedEncounterDeck: string[];\n  encounterDeckId: string;\n  relatedObligationDeck: string[];\n  obligationDeckId: string;\n}\n\nexport const addCardStackWithId =\n  createAction<AddCardStackWithIdPayload>(\"addCardStackWithId\");\n\nexport const pullCardOutOfCardStackWithId =\n  createAction<PullCardOutOfCardStackWithIdPayload>(\n    \"pullCardOutOfCardStackWithId\"\n  );\n\nexport const drawCardsOutOfCardStackWithIds =\n  createAction<DrawCardsOutOfCardStackWithIdsPayload>(\n    \"drawCardsOutOfCardStackWithIds\"\n  );\n\nexport const startCardMoveWithSplitStackId =\n  createAction<StartCardMoveWithSplitStackIdPayload>(\n    \"startCardMoveWithSplitStackId\"\n  );\n\nexport const replaceCardStack =\n  createAction<ReplaceCardStackPayload>(\"replaceCardStack\");\n\nexport const setStackShuffling =\n  createAction<{\n    id: string;\n    shuffling: boolean;\n  }>(\"setStackShuffling\");\n\nexport const createDeckFromTextFileWithIds = createAction<CreateDeckPayload>(\n  \"createDeckFromTextFileWithIds\"\n);\n","import { Vector2d } from \"konva/lib/types\";\n\nexport const getDistance = (point1: Vector2d, point2: Vector2d): number => {\n  const deltaX = point1.x - point2.x;\n  const deltaY = point1.y - point2.y;\n  return Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n};\n\nexport const getCenter = (p1: Vector2d, p2: Vector2d) => {\n  return {\n    x: (p1.x + p2.x) / 2,\n    y: (p1.y + p2.y) / 2,\n  };\n};\n","import { createSelector } from \"@reduxjs/toolkit\";\nimport { CardData } from \"../../external-api/common-card-data\";\nimport { RootState } from \"../../store/rootReducer\";\nimport { ICardsDataState, Set } from \"../cards-data/initialState\";\n\nexport interface IEncounterEntity {\n  setCode: string;\n  setData: Set;\n  cards: CardData[];\n}\n\nconst getCurrentCardData = (cardsData: ICardsDataState) => {\n  return (\n    cardsData.data[cardsData.activeDataType] ?? {\n      entities: {},\n      encounterEntities: {},\n      setData: {},\n    }\n  );\n};\n\nexport const getCardsData = (state: RootState) => state.cardsData;\n\nexport const getCardsDataEntities = createSelector(\n  getCardsData,\n  (cardsData) => {\n    const data = getCurrentCardData(cardsData);\n    return { ...data.entities, ...data.encounterEntities };\n  }\n);\n\nexport const getCardsDataHeroEntities = createSelector(\n  getCardsData,\n  (cardsData) => {\n    const data = getCurrentCardData(cardsData);\n    return data.entities;\n  }\n);\n\nexport const getCardsDataHerosByName = createSelector(\n  getCardsData,\n  (cardsData) => {\n    const data = getCurrentCardData(cardsData);\n    let cardsDataByName: { [key: string]: CardData } = {};\n    Object.values(data.entities).forEach((cd) => {\n      if (cd.typeCode === \"hero\") {\n        cardsDataByName[cd.name] = cd;\n      }\n    });\n    return cardsDataByName;\n  }\n);\n\nexport const getCardsDataPlayerCardsByName = createSelector(\n  getCardsData,\n  (cardsData) => {\n    const data = getCurrentCardData(cardsData);\n    let cardsDataByName: { [key: string]: CardData } = {};\n    Object.values(data.entities).forEach((cd) => {\n      if (cd.typeCode !== \"hero\") {\n        cardsDataByName[cd.name] = cd;\n      }\n    });\n    return cardsDataByName;\n  }\n);\n\nexport const getCardsDataEncounterEntities = createSelector(\n  getCardsData,\n  (cardsData) => {\n    const data = getCurrentCardData(cardsData);\n    return data.encounterEntities;\n  }\n);\n\nexport const getCardsDataSetData = createSelector(getCardsData, (cardsData) => {\n  const data = getCurrentCardData(cardsData);\n  return data.setData;\n});\n\nexport const getCardsDataSetDataAsEncounterEntities = createSelector(\n  getCardsDataSetData,\n  getCardsDataEncounterEntities,\n  (setData, encounterEntities) => {\n    return Object.entries(setData).map(([key, value]) => {\n      const encounterEntity: IEncounterEntity = {\n        setCode: key,\n        setData: value,\n        cards: value.cardsInSet.map((cis) => encounterEntities[cis.code]),\n      };\n\n      return encounterEntity;\n    });\n  }\n);\n\nexport const getCardsDataEncounterEntitiesBySetCode = createSelector(\n  getCardsDataEncounterEntities,\n  getCardsDataHeroEntities,\n  getCardsDataSetData,\n  (encounterEntities, herosData, setData): IEncounterEntity[] => {\n    const setTypesEncounters: { [key: string]: CardData[] } = {};\n\n    const campaignCards = Object.values(herosData).filter(\n      (pc) => pc.extraInfo.factionCode === \"campaign\"\n    );\n\n    Object.values(encounterEntities)\n      .concat(campaignCards)\n      .forEach((encounterCard) => {\n        const setCode = encounterCard.extraInfo.setCode || \"unknown\";\n        if (!!setTypesEncounters[setCode]) {\n          setTypesEncounters[setCode].push(encounterCard);\n        } else {\n          setTypesEncounters[setCode] = [encounterCard];\n        }\n      });\n\n    return Object.entries(setTypesEncounters)\n      .map(([key, value]) => ({\n        setCode: key,\n        setData: setData[key],\n        cards: value,\n      }))\n      .filter(\n        (set) =>\n          set.setData.setTypeCode !== \"nemesis\" &&\n          set.setData.setTypeCode !== \"hero\"\n      )\n      .sort((a, b) => (a.setData.name > b.setData.name ? 1 : -1));\n  }\n);\n","import { createSelector } from \"@reduxjs/toolkit\";\nimport { RootState } from \"../../store/rootReducer\";\nimport { ICardStack } from \"./initialState\";\n\nexport const getCards = (state: RootState) => state.liveState.present.cards;\n\nexport const getCardMapById = createSelector(getCards, (cards) => {\n  return cards.cards.reduce((map: { [k: string]: ICardStack }, card) => {\n    map[card.id] = card;\n    return map;\n  }, {});\n});\n\nexport const cardsSelectedWithPeerRef = (peerRef: string) =>\n  createSelector(getCards, (cards) => {\n    return cards.cards.filter((c) => c.selected && c.controlledBy === peerRef);\n  });\n\nexport const anyCardsSelectedWithPeerRef = (peerRef: string) =>\n  createSelector(getCards, (cards) => {\n    return cards.cards.some((c) => c.selected && c.controlledBy === peerRef);\n  });\n\nexport const getPanMode = (state: RootState) =>\n  state.liveState.present.cards.panMode;\n\nexport const getMultiselectMode = (state: RootState) =>\n  state.liveState.present.cards.multiselectMode;\n\nexport const getDropTargetCardsById = createSelector(getCards, (cards) => {\n  const returnVal: {\n    [key: string]: { ownerRef: string; card: ICardStack | null };\n  } = {};\n  Object.entries(cards.dropTargetCards).forEach(([key, value]) => {\n    if (!!value) {\n      returnVal[value.id] = { ownerRef: key, card: value };\n    }\n  });\n\n  return returnVal;\n});\n","import { ICardDetails } from \"../features/cards/initialState\";\n\n// For some reason, the codes from marvelcdb and the images from cardgamedb can be off\nexport const CARD_PACK_REMAPPING: { [key: string]: string } = {\n  bkw: \"07\",\n  cap: \"04\",\n  drs: \"08\",\n  hlk: \"09\",\n  trors: \"10\",\n  twc: \"03\",\n};\n\n// export const EXTRA_CARDS: { [key: string]: { [key: string]: number } } = {\n//   doctor_strange: {\n//     \"09032\": 1,\n//     \"09033\": 1,\n//     \"09034\": 1,\n//     \"09035\": 1,\n//     \"09036\": 1,\n//   },\n//   ant: {\n//     \"12001c\": 1,\n//   },\n// };\n\nexport const EXTRA_CARDS: { [key: string]: ICardDetails[] } = {\n  doctor_strange: [\n    { jsonId: \"09032\" },\n    { jsonId: \"09033\" },\n    { jsonId: \"09034\" },\n    { jsonId: \"09035\" },\n    { jsonId: \"09036\" },\n  ],\n  ant: [{ jsonId: \"12001c\" }],\n  wsp: [{ jsonId: \"13001c\" }],\n};\n","import { GameType } from \"./app-constants\";\nimport * as React from \"react\";\nimport NewReleasesIcon from \"@material-ui/icons/NewReleases\";\nimport HelpIcon from \"@material-ui/icons/Help\";\nimport SecurityIcon from \"@material-ui/icons/Security\";\nimport { CounterTokenType, StatusTokenType } from \"../constants/card-constants\";\n\nexport interface GameProperties {\n  deckSite: string;\n  decklistApi: string;\n  encounterUiName: string;\n  backgroundImageLocation: string;\n  tokens: {\n    stunned: TokenInfo | null;\n    confused: TokenInfo | null;\n    tough: TokenInfo | null;\n    damage: NumericTokenInfo | null;\n    threat: NumericTokenInfo | null;\n    generic: NumericTokenInfo | null;\n  };\n}\n\nexport interface TokenInfoBase {\n  touchMenuLetter: string | null;\n  touchMenuIcon: JSX.Element | null;\n  menuText: string;\n  imagePath: string;\n}\nexport interface NumericTokenInfo extends TokenInfoBase {\n  isNumeric: boolean;\n  counterTokenType: CounterTokenType;\n}\n\nexport interface TokenInfo extends TokenInfoBase {\n  menuRemoveText: string;\n  tokenType: StatusTokenType;\n}\n\nexport const GamePropertiesMap: { [key in GameType]: GameProperties } = {\n  marvelchampions: {\n    deckSite: \"marvelcdb.com\",\n    decklistApi: \"https://marvelcdb.com/api/public/decklist/\",\n    encounterUiName: \"Encounter Set\",\n    backgroundImageLocation:\n      process.env.PUBLIC_URL + \"/images/table/background_marvelchampions.png\",\n    tokens: {\n      stunned: {\n        tokenType: StatusTokenType.Stunned,\n        touchMenuLetter: null,\n        touchMenuIcon: <NewReleasesIcon fontSize=\"large\"></NewReleasesIcon>,\n        menuText: \"Stun\",\n        menuRemoveText: \"Remove Stun\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/stunned.png\",\n      },\n      confused: {\n        tokenType: StatusTokenType.Confused,\n        touchMenuLetter: null,\n        touchMenuIcon: <HelpIcon fontSize=\"large\"></HelpIcon>,\n        menuText: \"Confuse\",\n        menuRemoveText: \"Remove Confuse\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/confused.png\",\n      },\n      tough: {\n        tokenType: StatusTokenType.Tough,\n        touchMenuLetter: null,\n        touchMenuIcon: <SecurityIcon fontSize=\"large\"></SecurityIcon>,\n        menuText: \"Tough\",\n        menuRemoveText: \"Remove Tough\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/tough.png\",\n      },\n      damage: {\n        counterTokenType: CounterTokenType.Damage,\n        isNumeric: true,\n        touchMenuLetter: \"D\",\n        touchMenuIcon: null,\n        menuText: \"Set Damage\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/damage.png\",\n      },\n      threat: {\n        counterTokenType: CounterTokenType.Threat,\n        isNumeric: true,\n        touchMenuLetter: \"T\",\n        touchMenuIcon: null,\n        menuText: \"Set Threat\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/threat.png\",\n      },\n      generic: {\n        counterTokenType: CounterTokenType.Generic,\n        isNumeric: true,\n        touchMenuLetter: \"G\",\n        touchMenuIcon: null,\n        menuText: \"Set Generic Tokens\",\n        imagePath:\n          process.env.PUBLIC_URL + \"/images/standard/generic_counter.png\",\n      },\n    },\n  },\n  lotrlcg: {\n    deckSite: \"ringsdb.com\",\n    decklistApi: \"https://ringsdb.com/api/public/decklist/\",\n    encounterUiName: \"Scenario\",\n    backgroundImageLocation:\n      process.env.PUBLIC_URL + \"/images/table/background_lotrlcg.jpg\",\n    tokens: {\n      stunned: {\n        tokenType: StatusTokenType.Stunned,\n        touchMenuLetter: \"Q\",\n        touchMenuIcon: null,\n        menuText: \"Quest\",\n        menuRemoveText: \"Remove From Quest\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/quest.png\",\n      },\n      confused: null,\n      tough: null,\n      damage: {\n        counterTokenType: CounterTokenType.Damage,\n        isNumeric: true,\n        touchMenuLetter: \"D\",\n        touchMenuIcon: null,\n        menuText: \"Set Damage\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/damage_lotr.png\",\n      },\n      threat: {\n        counterTokenType: CounterTokenType.Threat,\n        isNumeric: true,\n        touchMenuLetter: \"P\",\n        touchMenuIcon: null,\n        menuText: \"Set Progress\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/progress.png\",\n      },\n      generic: {\n        counterTokenType: CounterTokenType.Generic,\n        isNumeric: true,\n        touchMenuLetter: \"R\",\n        touchMenuIcon: null,\n        menuText: \"Set Resource Tokens\",\n        imagePath: process.env.PUBLIC_URL + \"/images/standard/resource.png\",\n      },\n    },\n  },\n};\n","import { Action, createAsyncThunk, ThunkAction } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport { Vector2d } from \"konva/lib/types\";\nimport { RootState } from \"../../store/rootReducer\";\nimport {\n  getCardsDataEncounterEntities,\n  getCardsDataHeroEntities,\n  getCardsDataHerosByName,\n  getCardsDataPlayerCardsByName,\n} from \"../cards-data/cards-data.selectors\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport {\n  addCardStackWithId,\n  createDeckFromTextFileWithIds,\n  drawCardsOutOfCardStackWithIds,\n  pullCardOutOfCardStackWithId,\n  replaceCardStack,\n  setStackShuffling,\n  startCardMoveWithSplitStackId,\n} from \"./cards.actions\";\nimport { ICardDetails, ICardStack } from \"./initialState\";\nimport { getCards } from \"./cards.selectors\";\nimport { EXTRA_CARDS } from \"../../constants/card-pack-mapping\";\nimport { GameType, myPeerRef } from \"../../constants/app-constants\";\nimport { GamePropertiesMap } from \"../../constants/game-type-properties-mapping\";\nimport { convertMarvelTxtToDeckInfo } from \"../../utilities/marvel-txt-converter\";\n\ninterface AddCardStackPayload {\n  cardJsonIds: string[];\n  position: Vector2d;\n}\n\nexport interface PullCardOutOfCardStackPayload {\n  cardStackId: string;\n  jsonId: string;\n  pos: Vector2d;\n}\n\nexport interface StartCardMovePayload {\n  id: string;\n  splitTopCard: boolean;\n}\n\nexport interface DrawCardsOutOfCardStackPayload {\n  cardStackId: string;\n  numberToDraw: number;\n  facedown?: boolean;\n}\n\nexport const shuffleStack =\n  (id?: string): ThunkAction<void, RootState, unknown, Action<string>> =>\n  (dispatch, getState) => {\n    const cardsState = getCards(getState());\n    const stacksToShuffle = !!id\n      ? [cardsState.cards.find((c) => c.id === id)]\n      : cardsState.cards.filter(\n          (c) => c.selected && c.controlledBy === myPeerRef\n        );\n\n    stacksToShuffle\n      .filter((s): s is ICardStack => !!s && s.cardStack.length > 1)\n      .forEach((stackToShuffle) => {\n        dispatch(setStackShuffling({ id: stackToShuffle.id, shuffling: true }));\n        const shuffledStack = shuffle(stackToShuffle.cardStack);\n        dispatch(\n          replaceCardStack({ id: stackToShuffle.id, newStack: shuffledStack })\n        );\n\n        // We have to do a setTimeout here, because if we do it in this event loop,\n        // the overall change for this card is nothing for the shuffling param\n        setTimeout(() => {\n          dispatch(\n            setStackShuffling({ id: stackToShuffle.id, shuffling: false })\n          );\n        });\n      });\n  };\n\nexport const addCardStack =\n  (\n    payload: AddCardStackPayload\n  ): ThunkAction<void, RootState, unknown, Action<string>> =>\n  (dispatch) => {\n    const payloadWithId = {\n      ...payload,\n      id: uuidv4(),\n    };\n    dispatch(addCardStackWithId(payloadWithId));\n  };\n\nexport const pullCardOutOfCardStack =\n  (\n    payload: PullCardOutOfCardStackPayload\n  ): ThunkAction<void, RootState, unknown, Action<string>> =>\n  (dispatch) => {\n    const payloadWithId = {\n      ...payload,\n      id: uuidv4(),\n    };\n    dispatch(pullCardOutOfCardStackWithId(payloadWithId));\n  };\n\nexport const startCardMove =\n  (\n    payload: StartCardMovePayload\n  ): ThunkAction<void, RootState, unknown, Action<string>> =>\n  (dispatch) => {\n    const payloadWithId = {\n      ...payload,\n      splitCardId: uuidv4(),\n    };\n    dispatch(startCardMoveWithSplitStackId(payloadWithId));\n  };\n\nexport const drawCardsOutOfCardStack =\n  (\n    payload: DrawCardsOutOfCardStackPayload\n  ): ThunkAction<void, RootState, unknown, Action<string>> =>\n  (dispatch) => {\n    const possibleIds = Array.from({ length: payload.numberToDraw }).map((_i) =>\n      uuidv4()\n    );\n    const payloadWithIds = {\n      ...payload,\n      idsToUse: possibleIds,\n    };\n    dispatch(drawCardsOutOfCardStackWithIds(payloadWithIds));\n  };\n\nexport const createDeckFromTxt =\n  (payload: {\n    gameType: GameType;\n    position: Vector2d;\n    txtContents: string;\n  }): ThunkAction<void, RootState, unknown, Action<string>> =>\n  (dispatch, getState) => {\n    if (payload.gameType === GameType.MarvelChampions) {\n      const heroCardsDataByName = getCardsDataHerosByName(getState());\n      const playerCardsDataByName = getCardsDataPlayerCardsByName(getState());\n      dispatch(\n        createDeckFromTextFileWithIds(\n          getMarvelCards(\n            convertMarvelTxtToDeckInfo(\n              heroCardsDataByName,\n              playerCardsDataByName,\n              payload.position,\n              payload.txtContents\n            ),\n            getState(),\n            {\n              gameType: payload.gameType,\n              decklistId: -1,\n              position: payload.position,\n            }\n          )\n        )\n      );\n    }\n  };\n\nexport const fetchDecklistById = createAsyncThunk(\n  \"decklist/fetchByIdStatus\",\n  async (\n    payload: { gameType: GameType; decklistId: number; position: Vector2d },\n    thunkApi\n  ) => {\n    const response = await axios.get(\n      `${GamePropertiesMap[payload.gameType].decklistApi}${payload.decklistId}`\n    );\n    const state: RootState = thunkApi.getState() as RootState;\n\n    switch (payload.gameType) {\n      case GameType.MarvelChampions:\n        return getMarvelCards(response, state, payload);\n      case GameType.LordOfTheRingsLivingCardGame:\n        return getLOTRCards(response, state, payload);\n    }\n  }\n);\n\nconst getMarvelCards = (\n  response: any,\n  state: RootState,\n  payload: { gameType: GameType; decklistId: number; position: Vector2d }\n) => {\n  const heroCardsData = getCardsDataHeroEntities(state);\n  const heroSet = heroCardsData[response.data.investigator_code];\n  const heroSetCode = heroSet.extraInfo.setCode;\n  const encounterCardsData = getCardsDataEncounterEntities(state);\n\n  let heroObligationDeck: string[] = [];\n  Object.entries(encounterCardsData)\n    .filter(\n      ([_key, value]) =>\n        (value.extraInfo.setCode === `${heroSetCode}` ||\n          value.extraInfo.setCode === `${heroSetCode}_nemesis`) &&\n        value.typeCode === \"obligation\"\n    )\n    .forEach(([key, value]) => {\n      heroObligationDeck = heroObligationDeck.concat(\n        Array.from({ length: value.quantity }).map((_i) => key)\n      );\n    });\n\n  // get the encounter cards for this deck\n  const heroEncounterDeckData = Object.values(encounterCardsData).filter(\n    (value) =>\n      value.extraInfo.setCode === `${heroSetCode}_nemesis` &&\n      value.typeCode !== \"obligation\"\n  );\n\n  let heroEncounterDeck: string[] = [];\n  heroEncounterDeckData.forEach((cd) => {\n    heroEncounterDeck = heroEncounterDeck.concat(\n      Array.from({ length: cd.quantity }).map((_i) => cd.code)\n    );\n  });\n\n  // check to see if there are any special extra cards for this hero\n  const extraCards = EXTRA_CARDS[heroSetCode ?? \"\"] ?? [];\n\n  // response.data.slots = { ...extraCards, ...response.data.slots };\n\n  return {\n    position: payload.position,\n    heroId: uuidv4(),\n    data: response.data,\n    dataId: uuidv4(),\n    extraHeroCards: extraCards,\n    relatedEncounterDeck: heroEncounterDeck,\n    encounterDeckId: uuidv4(),\n    relatedObligationDeck: heroObligationDeck,\n    obligationDeckId: uuidv4(),\n  };\n};\n\nconst getLOTRCards = (\n  response: any,\n  state: RootState,\n  payload: { gameType: GameType; decklistId: number; position: Vector2d }\n) => {\n  const heroCardsData = getCardsDataHeroEntities(state);\n\n  let heroStack: ICardDetails[] = [];\n\n  Object.entries(response.data.heroes).forEach(([key, value]) => {\n    const cardDetails: ICardDetails[] = Array.from(Array(value).keys()).map(\n      (): ICardDetails => ({ jsonId: key })\n    );\n    heroStack = heroStack.concat(cardDetails);\n  });\n\n  const newSlots: { [key: string]: number } = {};\n\n  Object.entries(response.data.slots).forEach(([key, value]) => {\n    //get the card data to make sure it's not a hero\n    const cardData = heroCardsData[key];\n    if (!cardData) {\n      throw new Error(`Couldn't find card data for ${key}`);\n    }\n\n    if (cardData.typeCode !== \"Hero\") {\n      newSlots[key] = value as number;\n    }\n  });\n\n  response.data.slots = newSlots;\n\n  return {\n    position: payload.position,\n    heroId: uuidv4(),\n    data: response.data,\n    dataId: uuidv4(),\n    extraHeroCards: heroStack,\n    relatedEncounterDeck: [],\n    encounterDeckId: uuidv4(),\n    relatedObligationDeck: [],\n    obligationDeckId: uuidv4(),\n  };\n};\n\nconst shuffle = (array: ICardDetails[]): ICardDetails[] => {\n  const returnArray = JSON.parse(JSON.stringify(array));\n  var currentIndex = returnArray.length,\n    temporaryValue,\n    randomIndex;\n\n  // While there remain elements to shuffle...\n  while (0 !== currentIndex) {\n    // Pick a remaining element...\n    randomIndex = Math.floor(Math.random() * currentIndex);\n    currentIndex -= 1;\n\n    // And swap it with the current element.\n    temporaryValue = returnArray[currentIndex];\n    returnArray[currentIndex] = returnArray[randomIndex];\n    returnArray[randomIndex] = temporaryValue;\n  }\n\n  return returnArray;\n};\n","import { loadState } from \"../../store/localStorage\";\nimport {\n  CounterTokenType,\n  StatusTokenType,\n} from \"../../constants/card-constants\";\nimport * as jc from \"jsoncrush\";\n\nexport interface ICardStack {\n  controlledBy: string;\n  dragging: boolean;\n  shuffling: boolean;\n  exhausted: boolean;\n  faceup: boolean;\n  fill: string;\n  id: string;\n  selected: boolean;\n  x: number;\n  y: number;\n  cardStack: ICardDetails[];\n  statusTokens: {\n    [K in StatusTokenType]: boolean;\n  };\n  counterTokens: {\n    [K in CounterTokenType]: number;\n  };\n}\n\nexport interface ICardDetails {\n  jsonId: string;\n}\n\nexport interface ICardsState {\n  outOfSyncWithRemote: boolean;\n  cards: ICardStack[];\n  ghostCards: ICardStack[];\n  dropTargetCards: { [key: string]: ICardStack | null };\n  attachTargetCards: { [key: string]: ICardStack | null };\n  panMode: boolean;\n  multiselectMode: boolean;\n}\n\nconst queryParams = new URLSearchParams(window.location.search);\nconst queryParamsCardsString = queryParams.get(\"cards\");\nconst queryParamsCards = !!queryParamsCardsString\n  ? { cards: JSON.parse(jc.JSONUncrush(queryParamsCardsString)) }\n  : null;\n\nconst localStorageState: ICardsState =\n  queryParamsCards || (loadState(\"liveState\")?.cards ?? {});\n\n// Make sure initially, none of the cards are \"owned\" / \"selected\" / \"shuffling\"\nif (!!localStorageState.cards) {\n  localStorageState.cards.forEach((c) => {\n    c.controlledBy = \"\";\n    c.selected = false;\n    c.shuffling = false;\n  });\n}\n\nlocalStorageState.attachTargetCards = {};\nlocalStorageState.dropTargetCards = {};\nlocalStorageState.ghostCards = [];\nlocalStorageState.outOfSyncWithRemote = false;\n\nconst defaultState: ICardsState = {\n  outOfSyncWithRemote: false,\n  cards: [],\n  ghostCards: [],\n  dropTargetCards: {},\n  attachTargetCards: {},\n  panMode: true,\n  multiselectMode: false,\n};\n\nexport const initialState: ICardsState = {\n  ...defaultState,\n  ...localStorageState,\n};\n","import isEqual from \"lodash.isequal\";\nimport {\n  CaseReducer,\n  createSlice,\n  Draft,\n  original,\n  PayloadAction,\n} from \"@reduxjs/toolkit\";\nimport { Vector2d } from \"konva/lib/types\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport {\n  cardConstants,\n  CounterTokenType,\n  StatusTokenType,\n} from \"../../constants/card-constants\";\nimport {\n  receiveRemoteGameState,\n  resetApp,\n  verifyRemoteGameState,\n} from \"../../store/global.actions\";\nimport { getDistance } from \"../../utilities/geo\";\nimport {\n  addCardStackWithId,\n  createDeckFromTextFileWithIds,\n  CreateDeckPayload,\n  drawCardsOutOfCardStackWithIds,\n  pullCardOutOfCardStackWithId,\n  replaceCardStack,\n  setStackShuffling,\n  startCardMoveWithSplitStackId,\n} from \"./cards.actions\";\nimport { fetchDecklistById } from \"./cards.thunks\";\nimport {\n  ICardDetails,\n  ICardsState,\n  ICardStack,\n  initialState,\n} from \"./initialState\";\n\nconst CARD_DROP_TARGET_DISTANCE = 30;\nconst CARD_ATTACH_TARGET_MIN_DISTANCE = 50;\nconst CARD_ATTACH_TARGET_MAX_DISTANCE = 150;\n\n// Helper methods\nconst getCardStackWithId = (\n  state: ICardsState,\n  id: string\n): ICardStack | undefined => {\n  return state.cards.find((card) => card.id === id);\n};\n\nconst mutateCardWithId = (\n  state: ICardsState,\n  id: string,\n  ref: string,\n  callback: (card: ICardStack) => void\n) => {\n  const cardToUpdate = getCardStackWithId(state, id);\n  if (\n    cardToUpdate &&\n    (cardToUpdate.controlledBy === \"\" || cardToUpdate.controlledBy === ref)\n  ) {\n    callback(cardToUpdate);\n  }\n};\n\nconst foreachSelectedAndControlledCard = (\n  state: ICardsState,\n  actorRef: string,\n  callback: (card: ICardStack) => void\n) => {\n  state.cards\n    .filter((card) => card.selected && card.controlledBy === actorRef)\n    .forEach((card) => callback(card));\n};\n\nconst foreachUnselectedCard = (\n  state: ICardsState,\n  callback: (card: ICardStack) => void\n) => {\n  state.cards\n    .filter((card) => !card.selected)\n    .forEach((card) => callback(card));\n};\n\n// Reducers\nconst selectCardReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{ id: string; unselectOtherCards: boolean }>\n> = (state, action) => {\n  if (action.payload.unselectOtherCards) {\n    unselectAllCardsReducer(state, action);\n  }\n\n  mutateCardWithId(\n    state,\n    action.payload.id,\n    (action as any).ACTOR_REF,\n    (card) => {\n      card.selected = true;\n      card.controlledBy = (action as any).ACTOR_REF;\n    }\n  );\n};\n\nconst unselectCardReducer: CaseReducer<ICardsState, PayloadAction<string>> = (\n  state,\n  action\n) => {\n  mutateCardWithId(state, action.payload, (action as any).ACTOR_REF, (card) => {\n    card.selected = false;\n    card.controlledBy = \"\";\n  });\n};\n\nconst toggleSelectCardReducer: CaseReducer<ICardsState, PayloadAction<string>> =\n  (state, action) => {\n    mutateCardWithId(\n      state,\n      action.payload,\n      (action as any).ACTOR_REF,\n      (card) => {\n        card.selected = !card.selected;\n        if (!card.selected) {\n          card.controlledBy = \"\";\n        } else {\n          card.controlledBy = (action as any).ACTOR_REF;\n        }\n      }\n    );\n  };\n\nconst exhaustCardReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<string | undefined>\n> = (state, action) => {\n  state.cards\n    .filter(\n      (card) =>\n        card.controlledBy === (action as any).ACTOR_REF &&\n        (card.id === (action.payload ?? \"\") || card.selected)\n    )\n    .forEach((card) => {\n      card.exhausted = !card.exhausted;\n    });\n};\n\nconst clearCardTokensReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<string | undefined>\n> = (state, action) => {\n  state.cards\n    .filter(\n      (card) =>\n        card.controlledBy === (action as any).ACTOR_REF &&\n        (card.id === (action.payload ?? \"\") || card.selected)\n    )\n    .forEach((card) => {\n      card.statusTokens = {\n        tough: false,\n        stunned: false,\n        confused: false,\n      };\n\n      card.counterTokens = {\n        damage: 0,\n        threat: 0,\n        generic: 0,\n      };\n    });\n};\n\nconst getAttachDrawPos = (\n  state: Draft<ICardsState>,\n  baseCard: ICardStack\n): Vector2d => {\n  let drawPos = { x: 0, y: 0 };\n  let takenSpace = true;\n  for (let i = 0; takenSpace; i++) {\n    const xToDraw = baseCard.x + (i + 1) * 50;\n    const yToDraw = baseCard.y - (i + 1) * 50;\n\n    drawPos = { x: xToDraw, y: yToDraw };\n\n    //Check for existing card\n    takenSpace = !!state.cards.find((c) => c.x === xToDraw && c.y === yToDraw);\n  }\n  return drawPos;\n};\n\nconst cardMoveReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{ id: string; dx: number; dy: number }>\n> = (state, action) => {\n  const movedCards: ICardStack[] = [];\n\n  let primaryCard: ICardStack | null = null;\n\n  state.cards\n    .filter(\n      (card) =>\n        card.id === action.payload.id ||\n        (card.selected && card.controlledBy === (action as any).ACTOR_REF)\n    )\n    .forEach((card) => {\n      if (card.id === action.payload.id) {\n        primaryCard = card;\n      }\n\n      card.x += action.payload.dx;\n      card.y += action.payload.dy;\n\n      movedCards.push(card);\n    });\n\n  // go through and find if any unselected cards are potential drop targets\n  // If so, get the closest one. But only if the card is owned / controlled by us\n  const possibleDropTargets: { distance: number; card: ICardStack }[] = [];\n  if (\n    !!primaryCard &&\n    (primaryCard as ICardStack).controlledBy === (action as any).ACTOR_REF\n  ) {\n    foreachUnselectedCard(state, (card) => {\n      const distance = getDistance(\n        { x: card.x, y: card.y },\n        !!primaryCard ? { x: primaryCard.x, y: primaryCard.y } : { x: 0, y: 0 }\n      );\n      if (distance < CARD_DROP_TARGET_DISTANCE) {\n        possibleDropTargets.push({\n          distance,\n          card,\n        });\n      }\n    });\n  }\n\n  state.dropTargetCards[(action as any).ACTOR_REF] =\n    possibleDropTargets.sort((c1, c2) => c1.distance - c2.distance)[0]?.card ??\n    null;\n\n  // go through and find if any unselected cards are potential attach targets\n  // If so, get the closest one. But only if the card is owned / controlled by us\n  const possibleAttachTargets: { distance: number; card: ICardStack }[] = [];\n  if (\n    !!primaryCard &&\n    (primaryCard as ICardStack).controlledBy === (action as any).ACTOR_REF\n  ) {\n    foreachUnselectedCard(state, (card) => {\n      const distance = getDistance(\n        !!primaryCard ? { x: primaryCard.x, y: primaryCard.y } : { x: 0, y: 0 },\n        { x: card.x, y: card.y }\n      );\n      if (\n        distance < CARD_ATTACH_TARGET_MAX_DISTANCE &&\n        distance > CARD_ATTACH_TARGET_MIN_DISTANCE &&\n        card.x < (primaryCard?.x ?? 0) &&\n        card.y > (primaryCard?.y ?? 0)\n      ) {\n        possibleAttachTargets.push({\n          distance,\n          card,\n        });\n      }\n    });\n  }\n\n  state.attachTargetCards[(action as any).ACTOR_REF] =\n    possibleAttachTargets.sort((c1, c2) => c1.distance - c2.distance)[0]\n      ?.card ?? null;\n\n  const attachTarget = state.attachTargetCards[(action as any).ACTOR_REF];\n  if (!!attachTarget) {\n    // First, figure out where we should draw the ghost card. Keep moving up\n    // and to the right until there's not a card there\n\n    const drawPos = getAttachDrawPos(state, attachTarget);\n\n    // Next, check if there's already a ghost card where we were going to draw\n    const existingGhostCard = state.ghostCards.find(\n      (gc) =>\n        gc.x === drawPos.x &&\n        gc.y === drawPos.y &&\n        gc.cardStack.length > 0 &&\n        gc.cardStack[0].jsonId === \"-1\"\n    );\n    if (!existingGhostCard) {\n      const attachGhostCard: ICardStack = JSON.parse(\n        JSON.stringify(attachTarget)\n      );\n      // In general we don't want to do this (generate ids in here) but since this is just a temporary ghost card that we won't\n      // ever refer to by id, it should be safe.\n      attachGhostCard.id = uuidv4();\n      attachGhostCard.x = drawPos.x;\n      attachGhostCard.y = drawPos.y;\n      attachGhostCard.cardStack = [{ jsonId: \"-1\" }];\n      state.ghostCards.push(attachGhostCard);\n    }\n  } else {\n    // remove all 'attachment' ghost cards\n    state.ghostCards = state.ghostCards.filter(\n      (gc) => gc.cardStack.length > 0 && gc.cardStack[0].jsonId !== \"-1\"\n    );\n  }\n\n  // put the moved cards at the end. TODO: we could just store the move order or move time\n  // or something, and the array could be a selector\n  movedCards.forEach((movedCard) => {\n    state.cards.push(state.cards.splice(state.cards.indexOf(movedCard), 1)[0]);\n  });\n};\n\nconst endCardMoveReducer: CaseReducer<ICardsState, PayloadAction<string>> = (\n  state,\n  action\n) => {\n  let dropTargetCards: ICardDetails[] = [];\n  let attachTargetCardStacks: ICardStack[] = [];\n  state.cards\n    .filter(\n      (card) =>\n        card.id === action.payload ||\n        (card.selected && card.controlledBy === (action as any).ACTOR_REF)\n    )\n    .forEach((card) => {\n      card.dragging = false;\n\n      if (!!state.attachTargetCards[(action as any).ACTOR_REF]) {\n        attachTargetCardStacks.push(card);\n      } else if (!!state.dropTargetCards[(action as any).ACTOR_REF]) {\n        // Add the cards to the drop Target card stack\n        dropTargetCards = dropTargetCards.concat(card.cardStack);\n      }\n    });\n\n  const attachTarget = state.attachTargetCards[(action as any).ACTOR_REF];\n  if (!!attachTarget) {\n    const drawPos = getAttachDrawPos(state, attachTarget);\n\n    attachTargetCardStacks.forEach((cs, index) => {\n      cs.x = drawPos.x + index * 50;\n      cs.y = drawPos.y - index * 50;\n      state.cards.unshift(state.cards.splice(state.cards.indexOf(cs), 1)[0]);\n    });\n    // Now, if there was a drop target card, remove all those cards from the state\n  } else if (!!state.dropTargetCards[(action as any).ACTOR_REF]) {\n    state.cards = state.cards.filter(\n      (card) =>\n        !(\n          card.id === action.payload ||\n          (card.selected && card.controlledBy === (action as any).ACTOR_REF)\n        )\n    );\n\n    const dropTargetCard = state.cards.find(\n      (card) => card.id === state.dropTargetCards[(action as any).ACTOR_REF]?.id\n    );\n    if (!!dropTargetCard && dropTargetCards.length > 0) {\n      // add the cards we've collected to the top of the stack\n      dropTargetCard.cardStack = dropTargetCards.concat(\n        dropTargetCard.cardStack\n      );\n    }\n  }\n\n  state.ghostCards = [];\n  state.dropTargetCards[(action as any).ACTOR_REF] = null;\n  state.attachTargetCards[(action as any).ACTOR_REF] = null;\n};\n\nconst selectMultipleCardsReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{ ids: string[] }>\n> = (state, action) => {\n  action.payload.ids\n    .map((id) => state.cards.find((card) => card.id === id))\n    .forEach((card) => {\n      if (\n        card &&\n        (card.controlledBy === \"\" ||\n          card.controlledBy === (action as any).ACTOR_REF)\n      ) {\n        card.selected = true;\n        card.controlledBy = (action as any).ACTOR_REF;\n      }\n    });\n};\n\nconst unselectAllCardsReducer: CaseReducer<ICardsState, PayloadAction<any>> = (\n  state,\n  action\n) => {\n  state.cards\n    .filter(\n      (card) =>\n        card.controlledBy === \"\" ||\n        card.controlledBy === (action as any).ACTOR_REF\n    )\n    .forEach((card) => {\n      card.selected = false;\n      card.controlledBy = \"\";\n    });\n};\n\nconst togglePanModeReducer: CaseReducer<ICardsState> = (state) => {\n  state.panMode = !state.panMode;\n};\n\nconst toggleMultiselectModeReducer: CaseReducer<ICardsState> = (state) => {\n  state.multiselectMode = !state.multiselectMode;\n};\n\nconst flipCardsReducer: CaseReducer<ICardsState> = (state, action) => {\n  state.cards\n    .filter(\n      (card) =>\n        card.selected &&\n        (card.controlledBy === \"\" ||\n          card.controlledBy === (action as any).ACTOR_REF)\n    )\n    .forEach((card) => {\n      card.faceup = !card.faceup;\n      card.cardStack = card.cardStack.reverse();\n    });\n};\n\nconst resetCardsReducer: CaseReducer<ICardsState> = (state) => {\n  state.cards = [];\n};\n\nconst toggleTokenReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{ id?: string; tokenType: StatusTokenType; value?: boolean }>\n> = (state, action) => {\n  const cardToToggle = state.cards.find((c) => c.id === action.payload.id);\n  if (!!cardToToggle) {\n    if (action.payload.value !== undefined) {\n      cardToToggle.statusTokens[action.payload.tokenType] =\n        action.payload.value;\n    } else {\n      cardToToggle.statusTokens[action.payload.tokenType] =\n        !cardToToggle.statusTokens[action.payload.tokenType];\n    }\n  } else {\n    foreachSelectedAndControlledCard(\n      state,\n      (action as any).ACTOR_REF,\n      (card) => {\n        if (action.payload.value !== undefined) {\n          card.statusTokens[action.payload.tokenType] = action.payload.value;\n        } else {\n          card.statusTokens[action.payload.tokenType] =\n            !card.statusTokens[action.payload.tokenType];\n        }\n      }\n    );\n  }\n};\n\nconst adjustCounterTokenReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{\n    id?: string;\n    tokenType: CounterTokenType;\n    delta?: number;\n    value?: number;\n  }>\n> = (state, action) => {\n  let cardsToToggle = state.cards.filter(\n    (c) =>\n      (!!action.payload.id && action.payload.id === c.id) ||\n      (c.selected && c.controlledBy === (action as any).ACTOR_REF)\n  );\n\n  cardsToToggle.forEach((c) => {\n    if (action.payload.value !== undefined) {\n      c.counterTokens[action.payload.tokenType] = action.payload.value;\n    } else if (action.payload.delta !== undefined) {\n      c.counterTokens[action.payload.tokenType] += action.payload.delta;\n    }\n    if (c.counterTokens[action.payload.tokenType] < 0) {\n      c.counterTokens[action.payload.tokenType] = 0;\n    }\n  });\n};\n// Selectors\n\n// slice\nconst cardsSlice = createSlice({\n  name: \"cards\",\n  initialState: initialState,\n  reducers: {\n    selectCard: selectCardReducer,\n    unselectCard: unselectCardReducer,\n    toggleSelectCard: toggleSelectCardReducer,\n    exhaustCard: exhaustCardReducer,\n    cardMove: cardMoveReducer,\n    endCardMove: endCardMoveReducer,\n    selectMultipleCards: selectMultipleCardsReducer,\n    unselectAllCards: unselectAllCardsReducer,\n    togglePanMode: togglePanModeReducer,\n    toggleMultiselectMode: toggleMultiselectModeReducer,\n    flipCards: flipCardsReducer,\n    resetCards: resetCardsReducer,\n    toggleToken: toggleTokenReducer,\n    adjustCounterToken: adjustCounterTokenReducer,\n    clearCardTokens: clearCardTokensReducer,\n  },\n  extraReducers: (builder) => {\n    builder.addCase(receiveRemoteGameState, (state, action) => {\n      // TODO: find a way to keep this automatic\n      state.cards = action.payload.liveState.present.cards.cards;\n      state.ghostCards = action.payload.liveState.present.cards.ghostCards;\n    });\n\n    builder.addCase(verifyRemoteGameState, (state, action) => {\n      state.outOfSyncWithRemote = !(\n        isEqual(\n          original(state.cards)?.filter((c) => !c.dragging),\n          action.payload.liveState.present.cards.cards.filter(\n            (c) => !c.dragging\n          )\n        ) &&\n        isEqual(\n          original(state.ghostCards),\n          action.payload.liveState.present.cards.ghostCards\n        )\n      );\n\n      if (state.outOfSyncWithRemote) {\n        console.error(\n          \"CARDS state is out of synce with remote!!!\",\n          original(state),\n          action.payload.liveState.present.cards\n        );\n      } else {\n        console.log(\"CARDS state is in sync\");\n      }\n    });\n\n    builder.addCase(replaceCardStack, (state, action) => {\n      const cardToReplaceStack = state.cards.find(\n        (c) => c.id === action.payload.id\n      );\n      if (!!cardToReplaceStack) {\n        cardToReplaceStack.cardStack = action.payload.newStack;\n      }\n    });\n\n    builder.addCase(resetApp, (state) => {\n      state.cards = [];\n      // state.previewCard = null;\n      state.dropTargetCards = {};\n      state.ghostCards = [];\n      state.panMode = true;\n    });\n\n    builder.addCase(addCardStackWithId, (state, action) => {\n      const newStack: ICardStack = {\n        controlledBy: \"\",\n        x: action.payload.position.x,\n        y: action.payload.position.y,\n        dragging: false,\n        shuffling: false,\n        exhausted: false,\n        faceup: true,\n        fill: \"red\",\n        id: action.payload.id,\n        cardStack: action.payload.cardJsonIds.map((jsonId) => ({\n          jsonId,\n        })),\n        selected: false,\n        statusTokens: {\n          stunned: false,\n          confused: false,\n          tough: false,\n        },\n        counterTokens: {\n          damage: 0,\n          threat: 0,\n          generic: 0,\n        },\n      };\n\n      state.cards.push(newStack);\n    });\n\n    builder.addCase(pullCardOutOfCardStackWithId, (state, action) => {\n      const cardStackToUse = state.cards.find(\n        (c) => c.id === action.payload.cardStackId\n      );\n      if (!!cardStackToUse && cardStackToUse.cardStack.length > 1) {\n        const newCardStack: ICardDetails[] = [\n          { jsonId: action.payload.jsonId },\n        ];\n        const newCard = Object.assign({}, cardStackToUse, {\n          cardStack: newCardStack,\n        });\n        newCard.id = action.payload.id;\n        newCard.selected = true;\n        newCard.controlledBy = (action as any).ACTOR_REF;\n        newCard.x = newCard.x + cardConstants.CARD_WIDTH + 5;\n\n        // Find the first instance of the card with the json id. Note that because there\n        // might be multiple cards with the same json id, we can't just do a filter\n        const cardIndexToRemove = cardStackToUse.cardStack.findIndex(\n          (c) => c.jsonId === action.payload.jsonId\n        );\n\n        if (cardIndexToRemove !== -1) {\n          cardStackToUse.cardStack.splice(cardIndexToRemove, 1);\n        }\n\n        cardStackToUse.selected = false;\n        cardStackToUse.controlledBy = \"\";\n\n        state.cards.push(newCard);\n      }\n    });\n\n    builder.addCase(startCardMoveWithSplitStackId, (state, action) => {\n      // first, if the card moving isn't currently selected, clear all _our_ selected cards\n      const cardToStartMoving = getCardStackWithId(state, action.payload.id);\n      if (cardToStartMoving && !cardToStartMoving.selected) {\n        state.cards = state.cards.map((card) => {\n          if (\n            card.controlledBy === \"\" ||\n            card.controlledBy === (action as any).ACTOR_REF\n          ) {\n            card.selected = card.id === action.payload.id;\n            if (card.selected) {\n              card.controlledBy = (action as any).ACTOR_REF;\n            } else {\n              card.controlledBy = \"\";\n            }\n          }\n          return card;\n        });\n      }\n\n      // If we are splitting, make a new stack of cards\n      if (action.payload.splitTopCard) {\n        const cardToMove = state.cards.find((c) => c.id === action.payload.id);\n\n        if (!cardToMove) {\n          throw new Error(\"Expected to find card\");\n        }\n\n        cardToMove.selected = false;\n        cardToMove.controlledBy = \"\";\n\n        const topCard = cardToMove.cardStack.shift();\n        const newCard = Object.assign({}, cardToMove, {\n          selected: true,\n          controlledBy: (action as any).ACTOR_REF,\n          dragging: true,\n          cardStack: [topCard],\n        });\n\n        cardToMove.id = action.payload.splitCardId;\n\n        state.cards.push(newCard);\n      }\n\n      // Now all selected cards should be put into ghost cards, unless we are splitting the top card\n      state.ghostCards = [];\n\n      if (!action.payload.splitTopCard) {\n        foreachSelectedAndControlledCard(\n          state,\n          (action as any).ACTOR_REF,\n          (card) => {\n            card.dragging = true;\n            state.ghostCards.push(Object.assign({}, card));\n          }\n        );\n      }\n\n      //Finally, if we have a preview card, clear it\n      // state.previewCard = null;\n    });\n\n    builder.addCase(drawCardsOutOfCardStackWithIds, (state, action) => {\n      if (action.payload.numberToDraw !== action.payload.idsToUse.length) {\n        throw new Error(\"Did not receive the expected number of ids\");\n      }\n\n      // First, unselect everything else of ours\n      unselectAllCardsReducer(state, action as unknown as any);\n\n      // Get the cardstack in question\n      let cardStackToUse = state.cards.find(\n        (c) => c.id === action.payload.cardStackId\n      );\n\n      if (!cardStackToUse) {\n        throw new Error(\n          `Couldn't find card stack with id ${action.payload.cardStackId}`\n        );\n      }\n\n      const sourceCardStackId = cardStackToUse.id;\n\n      //Next, for each card we should draw, remove it from the stack and make a new stack, which should be selected\n      for (let index = 0; index < action.payload.numberToDraw; index++) {\n        if (!!cardStackToUse) {\n          const topCardDetails = cardStackToUse.cardStack.shift();\n          if (!topCardDetails) {\n            throw new Error(\"Expected to find a top card, but didn't\");\n          }\n          const newCardStack: ICardDetails[] = [\n            { jsonId: topCardDetails.jsonId },\n          ];\n          const newCard = Object.assign({}, cardStackToUse, {\n            cardStack: newCardStack,\n          });\n          newCard.id = action.payload.idsToUse[index];\n          newCard.selected = true;\n          newCard.controlledBy = (action as any).ACTOR_REF;\n          newCard.faceup = !action.payload.facedown;\n          newCard.x = newCard.x + (cardConstants.CARD_WIDTH + 5) * (index + 1);\n          newCard.y += cardConstants.CARD_HEIGHT;\n\n          if (cardStackToUse.cardStack.length === 0) {\n            // we went through all the cards, remove the original card\n            state.cards = state.cards.filter((c) => c.id !== sourceCardStackId);\n            cardStackToUse = undefined;\n          }\n\n          state.cards.push(newCard);\n        }\n      }\n    });\n\n    builder.addCase(setStackShuffling, (state, action) => {\n      // get the stack to update\n      const stackToUpdate = state.cards.find((c) => c.id === action.payload.id);\n\n      if (!!stackToUpdate) {\n        stackToUpdate.shuffling = action.payload.shuffling;\n      }\n    });\n\n    builder.addCase(createDeckFromTextFileWithIds, (state, action) =>\n      handleLoadDeck(state, action)\n    );\n\n    builder.addCase(fetchDecklistById.fulfilled, (state, action) =>\n      handleLoadDeck(state, action)\n    );\n  },\n});\n\nconst handleLoadDeck = (\n  state: Draft<ICardsState>,\n  action: PayloadAction<CreateDeckPayload>\n) => {\n  console.log(\"got decklist\");\n  console.log(action);\n\n  const potentialHeroCard: ICardDetails[] = action.payload.data\n    .investigator_code\n    ? [{ jsonId: action.payload.data.investigator_code }]\n    : [];\n\n  const heroCardStack = [\n    ...potentialHeroCard,\n    ...action.payload.extraHeroCards,\n  ];\n\n  const heroCard: ICardStack = {\n    controlledBy: (action as any).ACTOR_REF,\n    selected: true,\n    x: action.payload.position.x,\n    y: action.payload.position.y,\n    dragging: false,\n    shuffling: false,\n    exhausted: false,\n    faceup: true,\n    fill: \"red\",\n    id: action.payload.heroId,\n    cardStack: heroCardStack,\n    statusTokens: {\n      stunned: false,\n      confused: false,\n      tough: false,\n    },\n    counterTokens: {\n      damage: 0,\n      threat: 0,\n      generic: 0,\n    },\n  };\n\n  let mainDeckStack: ICardDetails[] = [];\n  Object.entries(action.payload.data.slots).forEach(([key, value]) => {\n    const cardDetails: ICardDetails[] = Array.from(Array(value).keys()).map(\n      (): ICardDetails => ({ jsonId: key })\n    );\n    mainDeckStack = mainDeckStack.concat(cardDetails);\n  });\n\n  const cardPadding = cardConstants.CARD_WIDTH + 10;\n\n  const newDeck: ICardStack = {\n    controlledBy: (action as any).ACTOR_REF,\n    selected: true,\n    x: action.payload.position.x + cardPadding,\n    y: action.payload.position.y,\n    dragging: false,\n    shuffling: false,\n    exhausted: false,\n    faceup: true,\n    fill: \"red\",\n    id: action.payload.dataId,\n    cardStack: mainDeckStack,\n    statusTokens: {\n      stunned: false,\n      confused: false,\n      tough: false,\n    },\n    counterTokens: {\n      damage: 0,\n      threat: 0,\n      generic: 0,\n    },\n  };\n\n  const encounterDeck: ICardStack = {\n    controlledBy: (action as any).ACTOR_REF,\n    selected: true,\n    x: action.payload.position.x + cardPadding * 2,\n    y: action.payload.position.y,\n    dragging: false,\n    shuffling: false,\n    exhausted: false,\n    faceup: true,\n    fill: \"red\",\n    id: action.payload.encounterDeckId,\n    cardStack: action.payload.relatedEncounterDeck.map((jsonId) => ({\n      jsonId,\n    })),\n    statusTokens: {\n      stunned: false,\n      confused: false,\n      tough: false,\n    },\n    counterTokens: {\n      damage: 0,\n      threat: 0,\n      generic: 0,\n    },\n  };\n\n  const obligationDeck: ICardStack = {\n    controlledBy: (action as any).ACTOR_REF,\n    selected: true,\n    x: action.payload.position.x + cardPadding * 3,\n    y: action.payload.position.y,\n    dragging: false,\n    shuffling: false,\n    exhausted: false,\n    faceup: true,\n    fill: \"red\",\n    id: action.payload.obligationDeckId,\n    cardStack: action.payload.relatedObligationDeck.map((jsonId) => ({\n      jsonId,\n    })),\n    statusTokens: {\n      stunned: false,\n      confused: false,\n      tough: false,\n    },\n    counterTokens: {\n      damage: 0,\n      threat: 0,\n      generic: 0,\n    },\n  };\n\n  if (heroCard.cardStack.length > 0) {\n    state.cards.push(heroCard);\n  }\n\n  if (newDeck.cardStack.length > 0) {\n    state.cards.push(newDeck);\n  }\n\n  if (encounterDeck.cardStack.length > 0) {\n    state.cards.push(encounterDeck);\n  }\n\n  if (obligationDeck.cardStack.length > 0) {\n    state.cards.push(obligationDeck);\n  }\n};\n\nexport const {\n  selectCard,\n  unselectCard,\n  toggleSelectCard,\n  exhaustCard,\n  cardMove,\n  endCardMove,\n  selectMultipleCards,\n  unselectAllCards,\n  togglePanMode,\n  toggleMultiselectMode,\n  flipCards,\n  resetCards,\n  toggleToken,\n  adjustCounterToken,\n  clearCardTokens,\n} = cardsSlice.actions;\n\nexport default cardsSlice.reducer;\n","import { createAction } from \"@reduxjs/toolkit\";\nimport { Vector2d } from \"konva/lib/types\";\n\nexport interface AddNewCounterWithIdPayload {\n  pos: Vector2d;\n  id: string;\n}\n\nexport const addNewCounterWithId = createAction<AddNewCounterWithIdPayload>(\n  \"addNewCounterWithId\"\n);\n","import { Vector2d } from \"konva/lib/types\";\nimport { PlayerColor } from \"../../constants/app-constants\";\nimport { loadState } from \"../../store/localStorage\";\nimport * as jc from \"jsoncrush\";\n\nexport interface ICountersState {\n  counters: ICounter[];\n  firstPlayerCounterPosition: Vector2d;\n}\n\nexport interface ICounter {\n  id: string;\n  position: Vector2d;\n  value: number;\n  color: PlayerColor;\n}\n\nconst queryParams = new URLSearchParams(window.location.search);\nconst queryParamsCountersString = queryParams.get(\"counters\");\nconst queryParamsCounters = !!queryParamsCountersString\n  ? JSON.parse(jc.JSONUncrush(queryParamsCountersString))\n  : null;\n\nconst localStorageState: ICountersState =\n  queryParamsCounters || (loadState(\"liveState\")?.counters ?? {});\n\nconst defaultState: ICountersState = {\n  counters: [],\n  firstPlayerCounterPosition: { x: 0, y: 0 },\n};\nexport const initialState: ICountersState = {\n  ...defaultState,\n  ...localStorageState,\n};\n","import { CaseReducer, createSlice, PayloadAction } from \"@reduxjs/toolkit\";\nimport { Vector2d } from \"konva/lib/types\";\nimport { PlayerColor } from \"../../constants/app-constants\";\nimport { receiveRemoteGameState, resetApp } from \"../../store/global.actions\";\nimport { addNewCounterWithId } from \"./counters.actions\";\nimport { ICountersState, initialState } from \"./initialState\";\n\n// Reducers\nconst updateCounterValueReducer: CaseReducer<\n  ICountersState,\n  PayloadAction<{ id: string; delta: number }>\n> = (state, action) => {\n  const counter = state.counters.find((c) => c.id === action.payload.id);\n  if (!!counter) {\n    counter.value += action.payload.delta;\n    if (counter.value < 0) {\n      counter.value = 0;\n    }\n  }\n};\n\nconst updateCounterColorReducer: CaseReducer<\n  ICountersState,\n  PayloadAction<{ id: string; newColor: PlayerColor }>\n> = (state, action) => {\n  const counter = state.counters.find((c) => c.id === action.payload.id);\n  if (!!counter) {\n    counter.color = action.payload.newColor;\n  }\n};\n\nconst removeCounterReducer: CaseReducer<ICountersState, PayloadAction<string>> =\n  (state, action) => {\n    state.counters = state.counters.filter((c) => c.id !== action.payload);\n  };\n\nconst moveCounterReducer: CaseReducer<\n  ICountersState,\n  PayloadAction<{ id: string; newPos: Vector2d }>\n> = (state, action) => {\n  const counter = state.counters.find((c) => c.id === action.payload.id);\n  if (!!counter) {\n    counter.position = {\n      x: action.payload.newPos.x,\n      y: action.payload.newPos.y,\n    };\n  }\n};\n\nconst moveFirstPlayerCounterReducer: CaseReducer<\n  ICountersState,\n  PayloadAction<Vector2d>\n> = (state, action) => {\n  state.firstPlayerCounterPosition = {\n    x: action.payload.x,\n    y: action.payload.y,\n  };\n};\n\n// slice\nconst countersSlice = createSlice({\n  name: \"counters\",\n  initialState: initialState,\n  reducers: {\n    updateCounterValue: updateCounterValueReducer,\n    removeCounter: removeCounterReducer,\n    moveCounter: moveCounterReducer,\n    moveFirstPlayerCounter: moveFirstPlayerCounterReducer,\n    updateCounterColor: updateCounterColorReducer,\n  },\n  extraReducers: (builder) => {\n    builder.addCase(receiveRemoteGameState, (state, action) => {\n      state.counters = action.payload.liveState.present.counters.counters;\n      state.firstPlayerCounterPosition =\n        action.payload.liveState.present.counters.firstPlayerCounterPosition;\n    });\n\n    builder.addCase(resetApp, (state, action) => {\n      state.counters = [];\n      state.firstPlayerCounterPosition = { x: 0, y: 0 };\n    });\n\n    builder.addCase(addNewCounterWithId, (state, action) => {\n      state.counters.push({\n        id: action.payload.id,\n        position: action.payload.pos,\n        value: 0,\n        color: \"red\",\n      });\n    });\n  },\n});\n\nexport const {\n  updateCounterValue,\n  removeCounter,\n  moveCounter,\n  moveFirstPlayerCounter,\n  updateCounterColor,\n} = countersSlice.actions;\n\nexport default countersSlice.reducer;\n","import { combineReducers } from \"redux\";\nimport undoable, { excludeAction, groupByActionTypes } from \"redux-undo\";\nimport cardsData from \"../features/cards-data/cards-data.slice\";\nimport { startCardMoveWithSplitStackId } from \"../features/cards/cards.actions\";\nimport cards, { cardMove } from \"../features/cards/cards.slice\";\nimport game, {\n  clearPreviewCard,\n  setPreviewCardId,\n} from \"../features/game/game.slice\";\n\nimport counters, { moveCounter } from \"../features/counters/counters.slice\";\n\nconst undoableState = combineReducers({\n  counters,\n  cards,\n});\n\nconst rootReducer = combineReducers({\n  game,\n  cardsData,\n  liveState: undoable(undoableState, {\n    limit: 20,\n    groupBy: groupByActionTypes([moveCounter.type]),\n    filter: excludeAction([\n      startCardMoveWithSplitStackId.type,\n      cardMove.type,\n      setPreviewCardId.type,\n      clearPreviewCard.type,\n    ]),\n  }),\n});\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","import Peer from \"peerjs\";\nimport cloneDeep from \"lodash.clonedeep\";\nimport { myPeerRef } from \"../constants/app-constants\";\nimport { togglePanMode } from \"../features/cards/cards.slice\";\nimport {\n  loadCardsData,\n  loadCardsDataForPack,\n  loadCardsForEncounterSet,\n} from \"../features/cards-data/cards-data.slice\";\nimport {\n  clearMenuPreviewCardJsonId,\n  clearPreviewCard,\n  connectToRemoteGame,\n  requestResync,\n  setMenuPreviewCardJsonId,\n  setPeerId,\n  setPlayerColor,\n  setPreviewCardId,\n  updatePosition,\n  updateZoom,\n} from \"../features/game/game.slice\";\nimport {\n  receiveRemoteGameState,\n  verifyRemoteGameState,\n} from \"./global.actions\";\nimport { RootState } from \"./rootReducer\";\n\nconst DEBUG = false;\n\nconst blacklistRemoteActions = {\n  [connectToRemoteGame.type]: true,\n  [updatePosition.type]: true,\n  [updateZoom.type]: true,\n  [setPreviewCardId.type]: true,\n  [clearPreviewCard.type]: true,\n  [setMenuPreviewCardJsonId.type]: true,\n  [clearMenuPreviewCardJsonId.type]: true,\n  [togglePanMode.type]: true,\n  [receiveRemoteGameState.type]: true,\n  [requestResync.type]: true,\n  [loadCardsData.type]: true,\n  [loadCardsDataForPack.type]: true,\n  [loadCardsForEncounterSet.type]: true,\n};\n\nconst log = (...args: any[]) => {\n  if (DEBUG) {\n    console.log(args[0], args[1]);\n  }\n};\n\nconst setupConnection = (conn: any, storeAPI: any) => {\n  conn.on(\"data\", (data: any) => {\n    if (!data.INITIAL_STATE_MSG) {\n      if (!!data.RESYNC) {\n        log(\"received request for resync\");\n        conn.send({\n          INITIAL_STATE_MSG: true,\n          state: storeAPI.getState(),\n        });\n      } else if (!!data.PING) {\n        // Check local state\n        data.REMOTE_ACTION = true;\n        storeAPI.dispatch(verifyRemoteGameState(data.state));\n      } else {\n        log(\"recieved remote action\", data);\n        data.REMOTE_ACTION = true;\n        log(\"dispatching remote action\", data);\n        storeAPI.dispatch(data);\n      }\n    } else {\n      console.log(\"going to replace (most of) state with\", data.state);\n      setTimeout(() => {\n        storeAPI.dispatch(receiveRemoteGameState(data.state));\n      }, 0);\n    }\n  });\n};\n\nexport const peerJSMiddleware = (storeAPI: any) => {\n  const cgpPeer = new Peer(undefined, {\n    host: \"peerjs.middle-earth.house\",\n    path: \"/cgp\",\n    secure: true,\n    debug: 0,\n    config: {\n      iceServers: [\n        { urls: \"stun:stun.l.google.com:19302\" },\n        {\n          urls: \"turn:numb.viagenie.ca\",\n          username: \"webrtc@live.com\",\n          credential: \"muazkh\",\n        },\n      ],\n    },\n  });\n  let activeCon: Peer.DataConnection;\n\n  cgpPeer.on(\"error\", (err) => {\n    console.error(\"*****************Server error\");\n    console.error(err);\n  });\n\n  cgpPeer.on(\"disconnected\", () => {\n    console.log(\"****Peer server connection disconnected\");\n  });\n\n  cgpPeer.on(\"open\", (id) => {\n    console.log(\"My peer ID is: \" + id);\n    storeAPI.dispatch(setPeerId(id));\n\n    //look for query param\n    const remoteParamArray = window.location.href.split(\"remote=\");\n    if (remoteParamArray.length > 1) {\n      const remoteId = remoteParamArray[1].split(\"&\")[0];\n      console.log(\"FOUND QUERY PARAM. Going to connect to peer \" + remoteId);\n      activeCon = cgpPeer.connect(remoteId, {\n        metadata: { ref: myPeerRef },\n      });\n      setupConnection(activeCon, storeAPI);\n    }\n  });\n\n  cgpPeer.on(\"connection\", (conn) => {\n    console.log(\"Connection received!\");\n    activeCon = conn;\n    setupConnection(activeCon, storeAPI);\n\n    activeCon.on(\"open\", () => {\n      console.log(\"connection ready for data\");\n      const stateToSend: RootState = cloneDeep(storeAPI.getState());\n      // @ts-ignore\n      delete stateToSend.cardsData;\n\n      log(\"going to send initial state\", stateToSend);\n\n      activeCon.send({\n        INITIAL_STATE_MSG: true,\n        state: stateToSend,\n      });\n      // TODO: more complicated logic to handle multiple connections. Right now\n      // this just changes the connecting client to blue\n      const setPlayerColorAction = setPlayerColor({\n        ref: activeCon.metadata.ref,\n        color: \"blue\",\n      });\n      activeCon.send(setPlayerColorAction);\n      activeCon.send(\n        setPlayerColor({\n          ref: myPeerRef,\n          color: \"red\",\n        })\n      );\n      storeAPI.dispatch(setPlayerColorAction);\n\n      // Set up periodic state verification\n      setInterval(() => {\n        const currentState: RootState = cloneDeep(storeAPI.getState());\n        // @ts-ignore\n        delete currentState.cardsData;\n\n        activeCon.send({\n          PING: true,\n          state: currentState,\n        });\n      }, 5000);\n    });\n\n    activeCon.on(\"error\", (err) => {\n      console.error(\"****************Connection error:\", err);\n    });\n\n    activeCon.on(\"close\", () => {\n      console.log(\"******connection closed for ref \" + activeCon.metadata.ref);\n    });\n\n    activeCon.peerConnection.onconnectionstatechange = (ev: Event) => {\n      console.log(`connection state changed`);\n      console.log(ev);\n      console.log(activeCon.peerConnection.connectionState);\n      if (\n        activeCon.peerConnection.connectionState === \"closed\" ||\n        activeCon.peerConnection.connectionState === \"disconnected\"\n      ) {\n        console.log(\n          \"CLEARING CLIENT OWNED CARDS for \" + activeCon.metadata.ref\n        );\n      }\n    };\n  });\n  return (next: any) => (action: any) => {\n    log(\"received local action\", action);\n\n    // If this isn't a REMOTE action, add our ref onto it\n    if (!action.REMOTE_ACTION) {\n      action.ACTOR_REF = myPeerRef;\n    } else if (!action.ACTOR_REF) {\n      console.error(`Received a REMOTE action without an ACTOR_REF:`);\n      console.log(action);\n    }\n\n    if (action.type === connectToRemoteGame.type) {\n      console.log(\"going to connect to peer \" + action.payload);\n      activeCon = cgpPeer.connect(action.payload, {\n        metadata: { ref: myPeerRef },\n      });\n      setupConnection(activeCon, storeAPI);\n    } else if (action.type === requestResync.type) {\n      if (!!activeCon) {\n        activeCon.send({ RESYNC: true });\n      }\n    }\n\n    if (\n      !action.REMOTE_ACTION &&\n      !!activeCon &&\n      !blacklistRemoteActions[action.type]\n    ) {\n      log(\"going to send action to peer!\");\n      activeCon.send(action);\n    }\n\n    return next(action);\n  };\n};\n","import throttle from \"lodash.throttle\";\nimport {\n  configureStore as rtkConfigureStore,\n  getDefaultMiddleware,\n} from \"@reduxjs/toolkit\";\nimport rootReducer from \"./rootReducer\";\nimport { saveState } from \"./localStorage\";\nimport { peerJSMiddleware } from \"./peer-js-redux-middleware\";\n\nconst customizedMiddleware = getDefaultMiddleware({\n  thunk: true,\n  immutableCheck: false,\n  serializableCheck: false,\n}).concat(peerJSMiddleware);\n\nexport default function configureStore() {\n  console.log(\"configuring store. NODE_ENV is \" + process.env.NODE_ENV);\n  const store = rtkConfigureStore({\n    reducer: rootReducer,\n    middleware: customizedMiddleware,\n    devTools: process.env.NODE_ENV !== \"production\",\n  });\n\n  store.subscribe(\n    throttle(() => {\n      saveState(store.getState());\n    }, 1000)\n  );\n\n  return store;\n}\n","import { Vector2d } from \"konva/lib/types\";\nimport React, { useState } from \"react\";\nimport TopLayer from \"./TopLayer\";\n// import FlipIcon from \"@material-ui/icons/Flip\";\n// import IconButton from \"@material-ui/core/IconButton\";\n// import OpenWithIcon from \"@material-ui/icons/OpenWith\";\n// import AutorenewIcon from \"@material-ui/icons/Autorenew\";\n// import ShuffleIcon from \"@material-ui/icons/Shuffle\";\nimport { GameType } from \"./constants/app-constants\";\nimport {\n  GamePropertiesMap,\n  NumericTokenInfo,\n  TokenInfo,\n} from \"./constants/game-type-properties-mapping\";\nimport { CounterTokenType, StatusTokenType } from \"./constants/card-constants\";\nimport { DrawCardsOutOfCardStackPayload } from \"./features/cards/cards.thunks\";\nimport { ICardStack } from \"./features/cards/initialState\";\nconst reactPieMenu = require(\"react-pie-menu\");\nconst PieMenu = reactPieMenu.default;\nconst { Slice } = reactPieMenu;\n\nenum MenuType {\n  TopLevelActions = \"toplevelactions\",\n  StatusTokenActions = \"statustokenactions\",\n  CounterTokenActions = \"countertokenactions\",\n  DrawActions = \"drawactions\",\n  DrawNumber = \"drawnumber\",\n}\n\nenum DrawMode {\n  FaceUp = \"faceup\",\n  FaceDown = \"facedown\",\n}\n\nlet swallowClick = false;\n\ninterface IProps {\n  selectedCardStacks: ICardStack[];\n  currentGameType: GameType | null;\n  position: Vector2d | null;\n  hideRadialMenu: () => void;\n  flipCards: () => void;\n  exhaustCard: (id?: string) => void;\n  shuffleStack: (id?: string) => void;\n  toggleToken: (payload: {\n    id?: string;\n    tokenType: StatusTokenType;\n    value?: boolean;\n  }) => void;\n  adjustCounterToken: (payload: {\n    id?: string;\n    tokenType: CounterTokenType;\n    delta?: number;\n    value?: number;\n  }) => void;\n  clearCardTokens: (id?: string) => void;\n  drawCardsOutOfCardStack: (payload: DrawCardsOutOfCardStackPayload) => void;\n}\nconst RadialMenu = (props: IProps) => {\n  const [visibleMenu, setVisibleMenu] = useState(MenuType.TopLevelActions);\n  const [currentDrawMode, setCurrentDrawMode] = useState(DrawMode.FaceDown);\n\n  if (!props.position && visibleMenu !== MenuType.TopLevelActions) {\n    setVisibleMenu(MenuType.TopLevelActions);\n  }\n\n  return !!props.position ? (\n    <TopLayer\n      trasparentBackground={true}\n      offsetContent={false}\n      position={{\n        x: Math.max(props.position.x - 128, 0),\n        y: Math.max(props.position.y - 128, 0),\n      }}\n      completed={() => {\n        props.hideRadialMenu();\n      }}\n    >\n      <div\n        onClick={(event) => {\n          if (swallowClick) {\n            event.stopPropagation();\n            event.preventDefault();\n            swallowClick = false;\n          }\n        }}\n      >\n        <PieMenu radius=\"156px\" centerRadius=\"30px\">\n          {renderMenuSlices(\n            visibleMenu,\n            setVisibleMenu,\n            currentDrawMode,\n            setCurrentDrawMode,\n            props\n          )}\n        </PieMenu>\n      </div>\n    </TopLayer>\n  ) : null;\n};\n\nconst renderMenuSlices = (\n  visibleMenu: MenuType,\n  setVisibleMenu: (type: MenuType) => void,\n  currentDrawMode: DrawMode,\n  setCurrentDrawMode: (mode: DrawMode) => void,\n  props: IProps\n) => {\n  switch (visibleMenu) {\n    case MenuType.StatusTokenActions:\n      return renderStatusTokensMenu(props);\n    case MenuType.CounterTokenActions:\n      return renderCounterTokensMenu(props);\n    case MenuType.DrawActions:\n      return renderDrawMenu(props, setVisibleMenu, setCurrentDrawMode);\n    case MenuType.DrawNumber:\n      return renderDrawNumberMenu(props, currentDrawMode);\n    case MenuType.TopLevelActions:\n    default:\n      return renderTopLevelMenu(props, setVisibleMenu);\n  }\n};\n\nconst renderTopLevelMenu = (\n  props: IProps,\n  setVisibleMenu: (type: MenuType) => void\n) => {\n  return [\n    <Slice\n      key={\"flip-slice\"}\n      onSelect={() => {\n        props.flipCards();\n      }}\n    >\n      <div>\n        {/* <FlipIcon /> */}\n        <div>Flip</div>\n      </div>\n    </Slice>,\n    <Slice\n      key={\"exhaust-slice\"}\n      onSelect={() => {\n        props.exhaustCard();\n      }}\n    >\n      <div>\n        {/* <AutorenewIcon /> */}\n        <div>Exhaust</div>\n      </div>\n    </Slice>,\n    <Slice\n      key={\"shuffle-slice\"}\n      onSelect={() => {\n        props.shuffleStack();\n      }}\n    >\n      <div>\n        {/* <ShuffleIcon /> */}\n        <div>Shuffle</div>\n      </div>\n    </Slice>,\n    <Slice\n      key={\"statuses-slice\"}\n      onSelect={() => {\n        setVisibleMenu(MenuType.StatusTokenActions);\n        swallowClick = true;\n      }}\n    >\n      <div>Statuses</div>\n    </Slice>,\n    <Slice\n      key={\"tokens-slice\"}\n      onSelect={() => {\n        setVisibleMenu(MenuType.CounterTokenActions);\n        swallowClick = true;\n      }}\n    >\n      <div>Tokens</div>\n    </Slice>,\n    <Slice\n      key={\"clear-slice\"}\n      onSelect={() => {\n        props.clearCardTokens();\n      }}\n    >\n      <div>Clear</div>\n    </Slice>,\n    <Slice\n      key={\"draw-menu-slice\"}\n      onSelect={() => {\n        setVisibleMenu(MenuType.DrawActions);\n        swallowClick = true;\n      }}\n    >\n      <div>Draw</div>\n    </Slice>,\n  ];\n};\n\nconst renderStatusTokensMenu = (props: IProps) => {\n  if (!props.currentGameType) {\n    return [<Slice></Slice>, <Slice></Slice>, <Slice></Slice>];\n  }\n  let slices = Object.values(GamePropertiesMap[props.currentGameType].tokens)\n    .filter(\n      (tokenInfo): tokenInfo is TokenInfo =>\n        !!tokenInfo && !(tokenInfo as NumericTokenInfo).isNumeric\n    )\n    .map((tokenInfo) => {\n      const action = () => {\n        props.toggleToken({\n          tokenType: tokenInfo.tokenType,\n        });\n      };\n\n      let key = `touch-menu-slice-${tokenInfo.menuText\n        .replace(/\\s/g, \"\")\n        .toLocaleLowerCase()}`;\n\n      // key =\n      //   key + (tokenInfo.touchMenuLetter?.indexOf(\"+\") !== -1 ? \"-plus\" : \"\");\n      return (\n        <Slice key={key} onSelect={action}>\n          <div>\n            {!!tokenInfo.touchMenuIcon ? tokenInfo.touchMenuIcon : null}\n            <div>{tokenInfo.menuText}</div>\n          </div>\n        </Slice>\n      );\n    });\n\n  while (slices.length < 3) {\n    slices = slices.concat([\n      <Slice key={`extra-slice-${Math.random()}`}></Slice>,\n    ]);\n  }\n\n  return slices;\n};\n\nconst renderCounterTokensMenu = (props: IProps) => {\n  if (!props.currentGameType) {\n    return [<Slice></Slice>, <Slice></Slice>, <Slice></Slice>];\n  }\n  let slices = Object.values(GamePropertiesMap[props.currentGameType].tokens)\n    .filter(\n      (tokenInfo): tokenInfo is NumericTokenInfo =>\n        !!tokenInfo && (tokenInfo as NumericTokenInfo).isNumeric\n    )\n    .flatMap((tokenInfo) => {\n      const addTokenInfo = {\n        ...tokenInfo,\n        touchMenuLetter: `${tokenInfo.touchMenuLetter} +`,\n      };\n      const removeTokenInfo = {\n        ...tokenInfo,\n        touchMenuLetter: `${tokenInfo.touchMenuLetter} -`,\n      };\n      return [addTokenInfo, removeTokenInfo];\n    })\n    .map((tokenInfo) => {\n      const action = () => {\n        props.adjustCounterToken({\n          tokenType: tokenInfo.counterTokenType,\n          delta: tokenInfo.touchMenuLetter?.indexOf(\"+\") !== -1 ? 1 : -1,\n        });\n        swallowClick = true;\n      };\n\n      let key = `touch-menu-slice-${tokenInfo.menuText\n        .replace(/\\s/g, \"\")\n        .toLocaleLowerCase()}`;\n\n      key =\n        key + (tokenInfo.touchMenuLetter?.indexOf(\"+\") !== -1 ? \"-plus\" : \"\");\n      return (\n        <Slice key={key} onSelect={action}>\n          <div>\n            {!!tokenInfo.touchMenuIcon ? tokenInfo.touchMenuIcon : null}\n            <div>{tokenInfo.touchMenuLetter}</div>\n          </div>\n        </Slice>\n      );\n    });\n\n  while (slices.length < 3) {\n    slices = slices.concat([\n      <Slice key={`extra-slice-${Math.random()}`}></Slice>,\n    ]);\n  }\n\n  return slices;\n};\n\nconst renderDrawMenu = (\n  props: IProps,\n  setVisibleMenu: (type: MenuType) => void,\n  setCurrentDrawMode: (mode: DrawMode) => void\n) => {\n  // if (!props.currentGameType) {\n  return [\n    <Slice\n      key={\"draw-one-faceup-slice\"}\n      onSelect={() => {\n        if (props.selectedCardStacks.length === 1) {\n          props.drawCardsOutOfCardStack({\n            cardStackId: props.selectedCardStacks[0].id,\n            numberToDraw: 1,\n            facedown: false,\n          });\n        }\n      }}\n    >\n      1 faceup\n    </Slice>,\n    <Slice\n      key={\"draw-one-facedown-slice\"}\n      onSelect={() => {\n        if (props.selectedCardStacks.length === 1) {\n          props.drawCardsOutOfCardStack({\n            cardStackId: props.selectedCardStacks[0].id,\n            numberToDraw: 1,\n            facedown: true,\n          });\n        }\n      }}\n    >\n      1 facedown\n    </Slice>,\n    <Slice\n      key={\"draw-x-faceup-slice\"}\n      onSelect={() => {\n        setCurrentDrawMode(DrawMode.FaceUp);\n        setVisibleMenu(MenuType.DrawNumber);\n        swallowClick = true;\n      }}\n    >\n      X faceup\n    </Slice>,\n    <Slice\n      key={\"draw-x-facedown-slice\"}\n      onSelect={() => {\n        setCurrentDrawMode(DrawMode.FaceDown);\n        setVisibleMenu(MenuType.DrawNumber);\n        swallowClick = true;\n      }}\n    >\n      X facedown\n    </Slice>,\n  ];\n  // }\n};\n\nconst renderDrawNumberMenu = (props: IProps, currentDrawMode: DrawMode) => {\n  return Array.from({ length: 10 }, (_, i) => i + 1).map((num) => {\n    return (\n      <Slice\n        key={`draw-${num}-cards-slice`}\n        onSelect={() => {\n          if (props.selectedCardStacks.length === 1) {\n            props.drawCardsOutOfCardStack({\n              cardStackId: props.selectedCardStacks[0].id,\n              numberToDraw: num,\n              facedown: currentDrawMode === DrawMode.FaceDown,\n            });\n          }\n        }}\n      >\n        {num}\n      </Slice>\n    );\n  });\n};\n\nexport default RadialMenu;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport { ICardStack } from \"./features/cards/initialState\";\nimport { Rect, Text } from \"react-konva\";\nimport { cardConstants } from \"./constants/card-constants\";\nimport { GameType } from \"./constants/app-constants\";\nimport { GamePropertiesMap } from \"./constants/game-type-properties-mapping\";\ninterface IProps {\n  currentGameType: GameType;\n  x: number;\n  y: number;\n  card: ICardStack | undefined;\n}\n\ninterface IState {\n  imagesLoaded: {\n    damage: boolean;\n    threat: boolean;\n    generic: boolean;\n  };\n}\n\nconst desiredWidth = 47;\nconst desiredHeight = 47;\n\nclass CardTokens extends Component<IProps, IState> {\n  private damageImg: HTMLImageElement;\n  private threatImg: HTMLImageElement;\n  private genericImg: HTMLImageElement;\n  private unmounted: boolean;\n\n  constructor(props: IProps) {\n    super(props);\n\n    this.unmounted = true;\n\n    this.state = {\n      imagesLoaded: {\n        damage: false,\n        threat: false,\n        generic: false,\n      },\n    };\n\n    this.damageImg = new Image();\n    this.threatImg = new Image();\n    this.genericImg = new Image();\n\n    const tokenInfo = GamePropertiesMap[this.props.currentGameType].tokens;\n\n    // DAMAGE\n    this.damageImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          imagesLoaded: {\n            damage: true,\n            threat: this.state.imagesLoaded.threat,\n            generic: this.state.imagesLoaded.generic,\n          },\n        });\n      }\n    };\n\n    if (!!this.props.card?.counterTokens.damage && !!tokenInfo.damage) {\n      this.damageImg.src = tokenInfo.damage.imagePath;\n    }\n\n    // THREAT\n    this.threatImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          imagesLoaded: {\n            damage: this.state.imagesLoaded.damage,\n            threat: true,\n            generic: this.state.imagesLoaded.generic,\n          },\n        });\n      }\n    };\n\n    if (!!this.props.card?.counterTokens.threat && !!tokenInfo.threat) {\n      this.threatImg.src = tokenInfo.threat.imagePath;\n    }\n\n    // GENERIC\n    this.genericImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          imagesLoaded: {\n            damage: this.state.imagesLoaded.damage,\n            threat: this.state.imagesLoaded.threat,\n            generic: true,\n          },\n        });\n      }\n    };\n\n    if (!!this.props.card?.counterTokens.generic && !!tokenInfo.generic) {\n      this.genericImg.src = tokenInfo.generic.imagePath;\n    }\n  }\n\n  public componentDidUpdate(prevProps: IProps, prevState: IState) {\n    const tokenInfo = GamePropertiesMap[this.props.currentGameType].tokens;\n\n    // DAMAGE\n    if (\n      !this.state.imagesLoaded.damage &&\n      !prevProps.card?.counterTokens.damage &&\n      !!this.props.card?.counterTokens.damage &&\n      !!tokenInfo.damage\n    ) {\n      this.damageImg.src = tokenInfo.damage.imagePath;\n    }\n\n    // THREAT\n    if (\n      !this.state.imagesLoaded.threat &&\n      !prevProps.card?.counterTokens.threat &&\n      !!this.props.card?.counterTokens.threat &&\n      !!tokenInfo.threat\n    ) {\n      this.threatImg.src = tokenInfo.threat.imagePath;\n    }\n\n    // GENERIC\n    if (\n      !this.state.imagesLoaded.generic &&\n      !prevProps.card?.counterTokens.generic &&\n      !!this.props.card?.counterTokens.generic &&\n      !!tokenInfo.generic\n    ) {\n      this.genericImg.src = tokenInfo.generic.imagePath;\n    }\n  }\n\n  public componentDidMount() {\n    this.unmounted = false;\n  }\n\n  public componentWillUnmount() {\n    this.unmounted = true;\n  }\n\n  render() {\n    if (!this.props.card) return null;\n\n    const damageX = this.props.x - desiredWidth / 2;\n    const damageY = this.props.y - cardConstants.CARD_HEIGHT / 2 + 20;\n    const showDamage =\n      this.state.imagesLoaded.damage && !!this.props.card.counterTokens.damage;\n\n    const damageToken = showDamage ? (\n      <Rect\n        key={`${this.props.card.id}-damageToken`}\n        x={damageX}\n        y={damageY}\n        scale={{\n          x: desiredWidth / this.damageImg.naturalWidth,\n          y: desiredHeight / this.damageImg.naturalHeight,\n        }}\n        width={this.damageImg.naturalWidth}\n        height={this.damageImg.naturalHeight}\n        fillPatternImage={this.damageImg}\n      ></Rect>\n    ) : null;\n\n    const damageText = showDamage ? (\n      <Text\n        key={`${this.props.card.id}-damageText`}\n        x={damageX}\n        y={damageY}\n        width={\n          this.damageImg.naturalWidth *\n          (desiredWidth / this.damageImg.naturalWidth)\n        }\n        height={\n          this.damageImg.naturalHeight *\n          (desiredHeight / this.damageImg.naturalHeight)\n        }\n        text={`${this.props.card.counterTokens.damage}`}\n        fill=\"white\"\n        align=\"center\"\n        verticalAlign=\"middle\"\n        fontSize={24}\n      ></Text>\n    ) : null;\n\n    const threatX = this.props.x - desiredWidth / 2;\n    const threatY = damageY + desiredHeight + 5;\n    const showThreat =\n      this.state.imagesLoaded.threat && !!this.props.card.counterTokens.threat;\n\n    const threatToken = showThreat ? (\n      <Rect\n        key={`${this.props.card.id}-threatToken`}\n        x={threatX}\n        y={threatY}\n        scale={{\n          x: desiredWidth / this.threatImg.naturalWidth,\n          y: desiredHeight / this.threatImg.naturalHeight,\n        }}\n        width={this.threatImg.naturalWidth}\n        height={this.threatImg.naturalHeight}\n        fillPatternImage={this.threatImg}\n      ></Rect>\n    ) : null;\n\n    const threatText = showThreat ? (\n      <Text\n        key={`${this.props.card.id}-threatText`}\n        x={threatX}\n        y={threatY}\n        width={\n          this.threatImg.naturalWidth *\n          (desiredWidth / this.threatImg.naturalWidth)\n        }\n        height={\n          this.threatImg.naturalHeight *\n          (desiredHeight / this.threatImg.naturalHeight)\n        }\n        text={`${this.props.card.counterTokens.threat}`}\n        fill=\"white\"\n        align=\"center\"\n        verticalAlign=\"middle\"\n        fontSize={24}\n      ></Text>\n    ) : null;\n\n    const genericX = this.props.x - desiredWidth / 2;\n    const genericY = threatY + desiredHeight + 5;\n    const showGeneric =\n      this.state.imagesLoaded.generic &&\n      !!this.props.card.counterTokens.generic;\n\n    const genericToken = showGeneric ? (\n      <Rect\n        key={`${this.props.card.id}-genericToken`}\n        x={genericX}\n        y={genericY}\n        scale={{\n          x: desiredWidth / this.genericImg.naturalWidth,\n          y: desiredHeight / this.genericImg.naturalHeight,\n        }}\n        width={this.genericImg.naturalWidth}\n        height={this.genericImg.naturalHeight}\n        fillPatternImage={this.genericImg}\n      ></Rect>\n    ) : null;\n\n    const genericText = showGeneric ? (\n      <Text\n        key={`${this.props.card.id}-genericText`}\n        x={genericX}\n        y={genericY}\n        width={\n          this.genericImg.naturalWidth *\n          (desiredWidth / this.genericImg.naturalWidth)\n        }\n        height={\n          this.genericImg.naturalHeight *\n          (desiredHeight / this.genericImg.naturalHeight)\n        }\n        text={`${this.props.card.counterTokens.generic}`}\n        fill=\"white\"\n        align=\"center\"\n        verticalAlign=\"middle\"\n        fontSize={24}\n      ></Text>\n    ) : null;\n\n    return [\n      damageToken,\n      damageText,\n      threatToken,\n      threatText,\n      genericToken,\n      genericText,\n    ];\n  }\n}\n\nexport default CardTokens;\n","import { connect } from \"react-redux\";\n\nimport { RootState } from \"./store/rootReducer\";\nimport CardTokens from \"./CardTokens\";\nimport { getCardMapById } from \"./features/cards/cards.selectors\";\n\nexport interface IProps {\n  id: string;\n}\n\nconst mapStateToProps = (state: RootState, props: IProps) => {\n  return {\n    card: getCardMapById(state)[props.id],\n  };\n};\n\nconst CardTokensContainer = connect(mapStateToProps, {})(CardTokens);\n\nexport default CardTokensContainer;\n","export const CARD_ALREADY_ROTATED_MAP: { [key: string]: boolean } = {\n  \"05026\": true,\n};\n\nexport const MISSING_CARD_IMAGE_MAP: { [key: string]: string } = {\n  \"02001a\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"8665869b-fae4-494e-91d1-1e8c308220c2\" +\n    \".jpg\",\n\n  \"02001b\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"8665869b-fae4-494e-91d1-1e8c308220c2\" +\n    \".b.jpg\",\n\n  \"02002a\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"cfd051be-4ade-4cf8-b575-4b673cfa9a92\" +\n    \".jpg\",\n\n  \"02002b\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"cfd051be-4ade-4cf8-b575-4b673cfa9a92\" +\n    \".b.jpg\",\n\n  \"02003a\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"b16187a4-3f29-4a4b-8b66-6e8c7524c402\" +\n    \".jpg\",\n\n  \"02003b\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"b16187a4-3f29-4a4b-8b66-6e8c7524c402\" +\n    \".b.jpg\",\n\n  \"02004\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"b35084d9-3a2b-418c-b1a4-e4929de16a2c\" +\n    \".jpg\",\n\n  \"02004_double_sided_back\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"b35084d9-3a2b-418c-b1a4-e4929de16a2c\" +\n    \".b.jpg\",\n\n  \"02005\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"1eae757a-25b2-4b29-a8e7-f43b12c531b0\" +\n    \".jpg\",\n\n  \"02005_double_sided_back\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"1eae757a-25b2-4b29-a8e7-f43b12c531b0\" +\n    \".b.jpg\",\n\n  \"02006a\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"0a59161d-7db6-4328-9eeb-1906ce8715a5\" +\n    \".jpg\",\n\n  \"02006b\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"0a59161d-7db6-4328-9eeb-1906ce8715a5\" +\n    \".b.jpg\",\n\n  \"12020\": \"https://lcgcdn.s3.amazonaws.com/mc/MC13en_20.jpg\",\n\n  // Scarlet Witch Cards\n  \"15001a\": \"https://marvelcdb.com/bundles/cards/15001a.png\",\n  \"15001b\": \"https://marvelcdb.com/bundles/cards/15001b.png\",\n  \"15002\": \"https://hallofheroeshome.files.wordpress.com/2021/03/s1.jpg\",\n  \"15003\": \"https://hallofheroeshome.files.wordpress.com/2021/03/s2.jpg\",\n  \"15004\": \"https://hallofheroeshome.files.wordpress.com/2021/03/s6.jpg\",\n  \"15005\": \"https://hallofheroeshome.files.wordpress.com/2021/03/s7.jpg\",\n  \"15006\": \"https://hallofheroeshome.files.wordpress.com/2021/03/s10.jpg\",\n  \"15007\": \"https://hallofheroeshome.files.wordpress.com/2021/03/s11.jpg\",\n  \"15008\": \"https://hallofheroeshome.files.wordpress.com/2021/03/s12.jpg\",\n  \"15009\": \"https://hallofheroeshome.files.wordpress.com/2021/03/s15.jpg\",\n  \"15010\": \"https://hallofheroeshome.files.wordpress.com/2021/03/w1.jpg\",\n  \"15011\": \"https://hallofheroeshome.files.wordpress.com/2021/03/w2.jpg\",\n  \"15012\": \"https://hallofheroeshome.files.wordpress.com/2021/03/w3.jpg\",\n  \"15013\": \"https://hallofheroeshome.files.wordpress.com/2021/03/w4.jpg\",\n  \"15014\": \"https://hallofheroeshome.files.wordpress.com/2021/03/w5.jpg\",\n  \"15015\": \"https://hallofheroeshome.files.wordpress.com/2021/03/w6.jpg\",\n  \"15019\": \"https://hallofheroeshome.files.wordpress.com/2021/03/w10.jpg\",\n  \"15023\": \"https://hallofheroeshome.files.wordpress.com/2021/03/n2.jpg\",\n  \"15024\": \"https://hallofheroeshome.files.wordpress.com/2021/03/n3.jpg\",\n  \"15025\": \"https://hallofheroeshome.files.wordpress.com/2021/03/n4.jpg\",\n  \"15026\": \"https://hallofheroeshome.files.wordpress.com/2021/03/n5.jpg\",\n  \"15027\": \"https://hallofheroeshome.files.wordpress.com/2021/03/n6.jpg\",\n  \"15028\": \"https://hallofheroeshome.files.wordpress.com/2021/03/z1.jpg\",\n  \"15029\": \"https://hallofheroeshome.files.wordpress.com/2021/03/z2.jpg\",\n  \"15030\": \"https://hallofheroeshome.files.wordpress.com/2021/03/z3.jpg\",\n  \"15031\": \"https://hallofheroeshome.files.wordpress.com/2021/03/z4.jpg\",\n\n  // Groot Cards\n  \"16001a\": \"https://marvelcdb.com/bundles/cards/16001a.png\",\n  \"16001b\": \"https://marvelcdb.com/bundles/cards/16001b.png\",\n  \"16002\": \"https://hallofheroeshome.files.wordpress.com/2021/04/g1.jpg\",\n  \"16003\": \"https://hallofheroeshome.files.wordpress.com/2021/04/g3.jpg\",\n  \"16004\": \"https://hallofheroeshome.files.wordpress.com/2021/04/g5.jpg\",\n  \"16005\": \"https://hallofheroeshome.files.wordpress.com/2021/04/g7.jpg\",\n  \"16006\": \"https://hallofheroeshome.files.wordpress.com/2021/04/g10.jpg\",\n  \"16007\": \"https://hallofheroeshome.files.wordpress.com/2021/04/g11.jpg\",\n  \"16008\": \"https://hallofheroeshome.files.wordpress.com/2021/04/g12.jpg\",\n  \"16009\": \"https://hallofheroeshome.files.wordpress.com/2021/04/g13.jpg\",\n  \"16010\": \"https://hallofheroeshome.files.wordpress.com/2021/04/g14.jpg\",\n  \"16011\": \"https://hallofheroeshome.files.wordpress.com/2021/04/g15.jpg\",\n  \"16012\": \"https://hallofheroeshome.files.wordpress.com/2021/04/z1.jpg\",\n  \"16014\": \"https://hallofheroeshome.files.wordpress.com/2021/04/z3.jpg\",\n  \"16016\": \"https://hallofheroeshome.files.wordpress.com/2021/04/z5.jpg\",\n  \"16017\": \"https://hallofheroeshome.files.wordpress.com/2021/04/z6.jpg\",\n  \"16019\": \"https://hallofheroeshome.files.wordpress.com/2021/04/z8.jpg\",\n  \"16020\": \"https://hallofheroeshome.files.wordpress.com/2021/04/z9.jpg\",\n  \"16024\": \"https://hallofheroeshome.files.wordpress.com/2021/04/z13.jpg\",\n  \"16025\": \"https://hallofheroeshome.files.wordpress.com/2021/04/n1.jpg\",\n  \"16026\": \"https://hallofheroeshome.files.wordpress.com/2021/04/n2.jpg\",\n  \"16027\": \"https://hallofheroeshome.files.wordpress.com/2021/04/n3.jpg\",\n  \"16028\": \"https://hallofheroeshome.files.wordpress.com/2021/04/n4.jpg\",\n\n  // Rocket Cards\n  \"16029a\": \"https://marvelcdb.com/bundles/cards/16029a.png\",\n  \"16029b\": \"https://hallofheroeshome.files.wordpress.com/2021/04/r0a.jpg\",\n  \"16030\": \"https://hallofheroeshome.files.wordpress.com/2021/04/r1.jpg\",\n  \"16031\": \"https://hallofheroeshome.files.wordpress.com/2021/04/r3.jpg\",\n  \"16032\": \"https://hallofheroeshome.files.wordpress.com/2021/04/r5.jpg\",\n  \"16033\": \"https://hallofheroeshome.files.wordpress.com/2021/04/r6.jpg\",\n  \"16034\": \"https://hallofheroeshome.files.wordpress.com/2021/04/r8.jpg\",\n  \"16035\": \"https://hallofheroeshome.files.wordpress.com/2021/04/r10.jpg\",\n  \"16036\": \"https://hallofheroeshome.files.wordpress.com/2021/04/r11.jpg\",\n  \"16037\": \"https://hallofheroeshome.files.wordpress.com/2021/04/r12.jpg\",\n  \"16038\": \"https://hallofheroeshome.files.wordpress.com/2021/04/r13.jpg\",\n  \"16039\": \"https://hallofheroeshome.files.wordpress.com/2021/04/r15.jpg\",\n  \"16040\": \"https://hallofheroeshome.files.wordpress.com/2021/04/z1-1.jpg\",\n  \"16043\": \"https://hallofheroeshome.files.wordpress.com/2021/04/z4-1.jpg\",\n  \"16045\": \"https://hallofheroeshome.files.wordpress.com/2021/04/z6-1.jpg\",\n  \"16046\": \"https://hallofheroeshome.files.wordpress.com/2021/04/z7-1.jpg\",\n  \"16047\": \"https://hallofheroeshome.files.wordpress.com/2021/04/z8-1.jpg\",\n  \"16048\": \"https://hallofheroeshome.files.wordpress.com/2021/04/z9-1.jpg\",\n  \"16052\": \"https://hallofheroeshome.files.wordpress.com/2021/04/z13-1.jpg\",\n  \"16053\": \"https://hallofheroeshome.files.wordpress.com/2021/04/n0.jpg\",\n  \"16054\": \"https://hallofheroeshome.files.wordpress.com/2021/04/n1-1.jpg\",\n  \"16055\": \"https://hallofheroeshome.files.wordpress.com/2021/04/n2-1.jpg\",\n  \"16056\": \"https://hallofheroeshome.files.wordpress.com/2021/04/n3-1.jpg\",\n  \"16057\": \"https://hallofheroeshome.files.wordpress.com/2021/04/n4-1.jpg\",\n\n  // Brotherhood of Badoon\n  \"16058\": \"https://hallofheroeshome.files.wordpress.com/2021/04/d1.jpg\",\n  \"16059\": \"https://hallofheroeshome.files.wordpress.com/2021/04/d2.jpg\",\n  \"16060\": \"https://hallofheroeshome.files.wordpress.com/2021/04/d3.jpg\",\n  \"16061\": \"https://hallofheroeshome.files.wordpress.com/2021/04/d4a.jpg\",\n  \"16061_double_sided_back\":\n    \"https://hallofheroeshome.files.wordpress.com/2021/04/d4b.jpg\",\n  \"16062\": \"https://hallofheroeshome.files.wordpress.com/2021/04/d5a.jpg\",\n  \"16062_double_sided_back\":\n    \"https://hallofheroeshome.files.wordpress.com/2021/04/d5b.jpg\",\n  \"16063\": \"https://hallofheroeshome.files.wordpress.com/2021/04/d6.jpg\",\n  \"16064\": \"https://hallofheroeshome.files.wordpress.com/2021/04/d7.jpg\",\n  \"16065\": \"https://hallofheroeshome.files.wordpress.com/2021/04/d8.jpg\",\n  \"16066\": \"https://hallofheroeshome.files.wordpress.com/2021/04/d10.jpg\",\n  \"16067\": \"https://hallofheroeshome.files.wordpress.com/2021/04/d11.jpg\",\n  \"16068\": \"https://hallofheroeshome.files.wordpress.com/2021/04/d12.jpg\",\n  \"16069\": \"https://hallofheroeshome.files.wordpress.com/2021/04/d13.jpg\",\n\n  // Band of Badoon\n  \"16117\": \"https://hallofheroeshome.files.wordpress.com/2021/04/bb1.jpg\",\n  \"16118\": \"https://hallofheroeshome.files.wordpress.com/2021/04/bb3.jpg\",\n  \"16119\": \"https://hallofheroeshome.files.wordpress.com/2021/04/bb6.jpg\",\n  \"16120\": \"https://hallofheroeshome.files.wordpress.com/2021/04/bb7.jpg\",\n  \"16121\": \"https://hallofheroeshome.files.wordpress.com/2021/04/bb9.jpg\",\n\n  // Ship Command\n  \"16142\": \"https://hallofheroeshome.files.wordpress.com/2021/04/sc1.jpg\",\n  \"16143\": \"https://hallofheroeshome.files.wordpress.com/2021/04/sc2.jpg\",\n  \"16144\": \"https://hallofheroeshome.files.wordpress.com/2021/04/sc3.jpg\",\n  \"16145\": \"https://hallofheroeshome.files.wordpress.com/2021/04/sc4.jpg\",\n  \"16146\": \"https://hallofheroeshome.files.wordpress.com/2021/04/sc5.jpg\",\n  \"16147\": \"https://hallofheroeshome.files.wordpress.com/2021/04/sc6.jpg\",\n  \"16148\": \"https://hallofheroeshome.files.wordpress.com/2021/04/sc7.jpg\",\n\n  // Star-Lord\n  \"17001a\": \"https://marvelcdb.com/bundles/cards/17001a.png\",\n  \"17001b\": \"https://marvelcdb.com/bundles/cards/17001b.png\",\n  \"17002\": \"https://hallofheroeshome.files.wordpress.com/2021/05/1-1.jpg\",\n  \"17003\": \"https://hallofheroeshome.files.wordpress.com/2021/05/2-1.jpg\",\n  \"17004\": \"https://hallofheroeshome.files.wordpress.com/2021/05/5.jpg\",\n  \"17005\": \"https://hallofheroeshome.files.wordpress.com/2021/05/7.jpg\",\n  \"17006\": \"https://hallofheroeshome.files.wordpress.com/2021/05/10.jpg\",\n  \"17007\": \"https://hallofheroeshome.files.wordpress.com/2021/05/11.jpg\",\n  \"17008\": \"https://hallofheroeshome.files.wordpress.com/2021/05/13.jpg\",\n  \"17009\": \"https://hallofheroeshome.files.wordpress.com/2021/05/14.jpg\",\n  \"17010\": \"https://hallofheroeshome.files.wordpress.com/2021/05/15.jpg\",\n  \"17011\": \"https://hallofheroeshome.files.wordpress.com/2021/05/a1.jpg\",\n  \"17012\": \"https://hallofheroeshome.files.wordpress.com/2021/05/a2.jpg\",\n  \"17013\": \"https://hallofheroeshome.files.wordpress.com/2021/05/a3.jpg\",\n  \"17014\": \"https://hallofheroeshome.files.wordpress.com/2021/05/a4.jpg\",\n  \"17015\": \"https://hallofheroeshome.files.wordpress.com/2021/05/a5.jpg\",\n  \"17017\": \"https://hallofheroeshome.files.wordpress.com/2021/05/a7.jpg\",\n  \"17019\": \"https://hallofheroeshome.files.wordpress.com/2021/05/a9.jpg\",\n  \"17020\": \"https://hallofheroeshome.files.wordpress.com/2021/05/a10.jpg\",\n  \"17021\": \"https://hallofheroeshome.files.wordpress.com/2021/05/a11.jpg\",\n  \"17022\": \"https://hallofheroeshome.files.wordpress.com/2021/05/a12.jpg\",\n  \"17023\": \"https://hallofheroeshome.files.wordpress.com/2021/05/a13.jpg\",\n  \"17024\": \"https://hallofheroeshome.files.wordpress.com/2021/05/o0.jpg\",\n  \"17025\": \"https://hallofheroeshome.files.wordpress.com/2021/05/o1.jpg\",\n  \"17026\": \"https://hallofheroeshome.files.wordpress.com/2021/05/o2.jpg\",\n  \"17027\": \"https://hallofheroeshome.files.wordpress.com/2021/05/o3.jpg\",\n  \"17028\": \"https://hallofheroeshome.files.wordpress.com/2021/05/bb1.jpg\",\n  \"17029\": \"https://hallofheroeshome.files.wordpress.com/2021/05/bb2.jpg\",\n  \"17030\": \"https://hallofheroeshome.files.wordpress.com/2021/05/bb3.jpg\",\n\n  // Gamora\n  \"18001a\": \"https://marvelcdb.com/bundles/cards/18001a.png\",\n  \"18001b\": \"https://marvelcdb.com/bundles/cards/18001b.png\",\n  \"18002\": \"https://hallofheroeshome.files.wordpress.com/2021/05/g1-1.jpg\",\n  \"18003\": \"https://hallofheroeshome.files.wordpress.com/2021/05/g2-1.jpg\",\n  \"18004\": \"https://hallofheroeshome.files.wordpress.com/2021/05/g4-1.jpg\",\n  \"18005\": \"https://hallofheroeshome.files.wordpress.com/2021/05/g6-1.jpg\",\n  \"18006\": \"https://hallofheroeshome.files.wordpress.com/2021/05/g8-1.jpg\",\n  \"18007\": \"https://hallofheroeshome.files.wordpress.com/2021/05/g10-1.jpg\",\n  \"18008\": \"https://hallofheroeshome.files.wordpress.com/2021/05/g12-1.jpg\",\n  \"18009\": \"https://hallofheroeshome.files.wordpress.com/2021/05/g13-1.jpg\",\n  \"18010\": \"https://hallofheroeshome.files.wordpress.com/2021/05/g15-1.jpg\",\n  \"18011\": \"https://hallofheroeshome.files.wordpress.com/2021/05/z0.png\",\n  \"18012\": \"https://hallofheroeshome.files.wordpress.com/2021/05/c1.jpg\",\n  \"18013\": \"https://hallofheroeshome.files.wordpress.com/2021/05/d1.jpg\",\n  \"18015\": \"https://hallofheroeshome.files.wordpress.com/2021/05/f1.jpg\",\n  \"18016\": \"https://hallofheroeshome.files.wordpress.com/2021/05/i111.jpg\",\n  \"18018\": \"https://hallofheroeshome.files.wordpress.com/2021/05/aaa1.jpg\",\n  \"18019\":\n    \"https://hallofheroeshome.files.wordpress.com/2021/05/gamora-spoilers-41024_1.jpg\",\n  \"18020\": \"https://hallofheroeshome.files.wordpress.com/2021/05/h1.jpg\",\n  \"18024\": \"https://hallofheroeshome.files.wordpress.com/2021/05/n1.jpg\",\n  \"18025\": \"https://hallofheroeshome.files.wordpress.com/2021/05/s1.jpg\",\n  \"18026\": \"https://hallofheroeshome.files.wordpress.com/2021/05/n3.jpg\",\n  \"18027\": \"https://hallofheroeshome.files.wordpress.com/2021/05/n4.jpg\",\n  \"18028\": \"https://hallofheroeshome.files.wordpress.com/2021/05/n5.jpg\",\n  \"18029\": \"https://hallofheroeshome.files.wordpress.com/2021/05/zzz1.jpg\",\n  \"18030\": \"https://hallofheroeshome.files.wordpress.com/2021/05/zzz2.jpg\",\n  \"18031\": \"https://hallofheroeshome.files.wordpress.com/2021/05/zzz3.jpg\",\n\n  // Drax\n  \"19001a\": \"https://marvelcdb.com/bundles/cards/19001a.png\",\n  \"19001b\": \"https://marvelcdb.com/bundles/cards/19001b.png\",\n  \"19002\": \"https://hallofheroeshome.files.wordpress.com/2021/06/d1.jpg\",\n  \"19003\": \"https://hallofheroeshome.files.wordpress.com/2021/06/d2.jpg\",\n  \"19004\": \"https://hallofheroeshome.files.wordpress.com/2021/06/d4.jpg\",\n  \"19005\": \"https://hallofheroeshome.files.wordpress.com/2021/06/d6.jpg\",\n  \"19006\": \"https://hallofheroeshome.files.wordpress.com/2021/06/d8.jpg\",\n  \"19007\": \"https://hallofheroeshome.files.wordpress.com/2021/06/d10.jpg\",\n  \"19008\": \"https://hallofheroeshome.files.wordpress.com/2021/06/d12.jpg\",\n  \"19009\": \"https://hallofheroeshome.files.wordpress.com/2021/06/d13.jpg\",\n  \"19010\": \"https://hallofheroeshome.files.wordpress.com/2021/06/d14.jpg\",\n  \"19011\": \"https://hallofheroeshome.files.wordpress.com/2021/06/d15.jpg\",\n  \"19012\": \"https://hallofheroeshome.files.wordpress.com/2021/06/z1.jpg\",\n  \"19013\": \"https://hallofheroeshome.files.wordpress.com/2021/06/z2.jpg\",\n  \"19015\": \"https://hallofheroeshome.files.wordpress.com/2021/06/z4.jpg\",\n  \"19016\": \"https://hallofheroeshome.files.wordpress.com/2021/06/z5.jpg\",\n  \"19017\": \"https://hallofheroeshome.files.wordpress.com/2021/06/z6.jpg\",\n  \"19018\": \"https://hallofheroeshome.files.wordpress.com/2021/06/z7.jpg\",\n  \"19020\": \"https://hallofheroeshome.files.wordpress.com/2021/06/z9.jpg\",\n  \"19025\": \"https://hallofheroeshome.files.wordpress.com/2021/06/n1.jpg\",\n  \"19026\": \"https://hallofheroeshome.files.wordpress.com/2021/06/n2.jpg\",\n  \"19027\": \"https://hallofheroeshome.files.wordpress.com/2021/06/n3.jpg\",\n  \"19028\": \"https://hallofheroeshome.files.wordpress.com/2021/06/n4.jpg\",\n  \"19029\": \"https://hallofheroeshome.files.wordpress.com/2021/06/n5.jpg\",\n  \"19030\": \"https://hallofheroeshome.files.wordpress.com/2021/06/zz1.jpg\",\n  \"19031\": \"https://hallofheroeshome.files.wordpress.com/2021/06/zz2.jpg\",\n  \"19032\": \"https://hallofheroeshome.files.wordpress.com/2021/06/zz3.jpg\",\n};\n","// tslint:disable:no-console\nimport { KonvaEventObject } from \"konva/lib/Node\";\nimport { Rect as RectRef } from \"konva/lib/shapes/Rect\";\nimport { Vector2d } from \"konva/lib/types\";\nimport * as React from \"react\";\nimport { Component } from \"react\";\nimport { Rect, Text } from \"react-konva\";\nimport { animated, Spring } from \"@react-spring/konva\";\nimport CardTokensContainer from \"./CardTokensContainer\";\nimport { GameType, myPeerRef, PlayerColor } from \"./constants/app-constants\";\nimport { cardConstants } from \"./constants/card-constants\";\nimport { CARD_ALREADY_ROTATED_MAP } from \"./constants/card-missing-image-map\";\nimport { GamePropertiesMap } from \"./constants/game-type-properties-mapping\";\n\nexport const HORIZONTAL_TYPE_CODES = [\n  \"main_scheme\",\n  \"side_scheme\",\n  \"quest\",\n  \"player_side_quest\",\n];\n\nexport interface CardTokens {\n  damage: number;\n  threat: number;\n  generic: number;\n}\n\nexport interface CardUIState {\n  stunned: boolean;\n  confused: boolean;\n  tough: boolean;\n  tokens: CardTokens;\n}\n\ninterface IProps {\n  currentGameType: GameType;\n  name: string;\n  code: string;\n  selectedColor: PlayerColor;\n  controlledBy: string;\n  dragging: boolean;\n  shuffling: boolean;\n  exhausted: boolean;\n  cardState?: CardUIState;\n  fill: string;\n  handleClick?: (\n    id: string,\n    event: KonvaEventObject<MouseEvent>,\n    wasTouch: boolean\n  ) => void;\n  handleDoubleClick?: (id: string, event: KonvaEventObject<MouseEvent>) => void;\n  handleDoubleTap?: (id: string, event: KonvaEventObject<TouchEvent>) => void;\n  handleDragStart?: (id: string, event: KonvaEventObject<DragEvent>) => void;\n  handleDragMove?: (info: { id: string; dx: number; dy: number }) => void;\n  handleDragEnd?: (id: string) => void;\n  handleHover?: (id: string) => void;\n  handleHoverLeave?: (id: string) => void;\n  id: string;\n  selected: boolean;\n  dropTargetColor?: string;\n  x: number;\n  y: number;\n  width?: number;\n  height?: number;\n  imgUrls: string[];\n  isGhost?: boolean;\n  numCardsInStack?: number;\n  typeCode?: string;\n  faceup: boolean;\n  handleContextMenu?: (\n    id: string,\n    event: KonvaEventObject<PointerEvent>\n  ) => void;\n}\n\ninterface IState {\n  imageLoaded: boolean;\n  imageLoadFailed: number;\n  prevImgUrls: string[];\n  tokenImagesLoaded: {\n    stunned: boolean;\n    confused: boolean;\n    tough: boolean;\n  };\n}\n\nconst stringArraysEqual = (array1: string[], array2: string[]) => {\n  return (\n    array1.length === array2.length &&\n    array1.every((value, index) => {\n      return value === array2[index];\n    })\n  );\n};\n\nclass Card extends Component<IProps, IState> {\n  // tslint:disable-next-line:member-access\n  static getDerivedStateFromProps(props: IProps, state: IState): IState | null {\n    if (!stringArraysEqual(props.imgUrls, state.prevImgUrls ?? [])) {\n      return {\n        imageLoaded: false,\n        imageLoadFailed: 0,\n        prevImgUrls: props.imgUrls,\n        tokenImagesLoaded: {\n          stunned: state.tokenImagesLoaded.stunned,\n          confused: state.tokenImagesLoaded.confused,\n          tough: state.tokenImagesLoaded.tough,\n        },\n      };\n    }\n    // No state update necessary\n    return null;\n  }\n\n  private imgs: HTMLImageElement[] = [];\n  private stunnedImg: HTMLImageElement;\n  private confusedImg: HTMLImageElement;\n  private toughImg: HTMLImageElement;\n  private unmounted: boolean;\n  private touchTimer: any = null;\n  private rect: RectRef | null = null;\n  private shuffleToggle = false;\n\n  constructor(props: IProps) {\n    super(props);\n\n    this.unmounted = true;\n\n    this.state = {\n      imageLoaded: false,\n      imageLoadFailed: 0,\n      prevImgUrls: this.props.imgUrls,\n      tokenImagesLoaded: {\n        stunned: false,\n        confused: false,\n        tough: false,\n      },\n    };\n\n    this.initCardImages(props);\n\n    this.stunnedImg = new Image();\n    this.confusedImg = new Image();\n    this.toughImg = new Image();\n\n    // STUNNED\n    this.stunnedImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          tokenImagesLoaded: {\n            stunned: true,\n            confused: this.state.tokenImagesLoaded.confused,\n            tough: this.state.tokenImagesLoaded.tough,\n          },\n        });\n      }\n    };\n\n    const tokenInfo = GamePropertiesMap[props.currentGameType].tokens;\n\n    if (!!props.cardState?.stunned && !!tokenInfo.stunned) {\n      this.stunnedImg.src = tokenInfo.stunned.imagePath;\n    }\n\n    // CONFUSED\n    this.confusedImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          tokenImagesLoaded: {\n            stunned: this.state.tokenImagesLoaded.stunned,\n            confused: true,\n            tough: this.state.tokenImagesLoaded.tough,\n          },\n        });\n      }\n    };\n\n    if (!!props.cardState?.confused && !!tokenInfo.confused) {\n      this.confusedImg.src = tokenInfo.confused.imagePath;\n    }\n\n    // TOUGH\n    this.toughImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          tokenImagesLoaded: {\n            stunned: this.state.tokenImagesLoaded.stunned,\n            confused: this.state.tokenImagesLoaded.confused,\n            tough: true,\n          },\n        });\n      }\n    };\n\n    if (!!props.cardState?.tough && !!tokenInfo.tough) {\n      this.toughImg.src = tokenInfo.tough.imagePath;\n    }\n  }\n\n  public componentDidUpdate(prevProps: IProps, prevState: IState) {\n    // if we just went from not shuffling -> shuffling, animate\n    if (!prevProps.shuffling && this.props.shuffling) {\n      if (!!this.rect) {\n        this.shuffleToggle = !this.shuffleToggle;\n        this.rect.to({\n          rotation: this.currentRotation + (this.shuffleToggle ? 360 : -360),\n          duration: 0.2,\n        });\n      }\n    }\n\n    if (\n      !this.state.imageLoaded &&\n      !stringArraysEqual(prevProps.imgUrls, this.props.imgUrls)\n    ) {\n      this.setState({\n        imageLoaded: false,\n        imageLoadFailed: 0,\n      });\n      this.initCardImages(this.props);\n    }\n\n    const tokenInfo = GamePropertiesMap[this.props.currentGameType].tokens;\n\n    // STUNNED\n    if (\n      !this.state.tokenImagesLoaded.stunned &&\n      !prevProps.cardState?.stunned &&\n      !!this.props.cardState?.stunned &&\n      !!tokenInfo.stunned\n    ) {\n      this.stunnedImg.src = tokenInfo.stunned.imagePath;\n    }\n\n    // CONFUSED\n    if (\n      !this.state.tokenImagesLoaded.confused &&\n      !prevProps.cardState?.confused &&\n      !!this.props.cardState?.confused &&\n      !!tokenInfo.confused\n    ) {\n      this.confusedImg.src = tokenInfo.confused.imagePath;\n    }\n\n    // TOUGH\n    if (\n      !this.state.tokenImagesLoaded.tough &&\n      !prevProps.cardState?.tough &&\n      !!this.props.cardState?.tough &&\n      !!tokenInfo.tough\n    ) {\n      this.toughImg.src = tokenInfo.tough.imagePath;\n    }\n  }\n\n  private initCardImages = (props: IProps) => {\n    this.imgs = props.imgUrls.map(() => new Image());\n\n    // When the image loads, set a flag in the state\n    this.imgs.forEach(\n      (img) =>\n        (img.onload = () => {\n          if (!this.unmounted) {\n            this.setState({\n              imageLoaded: true,\n            });\n          }\n        })\n    );\n\n    this.imgs.forEach(\n      (img) =>\n        (img.onerror = () => {\n          if (!this.unmounted) {\n            this.setState({\n              imageLoadFailed: this.state.imageLoadFailed + 1,\n            });\n          }\n        })\n    );\n\n    props.imgUrls.forEach((imgUrl, index) => (this.imgs[index].src = imgUrl));\n  };\n\n  public componentDidMount() {\n    this.unmounted = false;\n  }\n\n  public componentWillUnmount() {\n    this.unmounted = true;\n  }\n\n  public render() {\n    return this.renderCard(this.state.imageLoaded);\n  }\n\n  private renderCard(imageLoaded: boolean) {\n    const heightToUse = this.props.height || cardConstants.CARD_HEIGHT;\n    const widthToUse = this.props.width || cardConstants.CARD_WIDTH;\n\n    return this.renderUnanimatedCard(heightToUse, widthToUse, imageLoaded);\n  }\n\n  // Unfortunately, if you try to use shadow / blur to indicate selection\n  // (which I did at first and looks better, imo) the performance in horrible,\n  // even with some reccommended settings (shadowForStrokeEnabled = false and\n  // hitStrokeWidth = 0). So we'll just use stroke / border for everything\n  private getStrokeColor = () => {\n    if (!!this.props.dropTargetColor) {\n      return this.props.dropTargetColor;\n    }\n\n    if (this.props.selected) {\n      return this.props.selectedColor;\n    }\n\n    return \"\";\n  };\n\n  private renderUnanimatedCard = (\n    heightToUse: number,\n    widthToUse: number,\n    imageLoaded: boolean\n  ) => {\n    const imgToUse = imageLoaded\n      ? this.imgs.find((i) => i.complete && i.naturalHeight !== 0)\n      : undefined;\n\n    const scale = this.getScale(imgToUse, widthToUse, heightToUse);\n    const offset = {\n      x: widthToUse / 2,\n      y: heightToUse / 2,\n    };\n\n    const card = (\n      <Spring\n        key={`${this.props.id}-card`}\n        to={{\n          rotation: this.props.exhausted ? 90 : 0,\n        }}\n      >\n        {(animatedProps: any) => (\n          <animated.Rect\n            {...animatedProps}\n            ref={(node) => {\n              if (!!node) {\n                this.rect = node;\n              }\n            }}\n            cornerRadius={9}\n            x={this.props.x}\n            y={this.props.y}\n            width={widthToUse}\n            height={heightToUse}\n            offset={offset}\n            stroke={this.getStrokeColor()}\n            strokeWidth={!!this.getStrokeColor() ? 4 : 0}\n            fillPatternRotation={\n              !imageLoaded ||\n              this.shouldRenderImageHorizontal(\n                this.props.code,\n                this.props.typeCode || \"\",\n                HORIZONTAL_TYPE_CODES\n              )\n                ? 270\n                : 0\n            }\n            fillPatternImage={imgToUse}\n            fillPatternScaleX={scale.width}\n            fillPatternScaleY={scale.height}\n            fill={imageLoaded ? undefined : \"gray\"}\n            shadowForStrokeEnabled={false}\n            hitStrokeWidth={0}\n            opacity={this.props.isGhost ? 0.5 : 1}\n            draggable={\n              this.props.controlledBy === \"\" ||\n              this.props.controlledBy === myPeerRef\n            }\n            onDragStart={this.handleDragStart}\n            onDragMove={this.handleDragMove}\n            onDragEnd={this.handleDragEnd}\n            onDblClick={this.handleDoubleClick}\n            onDblTap={this.handleDoubleTap}\n            onClick={this.handleClick}\n            onTap={this.handleTap}\n            onMouseDown={this.handleMouseDown}\n            onTouchStart={this.handleTouchStart}\n            onTouchMove={this.handleTouchMove}\n            onTouchEnd={this.handleTouchEnd}\n            onMouseOver={this.handleMouseOver}\n            onMouseOut={this.handleMouseOut}\n            onContextMenu={this.handleContextMenu}\n          />\n        )}\n      </Spring>\n    );\n\n    const cardStackOffset = {\n      x: offset.x + 4,\n      y: offset.y - 4,\n    };\n\n    const cardStack =\n      (this.props.numCardsInStack || 1) > 1 ? (\n        <Spring\n          key={`${this.props.id}-cardStack`}\n          to={{\n            rotation: this.props.exhausted ? 90 : 0,\n          }}\n        >\n          {(animatedProps: any) => (\n            <animated.Rect\n              {...animatedProps}\n              cornerRadius={[9, 9, 9, 9]}\n              x={this.props.x}\n              y={this.props.y}\n              width={widthToUse}\n              height={heightToUse}\n              offset={cardStackOffset}\n              opacity={this.props.isGhost ? 0.5 : 1}\n              fill={\"gray\"}\n              shadowForStrokeEnabled={false}\n              hitStrokeWidth={0}\n            />\n          )}\n        </Spring>\n      ) : null;\n\n    const shouldRenderStunned =\n      !!this.props.cardState?.stunned && this.state.tokenImagesLoaded.stunned;\n\n    const stunnedToken = this.getTokenInSlot(\n      shouldRenderStunned,\n      this.stunnedImg,\n      offset,\n      0\n    );\n    const confusedToken = this.getTokenInSlot(\n      !!this.props.cardState?.confused && this.state.tokenImagesLoaded.confused,\n      this.confusedImg,\n      offset,\n      1\n    );\n    const toughToken = this.getTokenInSlot(\n      !!this.props.cardState?.tough && this.state.tokenImagesLoaded.tough,\n      this.toughImg,\n      offset,\n      2\n    );\n\n    const cardTokens =\n      this.props.dragging || this.props.isGhost ? null : (\n        <CardTokensContainer\n          currentGameType={this.props.currentGameType}\n          key={`${this.props.id}-cardTokens`}\n          id={this.props.id}\n          x={this.props.x}\n          y={this.props.y}\n        ></CardTokensContainer>\n      );\n\n    const noImageCardNameText = this.renderCardName(\n      offset,\n      widthToUse,\n      heightToUse\n    );\n\n    return [\n      cardStack,\n      card,\n      noImageCardNameText,\n      stunnedToken,\n      confusedToken,\n      toughToken,\n      cardTokens,\n    ];\n  };\n\n  private renderCardName(\n    offset: Vector2d,\n    cardWidth: number,\n    cardHeight: number\n  ) {\n    const textOffset = { x: offset.x - 10, y: offset.y - 20 };\n    const textItem =\n      this.state.imageLoadFailed === this.props.imgUrls.length &&\n      this.state.imageLoadFailed !== 0 ? (\n        <Text\n          key={`${this.props.id}-cardnametext`}\n          offset={textOffset}\n          x={this.props.x}\n          y={this.props.y}\n          width={cardWidth - 10}\n          height={cardHeight - 20}\n          fontSize={24}\n          text={`${this.props.name} ${this.props.code}`}\n          draggable={\n            this.props.controlledBy === \"\" ||\n            this.props.controlledBy === myPeerRef\n          }\n          onDragStart={this.handleDragStart}\n          onDragMove={this.handleDragMove}\n          onDragEnd={this.handleDragEnd}\n          onDblClick={this.handleDoubleClick}\n          onDblTap={this.handleDoubleClick}\n          onClick={this.handleClick}\n          onTap={this.handleClick}\n          onMouseDown={this.handleMouseDown}\n          onTouchStart={this.handleMouseDown}\n          onMouseOver={this.handleMouseOver}\n          onMouseOut={this.handleMouseOut}\n          onContextMenu={this.handleContextMenu}\n        ></Text>\n      ) : null;\n\n    return textItem;\n  }\n\n  private getTokenInSlot(\n    shouldRender: boolean,\n    img: HTMLImageElement,\n    offset: { x: number; y: number },\n    slot: 0 | 1 | 2\n  ) {\n    const dimensions = {\n      width: img.naturalWidth / 2,\n      height: img.naturalHeight / 2,\n    };\n\n    const stunnedOffset = {\n      x: offset.x - cardConstants.CARD_WIDTH + dimensions.width / 2,\n      y: offset.y - dimensions.height * slot - 5 * (slot + 1) - 10,\n    };\n\n    return shouldRender ? (\n      <Rect\n        key={`${this.props.id}-status${slot}`}\n        native={true}\n        cornerRadius={8}\n        x={this.props.x}\n        y={this.props.y}\n        width={dimensions.width}\n        height={dimensions.height}\n        fillPatternScaleX={0.5}\n        fillPatternScaleY={0.5}\n        offset={stunnedOffset}\n        fillPatternImage={img}\n      />\n    ) : null;\n  }\n\n  private shouldRenderImageHorizontal(\n    code: string,\n    type: string,\n    typeCodes: string[]\n  ): boolean {\n    const shouldRotateByType =\n      typeCodes.includes(type.toLocaleLowerCase()) && !this.plainCardBack;\n    return shouldRotateByType && !CARD_ALREADY_ROTATED_MAP[code];\n  }\n\n  private get plainCardBack() {\n    return (\n      this.props.imgUrls.some((i) => i.includes(\"standard\")) &&\n      this.props.imgUrls.some((i) => i.includes(\"_back\"))\n    );\n  }\n\n  private get currentRotation() {\n    return this.props.exhausted ? 90 : 0;\n  }\n\n  private getScale(\n    img: HTMLImageElement | undefined,\n    widthToUse: number,\n    heightToUse: number\n  ) {\n    const width = !!img ? widthToUse / img.naturalWidth : widthToUse;\n\n    const widthHorizontal = !!img ? heightToUse / img.naturalWidth : widthToUse;\n\n    const height = !!img ? heightToUse / img.naturalHeight : heightToUse;\n\n    const heightHorizontal = !!img\n      ? widthToUse / img.naturalHeight\n      : heightToUse;\n\n    return this.shouldRenderImageHorizontal(\n      this.props.code,\n      this.props.typeCode || \"\",\n      HORIZONTAL_TYPE_CODES\n    )\n      ? { width: widthHorizontal, height: heightHorizontal }\n      : { width, height };\n  }\n\n  private handleContextMenu = (event: KonvaEventObject<PointerEvent>): void => {\n    if (!!this.props.handleContextMenu) {\n      this.props.handleContextMenu(this.props.id, event);\n    }\n  };\n\n  private handleDoubleClick = (event: KonvaEventObject<MouseEvent>) => {\n    if (this.props.handleDoubleClick) {\n      this.props.handleDoubleClick(this.props.id, event);\n    }\n  };\n\n  private handleDoubleTap = (event: KonvaEventObject<TouchEvent>) => {\n    if (this.props.handleDoubleTap) {\n      this.props.handleDoubleTap(this.props.id, event);\n    }\n  };\n\n  private handleDragStart = (event: KonvaEventObject<DragEvent>) => {\n    if (this.props.handleDragStart) {\n      this.props.handleDragStart(this.props.id, event);\n    }\n  };\n\n  private handleDragMove = (event: any) => {\n    if (this.props.handleDragMove) {\n      this.props.handleDragMove({\n        id: this.props.id,\n        dx: event.target.x() - this.props.x,\n        dy: event.target.y() - this.props.y,\n      });\n    }\n  };\n\n  private handleDragEnd = () => {\n    if (this.props.handleDragEnd && this.props.dragging) {\n      this.props.handleDragEnd(this.props.id);\n    }\n  };\n\n  private handleTap = (event: KonvaEventObject<MouseEvent>) => {\n    this.handleTapOrClick(event, true);\n  };\n\n  private handleClick = (event: KonvaEventObject<MouseEvent>) => {\n    this.handleTapOrClick(event, false);\n  };\n\n  private handleTapOrClick = (\n    event: KonvaEventObject<MouseEvent>,\n    wasTouch: boolean\n  ) => {\n    if (this.props.handleClick) {\n      this.props.handleClick(this.props.id, event, wasTouch);\n      event.cancelBubble = true;\n    }\n  };\n\n  private handleMouseDown = (event: any) => {\n    event.cancelBubble = true;\n  };\n\n  private handleTouchStart = (event: KonvaEventObject<TouchEvent>) => {\n    event.cancelBubble = true;\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n\n    this.touchTimer = setTimeout(() => {\n      this.handleContextMenu(\n        event as unknown as KonvaEventObject<PointerEvent>\n      );\n    }, 750);\n  };\n\n  private handleTouchMove = (event: KonvaEventObject<TouchEvent>) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n  };\n\n  private handleTouchEnd = (event: KonvaEventObject<TouchEvent>) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n  };\n\n  private handleMouseOver = () => {\n    if (this.props.handleHover) {\n      this.props.handleHover(this.props.id);\n    }\n  };\n\n  private handleMouseOut = () => {\n    if (this.props.handleHoverLeave) {\n      this.props.handleHoverLeave(this.props.id);\n    }\n  };\n}\n\nexport default Card;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport Autocomplete from \"@material-ui/lab/Autocomplete\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { CardData } from \"./external-api/common-card-data\";\nimport { ICardData } from \"./features/cards-data/initialState\";\nimport { ICardStack } from \"./features/cards/initialState\";\nimport { AutocompleteHighlightChangeReason } from \"@material-ui/lab/useAutocomplete\";\ninterface IProps {\n  cardsDataEntities: ICardData;\n  card: ICardStack;\n  cardSelected: (jsonId: string) => void;\n  preview: (jsonId: string) => void;\n  clearPreview: () => void;\n}\n\nclass CardStackCardSelector extends Component<IProps> {\n  private cardsDataInStack: CardData[] = [];\n\n  constructor(props: IProps) {\n    super(props);\n    this.cardsDataInStack = props.card.cardStack.map((c) => {\n      return this.props.cardsDataEntities[c.jsonId];\n    });\n  }\n\n  componentWillUnmount() {\n    this.props.clearPreview();\n  }\n\n  render() {\n    return (\n      <div onClick={this.cancelBubble} onKeyPress={this.cancelBubble}>\n        <Autocomplete\n          id=\"cardstack-card-selector-combobox\"\n          options={this.cardsDataInStack}\n          getOptionLabel={(option) => option.name}\n          style={{ width: 300 }}\n          onChange={this.handleSelected}\n          onHighlightChange={this.handleHighlightChange}\n          renderInput={(params) => (\n            <TextField {...params} label=\"Find Card...\" variant=\"outlined\" />\n          )}\n        />\n      </div>\n    );\n  }\n\n  private handleHighlightChange = (\n    _event: any,\n    option: CardData | null,\n    reason: AutocompleteHighlightChangeReason\n  ) => {\n    if (!option) {\n      this.props.clearPreview();\n    } else {\n      this.props.preview(option.code);\n    }\n  };\n\n  private handleSelected = (_event: any, value: CardData | null) => {\n    this.props.clearPreview();\n    if (!!value && !!this.props.cardSelected) {\n      this.props.cardSelected(value.code);\n    }\n  };\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n}\n\nexport default CardStackCardSelector;\n","import { connect } from \"react-redux\";\nimport CardStackCardSelector from \"./CardStackCardSelector\";\nimport { getCardsDataEntities } from \"./features/cards-data/cards-data.selectors\";\nimport {\n  clearMenuPreviewCardJsonId,\n  setMenuPreviewCardJsonId,\n} from \"./features/game/game.slice\";\n\nimport { RootState } from \"./store/rootReducer\";\n\nconst mapStateToProps = (state: RootState) => {\n  return {\n    cardsDataEntities: getCardsDataEntities(state),\n  };\n};\n\nconst CardStackCardSelectorContainer = connect(mapStateToProps, {\n  preview: setMenuPreviewCardJsonId,\n  clearPreview: clearMenuPreviewCardJsonId,\n})(CardStackCardSelector);\n\nexport default CardStackCardSelectorContainer;\n","import MenuItem from \"@material-ui/core/MenuItem\";\nimport React from \"react\";\n\ninterface IProps {\n  label: string;\n  key?: string;\n  handleFile: (file: File) => void;\n}\n\nconst FileUploader = (props: IProps) => {\n  // Create a reference to the hidden file input element\n  const hiddenFileInput = React.useRef<HTMLInputElement>(null);\n\n  // Programatically click the hidden file input element\n  // when the Button component is clicked\n  const handleClick = (event: React.MouseEvent) => {\n    if (!!hiddenFileInput?.current) {\n      var evt = document.createEvent(\"MouseEvents\");\n      evt.initEvent(\"click\", true, false);\n      hiddenFileInput.current.dispatchEvent(evt);\n    }\n    event.stopPropagation();\n  };\n  // Call a function (passed as a prop from the parent component)\n  // to handle the user-selected file\n  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    if (!!event.target.files && event.target.files.length > 0) {\n      const fileUploaded = event.target.files[0];\n      props.handleFile(fileUploaded);\n    }\n  };\n  return (\n    <>\n      <MenuItem onClick={handleClick}>{props.label}</MenuItem>\n      <input\n        type=\"file\"\n        ref={hiddenFileInput}\n        onChange={handleChange}\n        style={{ display: \"none\" }}\n      />\n    </>\n  );\n};\n\nexport default FileUploader;\n","import { Vector2d } from \"konva/lib/types\";\nimport * as React from \"react\";\nimport { Component } from \"react\";\nimport Menu from \"@material-ui/core/Menu\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport NestedMenuItem from \"material-ui-nested-menu-item\";\nimport FileUploader from \"./FileUploader\";\n\nexport interface ContextMenuItem {\n  label: string;\n  action?: () => void;\n  fileLoadedAction?: (fileContents: string) => void;\n  children?: ContextMenuItem[];\n  fileUploader?: boolean;\n}\n\ninterface IProps {\n  position: Vector2d;\n  items: ContextMenuItem[];\n  contextItemClicked?: (item: ContextMenuItem) => void;\n  hideContextMenu: () => void;\n}\n\ninterface IState {\n  menuOpen: boolean;\n}\n\nconst isTargetFileInput = (target: EventTarget) => {\n  const targetAsInput = target as HTMLInputElement;\n  return !!targetAsInput?.files;\n};\n\nclass ContextMenu extends Component<IProps, IState> {\n  private nestedRef: any;\n\n  constructor(props: IProps) {\n    super(props);\n\n    this.state = {\n      menuOpen: true,\n    };\n  }\n\n  render() {\n    return (\n      <div\n        id=\"context-menu-layer\"\n        onContextMenu={this.preventDefault}\n        onClick={(event) => {\n          if (!isTargetFileInput(event.target)) {\n            this.props.hideContextMenu();\n          }\n        }}\n      >\n        <Menu\n          keepMounted\n          open={this.state.menuOpen}\n          onClose={this.handleMenuClosed}\n          anchorReference=\"anchorPosition\"\n          anchorPosition={{\n            top: this.props.position.y + 8,\n            left: this.props.position.x + 8,\n          }}\n        >\n          {this.props.items.map((i, index) => this.renderMenuItem(i, index))}\n        </Menu>\n      </div>\n    );\n  }\n\n  private renderMenuItem = (i: ContextMenuItem, index: number) => {\n    if (!!i.children) {\n      return (\n        <NestedMenuItem\n          ref={(val) => {\n            this.nestedRef = val;\n          }}\n          key={`contextMenu-item-${index}`}\n          parentMenuOpen={this.state.menuOpen}\n          label={i.label}\n          onClick={(event) => {\n            if (!!this.nestedRef) {\n              event.stopPropagation();\n              // This is a hack to force the nested menu to open on touch devices.\n              // the `NestedMenuItem` library doesn't correctly support touch events, only hover\n              this.nestedRef.parentElement.focus();\n            }\n          }}\n        >\n          {i.children.map((nestedI, nestedIndex) => {\n            return this.renderMenuItem(nestedI, index * 1000 + nestedIndex);\n          })}\n        </NestedMenuItem>\n      );\n    } else if (!!i.fileUploader) {\n      return (\n        <FileUploader\n          label={i.label}\n          key={`contextMenu-item-${index}`}\n          handleFile={(file) => {\n            // setting up the reader\n            const reader = new FileReader();\n            reader.readAsText(file, \"UTF-8\");\n\n            // here we tell the reader what to do when it's done reading...\n            reader.onload = (readerEvent) => {\n              const content: string = readerEvent.target?.result as string; // this is the content!\n              if (!!i.fileLoadedAction) {\n                i.fileLoadedAction(content);\n              }\n              this.props.hideContextMenu();\n            };\n          }}\n        ></FileUploader>\n      );\n    } else {\n      return (\n        <MenuItem\n          key={`contextMenu-item-${index}`}\n          onClick={this.handleContextItemClicked(i)}\n        >\n          {i.label}\n        </MenuItem>\n      );\n    }\n  };\n\n  private handleMenuClosed = () => {\n    this.setState({\n      menuOpen: false,\n    });\n    this.props.hideContextMenu();\n  };\n  private preventDefault = (\n    event: React.MouseEvent<HTMLElement, MouseEvent>\n  ) => {\n    event.preventDefault();\n  };\n\n  private handleContextItemClicked = (item: ContextMenuItem) => () => {\n    if (!!item.action) {\n      item.action();\n    }\n    if (!!this.props.contextItemClicked) {\n      this.props.contextItemClicked(this.props.items[0]);\n    }\n    if (!!item.action) {\n      if (!!this.nestedRef) {\n        this.nestedRef.blur();\n      }\n      this.props.hideContextMenu();\n    }\n  };\n}\n\nexport default ContextMenu;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport { Vector2d } from \"konva/lib/types\";\nimport { Group, Rect, Text } from \"react-konva\";\nimport { KonvaEventObject } from \"konva/lib/Node\";\nimport { PlayerColor } from \"./constants/app-constants\";\n\ninterface IProps {\n  id: string;\n  pos: Vector2d;\n  value: number;\n  color: PlayerColor;\n  updateCounterValueBy: (amount: number) => void;\n  handleContextMenu: (event: KonvaEventObject<PointerEvent>) => void;\n  onDragEnd: (event: KonvaEventObject<DragEvent>) => void;\n}\n\nclass Counter extends Component<IProps> {\n  private touchTimer: any = null;\n\n  render() {\n    return (\n      <Group\n        x={this.props.pos.x}\n        y={this.props.pos.y}\n        draggable={true}\n        onClick={this.cancelBubble}\n        onContextMenu={this.props.handleContextMenu}\n        onDragEnd={this.props.onDragEnd}\n        onTouchStart={this.handleTouchStart}\n        onMouseDown={this.cancelBubble}\n        onTouchMove={this.handleTouchMove}\n        onTouchEnd={this.handleTouchEnd}\n      >\n        <Rect\n          cornerRadius={30}\n          width={200}\n          height={100}\n          fill={this.props.color}\n        ></Rect>\n        <Text\n          width={200}\n          height={100}\n          fontSize={36}\n          text={`${this.props.value}`}\n          align={\"center\"}\n          verticalAlign={\"middle\"}\n        ></Text>\n        <Text\n          x={10}\n          y={25}\n          width={50}\n          height={50}\n          fontSize={36}\n          text={`-`}\n          align={\"center\"}\n          verticalAlign={\"middle\"}\n          onClick={this.handleDecrement}\n          onTap={this.handleDecrement}\n        ></Text>\n        <Text\n          x={140}\n          y={25}\n          width={50}\n          height={50}\n          fontSize={36}\n          text={`+`}\n          align={\"center\"}\n          verticalAlign={\"middle\"}\n          onClick={this.handleIncrement}\n          onTap={this.handleIncrement}\n        ></Text>\n      </Group>\n    );\n  }\n\n  private cancelBubble = (event: KonvaEventObject<MouseEvent>) => {\n    event.cancelBubble = true;\n  };\n\n  private handleDecrement = () => {\n    this.props.updateCounterValueBy(-1);\n  };\n\n  private handleIncrement = () => {\n    this.props.updateCounterValueBy(1);\n  };\n\n  private handleTouchStart = (event: KonvaEventObject<TouchEvent>) => {\n    event.cancelBubble = true;\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n\n    this.touchTimer = setTimeout(() => {\n      this.props.handleContextMenu(\n        event as unknown as KonvaEventObject<PointerEvent>\n      );\n    }, 750);\n  };\n\n  private handleTouchMove = (event: KonvaEventObject<TouchEvent>) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n  };\n\n  private handleTouchEnd = (event: KonvaEventObject<TouchEvent>) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n  };\n}\n\nexport default Counter;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport TextField from \"@material-ui/core/TextField\";\n\ninterface IProps {\n  loadDeckId: (id: number) => void;\n}\n\nclass DeckLoader extends Component<IProps> {\n  inputValue: string = \"\";\n\n  private focusInputField = (input: any) => {\n    if (input) {\n      setTimeout(() => {\n        input.querySelector(\"input\").focus();\n      }, 100);\n    }\n  };\n\n  render() {\n    return (\n      <div\n        onClick={this.cancelBubble}\n        onKeyPress={this.cancelBubble}\n        className=\"token-field-row\"\n      >\n        <TextField\n          ref={this.focusInputField}\n          onKeyPress={this.handleKeyPress}\n          onClick={this.cancelBubble}\n          onChange={(event) => {\n            this.inputValue = event.target.value;\n          }}\n          type=\"number\"\n          variant=\"outlined\"\n        ></TextField>{\" \"}\n      </div>\n    );\n  }\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n\n  private handleKeyPress = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    if (event.key.toLocaleLowerCase() === \"enter\") {\n      this.props.loadDeckId(+this.inputValue);\n    }\n  };\n}\n\nexport default DeckLoader;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport { IEncounterEntity } from \"./features/cards-data/cards-data.selectors\";\nimport Autocomplete from \"@material-ui/lab/Autocomplete\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { GamePropertiesMap } from \"./constants/game-type-properties-mapping\";\nimport { GameType } from \"./constants/app-constants\";\ninterface IProps {\n  currentGameType: GameType;\n  encounterData: IEncounterEntity[];\n  loadCards: (cards: string[][]) => void;\n}\n\nclass EncounterLoader extends Component<IProps> {\n  render() {\n    return (\n      <div onClick={this.cancelBubble} onKeyPress={this.cancelBubble}>\n        <Autocomplete\n          id=\"encounter-loader-combobox\"\n          options={this.props.encounterData || []}\n          getOptionLabel={(option) => option.setData.name}\n          style={{ width: 300 }}\n          onChange={this.handleSelected}\n          renderInput={(params) => (\n            <TextField\n              {...params}\n              label={\n                GamePropertiesMap[this.props.currentGameType].encounterUiName\n              }\n              variant=\"outlined\"\n            />\n          )}\n        />\n      </div>\n    );\n  }\n\n  private handleSelected = (_event: any, value: IEncounterEntity | null) => {\n    if (!!value) {\n      let questCards: string[] = [];\n      let encounterCards: string[] = [];\n      const filteredCards = value.cards\n        // We don't want cards that show up as another card's 'back_link' to be loaded as separate cards\n        .filter((c) => !value.cards.some((oc) => oc.backLink === c.code));\n\n      filteredCards\n        .filter((c) => c.typeCode.toLocaleLowerCase() === \"quest\")\n        .forEach((c) => {\n          questCards = questCards.concat(\n            Array.from({ length: c.quantity }).map((_i) => c.code)\n          );\n        });\n\n      filteredCards\n        .filter((c) => c.typeCode.toLocaleLowerCase() !== \"quest\")\n        .forEach((c) => {\n          encounterCards = encounterCards.concat(\n            Array.from({ length: c.quantity }).map((_i) => c.code)\n          );\n        });\n      let totalCards = [encounterCards];\n      if (questCards.length > 0) {\n        totalCards = [questCards].concat(totalCards);\n      }\n\n      this.props.loadCards(totalCards);\n    }\n  };\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n}\n\nexport default EncounterLoader;\n","import { connect } from \"react-redux\";\nimport { GameType } from \"./constants/app-constants\";\nimport EncounterLoader from \"./EncounterLoader\";\nimport {\n  getCardsDataEncounterEntitiesBySetCode,\n  getCardsDataSetDataAsEncounterEntities,\n} from \"./features/cards-data/cards-data.selectors\";\n\nimport { RootState } from \"./store/rootReducer\";\n\ninterface IProps {\n  currentGameType: GameType;\n}\n\nconst mapStateToProps = (state: RootState, ownProps: IProps) => {\n  return {\n    encounterData:\n      ownProps.currentGameType === GameType.LordOfTheRingsLivingCardGame\n        ? getCardsDataSetDataAsEncounterEntities(state)\n        : getCardsDataEncounterEntitiesBySetCode(state),\n  };\n};\n\nconst EncounterLoaderContainer = connect(mapStateToProps, {})(EncounterLoader);\n\nexport default EncounterLoaderContainer;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport { Rect } from \"react-konva\";\nimport { Vector2d } from \"konva/lib/types\";\nimport { KonvaEventObject } from \"konva/lib/Node\";\nimport { GameType } from \"./constants/app-constants\";\n\ninterface IProps {\n  currentGameType: GameType;\n  pos: Vector2d;\n  updatePos: (newPos: Vector2d) => void;\n}\n\ninterface IState {\n  img: HTMLImageElement | null;\n}\n\nclass FirstPlayerToken extends Component<IProps, IState> {\n  constructor(props: IProps) {\n    super(props);\n\n    this.state = {\n      img: null,\n    };\n  }\n\n  public componentDidMount() {\n    const image = new Image();\n    image.onload = () => {\n      this.setState({\n        img: image,\n      });\n    };\n    image.src =\n      process.env.PUBLIC_URL +\n      \"/images/table/first_player_token_\" +\n      this.props.currentGameType +\n      \".png\";\n  }\n\n  render() {\n    return (\n      <Rect\n        x={this.props.pos.x}\n        y={this.props.pos.y}\n        draggable={true}\n        onTouchStart={this.cancelBubble}\n        onMouseDown={this.cancelBubble}\n        onDragEnd={this.handleDragEnd}\n        scale={{\n          x: 160 / (this.state.img?.naturalWidth ?? 1),\n          y: 160 / (this.state.img?.naturalWidth ?? 1),\n        }}\n        width={this.state.img?.naturalWidth ?? 0}\n        height={this.state.img?.naturalHeight ?? 0}\n        fillPatternImage={this.state.img ?? undefined}\n      ></Rect>\n    );\n  }\n\n  private cancelBubble = (\n    e: KonvaEventObject<MouseEvent> | KonvaEventObject<TouchEvent>\n  ) => {\n    e.cancelBubble = true;\n  };\n\n  private handleDragEnd = (event: KonvaEventObject<DragEvent>) => {\n    this.props.updatePos({\n      x: event.target.x(),\n      y: event.target.y(),\n    });\n  };\n}\n\nexport default FirstPlayerToken;\n","import { createSelector } from \"@reduxjs/toolkit\";\nimport { RootState } from \"../../store/rootReducer\";\n\nexport const getCounters = (state: RootState) =>\n  state.liveState.present.counters;\n\nexport const getCurrentCounters = createSelector(getCounters, (counters) => {\n  return counters.counters;\n});\n\nexport const getFirstPlayerTokenPos = createSelector(\n  getCounters,\n  (counters) => counters.firstPlayerCounterPosition\n);\n","import { connect } from \"react-redux\";\nimport FirstPlayerToken from \"./FirstPlayerToken\";\nimport { moveFirstPlayerCounter } from \"./features/counters/counters.slice\";\nimport { RootState } from \"./store/rootReducer\";\nimport { getFirstPlayerTokenPos } from \"./features/counters/counters.selectors\";\n\nconst mapStateToProps = (state: RootState) => {\n  return {\n    pos: getFirstPlayerTokenPos(state),\n  };\n};\n\nconst FirstPlayerTokenContainer = connect(mapStateToProps, {\n  updatePos: moveFirstPlayerCounter,\n})(FirstPlayerToken);\n\nexport default FirstPlayerTokenContainer;\n","import { Component } from \"react\";\nimport * as React from \"react\";\ninterface IProps {\n  connect: (peerId: string) => void;\n}\n\nclass PeerConnector extends Component<IProps> {\n  public inputRef: HTMLInputElement | null = null;\n\n  render() {\n    return (\n      <div onClick={this.cancelBubble} onKeyPress={this.cancelBubble}>\n        <input\n          ref={(ref) => {\n            if (!ref) return;\n            this.inputRef = ref;\n          }}\n        ></input>\n        <button onClick={this.connect}>Connect</button>\n      </div>\n    );\n  }\n\n  private connect = (_event: any) => {\n    console.log(\"connecting with peer id \" + this.inputRef?.value);\n\n    this.props.connect(this.inputRef?.value || \"\");\n  };\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n}\n\nexport default PeerConnector;\n","import { createSelector } from \"@reduxjs/toolkit\";\nimport { RootState } from \"../../store/rootReducer\";\nimport { ICardStack } from \"../cards/initialState\";\n\nexport const getGame = (state: RootState) => state.game;\n\nexport const getCurrentZoom = createSelector(getGame, (game) => {\n  return game.stageZoom;\n});\n\nexport const getPlayerColors = createSelector(getGame, (game) => {\n  return game.playerColors;\n});\n\nexport const getPeerId = createSelector(getGame, (game) => game.peerId);\n\nexport const getActiveGameType = createSelector(\n  getGame,\n  (game) => game.activeGameType\n);\n\nexport const getRadialMenuPosition = createSelector(\n  getGame,\n  (game) => game.radialMenuPosition\n);\n\nexport const getMenuPreviewCard = createSelector(getGame, (game) => {\n  if (!game.menuPreviewCardJsonId) return null;\n\n  const menuPreviewCard: ICardStack = {\n    id: \"menu-preview-card\",\n    controlledBy: \"\",\n    exhausted: false,\n    faceup: true,\n    fill: \"gray\",\n    x: 0,\n    y: 0,\n    statusTokens: {\n      stunned: false,\n      confused: false,\n      tough: false,\n    },\n    counterTokens: {\n      damage: 0,\n      threat: 0,\n      generic: 0,\n    },\n    selected: false,\n    dragging: false,\n    shuffling: false,\n    cardStack: [{ jsonId: game.menuPreviewCardJsonId }],\n  };\n\n  return menuPreviewCard;\n});\n","import { Vector2d } from \"konva/lib/types\";\nimport * as React from \"react\";\nimport { Component } from \"react\";\nimport \"./TopLayer.scss\";\n\ninterface IProps {\n  trasparentBackground?: boolean;\n  offsetContent?: boolean;\n  position: Vector2d;\n  completed: () => void;\n}\n\nclass TopLayer extends Component<IProps> {\n  render() {\n    const offset = this.props.offsetContent ? 8 : 0;\n    const containerStyle: React.CSSProperties = {\n      top: `${this.props.position.y + offset}px`,\n      left: `${this.props.position.x + offset}px`,\n    };\n\n    if (!this.props.trasparentBackground) {\n      containerStyle.backgroundColor = \"white\";\n    }\n\n    return (\n      <div\n        id=\"top-layer\"\n        onClick={this.props.completed}\n        onContextMenu={this.preventDefault}\n      >\n        <div\n          className=\"top-layer-content-wrapper\"\n          style={containerStyle}\n          onContextMenu={this.preventDefault}\n          onClick={this.handleClick}\n        >\n          {this.props.children}\n        </div>\n      </div>\n    );\n  }\n\n  private handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    event.stopPropagation();\n    this.props.completed();\n  };\n\n  private preventDefault = (\n    event: React.MouseEvent<HTMLElement, MouseEvent>\n  ) => {\n    event.preventDefault();\n  };\n}\n\nexport default TopLayer;\n","import { connect } from \"react-redux\";\nimport { myPeerRef } from \"./constants/app-constants\";\nimport { cardsSelectedWithPeerRef } from \"./features/cards/cards.selectors\";\nimport {\n  exhaustCard,\n  flipCards,\n  toggleToken,\n  adjustCounterToken,\n  clearCardTokens,\n} from \"./features/cards/cards.slice\";\nimport {\n  shuffleStack,\n  drawCardsOutOfCardStack,\n} from \"./features/cards/cards.thunks\";\nimport { getGame, getRadialMenuPosition } from \"./features/game/game.selectors\";\nimport { hideRadialMenu } from \"./features/game/game.slice\";\nimport RadialMenu from \"./RadialMenu\";\nimport { RootState } from \"./store/rootReducer\";\n\nconst mapStateToProps = (state: RootState) => {\n  return {\n    selectedCardStacks: cardsSelectedWithPeerRef(myPeerRef)(state),\n    currentGameType: getGame(state).activeGameType,\n    position: getRadialMenuPosition(state),\n  };\n};\n\nconst RadialMenuContainer = connect(mapStateToProps, {\n  flipCards,\n  exhaustCard,\n  toggleToken,\n  shuffleStack,\n  adjustCounterToken,\n  hideRadialMenu,\n  clearCardTokens,\n  drawCardsOutOfCardStack,\n})(RadialMenu);\n\nexport default RadialMenuContainer;\n","import * as React from \"react\";\nimport { Component } from \"react\";\nimport { CounterTokenType } from \"./constants/card-constants\";\nimport TextField from \"@material-ui/core/TextField\";\nimport Button from \"@material-ui/core/Button\";\n\ninterface IProps {\n  id: string;\n  tokenType: CounterTokenType;\n  updated: (payload: {\n    id: string;\n    tokenType: CounterTokenType;\n    value: number;\n  }) => void;\n}\n\nclass TokenValueModifier extends Component<IProps> {\n  inputValue: string = \"0\";\n\n  private focusInputField = (input: any) => {\n    if (input) {\n      setTimeout(() => {\n        input.querySelector(\"input\").focus();\n      }, 100);\n    }\n  };\n\n  render() {\n    return (\n      <div\n        onClick={this.cancelBubble}\n        onKeyPress={this.cancelBubble}\n        className=\"token-field-row\"\n      >\n        <TextField\n          ref={this.focusInputField}\n          onKeyPress={this.handleKeyPress}\n          variant=\"outlined\"\n          type=\"number\"\n          onChange={(event) => {\n            this.inputValue = event.target.value;\n          }}\n        ></TextField>\n        <Button\n          onClick={this.handleClick}\n          style={{ height: \"56px\", marginLeft: \"5px\" }}\n          variant=\"outlined\"\n          color=\"primary\"\n        >\n          Set\n        </Button>\n      </div>\n    );\n  }\n\n  private handleKeyPress = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    const code = event.key.toLocaleLowerCase();\n    if (code === \"enter\") {\n      this.complete(+this.inputValue);\n    }\n  };\n\n  private handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    this.complete(+this.inputValue);\n  };\n\n  private complete = (newValue: number) => {\n    this.props.updated({\n      id: this.props.id,\n      tokenType: this.props.tokenType,\n      value: newValue,\n    });\n  };\n\n  // private preventDefault = (\n  //   event: React.MouseEvent<HTMLElement, MouseEvent>\n  // ) => {\n  //   event.preventDefault();\n  // };\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n}\n\nexport default TokenValueModifier;\n","import IconButton from \"@material-ui/core/IconButton\";\nimport * as React from \"react\";\nimport { Component } from \"react\";\nimport \"./TouchMenu.scss\";\n//Icons\nimport OpenWithIcon from \"@material-ui/icons/OpenWith\";\nimport SelectAllIcon from \"@material-ui/icons/SelectAll\";\nimport InfoIcon from \"@material-ui/icons/Info\";\n\nimport { GameType } from \"./constants/app-constants\";\nimport { CounterTokenType, StatusTokenType } from \"./constants/card-constants\";\nimport { Vector2d } from \"konva/lib/types\";\n\ninterface IProps {\n  anyCardsSelected: boolean;\n  currentGameType: GameType | null;\n  panMode: boolean;\n  multiselectMode: boolean;\n  togglePanMode: () => void;\n  toggleMultiselectMode: () => void;\n  flipCards: () => void;\n  exhaustCard: (id?: string) => void;\n  toggleToken: (payload: {\n    id?: string;\n    tokenType: StatusTokenType;\n    value?: boolean;\n  }) => void;\n  shuffleStack: (id?: string) => void;\n  adjustCounterToken: (payload: {\n    id?: string;\n    tokenType: CounterTokenType;\n    delta?: number;\n    value?: number;\n  }) => void;\n  showRadialMenuAtPosition: (payload: Vector2d) => void;\n}\nclass TouchMenu extends Component<IProps> {\n  render() {\n    return (\n      <div className=\"touch-menu\">\n        <IconButton\n          className={this.props.panMode ? \"toggle-on\" : \"\"}\n          onClick={() => {\n            this.props.togglePanMode();\n          }}\n        >\n          <OpenWithIcon fontSize=\"large\" />\n        </IconButton>\n        <IconButton\n          className={this.props.multiselectMode ? \"toggle-on\" : \"\"}\n          onClick={() => {\n            this.props.toggleMultiselectMode();\n          }}\n        >\n          <SelectAllIcon fontSize=\"large\" />\n        </IconButton>\n        <IconButton\n          onClick={() => {\n            if (this.props.anyCardsSelected) {\n              this.props.showRadialMenuAtPosition({ x: 0, y: 0 });\n            }\n          }}\n        >\n          <InfoIcon fontSize=\"large\" />\n        </IconButton>\n      </div>\n    );\n  }\n}\n\nexport default TouchMenu;\n","import { connect } from \"react-redux\";\nimport {\n  anyCardsSelectedWithPeerRef,\n  getMultiselectMode,\n  getPanMode,\n} from \"./features/cards/cards.selectors\";\nimport {\n  exhaustCard,\n  flipCards,\n  togglePanMode,\n  toggleMultiselectMode,\n  toggleToken,\n  adjustCounterToken,\n} from \"./features/cards/cards.slice\";\nimport { shuffleStack } from \"./features/cards/cards.thunks\";\nimport { getGame } from \"./features/game/game.selectors\";\nimport { RootState } from \"./store/rootReducer\";\nimport TouchMenu from \"./TouchMenu\";\nimport { showRadialMenuAtPosition } from \"./features/game/game.slice\";\nimport { myPeerRef } from \"./constants/app-constants\";\n\nconst mapStateToProps = (state: RootState) => {\n  return {\n    anyCardsSelected: anyCardsSelectedWithPeerRef(myPeerRef)(state),\n    currentGameType: getGame(state).activeGameType,\n    panMode: getPanMode(state),\n    multiselectMode: getMultiselectMode(state),\n  };\n};\n\nconst TouchMenuContainer = connect(mapStateToProps, {\n  togglePanMode,\n  toggleMultiselectMode,\n  flipCards,\n  exhaustCard,\n  toggleToken,\n  shuffleStack,\n  adjustCounterToken,\n  showRadialMenuAtPosition,\n})(TouchMenu);\n\nexport default TouchMenuContainer;\n","export const copyToClipboard = (text: string) => {\n  navigator.clipboard.writeText(text);\n};\n\nexport const getBaseUrl = (): string => {\n  return `${window.location.origin}${window.location.pathname}`;\n};\n\nexport const generateRemoteGameUrl = (peerId: string) => {\n  return `${window.location.origin}${window.location.pathname}?remote=${peerId}`;\n};\n","import * as Intersects from \"intersects\";\nimport Konva from \"konva\";\nimport { KonvaEventObject } from \"konva/lib/Node\";\nimport { Vector2d } from \"konva/lib/types\";\nimport * as React from \"react\";\nimport { Component } from \"react\";\nimport { Layer, Rect, Stage } from \"react-konva\";\nimport { Provider, ReactReduxContext } from \"react-redux\";\nimport Card, { HORIZONTAL_TYPE_CODES } from \"./Card\";\nimport CardStackCardSelectorContainer from \"./CardStackCardSelectorContainer\";\nimport {\n  GameType,\n  myPeerRef,\n  PlayerColor,\n  possibleColors,\n} from \"./constants/app-constants\";\nimport {\n  CounterTokenType,\n  StatusTokenType,\n  cardConstants,\n} from \"./constants/card-constants\";\nimport { MISSING_CARD_IMAGE_MAP } from \"./constants/card-missing-image-map\";\nimport { CARD_PACK_REMAPPING } from \"./constants/card-pack-mapping\";\nimport { GamePropertiesMap } from \"./constants/game-type-properties-mapping\";\nimport ContextMenu, { ContextMenuItem } from \"./ContextMenu\";\nimport Counter from \"./Counter\";\nimport DeckLoader from \"./DeckLoader\";\nimport EncounterLoaderContainer from \"./EncounterLoaderContainer\";\nimport { CardData } from \"./external-api/common-card-data\";\nimport { ICardData } from \"./features/cards-data/initialState\";\nimport { DrawCardsOutOfCardStackPayload } from \"./features/cards/cards.thunks\";\nimport { ICardsState, ICardStack } from \"./features/cards/initialState\";\nimport { ICounter } from \"./features/counters/initialState\";\nimport { IGameState } from \"./features/game/initialState\";\nimport FirstPlayerTokenContainer from \"./FirstPlayerTokenContainer\";\nimport \"./Game.scss\";\nimport PeerConnector from \"./PeerConnector\";\nimport RadialMenuContainer from \"./RadialMenuContainer\";\nimport TokenValueModifier from \"./TokenValueModifier\";\nimport TopLayer from \"./TopLayer\";\nimport TouchMenuContainer from \"./TouchMenuContainer\";\nimport { getCenter, getDistance } from \"./utilities/geo\";\nimport { copyToClipboard, generateRemoteGameUrl } from \"./utilities/text-utils\";\n\nconst SCALE_BY = 1.02;\n\ninterface IProps {\n  currentGameType: GameType;\n  cards: ICardsState;\n  cardsData: ICardData;\n  gameState: IGameState;\n  panMode: boolean;\n  multiselectMode: boolean;\n  playerColors: { [key: string]: PlayerColor };\n  menuPreviewCard: ICardStack | null;\n  cardMove: (info: { id: string; dx: number; dy: number }) => void;\n  endCardMove: (id: string) => void;\n  exhaustCard: (id?: string) => void;\n  selectCard: (payload: { id: string; unselectOtherCards: boolean }) => void;\n  unselectCard: (id: string) => void;\n  toggleSelectCard: (id: string) => void;\n  startCardMove: (payload: { id: string; splitTopCard: boolean }) => void;\n  unselectAllCards: (payload?: any) => void;\n  selectMultipleCards: (cards: { ids: string[] }) => void;\n  setPreviewCardId: (id: string) => void;\n  clearPreviewCard: () => void;\n  togglePanMode: () => void;\n  flipCards: () => void;\n  loadCardsData: () => void;\n  allJsonData: (payload: any) => void;\n  shuffleStack: (id?: string) => void;\n  fetchDecklistById: (payload: {\n    gameType: GameType;\n    decklistId: number;\n    position: Vector2d;\n  }) => void;\n  updateZoom: (zoom: Vector2d) => void;\n  updatePosition: (pos: Vector2d) => void;\n  resetApp: () => void;\n  addCardStack: (payload: {\n    cardJsonIds: string[];\n    position: Vector2d;\n  }) => void;\n  toggleToken: (payload: {\n    id?: string;\n    tokenType: StatusTokenType;\n    value?: boolean;\n  }) => void;\n  adjustCounterToken: (payload: {\n    id?: string;\n    tokenType: CounterTokenType;\n    delta?: number;\n    value?: number;\n  }) => void;\n  pullCardOutOfCardStack: (payload: {\n    cardStackId: string;\n    jsonId: string;\n    pos: Vector2d;\n  }) => void;\n  addNewCounter: (pos: Vector2d) => void;\n  updateCounterValue: (payload: { id: string; delta: number }) => void;\n  removeCounter: (id: string) => void;\n  moveCounter: (payload: { id: string; newPos: Vector2d }) => void;\n  connectToRemoteGame: (peerId: string) => void;\n  undo: () => void;\n  redo: () => void;\n  counters: ICounter[];\n  requestResync: () => void;\n  peerId: string;\n  dropTargetCardsById: {\n    [key: string]: { ownerRef: string; card: ICardStack | null };\n  };\n  drawCardsOutOfCardStack: (payload: DrawCardsOutOfCardStackPayload) => void;\n  quitGame: () => void;\n  updateCounterColor: (payload: { id: string; newColor: PlayerColor }) => void;\n  createDeckFromTxt: (payload: {\n    gameType: GameType;\n    position: Vector2d;\n    txtContents: string;\n  }) => void;\n  generateGameStateUrl: () => void;\n  showRadialMenuAtPosition: (payload: Vector2d) => void;\n}\n\ninterface IState {\n  drewASelectionRect: boolean;\n  selectRect: {\n    height: number;\n    width: number;\n  };\n  selectStartPos: {\n    x: number;\n    y: number;\n  };\n  selecting: boolean;\n  showContextMenu: boolean;\n  contextMenuPosition: Vector2d | null;\n  contextMenuItems: ContextMenuItem[];\n  showDeckImporter: boolean;\n  deckImporterPosition: Vector2d | null;\n  showEncounterImporter: boolean;\n  encounterImporterPosition: Vector2d | null;\n  showCardSearch: boolean;\n  cardSearchPosition: Vector2d | null;\n  cardStackForSearching: ICardStack | null;\n  showPeerConnector: boolean;\n  peerConnectorPosition: Vector2d | null;\n  showTokenValueModifier: boolean;\n  tokenValueModifierProps: { id: string; tokenType: CounterTokenType } | null;\n  tokenValueModifierPosition: Vector2d | null;\n  playmatImage: HTMLImageElement | null;\n  playmatImageLoaded: boolean;\n  previewCardModal: boolean;\n  stageWidth: number;\n  stageHeight: number;\n}\nclass Game extends Component<IProps, IState> {\n  public stage: Konva.Stage | null = null;\n\n  private touchTimer: any = null;\n  private doubleTapTimer: any = null;\n\n  private lastCenter: Vector2d | null = null;\n  private lastDist: number = 0;\n\n  constructor(props: IProps) {\n    super(props);\n\n    if (!!Konva) {\n      Konva.hitOnDragEnabled = true;\n    }\n\n    this.state = {\n      drewASelectionRect: false,\n      selectRect: {\n        height: 0,\n        width: 0,\n      },\n      selectStartPos: {\n        x: 0,\n        y: 0,\n      },\n      selecting: false,\n      showContextMenu: false,\n      contextMenuPosition: null,\n      contextMenuItems: [],\n      showDeckImporter: false,\n      deckImporterPosition: null,\n      showEncounterImporter: false,\n      encounterImporterPosition: null,\n      showCardSearch: false,\n      cardSearchPosition: null,\n      cardStackForSearching: null,\n      showPeerConnector: false,\n      peerConnectorPosition: null,\n      showTokenValueModifier: false,\n      tokenValueModifierProps: null,\n      tokenValueModifierPosition: null,\n      playmatImage: null,\n      playmatImageLoaded: false,\n      previewCardModal: false,\n      stageWidth: window.innerWidth,\n      stageHeight: window.innerHeight,\n    };\n  }\n\n  public componentDidMount() {\n    const image = new Image();\n    image.onload = () => {\n      this.setState({\n        playmatImage: image,\n        playmatImageLoaded: true,\n      });\n    };\n\n    image.onerror = (e) => {\n      console.error(e);\n    };\n    image.src =\n      GamePropertiesMap[this.props.currentGameType].backgroundImageLocation;\n    this.props.loadCardsData();\n    this.props.allJsonData(\"\");\n\n    window.addEventListener(\"resize\", this.handleResize);\n  }\n\n  public componentWillUnmount = () => {\n    window.removeEventListener(\"resize\", this.handleResize);\n  };\n\n  public render() {\n    // TODO: This feels like a bad hack. I bet all the\n    //       swallowing of click events is keeping\n    //       focus from behaving 'normally' and doing\n    //       the expected thing with focus. But there are\n    //       a lot of things that don't work quite right\n    //       if the body has focus, so we're going to\n    //       force the game area to have focus if it\n    //       lost it\n    if (document.activeElement === document.body) {\n      // setTimeout so we don't manually change the dom while rendering\n      setTimeout(() => {\n        const el = document.querySelector(\".play-area\") as HTMLElement;\n        el?.focus();\n      }, 0);\n    }\n    // END HACK\n\n    const staticCards = this.props.cards.cards\n      .filter((card) => !card.dragging)\n      .map((card) => {\n        return (\n          <Card\n            currentGameType={this.props.currentGameType}\n            code={this.getCardCode(card)}\n            name={this.getCardName(card)}\n            selectedColor={\n              this.props.playerColors[card.controlledBy] ?? \"black\"\n            }\n            controlledBy={card.controlledBy}\n            key={card.id}\n            id={card.id}\n            x={card.x}\n            y={card.y}\n            exhausted={card.exhausted}\n            fill={card.fill}\n            selected={card.selected}\n            dropTargetColor={\n              this.props.playerColors[\n                this.props.dropTargetCardsById[card.id]?.ownerRef\n              ] ?? \"\"\n            }\n            dragging={card.dragging}\n            shuffling={card.shuffling}\n            handleDragStart={this.handleCardDragStart}\n            handleDragMove={this.props.cardMove}\n            handleDragEnd={this.props.endCardMove}\n            handleDoubleClick={this.handleSelectAndExhaust}\n            handleDoubleTap={this.showOrToggleModalPreviewCard}\n            handleClick={this.handleCardClick(card)}\n            handleHover={this.props.setPreviewCardId}\n            handleHoverLeave={this.props.clearPreviewCard}\n            handleContextMenu={this.handleCardContextMenu}\n            imgUrls={this.getImgUrls(card)}\n            typeCode={this.getCardType(card)}\n            faceup={card.faceup}\n            numCardsInStack={card.cardStack.length}\n            cardState={{\n              stunned: card.statusTokens.stunned,\n              confused: card.statusTokens.confused,\n              tough: card.statusTokens.tough,\n              tokens: { damage: 0, threat: 0, generic: 0 },\n            }}\n          />\n        );\n      });\n\n    const ghostCards = this.props.cards.ghostCards.map((card) => {\n      return (\n        <Card\n          currentGameType={this.props.currentGameType}\n          name={this.getCardName(card)}\n          code={this.getCardCode(card)}\n          selectedColor={this.props.playerColors[card.controlledBy] ?? \"black\"}\n          controlledBy={card.controlledBy}\n          key={`ghost${card.id}`}\n          id={card.id}\n          x={card.x}\n          y={card.y}\n          exhausted={card.exhausted}\n          fill={card.fill}\n          selected={false}\n          dragging={false}\n          shuffling={false}\n          imgUrls={this.getImgUrls(card)}\n          typeCode={this.getCardType(card)}\n          faceup={card.faceup}\n          isGhost={true}\n        />\n      );\n    });\n\n    const movingCards = this.props.cards.cards\n      .filter((card) => card.dragging)\n      .map((card) => {\n        return (\n          <Card\n            currentGameType={this.props.currentGameType}\n            name={this.getCardName(card)}\n            code={this.getCardCode(card)}\n            selectedColor={\n              this.props.playerColors[card.controlledBy] ?? \"black\"\n            }\n            controlledBy={card.controlledBy}\n            key={card.id}\n            id={card.id}\n            x={card.x}\n            y={card.y}\n            exhausted={card.exhausted}\n            fill={card.fill}\n            selected={card.selected}\n            dragging={card.dragging}\n            shuffling={card.shuffling}\n            handleDragStart={this.handleCardDragStart}\n            handleDragMove={this.props.cardMove}\n            handleDragEnd={this.props.endCardMove}\n            imgUrls={this.getImgUrls(card)}\n            typeCode={this.getCardType(card)}\n            faceup={card.faceup}\n            numCardsInStack={card.cardStack.length}\n          />\n        );\n      });\n\n    const iAmDragging = this.props.cards.cards.some(\n      (c) => c.dragging && c.controlledBy === myPeerRef\n    );\n\n    const possiblePreviewCards = !!this.props.menuPreviewCard\n      ? [this.props.menuPreviewCard]\n      : this.props.cards.cards.filter(\n          (card) =>\n            !!this.props.gameState.previewCard &&\n            card.id === this.props.gameState.previewCard.id\n        );\n\n    const previewCards = this.stage\n      ? possiblePreviewCards\n          .filter((_card) => !this.state.selecting && !iAmDragging)\n          .map((card) => {\n            const isHorizontal = HORIZONTAL_TYPE_CODES.includes(\n              this.getCardType(card)\n            );\n            const imgUrls = this.getImgUrls(card);\n            const rawPos = this.getRawPreviewCardPosition(isHorizontal);\n            const previewPos = this.getRelativePositionFromTarget(\n              this.stage,\n              rawPos\n            );\n\n            let previewCardHeight = cardConstants.CARD_PREVIEW_HEIGHT;\n            let previewCardWidth = cardConstants.CARD_PREVIEW_WIDTH;\n\n            // Note that we only adjust the height, because the card will\n            // be rotated if it supposed to be displayed horizontally\n            previewCardHeight = Math.min(\n              cardConstants.CARD_PREVIEW_HEIGHT,\n              isHorizontal ? window.innerWidth : window.innerHeight\n            );\n            const previewCardRatio =\n              previewCardHeight / cardConstants.CARD_PREVIEW_HEIGHT;\n            previewCardWidth *= previewCardRatio;\n\n            return imgUrls.some(\n              (url) => url.indexOf(\"card_back\") !== -1\n            ) ? null : (\n              <Card\n                currentGameType={this.props.currentGameType}\n                name={this.getCardName(card)}\n                code={this.getCardCode(card)}\n                selectedColor={\n                  this.props.playerColors[card.controlledBy] ?? \"black\"\n                }\n                controlledBy={card.controlledBy}\n                key={`preview${card.id}`}\n                id={card.id}\n                x={previewPos.x}\n                y={previewPos.y}\n                exhausted={isHorizontal}\n                fill={card.fill}\n                selected={false}\n                dragging={false}\n                shuffling={false}\n                imgUrls={imgUrls}\n                typeCode={this.getCardType(card)}\n                faceup={card.faceup}\n                height={previewCardHeight / this.props.gameState.stageZoom.y}\n                width={previewCardWidth / this.props.gameState.stageZoom.x}\n              />\n            );\n          })\n          .filter((c): c is JSX.Element => c !== null)\n      : [];\n\n    const playmatScale =\n      this.state.playmatImageLoaded && !!this.state.playmatImage?.naturalWidth\n        ? 2880 / this.state.playmatImage?.naturalWidth\n        : 1;\n\n    return (\n      <div\n        className=\"play-area\"\n        tabIndex={1}\n        onKeyDown={this.handleKeyDown}\n        onKeyPress={this.handleKeyPress}\n      >\n        <RadialMenuContainer></RadialMenuContainer>\n        {this.renderEmptyMessage()}\n        {this.renderContextMenu()}\n        {this.renderPreviewCardModal()}\n        {this.renderTouchMenu()}\n        {this.renderDeckImporter()}\n        {this.renderEncounterImporter()}\n        {this.renderCardSearch()}\n        {this.renderPeerConnector()}\n        {this.renderTokenModifier()}\n\n        <ReactReduxContext.Consumer>\n          {({ store }) => (\n            <Stage\n              ref={(ref) => {\n                if (!ref) return;\n\n                this.stage = ref;\n              }}\n              x={this.props.gameState.stagePosition.x}\n              y={this.props.gameState.stagePosition.y}\n              width={this.state.stageWidth}\n              height={this.state.stageHeight}\n              onClick={this.handleStageClickOrTap}\n              onTap={this.handleStageClickOrTap}\n              onMouseDown={\n                this.props.panMode ? this.noOp : this.handleMouseDown\n              }\n              onMouseUp={this.props.panMode ? this.noOp : this.handleMouseUp}\n              onMouseMove={\n                this.props.panMode ? this.noOp : this.handleMouseMove\n              }\n              onTouchStart={this.handleTouchStart}\n              onTouchMove={this.handleTouchMove}\n              onTouchEnd={this.handleTouchEnd}\n              onContextMenu={this.handleContextMenu}\n              scale={this.props.gameState.stageZoom}\n              onWheel={this.handleWheel}\n              draggable={this.props.panMode}\n              onDragMove={this.noOp}\n              onDragEnd={this.noOp}\n              preventDefault={true}\n            >\n              <Provider store={store}>\n                <Layer>\n                  <Rect\n                    fill={\n                      this.state.playmatImageLoaded ? undefined : \"lightgray\"\n                    }\n                    scale={{\n                      x: playmatScale,\n                      y: playmatScale,\n                    }}\n                    width={\n                      this.state.playmatImageLoaded\n                        ? this.state.playmatImage?.naturalWidth\n                        : 2880\n                    }\n                    height={\n                      this.state.playmatImageLoaded\n                        ? this.state.playmatImage?.naturalHeight\n                        : 1440\n                    }\n                    fillPatternImage={\n                      this.state.playmatImageLoaded && !!this.state.playmatImage\n                        ? this.state.playmatImage\n                        : undefined\n                    }\n                  ></Rect>\n                </Layer>\n                <Layer>\n                  {this.props.counters.map((counter) => (\n                    <Counter\n                      key={`${counter.id}-counter`}\n                      id={counter.id}\n                      pos={counter.position}\n                      value={counter.value}\n                      color={counter.color}\n                      updateCounterValueBy={this.handleCounterValueUpdate(\n                        counter.id\n                      )}\n                      handleContextMenu={this.handleCounterContextMenu(\n                        counter.id\n                      )}\n                      onDragEnd={this.handleCounterDrag(counter.id)}\n                    ></Counter>\n                  ))}\n                </Layer>\n                <Layer preventDefault={true}>\n                  {ghostCards.concat(staticCards).concat(movingCards)}\n\n                  <FirstPlayerTokenContainer\n                    currentGameType={this.props.currentGameType}\n                  ></FirstPlayerTokenContainer>\n\n                  {previewCards}\n                </Layer>\n                <Layer>\n                  <Rect\n                    x={this.state.selectStartPos.x}\n                    y={this.state.selectStartPos.y}\n                    width={this.state.selectRect.width}\n                    height={this.state.selectRect.height}\n                    stroke=\"yellow\"\n                    strokeWidth={4}\n                  />\n                </Layer>\n              </Provider>\n            </Stage>\n          )}\n        </ReactReduxContext.Consumer>\n      </div>\n    );\n  }\n\n  private handleCounterValueUpdate = (id: string) => (delta: number) => {\n    this.props.updateCounterValue({ id, delta });\n  };\n\n  private handleCounterDrag =\n    (id: string) => (event: KonvaEventObject<DragEvent>) => {\n      this.props.moveCounter({\n        id,\n        newPos: {\n          x: event.target.x(),\n          y: event.target.y(),\n        },\n      });\n    };\n\n  private noOp = () => {};\n\n  private renderEmptyMessage = () => {\n    if (this.props.cards.cards.length > 0) return null;\n\n    return (\n      <div>\n        <span>\n          Right click and select 'Load Deck ID' to load a deck from{\" \"}\n          {GamePropertiesMap[this.props.currentGameType].deckSite}\n        </span>\n      </div>\n    );\n  };\n\n  private renderContextMenu = () => {\n    if (!this.state.showContextMenu) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.contextMenuPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing context menu position\");\n    }\n\n    return (\n      <ContextMenu\n        position={{\n          x: containerRect.left + pointerPosition.x,\n          y: containerRect.top + pointerPosition.y,\n        }}\n        items={this.state.contextMenuItems}\n        hideContextMenu={() => this.clearContextMenu()}\n      ></ContextMenu>\n    );\n  };\n\n  private renderPreviewCardModal = () => {\n    if (!this.state.previewCardModal) return null;\n    return (\n      <TopLayer\n        position={{ x: 0, y: 0 }}\n        completed={() => {\n          this.props.clearPreviewCard();\n          this.setState({\n            previewCardModal: false,\n          });\n        }}\n      ></TopLayer>\n    );\n  };\n\n  private renderTouchMenu = () => {\n    if (this.props.cards.cards.length === 0) return null;\n    return <TouchMenuContainer></TouchMenuContainer>;\n  };\n\n  private renderDeckImporter = () => {\n    if (!this.state.showDeckImporter) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.deckImporterPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing deck importer position\");\n    }\n\n    return (\n      <TopLayer\n        position={{\n          x: containerRect.left + pointerPosition.x,\n          y: containerRect.top + pointerPosition.y,\n        }}\n        completed={this.clearDeckImporter}\n      >\n        <DeckLoader\n          loadDeckId={this.handleImportDeck(\n            this.getRelativePositionFromTarget(this.stage)\n          )}\n        />\n      </TopLayer>\n    );\n  };\n\n  private renderEncounterImporter = () => {\n    if (!this.state.showEncounterImporter) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.encounterImporterPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing deck importer position\");\n    }\n\n    const pos = {\n      x: containerRect.left + pointerPosition.x,\n      y: containerRect.top + pointerPosition.y,\n    };\n\n    return (\n      <TopLayer position={pos} completed={this.clearEncounterImporter}>\n        <EncounterLoaderContainer\n          currentGameType={this.props.currentGameType}\n          loadCards={this.handleLoadEncounter(\n            this.getRelativePositionFromTarget(this.stage)\n          )}\n        />\n      </TopLayer>\n    );\n  };\n\n  private renderCardSearch = () => {\n    if (!this.state.showCardSearch) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.cardSearchPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing card search position\");\n    }\n\n    const pos = {\n      x: containerRect.left + pointerPosition.x,\n      y: containerRect.top + pointerPosition.y,\n    };\n\n    return !!this.state.cardStackForSearching ? (\n      <TopLayer position={pos} completed={this.clearCardSearch}>\n        <CardStackCardSelectorContainer\n          card={this.state.cardStackForSearching}\n          cardSelected={this.handleCardSelectedFromCardStack(\n            this.state.cardStackForSearching.id,\n            pos\n          )}\n        />\n      </TopLayer>\n    ) : null;\n  };\n\n  private renderPeerConnector = () => {\n    if (!this.state.showPeerConnector) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.peerConnectorPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing peer connector position\");\n    }\n\n    const pos = {\n      x: containerRect.left + pointerPosition.x,\n      y: containerRect.top + pointerPosition.y,\n    };\n\n    return !!this.state.showPeerConnector ? (\n      <TopLayer position={pos} completed={this.clearPeerConnector}>\n        <PeerConnector connect={this.handlePeerConnect}></PeerConnector>\n      </TopLayer>\n    ) : null;\n  };\n\n  private renderTokenModifier = () => {\n    if (!this.state.showTokenValueModifier) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.tokenValueModifierPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing token Modifier position\");\n    }\n\n    const pos = {\n      x: containerRect.left + pointerPosition.x,\n      y: containerRect.top + pointerPosition.y,\n    };\n\n    return !!this.state.showTokenValueModifier &&\n      !!this.state.tokenValueModifierProps ? (\n      <TopLayer position={pos} completed={this.clearTokenValueModifier}>\n        <TokenValueModifier\n          id={this.state.tokenValueModifierProps.id}\n          tokenType={this.state.tokenValueModifierProps.tokenType}\n          updated={(payload) => {\n            this.props.adjustCounterToken(payload);\n            this.clearTokenValueModifier();\n          }}\n        ></TokenValueModifier>\n      </TopLayer>\n    ) : null;\n  };\n\n  private handleLoadEncounter = (position: Vector2d) => (cards: string[][]) => {\n    this.clearEncounterImporter();\n    cards.forEach((c, index) => {\n      this.props.addCardStack({\n        position: {\n          x: position.x + (cardConstants.CARD_WIDTH + 10) * index,\n          y: position.y,\n        },\n        cardJsonIds: c,\n      });\n    });\n  };\n\n  private handleImportDeck = (position: Vector2d) => (id: number) => {\n    this.clearDeckImporter();\n    this.props.fetchDecklistById({\n      gameType: this.props.currentGameType,\n      decklistId: id,\n      position,\n    });\n  };\n\n  private handlePeerConnect = (peerId: string) => {\n    this.clearPeerConnector();\n    this.props.connectToRemoteGame(peerId);\n  };\n\n  private handleCardSelectedFromCardStack =\n    (cardStackId: string, pos: Vector2d) => (jsonId: string) => {\n      this.clearCardSearch();\n      this.props.pullCardOutOfCardStack({ cardStackId, jsonId, pos });\n    };\n\n  private clearContextMenu = () => {\n    this.setState({\n      showContextMenu: false,\n      contextMenuPosition: null,\n      contextMenuItems: [],\n    });\n  };\n\n  private clearDeckImporter = () => {\n    this.setState({\n      showDeckImporter: false,\n      deckImporterPosition: null,\n    });\n  };\n\n  private clearTokenValueModifier = () => {\n    this.setState({\n      showTokenValueModifier: false,\n      tokenValueModifierProps: null,\n      tokenValueModifierPosition: null,\n    });\n  };\n\n  private clearEncounterImporter = () => {\n    this.setState({\n      showEncounterImporter: false,\n      encounterImporterPosition: null,\n    });\n  };\n\n  private clearCardSearch = () => {\n    this.setState({\n      showCardSearch: false,\n      cardSearchPosition: null,\n      cardStackForSearching: null,\n    });\n  };\n\n  private clearPeerConnector = () => {\n    this.setState({\n      showPeerConnector: false,\n      peerConnectorPosition: null,\n    });\n  };\n\n  private handleStageClickOrTap = (event: KonvaEventObject<MouseEvent>) => {\n    if (this.state.showContextMenu) {\n      return;\n    }\n    const mousePos = this.getRelativePositionFromTarget(this.stage);\n    if (\n      this.props.panMode ||\n      getDistance(this.state.selectStartPos, mousePos) < 30\n    ) {\n      this.props.unselectAllCards();\n    }\n  };\n\n  private handleWheel = (event: KonvaEventObject<WheelEvent>) => {\n    event.evt.preventDefault();\n\n    if (!this.stage) return;\n\n    var oldScale = this.props.gameState.stageZoom.x;\n\n    const pointer = this.stage.getPointerPosition() ?? { x: 0, y: 0 };\n\n    const mousePointTo = {\n      x: (pointer.x - this.stage.x()) / oldScale,\n      y: (pointer.y - this.stage.y()) / oldScale,\n    };\n\n    const newScale =\n      event.evt.deltaY < 0 ? oldScale * SCALE_BY : oldScale / SCALE_BY;\n\n    this.props.updateZoom({ x: newScale, y: newScale });\n\n    const newPos = {\n      x: pointer.x - mousePointTo.x * newScale,\n      y: pointer.y - mousePointTo.y * newScale,\n    };\n\n    this.props.updatePosition(newPos);\n  };\n\n  private handleCounterContextMenu =\n    (counterId: string) => (event: KonvaEventObject<PointerEvent>) => {\n      event.evt.preventDefault();\n      event.cancelBubble = true;\n\n      const counter = this.props.counters.find((c) => c.id === counterId);\n\n      const menuItems: ContextMenuItem[] = [\n        {\n          label: \"Remove\",\n          action: () => {\n            this.props.removeCounter(counterId);\n          },\n        },\n        {\n          label: \"Reset\",\n          action: () => {\n            this.props.updateCounterValue({\n              id: counterId,\n              delta: (counter?.value ?? 0) * -1,\n            });\n          },\n        },\n        {\n          label: \"Set Color\",\n          children: possibleColors.map((color) => {\n            return {\n              label: color,\n              action: () => {\n                this.props.updateCounterColor({\n                  id: counterId,\n                  newColor: color,\n                });\n              },\n            };\n          }),\n        },\n      ];\n\n      this.setState({\n        showContextMenu: true,\n        contextMenuPosition: this.stage?.getPointerPosition() ?? null,\n        contextMenuItems: menuItems,\n      });\n    };\n\n  private handleCardContextMenu = (\n    cardId: string,\n    event: KonvaEventObject<PointerEvent>\n  ) => {\n    event.evt.preventDefault();\n    event.cancelBubble = true;\n\n    // We want to unselect all the other cards if the card isn't actively selected\n    const cardStack = this.props.cards.cards.find((c) => c.id === cardId);\n\n    // Next, select the card that was right-clicked\n    this.props.selectCard({\n      id: cardId,\n      unselectOtherCards: !!cardStack ? !cardStack.selected : true,\n    });\n\n    const card = this.props.cards.cards.find((c) => c.id === cardId);\n    const numCardsInStack = card?.cardStack?.length || 0;\n    const currentStatusTokens = card?.statusTokens || {\n      stunned: false,\n      confused: false,\n      tough: false,\n    };\n\n    const menuItems = [\n      {\n        label: \"Flip\",\n        action: () => {\n          this.props.flipCards();\n        },\n      },\n    ];\n\n    if (numCardsInStack > 1) {\n      menuItems.push({\n        label: \"Shuffle\",\n        action: () => {\n          this.props.shuffleStack();\n        },\n      });\n\n      menuItems.push({\n        label: \"Find Specific Card\",\n        action: () => {\n          if (!!card) {\n            this.setState({\n              showCardSearch: true,\n              cardSearchPosition: this.stage?.getPointerPosition() ?? null,\n              cardStackForSearching: card,\n            });\n          }\n        },\n      });\n    }\n\n    const tokenInfoForGameType =\n      GamePropertiesMap[this.props.currentGameType].tokens;\n\n    if (!!tokenInfoForGameType.stunned) {\n      menuItems.push({\n        label: !!currentStatusTokens.stunned\n          ? tokenInfoForGameType.stunned.menuRemoveText\n          : tokenInfoForGameType.stunned.menuText,\n        action: () => {\n          this.props.toggleToken({\n            id: card?.id || \"\",\n            tokenType: StatusTokenType.Stunned,\n            value: !currentStatusTokens.stunned,\n          });\n        },\n      });\n    }\n\n    if (!!tokenInfoForGameType.confused) {\n      menuItems.push({\n        label: !!currentStatusTokens.confused\n          ? tokenInfoForGameType.confused.menuRemoveText\n          : tokenInfoForGameType.confused.menuText,\n        action: () => {\n          this.props.toggleToken({\n            id: card?.id || \"\",\n            tokenType: StatusTokenType.Confused,\n            value: !currentStatusTokens.confused,\n          });\n        },\n      });\n    }\n\n    if (!!tokenInfoForGameType.tough) {\n      menuItems.push({\n        label: !!currentStatusTokens.tough\n          ? tokenInfoForGameType.tough.menuRemoveText\n          : tokenInfoForGameType.tough.menuText,\n        action: () => {\n          this.props.toggleToken({\n            id: card?.id || \"\",\n            tokenType: StatusTokenType.Tough,\n            value: !currentStatusTokens.tough,\n          });\n        },\n      });\n    }\n\n    if (!!tokenInfoForGameType.damage) {\n      menuItems.push({\n        label: tokenInfoForGameType.damage.menuText,\n        action: () => {\n          this.setState({\n            showContextMenu: false,\n            contextMenuItems: [],\n            contextMenuPosition: null,\n\n            showTokenValueModifier: true,\n            tokenValueModifierProps: {\n              id: card?.id || \"\",\n              tokenType: CounterTokenType.Damage,\n            },\n            tokenValueModifierPosition:\n              this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      });\n    }\n\n    if (!!tokenInfoForGameType.threat) {\n      menuItems.push({\n        label: tokenInfoForGameType.threat.menuText,\n        action: () => {\n          this.setState({\n            showContextMenu: false,\n            contextMenuItems: [],\n            contextMenuPosition: null,\n\n            showTokenValueModifier: true,\n            tokenValueModifierProps: {\n              id: card?.id || \"\",\n              tokenType: CounterTokenType.Threat,\n            },\n            tokenValueModifierPosition:\n              this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      });\n    }\n\n    if (!!tokenInfoForGameType.generic) {\n      menuItems.push({\n        label: tokenInfoForGameType.generic.menuText,\n        action: () => {\n          this.setState({\n            showContextMenu: false,\n            contextMenuItems: [],\n            contextMenuPosition: null,\n\n            showTokenValueModifier: true,\n            tokenValueModifierProps: {\n              id: card?.id || \"\",\n              tokenType: CounterTokenType.Generic,\n            },\n            tokenValueModifierPosition:\n              this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      });\n    }\n\n    menuItems.push({\n      label: \"Remove All Tokens\",\n      action: () => {\n        this.props.adjustCounterToken({\n          id: card?.id || \"\",\n          tokenType: CounterTokenType.Damage,\n          value: 0,\n        });\n\n        this.props.adjustCounterToken({\n          id: card?.id || \"\",\n          tokenType: CounterTokenType.Threat,\n          value: 0,\n        });\n\n        this.props.adjustCounterToken({\n          id: card?.id || \"\",\n          tokenType: CounterTokenType.Generic,\n          value: 0,\n        });\n      },\n    });\n\n    this.setState({\n      showContextMenu: true,\n      contextMenuPosition: this.stage?.getPointerPosition() ?? null,\n      contextMenuItems: menuItems,\n    });\n  };\n\n  private handleCardClick =\n    (card: ICardStack) =>\n    (\n      cardId: string,\n      event: KonvaEventObject<MouseEvent>,\n      wasTouch: boolean\n    ) => {\n      // Here check if modifier held down\n      const modifierKeyHeld =\n        event.evt.shiftKey || event.evt.metaKey || event.evt.ctrlKey;\n\n      if (card.selected && (modifierKeyHeld || this.props.multiselectMode)) {\n        this.props.toggleSelectCard(cardId);\n      } else {\n        this.props.selectCard({\n          id: cardId,\n          unselectOtherCards: !modifierKeyHeld && !this.props.multiselectMode,\n        });\n\n        if (\n          wasTouch &&\n          !modifierKeyHeld &&\n          !this.props.multiselectMode &&\n          !this.doubleTapTimer &&\n          !this.state.showContextMenu\n        ) {\n          this.doubleTapTimer = setTimeout(() => {\n            this.props.showRadialMenuAtPosition(\n              this.stage?.getPointerPosition() || { x: 0, y: 0 }\n            );\n            this.doubleTapTimer = null;\n          }, 200);\n        }\n      }\n    };\n\n  private handleSelectAndExhaust = (\n    cardId: string,\n    event: KonvaEventObject<MouseEvent>\n  ) => {\n    // Here check if modifier held down\n    const modifierKeyHeld =\n      event.evt.shiftKey || event.evt.metaKey || event.evt.ctrlKey;\n    this.props.selectCard({ id: cardId, unselectOtherCards: !modifierKeyHeld });\n    this.props.exhaustCard(cardId);\n  };\n\n  private showOrToggleModalPreviewCard = (\n    cardId: string,\n    _event: KonvaEventObject<TouchEvent>\n  ) => {\n    // Clear the timer if we were waiting\n    if (!!this.doubleTapTimer) {\n      clearTimeout(this.doubleTapTimer);\n      this.doubleTapTimer = null;\n    }\n\n    if (\n      !!this.props.gameState.previewCard &&\n      this.props.gameState.previewCard.id === cardId\n    ) {\n      this.props.clearPreviewCard();\n    } else {\n      this.setState({\n        previewCardModal: true,\n      });\n      this.props.setPreviewCardId(cardId);\n    }\n  };\n\n  private handleCardDragStart = (\n    cardId: string,\n    event: KonvaEventObject<DragEvent>\n  ) => {\n    let splitTopCard = false;\n    // If multiple things are selected, you can't pull something off the top of a stack,\n    // so just do a normal drag\n    const multipleSelected =\n      this.props.cards.cards.filter(\n        (c) => c.selected && c.controlledBy === myPeerRef\n      ).length > 1;\n\n    if (!multipleSelected) {\n      const draggingCard = this.props.cards.cards.find((c) => c.id === cardId);\n      const hasStack = (draggingCard?.cardStack || []).length > 1;\n      if (!!draggingCard && hasStack) {\n        // Check if we're dragging in the upper right corner of the card\n        const upperRightPoint = {\n          x:\n            draggingCard.x +\n            (draggingCard.exhausted\n              ? cardConstants.CARD_HEIGHT\n              : cardConstants.CARD_WIDTH) /\n              2,\n          y:\n            draggingCard.y -\n            (draggingCard.exhausted\n              ? cardConstants.CARD_WIDTH\n              : cardConstants.CARD_HEIGHT) /\n              2,\n        };\n        const distance = getDistance(\n          upperRightPoint,\n          this.getRelativePositionFromTarget(this.stage)\n        );\n        if (distance < 50) {\n          splitTopCard = true;\n        }\n      }\n    }\n\n    this.props.startCardMove({ id: cardId, splitTopCard });\n  };\n\n  private handleKeyPress = (event: React.KeyboardEvent<HTMLElement>) => {\n    const modifier: boolean = event.ctrlKey || event.metaKey;\n    const code = event.key.toLocaleLowerCase();\n    const intCode = parseInt(code);\n    if (code === \"p\") {\n      this.props.togglePanMode();\n    } else if (code === \"f\") {\n      this.props.flipCards();\n    } else if (code === \"e\") {\n      this.props.exhaustCard();\n    } else if (code === \"s\") {\n      this.props.shuffleStack();\n    } else if (!Number.isNaN(intCode)) {\n      // if a ctrl / cmd key was held, we're\n      // adding tokens\n      if (modifier) {\n      } else {\n        // First, get the selected card stack\n        const mySelectedCards = this.props.cards.cards.filter(\n          (c) => c.selected && c.controlledBy === myPeerRef\n        );\n        if (mySelectedCards.length !== 1) {\n          console.log(\n            \"will not be drawing any cards because the number of selected stacks is \" +\n              mySelectedCards.length\n          );\n        } else {\n          this.props.drawCardsOutOfCardStack({\n            cardStackId: mySelectedCards[0].id,\n            numberToDraw: intCode,\n          });\n        }\n      }\n    }\n  };\n\n  private handleKeyDown = (event: React.KeyboardEvent<HTMLElement>) => {\n    const code = event.key.toLocaleLowerCase();\n    const intCode = parseInt(code);\n\n    if ((event.ctrlKey || event.metaKey) && !Number.isNaN(intCode)) {\n      const tokenInfoForGameType =\n        GamePropertiesMap[this.props.currentGameType].tokens;\n      switch (intCode) {\n        case 1:\n          if (!!tokenInfoForGameType.damage) {\n            this.props.adjustCounterToken({\n              tokenType: CounterTokenType.Damage,\n              delta: 1,\n            });\n          }\n          break;\n        case 2:\n          if (!!tokenInfoForGameType.threat) {\n            this.props.adjustCounterToken({\n              tokenType: CounterTokenType.Threat,\n              delta: 1,\n            });\n          }\n          break;\n\n        case 3:\n          if (!!tokenInfoForGameType.generic) {\n            this.props.adjustCounterToken({\n              tokenType: CounterTokenType.Generic,\n              delta: 1,\n            });\n          }\n          break;\n        case 4:\n          if (!!tokenInfoForGameType.damage) {\n            this.props.adjustCounterToken({\n              tokenType: CounterTokenType.Damage,\n              delta: -1,\n            });\n          }\n          break;\n        case 5:\n          if (!!tokenInfoForGameType.threat) {\n            this.props.adjustCounterToken({\n              tokenType: CounterTokenType.Threat,\n              delta: -1,\n            });\n          }\n          break;\n\n        case 6:\n          if (!!tokenInfoForGameType.generic) {\n            this.props.adjustCounterToken({\n              tokenType: CounterTokenType.Generic,\n              delta: -1,\n            });\n          }\n          break;\n      }\n      event.preventDefault();\n    }\n\n    if (\n      event.shiftKey &&\n      (event.ctrlKey || event.metaKey) &&\n      event.key === \"z\"\n    ) {\n      this.props.redo();\n    } else if ((event.ctrlKey || event.metaKey) && event.key === \"z\") {\n      event.preventDefault();\n      this.props.undo();\n    }\n  };\n\n  private getRawPreviewCardPosition = (horizontal: boolean): Vector2d => {\n    const pointerPos = this.stage?.getPointerPosition() ?? { x: 0, y: 0 };\n    const screenMidPointX = window.innerWidth / 2;\n    const screenMidPointY = window.innerHeight / 2;\n\n    const widthToUse = horizontal\n      ? cardConstants.CARD_PREVIEW_HEIGHT\n      : cardConstants.CARD_PREVIEW_WIDTH;\n    const heightToUse = horizontal\n      ? cardConstants.CARD_PREVIEW_WIDTH\n      : cardConstants.CARD_PREVIEW_HEIGHT;\n\n    if (this.state.previewCardModal) {\n      return {\n        x: screenMidPointX,\n        y: screenMidPointY,\n      };\n    }\n\n    return pointerPos.x < screenMidPointX\n      ? {\n          x: window.innerWidth - widthToUse / 2,\n          y: heightToUse / 2,\n        }\n      : {\n          x: widthToUse / 2,\n          y: heightToUse / 2,\n        };\n  };\n\n  private getRelativePositionFromTarget = (\n    target: any,\n    posParam?: Vector2d\n  ) => {\n    const transform = target.getAbsoluteTransform().copy();\n    transform.invert();\n    let pos = posParam || target.getPointerPosition();\n    return transform.point(pos) as Vector2d;\n  };\n\n  private handleMouseDown = (\n    event: KonvaEventObject<MouseEvent> | KonvaEventObject<TouchEvent>\n  ) => {\n    if (\n      (event.evt instanceof MouseEvent && event.evt.button === 0) ||\n      event.evt instanceof TouchEvent\n    ) {\n      // Only do something if it's the primary button (not a right-click)\n      const pos = this.getRelativePositionFromTarget(this.stage);\n\n      this.setState({\n        selectStartPos: {\n          x: pos.x,\n          y: pos.y,\n        },\n        selecting: true,\n      });\n    }\n\n    return false;\n  };\n\n  private getSelectionRectInfo = () => {\n    const selectStartPos = this.state.selectStartPos;\n    const selectRect = this.state.selectRect;\n    return {\n      height: Math.abs(selectRect.height),\n      width: Math.abs(selectRect.width),\n      x:\n        selectRect.width < 0\n          ? selectStartPos.x + selectRect.width\n          : selectStartPos.x,\n      y:\n        selectRect.height < 0\n          ? selectStartPos.y + selectRect.height\n          : selectStartPos.y,\n    };\n  };\n\n  private handleMouseUp = () => {\n    // if we were selecting, check for intersection\n    if (this.state.drewASelectionRect) {\n      const selectRect = this.getSelectionRectInfo();\n      const selectedCards: any[] = this.props.cards.cards.reduce<ICardStack[]>(\n        (currSelectedCards, card) => {\n          const intersects = Intersects.boxBox(\n            selectRect.x,\n            selectRect.y,\n            selectRect.width,\n            selectRect.height,\n            card.x - 50,\n            card.y - 75,\n            cardConstants.CARD_WIDTH,\n            cardConstants.CARD_HEIGHT\n          );\n\n          if (intersects) {\n            currSelectedCards.push(card);\n          }\n\n          return currSelectedCards;\n        },\n        []\n      );\n\n      this.props.selectMultipleCards({\n        ids: selectedCards.map((card) => card.id),\n      });\n    }\n\n    this.setState({\n      drewASelectionRect: false,\n      selectRect: {\n        height: 0,\n        width: 0,\n      },\n      selecting: false,\n    });\n\n    return false;\n  };\n\n  private handleTouchStart = (event: KonvaEventObject<TouchEvent>) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n\n    this.touchTimer = setTimeout(() => {\n      this.handleContextMenu(event);\n    }, 750);\n\n    if (!this.props.panMode) {\n      this.handleMouseDown(event);\n    }\n  };\n\n  private handleTouchMove = (e: any) => {\n    e.evt.preventDefault();\n\n    var touch1 = e.evt.touches[0];\n    var touch2 = e.evt.touches[1];\n\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n\n    if (touch1 && touch2) {\n      this.handleMultiTouch(touch1, touch2);\n    } else {\n      this.handleMouseMove(e);\n    }\n  };\n\n  private handleMultiTouch = (touch1: any, touch2: any) => {\n    if (!this.stage) {\n      return;\n    }\n    // if the stage was under Konva's drag&drop\n    // we need to stop it, and implement our own pan logic with two pointers\n    if (this.stage.isDragging()) {\n      this.stage.stopDrag();\n    }\n\n    const p1 = {\n      x: touch1.clientX,\n      y: touch1.clientY,\n    };\n    const p2 = {\n      x: touch2.clientX,\n      y: touch2.clientY,\n    };\n\n    if (!this.lastCenter) {\n      this.lastCenter = getCenter(p1, p2);\n      return;\n    }\n    const newCenter = getCenter(p1, p2);\n\n    const dist = getDistance(p1, p2);\n\n    if (!this.lastDist) {\n      this.lastDist = dist;\n    }\n\n    // local coordinates of center point\n    const pointTo = {\n      x: (newCenter.x - this.stage.x()) / this.props.gameState.stageZoom.x,\n      y: (newCenter.y - this.stage.y()) / this.props.gameState.stageZoom.y,\n    };\n\n    const scale = this.props.gameState.stageZoom.x * (dist / this.lastDist);\n    this.props.updateZoom({ x: scale, y: scale });\n\n    // calculate new position of the stage\n    const dx = newCenter.x - this.lastCenter.x;\n    const dy = newCenter.y - this.lastCenter.y;\n\n    const newPos = {\n      x: newCenter.x - pointTo.x * scale + dx,\n      y: newCenter.y - pointTo.y * scale + dy,\n    };\n\n    this.props.updatePosition(newPos);\n\n    this.lastDist = dist;\n    this.lastCenter = newCenter;\n  };\n\n  private handleTouchEnd = (event: KonvaEventObject<TouchEvent>) => {\n    this.lastDist = 0;\n    this.lastCenter = null;\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n\n    if (!this.props.panMode) {\n      this.handleMouseUp();\n    }\n  };\n\n  private handleMouseMove = (event: any) => {\n    if (this.state.selecting) {\n      const pos = this.getRelativePositionFromTarget(event.currentTarget);\n      this.setState({\n        drewASelectionRect: true,\n        selectRect: {\n          height: pos.y - this.state.selectStartPos.y,\n          width: pos.x - this.state.selectStartPos.x,\n        },\n      });\n    }\n    event.cancelBubble = true;\n  };\n\n  private handleContextMenu = (\n    event: KonvaEventObject<PointerEvent> | KonvaEventObject<TouchEvent>\n  ): void => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n    event.evt.preventDefault();\n    event.cancelBubble = true;\n\n    const menuItems = [\n      {\n        label: \"Undo\",\n        action: this.props.undo,\n      },\n      {\n        label: \"Redo\",\n        action: this.props.redo,\n      },\n      {\n        label: \"Load Deck by ID\",\n        action: () => {\n          this.setState({\n            showDeckImporter: true,\n            deckImporterPosition: this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      },\n      {\n        label: \"Load Deck from txt file\",\n        fileLoadedAction: (txtContents: string) => {\n          this.props.createDeckFromTxt({\n            gameType: this.props.currentGameType,\n            position: this.stage?.getPointerPosition() ?? { x: 0, y: 0 },\n            txtContents,\n          });\n        },\n        fileUploader: true,\n      },\n      {\n        label: `Load ${\n          GamePropertiesMap[this.props.currentGameType].encounterUiName\n        }`,\n        action: () => {\n          this.setState({\n            showEncounterImporter: true,\n            encounterImporterPosition: this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      },\n      {\n        label: \"Create new counter\",\n        action: () => {\n          this.props.addNewCounter(\n            this.getRelativePositionFromTarget(this.stage) ?? { x: 0, y: 0 }\n          );\n        },\n      },\n      { label: \"Reset Game\", action: this.props.resetApp },\n      {\n        label: \"Quit Game\",\n        action: () => {\n          this.props.quitGame();\n          this.props.resetApp();\n        },\n      },\n      {\n        label: \"Connect to Remote Game\",\n        action: () => {\n          this.setState({\n            showPeerConnector: true,\n            peerConnectorPosition: this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      },\n      {\n        label: \"Request resync from Remote Game\",\n        action: this.props.requestResync,\n      },\n      {\n        label: `Peer id is ${this.props.peerId}`,\n        action: () => {\n          if (!!this.props.peerId) {\n            copyToClipboard(generateRemoteGameUrl(this.props.peerId));\n          }\n        },\n      },\n      {\n        label: `Copy game state as url`,\n        action: () => {\n          this.props.generateGameStateUrl();\n        },\n      },\n    ];\n\n    this.setState({\n      showContextMenu: true,\n      contextMenuPosition: this.stage?.getPointerPosition() ?? null,\n      contextMenuItems: menuItems,\n    });\n  };\n\n  private getCardType = (card: ICardStack): string => {\n    if (Object.keys(this.props.cardsData).length === 0) return \"\";\n\n    const cardData = this.props.cardsData[card.cardStack[0].jsonId];\n\n    return (cardData?.typeCode ?? \"\").toLocaleLowerCase();\n  };\n\n  private getCardName = (card: ICardStack) => {\n    const cardInQuestion = card.faceup\n      ? card.cardStack[0]\n      : card.cardStack[card.cardStack.length - 1];\n    return this.props.cardsData[cardInQuestion.jsonId]?.name ?? \"\";\n  };\n\n  private getCardCode = (card: ICardStack) => {\n    const cardInQuestion = card.faceup\n      ? card.cardStack[0]\n      : card.cardStack[card.cardStack.length - 1];\n\n    if (!cardInQuestion) {\n      console.error(\"Could not get card in question for stack:\", card);\n    }\n\n    const idToGrab = cardInQuestion?.jsonId ?? \"missing-id\";\n\n    return (\n      this.props.cardsData[idToGrab]?.code ?? `code missing for ${idToGrab}`\n    );\n  };\n\n  private checkMissingImageMap(code: string): string | null {\n    return MISSING_CARD_IMAGE_MAP[code] ?? null;\n  }\n\n  private generateLCGCDNImageUrl(card: CardData, faceup: boolean): string {\n    if (!card) {\n      return `https://lcgcdn.s3.amazonaws.com/mc/NOPE.jpg`;\n    }\n\n    // get the first two digits\n    let codeToUse = card.code;\n\n    if (!faceup && !!card.backLink) {\n      codeToUse = card.backLink;\n    }\n\n    const groupCode =\n      CARD_PACK_REMAPPING[card.extraInfo.packCode ?? \"\"] ??\n      codeToUse.substring(0, 2);\n    let cardCode = codeToUse.substring(2);\n\n    //trim leading \"0\" chars\n    while (cardCode[0] === \"0\") {\n      cardCode = cardCode.substring(1);\n    }\n\n    cardCode = cardCode.toLocaleUpperCase();\n\n    let cardSuffix = \"\";\n\n    if (!!card.doubleSided) {\n      cardSuffix = faceup ? \"A\" : \"B\";\n    }\n\n    return `https://lcgcdn.s3.amazonaws.com/mc/MC${groupCode}en_${cardCode}${cardSuffix}.jpg`;\n  }\n\n  private getImgUrls = (card: ICardStack): string[] => {\n    if (Object.keys(this.props.cardsData).length === 0) return [];\n\n    let urls: string[] = [];\n\n    const topCardData = this.props.cardsData[card.cardStack[0].jsonId];\n\n    if (!topCardData) {\n      return [];\n    }\n\n    let cardData: CardData | null = topCardData;\n\n    if (!!cardData.images) {\n      if (!card.faceup) {\n        if (!cardData.images.back) {\n          return [\n            topCardData.extraInfo.factionCode === \"encounter\"\n              ? process.env.PUBLIC_URL +\n                \"/images/standard/encounter_card_back_\" +\n                this.props.currentGameType +\n                \".png\"\n              : process.env.PUBLIC_URL +\n                \"/images/standard/card_back_\" +\n                this.props.currentGameType +\n                \".png\",\n          ];\n        } else {\n          return [cardData.images.back];\n        }\n      } else {\n        return [cardData.images.front];\n      }\n    }\n\n    if (!card.faceup) {\n      if (!!topCardData.backLink || !!topCardData.doubleSided) {\n        urls = [\n          this.generateLCGCDNImageUrl(topCardData, card.faceup),\n          // `https://marvelcdb.com/bundles/cards/${bottomCardData.back_link}.png`,\n          // `https://marvelcdb.com/bundles/cards/${bottomCardData.back_link}.jpg`,\n          // process.env.PUBLIC_URL +\n          //   \"/images/cards/\" +\n          //   bottomCardData.octgn_id +\n          //   \".b.jpg\",\n        ];\n      } else {\n        cardData = null;\n        urls = [\n          topCardData.extraInfo.factionCode === \"encounter\"\n            ? process.env.PUBLIC_URL +\n              \"/images/standard/encounter_card_back_\" +\n              this.props.currentGameType +\n              \".png\"\n            : process.env.PUBLIC_URL +\n              \"/images/standard/card_back_\" +\n              this.props.currentGameType +\n              \".png\",\n        ];\n      }\n    } else {\n      urls = [\n        this.generateLCGCDNImageUrl(topCardData, card.faceup),\n        // `https://marvelcdb.com/bundles/cards/${topCardData.code}.png`,\n        // `https://marvelcdb.com/bundles/cards/${topCardData.code}.jpg`,\n        // process.env.PUBLIC_URL +\n        //   \"/images/cards/\" +\n        //   topCardData.octgn_id +\n        //   \".jpg\",\n      ];\n    }\n\n    let codeForMissingCheck = \"\";\n\n    if (!!cardData) {\n      if (card.faceup) {\n        codeForMissingCheck = cardData.code;\n      } else {\n        if (!!cardData.backLink) {\n          codeForMissingCheck = cardData.backLink;\n        } else if (cardData.doubleSided) {\n          codeForMissingCheck = `${cardData.code}_double_sided_back`;\n        }\n      }\n    }\n\n    const missingImageOverride = !!cardData\n      ? this.checkMissingImageMap(codeForMissingCheck)\n      : null;\n\n    if (!!missingImageOverride) {\n      urls.unshift(missingImageOverride);\n    }\n\n    return urls;\n  };\n\n  private handleResize = () => {\n    this.setState({\n      stageHeight: window.innerHeight,\n      stageWidth: window.innerWidth,\n    });\n  };\n}\n\nexport default Game;\n","export const packList = [\n\"ant.json\",\n\"ant_encounter.json\",\n\"bkw.json\",\n\"bkw_encounter.json\",\n\"cap.json\",\n\"cap_encounter.json\",\n\"core.json\",\n\"core_encounter.json\",\n\"drax.json\",\n\"drax_encounter.json\",\n\"drs.json\",\n\"drs_encounter.json\",\n\"gam.json\",\n\"gam_encounter.json\",\n\"gmw.json\",\n\"gmw_encounter.json\",\n\"gob_encounter.json\",\n\"hlk.json\",\n\"hlk_encounter.json\",\n\"msm.json\",\n\"msm_encounter.json\",\n\"qsv.json\",\n\"qsv_encounter.json\",\n\"ron_encounter.json\",\n\"scw.json\",\n\"scw_encounter.json\",\n\"stld.json\",\n\"stld_encounter.json\",\n\"thor.json\",\n\"thor_encounter.json\",\n\"toafk_encounter.json\",\n\"trors.json\",\n\"trors_encounter.json\",\n\"twc_encounter.json\",\n\"wsp.json\",\n\"wsp_encounter.json\",\n];","export const packList = [\n\"A Journey To Rhosgobel.json\",\n\"A Journey to Rhosgobel Nightmare.json\",\n\"A Knife in the Dark Nightmare.json\",\n\"A Shadow in the East.json\",\n\"A Shadow of the Past Nightmare.json\",\n\"A Storm on Cobas Haven Nightmare.json\",\n\"A Storm on Cobas Haven.json\",\n\"Across the Ettenmoors Nightmare.json\",\n\"Across the Ettenmoors.json\",\n\"Among the Outlaws.json\",\n\"Assault on Osgiliath Nightmare.json\",\n\"Assault on Osgiliath.json\",\n\"Attack on Dol Guldur.json\",\n\"Beneath the Sands.json\",\n\"Breaking of the Fellowship Nightmare.json\",\n\"Celebrimbor's Secret Nightmare.json\",\n\"Celebrimbor's Secret.json\",\n\"Challenge of the Wainriders.json\",\n\"Children of Eorl.json\",\n\"Conflict at the Carrock Nightmare.json\",\n\"Conflict at the Carrock.json\",\n\"Core Set.json\",\n\"Deadmen's Dike Nightmare.json\",\n\"Dungeons Deep and Caverns Dim Nightmare.json\",\n\"Encounter at Amon Dîn Nightmare.json\",\n\"Encounter at Amon Dîn.json\",\n\"Escape From Dol Guldur Nightmare.json\",\n\"Escape from Khazad-dûm.json\",\n\"Escape from Mount Gram Nightmare.json\",\n\"Escape from Mount Gram.json\",\n\"Fire in the Night.json\",\n\"First Age.json\",\n\"Flies and Spiders Nightmare.json\",\n\"Flight from Moria Nightmare.json\",\n\"Flight of the Stormcaller Nightmare.json\",\n\"Flight of the Stormcaller.json\",\n\"Flight to the Ford Nightmare.json\",\n\"Fog on the Barrow-downs.json\",\n\"Foundations of Stone Nightmare.json\",\n\"Foundations of Stone.json\",\n\"Heirs of Númenor.json\",\n\"Helm's Deep Nightmare.json\",\n\"Into Fangorn Nightmare.json\",\n\"Into Ithilien Nightmare.json\",\n\"Into the Pit Nightmare.json\",\n\"Intruders in Chetwood Nightmare.json\",\n\"Journey Along the Anduin Nightmare.json\",\n\"Journey in the Dark Nightmare.json\",\n\"Journey to the Cross-roads Nightmare.json\",\n\"Khazad-dûm.json\",\n\"Mount Gundabad.json\",\n\"Murder at the Prancing Pony.json\",\n\"Over the Misty Mountains Grim Nightmare.json\",\n\"Passage Through Mirkwood Nightmare.json\",\n\"Peril in Pelargir Nightmare.json\",\n\"Race Across Harad.json\",\n\"Raid on the Grey Havens Nightmare.json\",\n\"Return to Mirkwood Nightmare.json\",\n\"Return to Mirkwood.json\",\n\"Road to Rivendell Nightmare.json\",\n\"Road to Rivendell.json\",\n\"Roam Across Rhovanion.json\",\n\"Shadow and Flame Nightmare.json\",\n\"Shadow and Flame.json\",\n\"Shelob's Lair Nightmare.json\",\n\"Temple of the Deceived Nightmare.json\",\n\"Temple of the Deceived.json\",\n\"The Antlered Crown Nightmare.json\",\n\"The Antlered Crown.json\",\n\"The Battle of Carn Dûm Nightmare.json\",\n\"The Battle of Carn Dûm.json\",\n\"The Battle of Five Armies Nightmare.json\",\n\"The Battle of Lake-town.json\",\n\"The Betrayal of Mîm.json\",\n\"The Black Riders.json\",\n\"The Black Serpent.json\",\n\"The Blood of Gondor Nightmare.json\",\n\"The Blood of Gondor.json\",\n\"The City of Corsairs Nightmare.json\",\n\"The City of Corsairs.json\",\n\"The City of Ulfast.json\",\n\"The Crossings of Poros.json\",\n\"The Dead Marshes Nightmare.json\",\n\"The Dead Marshes.json\",\n\"The Dread Realm Nightmare.json\",\n\"The Dread Realm.json\",\n\"The Drowned Ruins Nightmare.json\",\n\"The Drowned Ruins.json\",\n\"The Drúadan Forest Nightmare.json\",\n\"The Drúadan Forest.json\",\n\"The Dungeons of Cirith Gurat.json\",\n\"The Dunland Trap Nightmare.json\",\n\"The Dunland Trap.json\",\n\"The Fall of Nargothrond.json\",\n\"The Fate of Númenor Nightmare.json\",\n\"The Fate of Wilderland.json\",\n\"The Flame of the West.json\",\n\"The Fords of Isen Nightmare.json\",\n\"The Fortress of Nurn.json\",\n\"The Ghost of Framsburg.json\",\n\"The Grey Havens.json\",\n\"The Hills of Emyn Muil Nightmare.json\",\n\"The Hills of Emyn Muil.json\",\n\"The Hobbit: On the Doorstep.json\",\n\"The Hobbit: Over Hill and Under Hill.json\",\n\"The Hunt for Gollum Nightmare.json\",\n\"The Hunt for Gollum.json\",\n\"The Hunt for the Dreadnaught.json\",\n\"The Land of Shadow.json\",\n\"The Land of Sorrow.json\",\n\"The Lonely Mountain Nightmare.json\",\n\"The Long Dark Nightmare.json\",\n\"The Long Dark.json\",\n\"The Lost Realm.json\",\n\"The Massing at Osgiliath.json\",\n\"The Mines of Moria.json\",\n\"The Morgul Vale Nightmare.json\",\n\"The Morgul Vale.json\",\n\"The Mountain of Fire.json\",\n\"The Mûmakil.json\",\n\"The Nîn-in-Eilph Nightmare.json\",\n\"The Nîn-in-Eilph.json\",\n\"The Old Forest.json\",\n\"The Passage of the Marshes Nightmare.json\",\n\"The Redhorn Gate Nightmare.json\",\n\"The Redhorn Gate.json\",\n\"The Ring Goes South Nightmare.json\",\n\"The Road Darkens.json\",\n\"The Road to Isengard Nightmare.json\",\n\"The Ruins of Belegost.json\",\n\"The Sands of Harad.json\",\n\"The Seventh Level Nightmare.json\",\n\"The Siege of Annúminas.json\",\n\"The Siege of Cair Andros Nightmare.json\",\n\"The Steward's Fear Nightmare.json\",\n\"The Steward's Fear.json\",\n\"The Stone of Erech.json\",\n\"The Thing in the Depths Nightmare.json\",\n\"The Thing in the Depths.json\",\n\"The Three Trials Nightmare.json\",\n\"The Three Trials.json\",\n\"The Treachery of Rhudaur Nightmare.json\",\n\"The Treachery of Rhudaur.json\",\n\"The Treason of Saruman.json\",\n\"The Uruk-hai Nightmare.json\",\n\"The Voice of Isengard.json\",\n\"The Wastes of Eriador Nightmare.json\",\n\"The Wastes of Eriador.json\",\n\"The Watcher in the Water Nightmare.json\",\n\"The Watcher in the Water.json\",\n\"The Weather Hills Nightmare.json\",\n\"The Wilds of Rhovanion.json\",\n\"The Withered Heath.json\",\n\"The Wizard's Quest.json\",\n\"The Woodland Realm.json\",\n\"To Catch an Orc Nightmare.json\",\n\"Trial Upon the Marches.json\",\n\"Trouble in Tharbad Nightmare.json\",\n\"Trouble in Tharbad.json\",\n\"Two-Player Limited Edition Starter.json\",\n\"Under the Ash Mountains.json\",\n\"Voyage Across Belegaer Nightmare.json\",\n\"We Must Away, Ere Break of Day Nightmare.json\",\n\"Wrath and Ruin.json\",\n];","import { Action, ThunkAction } from \"@reduxjs/toolkit\";\nimport axios, { AxiosResponse } from \"axios\";\nimport { CardPack as CardPackMarvel } from \"../../external-api/marvel-card-data\";\nimport {\n  CardPack as CardPackLOTR,\n  Scenario,\n} from \"../../external-api/beorn-json-data\";\nimport { packList as marvelPackList } from \"../../generated/packsList\";\nimport { packList as lotrPackList } from \"../../generated/packsList_lotr\";\nimport scenarioListLOTR from \"../../external/ringsteki-json-data/scenarios.json\";\nimport { RootState } from \"../../store/rootReducer\";\nimport {\n  loadCardsDataForPack,\n  loadCardsForEncounterSet,\n} from \"./cards-data.slice\";\nimport { GameType } from \"../../constants/app-constants\";\n\nexport const allJsonData = (): ThunkAction<\n  void,\n  RootState,\n  unknown,\n  Action<string>\n> => async (dispatch) => {\n  let resultsList = await Promise.all(\n    marvelPackList.map((pack) => getSpecificMarvelPack(pack))\n  );\n\n  resultsList.forEach((result) => {\n    if (result.res.status === 200) {\n      dispatch(\n        loadCardsDataForPack({\n          packType: GameType.MarvelChampions,\n          pack: result.res.data as any,\n          pack_code: result.packCode,\n        })\n      );\n    } else {\n      console.error(\"Failed to load some json data\");\n    }\n  });\n\n  const resultsListLOTR = await Promise.all(\n    lotrPackList.map((pack) => getSpecificLOTRPack(pack))\n  );\n\n  resultsListLOTR.forEach((result) => {\n    if (result.res.status === 200) {\n      dispatch(\n        loadCardsDataForPack({\n          packType: GameType.LordOfTheRingsLivingCardGame,\n          pack: result.res.data as any,\n          pack_code: result.packCode,\n        })\n      );\n    } else {\n      console.error(\"Failed to load some json data\");\n    }\n  });\n\n  const resultsListLOTRScenarios = await Promise.all(\n    scenarioListLOTR.map((scenario) => getSpecificLOTRScenario(scenario.Title))\n  );\n\n  resultsListLOTRScenarios.forEach((result) => {\n    if (result.status === 200) {\n      dispatch(\n        loadCardsForEncounterSet({\n          setCode: result.data.Slug,\n          cards: result.data.AllCards,\n        })\n      );\n    } else {\n      console.error(\"Failed to load some json data\");\n    }\n  });\n};\n\nconst getSpecificMarvelPack = async (\n  packName: string\n): Promise<{ res: AxiosResponse<CardPackMarvel>; packCode: string }> => {\n  const response = await axios.get<CardPackMarvel>(\n    process.env.PUBLIC_URL + \"/json_data/\" + packName\n  );\n  return {\n    res: response,\n    packCode: packName.split(\".json\")[0],\n  };\n};\n\nconst getSpecificLOTRPack = async (\n  packName: string\n): Promise<{ res: AxiosResponse<CardPackLOTR>; packCode: string }> => {\n  const response = await axios.get<CardPackLOTR>(\n    process.env.PUBLIC_URL + \"/json_data/\" + packName\n  );\n  return {\n    res: response,\n    packCode: packName.split(\".json\")[0],\n  };\n};\n\nconst getSpecificLOTRScenario = async (\n  scenario: string\n): Promise<AxiosResponse<Scenario>> => {\n  const response = await axios.get<Scenario>(\n    process.env.PUBLIC_URL + \"/json_data/scenarios/\" + scenario + \".json\"\n  );\n  return response;\n};\n","import { connect } from \"react-redux\";\nimport { ActionCreators } from \"redux-undo\";\nimport Game from \"./Game\";\nimport { getCardsDataEntities } from \"./features/cards-data/cards-data.selectors\";\nimport { loadCardsData } from \"./features/cards-data/cards-data.slice\";\nimport {\n  getCards,\n  getDropTargetCardsById,\n  getMultiselectMode,\n  getPanMode,\n} from \"./features/cards/cards.selectors\";\nimport {\n  adjustCounterToken,\n  cardMove,\n  endCardMove,\n  exhaustCard,\n  flipCards,\n  selectCard,\n  selectMultipleCards,\n  togglePanMode,\n  toggleSelectCard,\n  toggleToken,\n  unselectAllCards,\n  unselectCard,\n} from \"./features/cards/cards.slice\";\nimport {\n  addCardStack,\n  fetchDecklistById,\n  pullCardOutOfCardStack,\n  startCardMove,\n  shuffleStack,\n  drawCardsOutOfCardStack,\n  createDeckFromTxt,\n} from \"./features/cards/cards.thunks\";\nimport { generateGameStateUrl } from \"./features/game/game.thunks\";\nimport { allJsonData } from \"./features/cards-data/cards-data.thunks\";\nimport {\n  getGame,\n  getMenuPreviewCard,\n  getPeerId,\n  getPlayerColors,\n} from \"./features/game/game.selectors\";\nimport {\n  connectToRemoteGame,\n  updatePosition,\n  updateZoom,\n  requestResync,\n  setPreviewCardId,\n  clearPreviewCard,\n  quitGame,\n  showRadialMenuAtPosition,\n} from \"./features/game/game.slice\";\n\nimport {\n  moveCounter,\n  removeCounter,\n  updateCounterValue,\n  updateCounterColor,\n} from \"./features/counters/counters.slice\";\nimport { addNewCounter } from \"./features/counters/counters.thunks\";\nimport { resetApp } from \"./store/global.actions\";\nimport { RootState } from \"./store/rootReducer\";\nimport { getCurrentCounters } from \"./features/counters/counters.selectors\";\n\nconst mapStateToProps = (state: RootState) => {\n  return {\n    playerColors: getPlayerColors(state),\n    cards: getCards(state),\n    cardsData: getCardsDataEntities(state),\n    panMode: getPanMode(state),\n    multiselectMode: getMultiselectMode(state),\n    gameState: getGame(state),\n    counters: getCurrentCounters(state),\n    peerId: getPeerId(state),\n    dropTargetCardsById: getDropTargetCardsById(state),\n    menuPreviewCard: getMenuPreviewCard(state),\n  };\n};\n\nconst GameContainer = connect(mapStateToProps, {\n  cardMove,\n  endCardMove,\n  exhaustCard,\n  loadCardsData,\n  allJsonData,\n  selectCard,\n  unselectCard,\n  toggleSelectCard,\n  selectMultipleCards,\n  startCardMove,\n  unselectAllCards,\n  togglePanMode,\n  flipCards,\n  shuffleStack,\n  fetchDecklistById,\n  updateZoom,\n  updatePosition,\n  resetApp,\n  addCardStack,\n  toggleToken,\n  adjustCounterToken,\n  pullCardOutOfCardStack,\n  addNewCounter,\n  updateCounterValue,\n  removeCounter,\n  moveCounter,\n  connectToRemoteGame,\n  requestResync,\n  undo: ActionCreators.undo,\n  redo: ActionCreators.redo,\n  drawCardsOutOfCardStack,\n  setPreviewCardId,\n  clearPreviewCard,\n  quitGame,\n  updateCounterColor,\n  createDeckFromTxt,\n  generateGameStateUrl,\n  showRadialMenuAtPosition,\n})(Game);\n\nexport default GameContainer;\n","import { Vector2d } from \"konva/lib/types\";\nimport { Action } from \"redux\";\nimport { ThunkAction } from \"redux-thunk\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { RootState } from \"../../store/rootReducer\";\nimport { addNewCounterWithId } from \"./counters.actions\";\n\nexport const addNewCounter =\n  (pos: Vector2d): ThunkAction<void, RootState, unknown, Action<string>> =>\n  (dispatch) => {\n    const payloadWithId = {\n      pos,\n      id: uuidv4(),\n    };\n    dispatch(addNewCounterWithId(payloadWithId));\n  };\n","import { Vector2d } from \"konva/lib/types\";\nimport { CardData } from \"../external-api/common-card-data\";\n\nexport const convertMarvelTxtToDeckInfo = (\n  heroDataByName: { [key: string]: CardData },\n  playerCardDataByName: { [key: string]: CardData },\n  position: Vector2d,\n  txtContents: string\n) => {\n  const nonEmptyLines = txtContents\n    .split(\"\\n\")\n    .map((l) => l.trim())\n    .filter((l) => !!l);\n\n  let heroName = \"\";\n  const packLineIndex = nonEmptyLines.findIndex((l) =>\n    l.toLocaleLowerCase().startsWith(\"pack\")\n  );\n  if (packLineIndex !== -1) {\n    heroName = nonEmptyLines[packLineIndex - 1];\n  }\n\n  const hero = heroDataByName[heroName];\n  if (!hero) {\n    throw new Error(`Could not find hero with name ${heroName}`);\n  }\n\n  // Mock out the slots\n  const pattern = /^\\dx/;\n  const slotLines = nonEmptyLines.filter((l) => l.match(pattern)?.index === 0);\n  let slots: { [key: string]: number } = {};\n\n  slotLines.forEach((sl) => {\n    // first character should be a number\n    const quantity = parseInt(sl[0]);\n    if (Number.isNaN(quantity)) {\n      throw new Error(\"Could not get number from txt file for card\");\n    }\n\n    const cardName = sl.split(pattern)[1].split(\"(\")[0].trim();\n    const card = playerCardDataByName[cardName];\n    slots[card.code] = quantity;\n  });\n\n  console.log(heroName);\n  return {\n    data: {\n      investigator_code: hero.code,\n      slots,\n    },\n  };\n};\n","import { Action, ThunkAction } from \"@reduxjs/toolkit\";\nimport { RootState } from \"../../store/rootReducer\";\nimport * as jc from \"jsoncrush\";\nimport { copyToClipboard, getBaseUrl } from \"../../utilities/text-utils\";\nexport const generateGameStateUrl = (): ThunkAction<\n  void,\n  RootState,\n  unknown,\n  Action<any>\n> => (_dispatch, getState) => {\n  const currentStoreState = getState();\n\n  const cards = currentStoreState.liveState.present.cards.cards;\n  const counters = currentStoreState.liveState.present.counters;\n  const gameType = currentStoreState.game.activeGameType;\n  const crushedCardsString = jc.JSONCrush(JSON.stringify(cards));\n  const crushedCountersString = jc.JSONCrush(JSON.stringify(counters));\n  copyToClipboard(\n    `${getBaseUrl()}?gameType=${gameType}&cards=${crushedCardsString}&counters=${crushedCountersString}`\n  );\n};\n\nexport const clearQueryParams = (): ThunkAction<\n  void,\n  RootState,\n  unknown,\n  Action<any>\n> => () => {\n  const queryParams = new URLSearchParams(window.location.search);\n  const queryParamsGameType = queryParams.get(\"gameType\");\n  if (!!queryParamsGameType) {\n    window.history.replaceState(\n      {},\n      document.title,\n      window.location.pathname || \"/\"\n    );\n  }\n};\n","import React, { useEffect } from \"react\";\nimport { GameType } from \"./constants/app-constants\";\nimport GameContainer from \"./GameContainer\";\nimport \"./App.scss\";\nimport Select from \"@material-ui/core/Select\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport FormControl from \"@material-ui/core/FormControl\";\nimport InputLabel from \"@material-ui/core/InputLabel\";\ninterface IProps {\n  activeGameType: GameType | null;\n  updateActiveGameType: (val: GameType) => void;\n  clearQueryParams: () => void;\n}\n\nconst App = (props: IProps) => {\n  const clearQueryParams = props.clearQueryParams;\n  useEffect(() => {\n    clearQueryParams();\n  }, [clearQueryParams]);\n\n  return !!props.activeGameType ? (\n    <GameContainer currentGameType={props.activeGameType}></GameContainer>\n  ) : (\n    renderGamePicker(props)\n  );\n};\n\nconst camelCaseToSpaces = (str: string) => {\n  // insert a space before all caps\n  return (\n    str\n      .replace(/([A-Z])/g, \" $1\")\n      // uppercase the first character\n      .replace(/^./, (s) => {\n        return s.toUpperCase();\n      })\n  );\n};\n\nconst renderGamePicker = (props: IProps) => {\n  return (\n    <div className=\"game-picker\">\n      <h1>Card Game Playground</h1>\n      <FormControl className=\"select\">\n        <InputLabel id=\"game-picker-label\">Select Game</InputLabel>\n        <Select\n          id=\"game-picker\"\n          labelId=\"game-picker-label\"\n          onChange={(e) => {\n            props.updateActiveGameType(e.target.value as GameType);\n          }}\n        >\n          {Object.entries(GameType).map(([key, value]) => {\n            const label = camelCaseToSpaces(key);\n            return <MenuItem value={value}>{label}</MenuItem>;\n          })}\n        </Select>\n      </FormControl>\n    </div>\n  );\n};\n\nexport default App;\n","import { connect } from \"react-redux\";\nimport App from \"./App\";\nimport { getActiveGameType } from \"./features/game/game.selectors\";\nimport { updateActiveGameType } from \"./features/game/game.slice\";\nimport { clearQueryParams } from \"./features/game/game.thunks\";\nimport { RootState } from \"./store/rootReducer\";\n\nconst mapStateToProps = (state: RootState) => {\n  return {\n    activeGameType: getActiveGameType(state),\n  };\n};\n\nconst AppContainer = connect(mapStateToProps, {\n  updateActiveGameType,\n  clearQueryParams,\n})(App);\n\nexport default AppContainer;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.scss\";\nimport { Provider } from \"react-redux\";\nimport * as serviceWorkerRegistration from \"./serviceWorkerRegistration\";\nimport configureStore from \"./store/configureStore\";\nimport AppContainer from \"./AppContainer\";\n\nconst store = configureStore();\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <AppContainer />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorkerRegistration.register();\n"],"sourceRoot":""}