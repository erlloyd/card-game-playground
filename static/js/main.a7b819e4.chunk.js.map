{"version":3,"sources":["../node_modules/peerjs/dist sync","constants/card-constants.ts","CardTokens.tsx","features/cards/cards.selectors.ts","CardTokensContainer.tsx","constants/app-constants.ts","Card.tsx","ContextMenu.tsx","DeckLoader.tsx","EncounterLoader.tsx","features/cards-data/cards-data.selectors.ts","EncounterLoaderContainer.tsx","utilities/geo.ts","store/localStorage.ts","features/cards/initialState.ts","features/cards/cards.slice.ts","features/cards/cards.actions.ts","constants/card-pack-mapping.ts","features/cards/cards.thunks.ts","store/global.actions.ts","TopLayer.tsx","CardStackCardSelector.tsx","features/game/initialState.ts","features/game/game.slice.ts","CardStackCardSelectorContainer.tsx","Counter.tsx","PeerConnector.tsx","constants/card-missing-image-map.ts","TokenValueModifier.tsx","images/background.png","images/first_player_token.png","FirstPlayerToken.tsx","features/counters/counters.actions.ts","features/counters/initialState.ts","features/counters/counters.slice.ts","features/counters/counters.selectors.ts","FirstPlayerTokenContainer.tsx","App.tsx","features/cards-data/cards-data.slice.ts","features/cards-data/initialState.ts","features/game/game.selectors.ts","AppContainer.tsx","features/counters/counters.thunks.ts","serviceWorker.ts","store/rootReducer.ts","store/peer-js-redux-middleware.ts","store/configureStore.ts","index.tsx"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","cardConstants","CardTokens","props","damageImg","threatImg","genericImg","unmounted","state","imagesLoaded","damage","threat","generic","Image","onload","setState","card","counterTokens","src","process","prevProps","prevState","this","damageX","x","naturalWidth","damageY","y","showDamage","damageToken","width","height","naturalHeight","fillPatternImage","damageText","text","fill","align","verticalAlign","fontSize","threatX","threatY","showThreat","threatToken","threatText","genericX","genericY","showGeneric","Component","getCards","liveState","present","cards","getCardMapById","createSelector","reduce","map","getPanMode","panMode","getDropTargetCardsById","returnVal","Object","entries","dropTargetCards","forEach","key","value","ownerRef","CardTokensContainer","connect","myPeerRef","uuidv4","HORIZONTAL_TYPE_CODES","stringArraysEqual","array1","array2","length","every","index","Card","imgs","stunnedImg","confusedImg","toughImg","touchTimer","rect","shuffleToggle","initCardImages","imgUrls","img","imageLoaded","onerror","imageLoadFailed","imgUrl","getStrokeColor","dropTargetColor","selected","selectedColor","renderUnanimatedCard","heightToUse","widthToUse","imgToUse","find","i","complete","undefined","scale","getScale","offset","native","to","rotation","exhausted","animatedProps","Rect","ref","node","cornerRadius","stroke","strokeWidth","fillPatternRotation","shouldRenderImageHorizontal","typeCode","fillPatternScaleX","fillPatternScaleY","shadowForStrokeEnabled","hitStrokeWidth","opacity","isGhost","draggable","controlledBy","onDragStart","handleDragStart","onDragMove","handleDragMove","onDragEnd","handleDragEnd","onDblClick","handleDoubleClick","onDblTap","onClick","handleClick","onTap","onMouseDown","handleMouseDown","onTouchStart","handleTouchStart","onTouchMove","handleTouchMove","onTouchEnd","handleTouchEnd","onMouseOver","handleMouseOver","onMouseOut","handleMouseOut","onContextMenu","handleContextMenu","cardStackOffset","cardStack","numCardsInStack","shouldRenderStunned","cardState","stunned","tokenImagesLoaded","stunnedToken","getTokenInSlot","confusedToken","confused","toughToken","tough","cardTokens","dragging","renderCardName","event","dx","target","dy","cancelBubble","clearTimeout","setTimeout","handleHover","handleHoverLeave","prevImgUrls","shuffling","currentRotation","duration","renderCard","cardWidth","cardHeight","textOffset","name","shouldRender","slot","dimensions","stunnedOffset","type","typeCodes","includes","plainCardBack","widthHorizontal","heightHorizontal","some","ContextMenu","preventDefault","handleContextItemClicked","item","action","contextItemClicked","items","hideContextMenu","Menu","keepMounted","open","onClose","anchorReference","anchorPosition","top","position","left","MenuItem","label","DeckLoader","inputValue","focusInputField","input","querySelector","focus","stopPropagation","handleKeyPress","toLocaleLowerCase","loadDeckId","onKeyPress","className","TextField","onChange","variant","EncounterLoader","handleSelected","_event","encounterCards","filter","c","oc","back_link","concat","Array","from","quantity","_i","loadCards","Autocomplete","options","encounterData","getOptionLabel","option","setData","style","renderInput","params","getCardsData","cardsData","getCardsDataEntities","entities","encounterEntities","getCardsDataHeroEntities","getCardsDataEncounterEntities","getCardsDataSetData","getCardsDataEncounterEntitiesBySetCode","setTypesEncounters","values","encounterCard","setCode","set_code","push","set","setTypeCode","sort","a","b","EncounterLoaderContainer","getDistance","point1","point2","deltaX","deltaY","Math","sqrt","getCenter","p1","p2","loadState","serializedState","localStorage","getItem","baseState","JSON","parse","err","console","error","localStorageState","StatusTokenType","CounterTokenType","initialState","ghostCards","addCardStackWithId","createAction","pullCardOutOfCardStackWithId","drawCardsOutOfCardStackWithIds","startCardMoveWithSplitStackId","replaceCardStack","setStackShuffling","CARD_PACK_REMAPPING","bkw","cap","drs","hlk","trors","twc","EXTRA_CARDS","doctor_strange","jsonId","ant","wsp","fetchDecklistById","createAsyncThunk","payload","thunkApi","axios","get","decklistId","response","getState","heroCardsData","heroSet","data","investigator_code","heroSetCode","encounterCardsData","heroObligationDeck","type_code","heroEncounterDeckData","heroEncounterDeck","cd","extraCards","heroId","dataId","extraHeroCards","relatedEncounterDeck","encounterDeckId","relatedObligationDeck","obligationDeckId","shuffle","array","temporaryValue","randomIndex","returnArray","stringify","currentIndex","floor","random","resetApp","receiveRemoteGameState","getCardStackWithId","mutateCardWithId","callback","cardToUpdate","unselectAllCardsReducer","ACTOR_REF","cardsSlice","createSlice","reducers","selectCard","unselectOtherCards","unselectCard","toggleSelectCard","exhaustCard","cardMove","movedCards","primaryCard","possibleDropTargets","foreachUnselectedCard","distance","c1","c2","movedCard","splice","indexOf","endCardMove","dropTargetCard","selectMultipleCards","ids","unselectAllCards","togglePanMode","flipCards","faceup","reverse","resetCards","toggleToken","cardToToggle","statusTokens","tokenType","adjustCounterToken","delta","extraReducers","builder","addCase","cardToReplaceStack","newStack","cardJsonIds","cardStackToUse","cardStackId","newCardStack","newCard","assign","cardIndexToRemove","findIndex","cardToStartMoving","splitTopCard","cardToMove","topCard","shift","splitCardId","actorRef","foreachSelectedAndControlledCard","numberToDraw","idsToUse","sourceCardStackId","topCardDetails","stackToUpdate","fulfilled","log","heroCard","mainDeckStack","slots","cardDetails","cardPadding","newDeck","encounterDeck","obligationDeck","actions","TopLayer","completed","containerStyle","children","CardStackCardSelector","cardsDataInStack","handleHighlightChange","reason","preview","clearPreview","cardSelected","cardsDataEntities","onHighlightChange","playerColors","peerId","previewCard","menuPreviewCardJsonId","stageZoom","stagePosition","gameSlice","updateZoom","updatePosition","connectToRemoteGame","setPlayerColor","color","setPeerId","requestResync","setPreviewCardId","clearPreviewCard","setMenuPreviewCardJsonId","clearMenuPreviewCardJsonId","CardStackCardSelectorContainer","Counter","handleDecrement","updateCounterValueBy","handleIncrement","pos","PeerConnector","inputRef","MISSING_CARD_IMAGE_MAP","TokenValueModifier","newValue","updated","Button","marginLeft","FirstPlayerToken","updatePos","image","firstPlayerToken","addNewCounterWithId","counters","firstPlayerCounterPosition","countersSlice","updateCounterValue","counter","removeCounter","moveCounter","newPos","moveFirstPlayerCounter","getCounters","getCurrentCounters","getFirstPlayerTokenPos","FirstPlayerTokenContainer","App","stage","lastCenter","lastDist","handleCounterValueUpdate","handleCounterDrag","noOp","renderEmptyMessage","renderContextMenu","showContextMenu","containerRect","container","getBoundingClientRect","pointerPosition","contextMenuPosition","contextMenuItems","clearContextMenu","renderDeckImporter","showDeckImporter","deckImporterPosition","clearDeckImporter","handleImportDeck","getRelativePositionFromTarget","renderEncounterImporter","showEncounterImporter","encounterImporterPosition","clearEncounterImporter","handleLoadEncounter","renderCardSearch","showCardSearch","cardSearchPosition","cardStackForSearching","clearCardSearch","handleCardSelectedFromCardStack","renderPeerConnector","showPeerConnector","peerConnectorPosition","clearPeerConnector","handlePeerConnect","renderTokenModifier","showTokenValueModifier","tokenValueModifierPosition","tokenValueModifierProps","clearTokenValueModifier","addCardStack","pullCardOutOfCardStack","handleStageClickOrTap","mousePos","selectStartPos","handleWheel","evt","oldScale","gameState","pointer","getPointerPosition","mousePointTo","newScale","handleCounterContextMenu","counterId","menuItems","handleCardContextMenu","cardId","currentStatusTokens","shuffleStack","Stunned","Confused","Tough","Damage","Threat","Generic","handleCardClick","modifierKeyHeld","shiftKey","metaKey","ctrlKey","handleSelectAndExhaust","handleCardDragStart","draggingCard","hasStack","upperRightPoint","startCardMove","intCode","parseInt","Number","isNaN","mySelectedCards","drawCardsOutOfCardStack","handleKeyDown","redo","undo","getRawPreviewCardPosition","horizontal","pointerPos","screenMidPointX","window","innerWidth","posParam","transform","getAbsoluteTransform","copy","invert","point","button","selecting","getSelectionRectInfo","selectRect","abs","handleMouseUp","drewASelectionRect","selectedCards","currSelectedCards","Intersects","touch1","touches","touch2","handleMultiTouch","handleMouseMove","isDragging","stopDrag","clientX","clientY","newCenter","dist","pointTo","currentTarget","addNewCounter","getCardType","cardData","getCardName","cardInQuestion","getCardCode","getImgUrls","urls","topCardData","double_sided","generateLCGCDNImageUrl","faction_code","codeForMissingCheck","missingImageOverride","checkMissingImageMap","unshift","Konva","hitOnDragEnabled","playmatImage","playmat","loadCardsData","staticCards","dropTargetCardsById","tokens","movingCards","iAmDragging","possiblePreviewCards","menuPreviewCard","previewCards","_card","isHorizontal","rawPos","previewPos","url","tabIndex","onKeyDown","Consumer","store","innerHeight","onMouseUp","onMouseMove","onWheel","codeToUse","groupCode","pack_code","substring","cardCode","toLocaleUpperCase","cardSuffix","cardsDataSlice","heroPacks","PackData","encounterPacks","pack","SetData","card_set_type_code","getGame","game","getPlayerColors","getPeerId","getMenuPreviewCard","AppContainer","dispatch","payloadWithId","cardsState","s","stackToShuffle","shuffledStack","ActionCreators","possibleIds","payloadWithIds","Boolean","location","hostname","match","undoableState","combineReducers","rootReducer","undoable","limit","groupBy","groupByActionTypes","excludeAction","blacklistRemoteActions","setupConnection","conn","storeAPI","on","INITIAL_STATE_MSG","RESYNC","send","REMOTE_ACTION","customizedMiddleware","getDefaultMiddleware","thunk","immutableCheck","serializableCheck","activeCon","cgpPeer","Peer","debug","config","iceServers","username","credential","remoteParamArray","href","split","remoteId","metadata","setPlayerColorAction","peerConnection","onconnectionstatechange","ev","connectionState","next","rtkConfigureStore","reducer","middleware","devTools","subscribe","throttle","blacklistStateKeys","setItem","saveState","configureStore","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.a7b819e4.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 277;","export const cardConstants = {\n  CARD_HEIGHT: 209,\n  CARD_WIDTH: 150,\n  CARD_PREVIEW_HEIGHT: 418,\n  CARD_PREVIEW_WIDTH: 300,\n};\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport { ICardStack } from \"./features/cards/initialState\";\nimport { Rect, Text } from \"react-konva\";\nimport { cardConstants } from \"./constants/card-constants\";\ninterface IProps {\n  x: number;\n  y: number;\n  card: ICardStack | undefined;\n}\n\ninterface IState {\n  imagesLoaded: {\n    damage: boolean;\n    threat: boolean;\n    generic: boolean;\n  };\n}\n\nclass CardTokens extends Component<IProps, IState> {\n  private damageImg: HTMLImageElement;\n  private threatImg: HTMLImageElement;\n  private genericImg: HTMLImageElement;\n  private unmounted: boolean;\n\n  constructor(props: IProps) {\n    super(props);\n\n    this.unmounted = true;\n\n    this.state = {\n      imagesLoaded: {\n        damage: false,\n        threat: false,\n        generic: false,\n      },\n    };\n\n    this.damageImg = new Image();\n    this.threatImg = new Image();\n    this.genericImg = new Image();\n\n    // DAMAGE\n    this.damageImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          imagesLoaded: {\n            damage: true,\n            threat: this.state.imagesLoaded.threat,\n            generic: this.state.imagesLoaded.generic,\n          },\n        });\n      }\n    };\n\n    if (!!this.props.card?.counterTokens.damage) {\n      this.damageImg.src =\n        process.env.PUBLIC_URL + \"/images/standard/damage.png\";\n    }\n\n    // THREAT\n    this.threatImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          imagesLoaded: {\n            damage: this.state.imagesLoaded.damage,\n            threat: true,\n            generic: this.state.imagesLoaded.generic,\n          },\n        });\n      }\n    };\n\n    if (!!this.props.card?.counterTokens.threat) {\n      this.threatImg.src =\n        process.env.PUBLIC_URL + \"/images/standard/threat.png\";\n    }\n\n    // GENERIC\n    this.genericImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          imagesLoaded: {\n            damage: this.state.imagesLoaded.damage,\n            threat: this.state.imagesLoaded.threat,\n            generic: true,\n          },\n        });\n      }\n    };\n\n    if (!!this.props.card?.counterTokens.generic) {\n      this.genericImg.src =\n        process.env.PUBLIC_URL + \"/images/standard/generic_counter.png\";\n    }\n  }\n\n  public componentDidUpdate(prevProps: IProps, prevState: IState) {\n    // DAMAGE\n    if (\n      !this.state.imagesLoaded.damage &&\n      !prevProps.card?.counterTokens.damage &&\n      !!this.props.card?.counterTokens.damage\n    ) {\n      this.damageImg.src =\n        process.env.PUBLIC_URL + \"/images/standard/damage.png\";\n    }\n\n    // THREAT\n    if (\n      !this.state.imagesLoaded.threat &&\n      !prevProps.card?.counterTokens.threat &&\n      !!this.props.card?.counterTokens.threat\n    ) {\n      this.threatImg.src =\n        process.env.PUBLIC_URL + \"/images/standard/threat.png\";\n    }\n\n    // DAMAGE\n    if (\n      !this.state.imagesLoaded.generic &&\n      !prevProps.card?.counterTokens.generic &&\n      !!this.props.card?.counterTokens.generic\n    ) {\n      this.genericImg.src =\n        process.env.PUBLIC_URL + \"/images/standard/generic_counter.png\";\n    }\n  }\n\n  public componentDidMount() {\n    this.unmounted = false;\n  }\n\n  public componentWillUnmount() {\n    this.unmounted = true;\n  }\n\n  render() {\n    if (!this.props.card) return null;\n\n    const damageX = this.props.x - this.damageImg.naturalWidth / 2;\n    const damageY = this.props.y - cardConstants.CARD_HEIGHT / 2 + 20;\n    const showDamage =\n      this.state.imagesLoaded.damage && !!this.props.card.counterTokens.damage;\n\n    const damageToken = showDamage ? (\n      <Rect\n        key={`${this.props.card.id}-damageToken`}\n        x={damageX}\n        y={damageY}\n        width={this.damageImg.naturalWidth}\n        height={this.damageImg.naturalHeight}\n        fillPatternImage={this.damageImg}\n      ></Rect>\n    ) : null;\n\n    const damageText = showDamage ? (\n      <Text\n        key={`${this.props.card.id}-damageText`}\n        x={damageX}\n        y={damageY}\n        width={this.damageImg.naturalWidth}\n        height={this.damageImg.naturalHeight}\n        text={`${this.props.card.counterTokens.damage}`}\n        fill=\"white\"\n        align=\"center\"\n        verticalAlign=\"middle\"\n        fontSize={24}\n      ></Text>\n    ) : null;\n\n    const threatX = this.props.x - this.threatImg.naturalWidth / 2;\n    const threatY = damageY + this.damageImg.naturalHeight + 5;\n    const showThreat =\n      this.state.imagesLoaded.threat && !!this.props.card.counterTokens.threat;\n\n    const threatToken = showThreat ? (\n      <Rect\n        key={`${this.props.card.id}-threatToken`}\n        x={threatX}\n        y={threatY}\n        width={this.threatImg.naturalWidth}\n        height={this.threatImg.naturalHeight}\n        fillPatternImage={this.threatImg}\n      ></Rect>\n    ) : null;\n\n    const threatText = showThreat ? (\n      <Text\n        key={`${this.props.card.id}-threatText`}\n        x={threatX}\n        y={threatY}\n        width={this.threatImg.naturalWidth}\n        height={this.threatImg.naturalHeight}\n        text={`${this.props.card.counterTokens.threat}`}\n        fill=\"white\"\n        align=\"center\"\n        verticalAlign=\"middle\"\n        fontSize={24}\n      ></Text>\n    ) : null;\n\n    const genericX = this.props.x - this.threatImg.naturalWidth / 2;\n    const genericY = threatY + this.threatImg.naturalHeight + 5;\n    const showGeneric =\n      this.state.imagesLoaded.generic &&\n      !!this.props.card.counterTokens.generic;\n\n    const genericToken = showGeneric ? (\n      <Rect\n        key={`${this.props.card.id}-genericToken`}\n        x={genericX}\n        y={genericY}\n        width={this.genericImg.naturalWidth}\n        height={this.genericImg.naturalHeight}\n        fillPatternImage={this.genericImg}\n      ></Rect>\n    ) : null;\n\n    const genericText = showGeneric ? (\n      <Text\n        key={`${this.props.card.id}-genericText`}\n        x={genericX}\n        y={genericY}\n        width={this.genericImg.naturalWidth}\n        height={this.genericImg.naturalHeight}\n        text={`${this.props.card.counterTokens.generic}`}\n        fill=\"white\"\n        align=\"center\"\n        verticalAlign=\"middle\"\n        fontSize={24}\n      ></Text>\n    ) : null;\n\n    return [\n      damageToken,\n      damageText,\n      threatToken,\n      threatText,\n      genericToken,\n      genericText,\n    ];\n  }\n}\n\nexport default CardTokens;\n","import { createSelector } from \"@reduxjs/toolkit\";\nimport { RootState } from \"../../store/rootReducer\";\nimport { ICardStack } from \"./initialState\";\n\nexport const getCards = (state: RootState) => state.liveState.present.cards;\n\nexport const getCardMapById = createSelector(getCards, (cards) => {\n  return cards.cards.reduce((map: { [k: string]: ICardStack }, card) => {\n    map[card.id] = card;\n    return map;\n  }, {});\n});\n\nexport const getPanMode = (state: RootState) =>\n  state.liveState.present.cards.panMode;\n\nexport const getDropTargetCardsById = createSelector(getCards, (cards) => {\n  const returnVal: {\n    [key: string]: { ownerRef: string; card: ICardStack | null };\n  } = {};\n  Object.entries(cards.dropTargetCards).forEach(([key, value]) => {\n    if (!!value) {\n      returnVal[value.id] = { ownerRef: key, card: value };\n    }\n  });\n\n  return returnVal;\n});\n","import { connect } from \"react-redux\";\n\nimport { RootState } from \"./store/rootReducer\";\nimport CardTokens from \"./CardTokens\";\nimport { getCardMapById } from \"./features/cards/cards.selectors\";\n\nexport interface IProps {\n  id: string;\n}\n\nconst mapStateToProps = (state: RootState, props: IProps) => {\n  return {\n    card: getCardMapById(state)[props.id],\n  };\n};\n\nconst CardTokensContainer = connect(mapStateToProps, {})(CardTokens);\n\nexport default CardTokensContainer;\n","import { v4 as uuidv4 } from \"uuid\";\n\nexport const myPeerRef = uuidv4();\n\nexport type PlayerColor =\n  | \"red\"\n  | \"cyan\"\n  | \"green\"\n  | \"blue\"\n  | \"magnenta\"\n  | \"yellow\";\n\nexport const possibleColors: PlayerColor[] = [\n  \"red\",\n  \"cyan\",\n  \"green\",\n  \"blue\",\n  \"magnenta\",\n  \"yellow\",\n];\n","// tslint:disable:no-console\nimport { KonvaEventObject } from \"konva/types/Node\";\nimport { Rect as RectRef } from \"konva/types/shapes/Rect\";\nimport { Vector2d } from \"konva/types/types\";\nimport * as React from \"react\";\nimport { Component } from \"react\";\nimport { Rect, Text } from \"react-konva\";\nimport { animated, Spring } from \"react-spring/renderprops-konva\";\nimport CardTokensContainer from \"./CardTokensContainer\";\nimport { myPeerRef, PlayerColor } from \"./constants/app-constants\";\nimport { cardConstants } from \"./constants/card-constants\";\n\nexport const HORIZONTAL_TYPE_CODES = [\"main_scheme\", \"side_scheme\"];\n\nexport interface CardTokens {\n  damage: number;\n  threat: number;\n  generic: number;\n}\n\nexport interface CardUIState {\n  stunned: boolean;\n  confused: boolean;\n  tough: boolean;\n  tokens: CardTokens;\n}\n\ninterface IProps {\n  name: string;\n  code: string;\n  selectedColor: PlayerColor;\n  controlledBy: string;\n  dragging: boolean;\n  shuffling: boolean;\n  exhausted: boolean;\n  cardState?: CardUIState;\n  fill: string;\n  handleClick?: (id: string, event: KonvaEventObject<MouseEvent>) => void;\n  handleDoubleClick?: (id: string, event: KonvaEventObject<MouseEvent>) => void;\n  handleDragStart?: (id: string, event: KonvaEventObject<DragEvent>) => void;\n  handleDragMove?: (info: { id: string; dx: number; dy: number }) => void;\n  handleDragEnd?: (id: string) => void;\n  handleHover?: (id: string) => void;\n  handleHoverLeave?: (id: string) => void;\n  id: string;\n  selected: boolean;\n  dropTargetColor?: string;\n  x: number;\n  y: number;\n  width?: number;\n  height?: number;\n  imgUrls: string[];\n  isGhost?: boolean;\n  numCardsInStack?: number;\n  typeCode?: string;\n  faceup: boolean;\n  handleContextMenu?: (\n    id: string,\n    event: KonvaEventObject<PointerEvent>\n  ) => void;\n}\n\ninterface IState {\n  imageLoaded: boolean;\n  imageLoadFailed: number;\n  prevImgUrls: string[];\n  tokenImagesLoaded: {\n    stunned: boolean;\n    confused: boolean;\n    tough: boolean;\n  };\n}\n\nconst stringArraysEqual = (array1: string[], array2: string[]) => {\n  return (\n    array1.length === array2.length &&\n    array1.every((value, index) => {\n      return value === array2[index];\n    })\n  );\n};\n\nclass Card extends Component<IProps, IState> {\n  // tslint:disable-next-line:member-access\n  static getDerivedStateFromProps(props: IProps, state: IState): IState | null {\n    if (!stringArraysEqual(props.imgUrls, state.prevImgUrls ?? [])) {\n      return {\n        imageLoaded: false,\n        imageLoadFailed: 0,\n        prevImgUrls: props.imgUrls,\n        tokenImagesLoaded: {\n          stunned: state.tokenImagesLoaded.stunned,\n          confused: state.tokenImagesLoaded.confused,\n          tough: state.tokenImagesLoaded.tough,\n        },\n      };\n    }\n    // No state update necessary\n    return null;\n  }\n\n  private imgs: HTMLImageElement[] = [];\n  private stunnedImg: HTMLImageElement;\n  private confusedImg: HTMLImageElement;\n  private toughImg: HTMLImageElement;\n  private unmounted: boolean;\n  private touchTimer: any = null;\n  private rect: RectRef | null = null;\n  private shuffleToggle = false;\n\n  constructor(props: IProps) {\n    super(props);\n\n    this.unmounted = true;\n\n    this.state = {\n      imageLoaded: false,\n      imageLoadFailed: 0,\n      prevImgUrls: this.props.imgUrls,\n      tokenImagesLoaded: {\n        stunned: false,\n        confused: false,\n        tough: false,\n      },\n    };\n\n    this.initCardImages(props);\n\n    this.stunnedImg = new Image();\n    this.confusedImg = new Image();\n    this.toughImg = new Image();\n\n    // STUNNED\n    this.stunnedImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          tokenImagesLoaded: {\n            stunned: true,\n            confused: this.state.tokenImagesLoaded.confused,\n            tough: this.state.tokenImagesLoaded.tough,\n          },\n        });\n      }\n    };\n\n    if (!!props.cardState?.stunned) {\n      this.stunnedImg.src =\n        process.env.PUBLIC_URL + \"/images/standard/stunned.png\";\n    }\n\n    // CONFUSED\n    this.confusedImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          tokenImagesLoaded: {\n            stunned: this.state.tokenImagesLoaded.stunned,\n            confused: true,\n            tough: this.state.tokenImagesLoaded.tough,\n          },\n        });\n      }\n    };\n\n    if (!!props.cardState?.confused) {\n      this.confusedImg.src =\n        process.env.PUBLIC_URL + \"/images/standard/confused.png\";\n    }\n\n    // TOUGH\n    this.toughImg.onload = () => {\n      if (!this.unmounted) {\n        this.setState({\n          tokenImagesLoaded: {\n            stunned: this.state.tokenImagesLoaded.stunned,\n            confused: this.state.tokenImagesLoaded.confused,\n            tough: true,\n          },\n        });\n      }\n    };\n\n    if (!!props.cardState?.tough) {\n      this.toughImg.src = process.env.PUBLIC_URL + \"/images/standard/tough.png\";\n    }\n  }\n\n  public componentDidUpdate(prevProps: IProps, prevState: IState) {\n    // if we just went from not shuffling -> shuffling, animate\n    if (!prevProps.shuffling && this.props.shuffling) {\n      if (!!this.rect) {\n        this.shuffleToggle = !this.shuffleToggle;\n        this.rect.to({\n          rotation: this.currentRotation + (this.shuffleToggle ? 360 : -360),\n          duration: 0.2,\n        });\n      }\n    }\n\n    if (\n      !this.state.imageLoaded &&\n      !stringArraysEqual(prevProps.imgUrls, this.props.imgUrls)\n    ) {\n      this.setState({\n        imageLoaded: false,\n        imageLoadFailed: 0,\n      });\n      this.initCardImages(this.props);\n    }\n\n    // STUNNED\n    if (\n      !this.state.tokenImagesLoaded.stunned &&\n      !prevProps.cardState?.stunned &&\n      !!this.props.cardState?.stunned\n    ) {\n      this.stunnedImg.src =\n        process.env.PUBLIC_URL + \"/images/standard/stunned.png\";\n    }\n\n    // CONFUSED\n    if (\n      !this.state.tokenImagesLoaded.confused &&\n      !prevProps.cardState?.confused &&\n      !!this.props.cardState?.confused\n    ) {\n      this.confusedImg.src =\n        process.env.PUBLIC_URL + \"/images/standard/confused.png\";\n    }\n\n    // TOUGH\n    if (\n      !this.state.tokenImagesLoaded.tough &&\n      !prevProps.cardState?.tough &&\n      !!this.props.cardState?.tough\n    ) {\n      this.toughImg.src = process.env.PUBLIC_URL + \"/images/standard/tough.png\";\n    }\n  }\n\n  private initCardImages = (props: IProps) => {\n    this.imgs = props.imgUrls.map(() => new Image());\n\n    // When the image loads, set a flag in the state\n    this.imgs.forEach(\n      (img) =>\n        (img.onload = () => {\n          if (!this.unmounted) {\n            this.setState({\n              imageLoaded: true,\n            });\n          }\n        })\n    );\n\n    this.imgs.forEach(\n      (img) =>\n        (img.onerror = () => {\n          if (!this.unmounted) {\n            this.setState({\n              imageLoadFailed: this.state.imageLoadFailed + 1,\n            });\n          }\n        })\n    );\n\n    props.imgUrls.forEach((imgUrl, index) => (this.imgs[index].src = imgUrl));\n  };\n\n  public componentDidMount() {\n    this.unmounted = false;\n  }\n\n  public componentWillUnmount() {\n    this.unmounted = true;\n  }\n\n  public render() {\n    return this.renderCard(this.state.imageLoaded);\n  }\n\n  private renderCard(imageLoaded: boolean) {\n    const heightToUse = this.props.height || cardConstants.CARD_HEIGHT;\n    const widthToUse = this.props.width || cardConstants.CARD_WIDTH;\n\n    return this.renderUnanimatedCard(heightToUse, widthToUse, imageLoaded);\n  }\n\n  // Unfortunately, if you try to use shadow / blur to indicate selection\n  // (which I did at first and looks better, imo) the performance in horrible,\n  // even with some reccommended settings (shadowForStrokeEnabled = false and\n  // hitStrokeWidth = 0). So we'll just use stroke / border for everything\n  private getStrokeColor = () => {\n    if (!!this.props.dropTargetColor) {\n      return this.props.dropTargetColor;\n    }\n\n    if (this.props.selected) {\n      return this.props.selectedColor;\n    }\n\n    return \"\";\n  };\n\n  private renderUnanimatedCard = (\n    heightToUse: number,\n    widthToUse: number,\n    imageLoaded: boolean\n  ) => {\n    const imgToUse = imageLoaded\n      ? this.imgs.find((i) => i.complete && i.naturalHeight !== 0)\n      : undefined;\n\n    const scale = this.getScale(imgToUse, widthToUse, heightToUse);\n    const offset = {\n      x: widthToUse / 2,\n      y: heightToUse / 2,\n    };\n\n    const card = (\n      <Spring\n        key={`${this.props.id}-card`}\n        native={true}\n        to={{\n          rotation: this.props.exhausted ? 90 : 0,\n        }}\n      >\n        {(animatedProps: any) => (\n          <animated.Rect\n            {...animatedProps}\n            ref={(node) => {\n              if (!!node) {\n                this.rect = node;\n              }\n            }}\n            cornerRadius={9}\n            x={this.props.x}\n            y={this.props.y}\n            width={widthToUse}\n            height={heightToUse}\n            offset={offset}\n            stroke={this.getStrokeColor()}\n            strokeWidth={!!this.getStrokeColor() ? 4 : 0}\n            fillPatternRotation={\n              !imageLoaded ||\n              this.shouldRenderImageHorizontal(\n                this.props.typeCode || \"\",\n                HORIZONTAL_TYPE_CODES\n              )\n                ? 270\n                : 0\n            }\n            fillPatternImage={imgToUse}\n            fillPatternScaleX={scale.width}\n            fillPatternScaleY={scale.height}\n            fill={imageLoaded ? undefined : \"gray\"}\n            shadowForStrokeEnabled={false}\n            hitStrokeWidth={0}\n            opacity={this.props.isGhost ? 0.5 : 1}\n            draggable={\n              this.props.controlledBy === \"\" ||\n              this.props.controlledBy === myPeerRef\n            }\n            onDragStart={this.handleDragStart}\n            onDragMove={this.handleDragMove}\n            onDragEnd={this.handleDragEnd}\n            onDblClick={this.handleDoubleClick}\n            onDblTap={this.handleDoubleClick}\n            onClick={this.handleClick}\n            onTap={this.handleClick}\n            onMouseDown={this.handleMouseDown}\n            onTouchStart={this.handleTouchStart}\n            onTouchMove={this.handleTouchMove}\n            onTouchEnd={this.handleTouchEnd}\n            onMouseOver={this.handleMouseOver}\n            onMouseOut={this.handleMouseOut}\n            onContextMenu={this.handleContextMenu}\n          />\n        )}\n      </Spring>\n    );\n\n    const cardStackOffset = {\n      x: offset.x + 4,\n      y: offset.y - 4,\n    };\n\n    const cardStack =\n      (this.props.numCardsInStack || 1) > 1 ? (\n        <Spring\n          key={`${this.props.id}-cardStack`}\n          native={true}\n          to={{\n            rotation: this.props.exhausted ? 90 : 0,\n          }}\n        >\n          {(animatedProps: any) => (\n            <animated.Rect\n              {...animatedProps}\n              cornerRadius={[9, 9, 9, 9]}\n              x={this.props.x}\n              y={this.props.y}\n              width={widthToUse}\n              height={heightToUse}\n              offset={cardStackOffset}\n              opacity={this.props.isGhost ? 0.5 : 1}\n              fill={\"gray\"}\n              shadowForStrokeEnabled={false}\n              hitStrokeWidth={0}\n            />\n          )}\n        </Spring>\n      ) : null;\n\n    const shouldRenderStunned =\n      !!this.props.cardState?.stunned && this.state.tokenImagesLoaded.stunned;\n\n    const stunnedToken = this.getTokenInSlot(\n      shouldRenderStunned,\n      this.stunnedImg,\n      offset,\n      0\n    );\n    const confusedToken = this.getTokenInSlot(\n      !!this.props.cardState?.confused && this.state.tokenImagesLoaded.confused,\n      this.confusedImg,\n      offset,\n      1\n    );\n    const toughToken = this.getTokenInSlot(\n      !!this.props.cardState?.tough && this.state.tokenImagesLoaded.tough,\n      this.toughImg,\n      offset,\n      2\n    );\n\n    const cardTokens =\n      this.props.dragging || this.props.isGhost ? null : (\n        <CardTokensContainer\n          key={`${this.props.id}-cardTokens`}\n          id={this.props.id}\n          x={this.props.x}\n          y={this.props.y}\n        ></CardTokensContainer>\n      );\n\n    const noImageCardNameText = this.renderCardName(\n      offset,\n      widthToUse,\n      heightToUse\n    );\n\n    return [\n      cardStack,\n      card,\n      noImageCardNameText,\n      stunnedToken,\n      confusedToken,\n      toughToken,\n      cardTokens,\n    ];\n  };\n\n  private renderCardName(\n    offset: Vector2d,\n    cardWidth: number,\n    cardHeight: number\n  ) {\n    const textOffset = { x: offset.x - 10, y: offset.y - 20 };\n    const textItem =\n      this.state.imageLoadFailed === this.props.imgUrls.length ? (\n        <Text\n          key={`${this.props.id}-cardnametext`}\n          offset={textOffset}\n          x={this.props.x}\n          y={this.props.y}\n          width={cardWidth - 10}\n          height={cardHeight - 20}\n          fontSize={24}\n          text={`${this.props.name} ${this.props.code}`}\n          draggable={\n            this.props.controlledBy === \"\" ||\n            this.props.controlledBy === myPeerRef\n          }\n          onDragStart={this.handleDragStart}\n          onDragMove={this.handleDragMove}\n          onDragEnd={this.handleDragEnd}\n          onDblClick={this.handleDoubleClick}\n          onDblTap={this.handleDoubleClick}\n          onClick={this.handleClick}\n          onTap={this.handleClick}\n          onMouseDown={this.handleMouseDown}\n          onTouchStart={this.handleMouseDown}\n          onMouseOver={this.handleMouseOver}\n          onMouseOut={this.handleMouseOut}\n          onContextMenu={this.handleContextMenu}\n        ></Text>\n      ) : null;\n\n    return textItem;\n  }\n\n  private getTokenInSlot(\n    shouldRender: boolean,\n    img: HTMLImageElement,\n    offset: { x: number; y: number },\n    slot: 0 | 1 | 2\n  ) {\n    const dimensions = {\n      width: img.naturalWidth / 2,\n      height: img.naturalHeight / 2,\n    };\n\n    const stunnedOffset = {\n      x: offset.x - cardConstants.CARD_WIDTH + dimensions.width / 2,\n      y: offset.y - dimensions.height * slot - 5 * (slot + 1) - 10,\n    };\n\n    return shouldRender ? (\n      <Rect\n        key={`${this.props.id}-status${slot}`}\n        native={true}\n        cornerRadius={8}\n        x={this.props.x}\n        y={this.props.y}\n        width={dimensions.width}\n        height={dimensions.height}\n        fillPatternScaleX={0.5}\n        fillPatternScaleY={0.5}\n        offset={stunnedOffset}\n        fillPatternImage={img}\n      />\n    ) : null;\n  }\n\n  private shouldRenderImageHorizontal(\n    type: string,\n    typeCodes: string[]\n  ): boolean {\n    return typeCodes.includes(type) && !this.plainCardBack;\n  }\n\n  private get plainCardBack() {\n    return (\n      this.props.imgUrls.some((i) => i.includes(\"standard\")) &&\n      this.props.imgUrls.some((i) => i.includes(\"_back\"))\n    );\n  }\n\n  private get currentRotation() {\n    return this.props.exhausted ? 90 : 0;\n  }\n\n  private getScale(\n    img: HTMLImageElement | undefined,\n    widthToUse: number,\n    heightToUse: number\n  ) {\n    const width = !!img ? widthToUse / img.naturalWidth : widthToUse;\n\n    const widthHorizontal = !!img ? heightToUse / img.naturalWidth : widthToUse;\n\n    const height = !!img ? heightToUse / img.naturalHeight : heightToUse;\n\n    const heightHorizontal = !!img\n      ? widthToUse / img.naturalHeight\n      : heightToUse;\n\n    return this.shouldRenderImageHorizontal(\n      this.props.typeCode || \"\",\n      HORIZONTAL_TYPE_CODES\n    )\n      ? { width: widthHorizontal, height: heightHorizontal }\n      : { width, height };\n  }\n\n  private handleContextMenu = (event: KonvaEventObject<PointerEvent>): void => {\n    if (!!this.props.handleContextMenu) {\n      this.props.handleContextMenu(this.props.id, event);\n    }\n  };\n\n  private handleDoubleClick = (event: KonvaEventObject<MouseEvent>) => {\n    if (this.props.handleDoubleClick) {\n      this.props.handleDoubleClick(this.props.id, event);\n    }\n  };\n\n  private handleDragStart = (event: KonvaEventObject<DragEvent>) => {\n    if (this.props.handleDragStart) {\n      this.props.handleDragStart(this.props.id, event);\n    }\n  };\n\n  private handleDragMove = (event: any) => {\n    if (this.props.handleDragMove) {\n      this.props.handleDragMove({\n        id: this.props.id,\n        dx: event.target.x() - this.props.x,\n        dy: event.target.y() - this.props.y,\n      });\n    }\n  };\n\n  private handleDragEnd = () => {\n    if (this.props.handleDragEnd && this.props.dragging) {\n      this.props.handleDragEnd(this.props.id);\n    }\n  };\n\n  private handleClick = (event: KonvaEventObject<MouseEvent>) => {\n    if (this.props.handleClick) {\n      this.props.handleClick(this.props.id, event);\n      event.cancelBubble = true;\n    }\n  };\n\n  private handleMouseDown = (event: any) => {\n    event.cancelBubble = true;\n  };\n\n  private handleTouchStart = (event: KonvaEventObject<TouchEvent>) => {\n    event.cancelBubble = true;\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n\n    this.touchTimer = setTimeout(() => {\n      this.handleContextMenu(\n        (event as unknown) as KonvaEventObject<PointerEvent>\n      );\n    }, 750);\n  };\n\n  private handleTouchMove = (event: KonvaEventObject<TouchEvent>) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n  };\n\n  private handleTouchEnd = (event: KonvaEventObject<TouchEvent>) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n  };\n\n  private handleMouseOver = () => {\n    if (this.props.handleHover) {\n      this.props.handleHover(this.props.id);\n    }\n  };\n\n  private handleMouseOut = () => {\n    if (this.props.handleHoverLeave) {\n      this.props.handleHoverLeave(this.props.id);\n    }\n  };\n}\n\nexport default Card;\n","import { Vector2d } from \"konva/types/types\";\nimport * as React from \"react\";\nimport { Component } from \"react\";\nimport Menu from \"@material-ui/core/Menu\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\n\nexport interface ContextMenuItem {\n  label: string;\n  action: () => void;\n}\n\ninterface IProps {\n  position: Vector2d;\n  items: ContextMenuItem[];\n  contextItemClicked?: (item: ContextMenuItem) => void;\n  hideContextMenu: () => void;\n}\n\nclass ContextMenu extends Component<IProps> {\n  render() {\n    return (\n      <div\n        id=\"context-menu-layer\"\n        onContextMenu={this.preventDefault}\n        onClick={this.props.hideContextMenu}\n      >\n        <Menu\n          keepMounted\n          open={true}\n          onClose={this.props.hideContextMenu}\n          anchorReference=\"anchorPosition\"\n          anchorPosition={{\n            top: this.props.position.y + 8,\n            left: this.props.position.x + 8,\n          }}\n        >\n          {this.props.items.map((i, index) => (\n            <MenuItem\n              key={`contextMenu-item-${index}`}\n              onClick={this.handleContextItemClicked(i)}\n            >\n              {i.label}\n            </MenuItem>\n          ))}\n        </Menu>\n      </div>\n    );\n  }\n\n  private preventDefault = (\n    event: React.MouseEvent<HTMLElement, MouseEvent>\n  ) => {\n    event.preventDefault();\n  };\n\n  private handleContextItemClicked = (item: ContextMenuItem) => () => {\n    item.action();\n    if (!!this.props.contextItemClicked) {\n      this.props.contextItemClicked(this.props.items[0]);\n    }\n    this.props.hideContextMenu();\n  };\n}\n\nexport default ContextMenu;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport TextField from \"@material-ui/core/TextField\";\n\ninterface IProps {\n  loadDeckId: (id: number) => void;\n}\n\nclass DeckLoader extends Component<IProps> {\n  inputValue: string = \"\";\n\n  private focusInputField = (input: any) => {\n    if (input) {\n      setTimeout(() => {\n        input.querySelector(\"input\").focus();\n      }, 100);\n    }\n  };\n\n  render() {\n    return (\n      <div\n        onClick={this.cancelBubble}\n        onKeyPress={this.cancelBubble}\n        className=\"token-field-row\"\n      >\n        <TextField\n          ref={this.focusInputField}\n          onKeyPress={this.handleKeyPress}\n          onClick={this.cancelBubble}\n          onChange={(event) => {\n            this.inputValue = event.target.value;\n          }}\n          type=\"number\"\n          variant=\"outlined\"\n        ></TextField>{\" \"}\n      </div>\n    );\n  }\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n\n  private handleKeyPress = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    if (event.key.toLocaleLowerCase() === \"enter\") {\n      this.props.loadDeckId(+this.inputValue);\n    }\n  };\n}\n\nexport default DeckLoader;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport { IEncounterEntity } from \"./features/cards-data/cards-data.selectors\";\nimport Autocomplete from \"@material-ui/lab/Autocomplete\";\nimport TextField from \"@material-ui/core/TextField\";\ninterface IProps {\n  encounterData: IEncounterEntity[];\n  loadCards: (cards: string[]) => void;\n}\n\nclass EncounterLoader extends Component<IProps> {\n  render() {\n    return (\n      <div onClick={this.cancelBubble} onKeyPress={this.cancelBubble}>\n        <Autocomplete\n          id=\"encounter-loader-combobox\"\n          options={this.props.encounterData || []}\n          getOptionLabel={(option) => option.setData.name}\n          style={{ width: 300 }}\n          onChange={this.handleSelected}\n          renderInput={(params) => (\n            <TextField {...params} label=\"Encounter Set\" variant=\"outlined\" />\n          )}\n        />\n      </div>\n    );\n  }\n\n  private handleSelected = (_event: any, value: IEncounterEntity | null) => {\n    if (!!value) {\n      let encounterCards: string[] = [];\n      value.cards\n        // We don't want cards that show up as another card's 'back_link' to be loaded as separate cards\n        .filter((c) => !value.cards.some((oc) => oc.back_link === c.code))\n        // Add the number of cards indicated by the quantity field\n        .forEach((c) => {\n          encounterCards = encounterCards.concat(\n            Array.from({ length: c.quantity }).map((_i) => c.code)\n          );\n        });\n      this.props.loadCards(encounterCards);\n    }\n  };\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n}\n\nexport default EncounterLoader;\n","import { createSelector } from \"@reduxjs/toolkit\";\nimport { CardData } from \"../../external-api/marvel-card-data\";\nimport { RootState } from \"../../store/rootReducer\";\nimport { Set } from \"../cards-data/initialState\";\n\nexport interface IEncounterEntity {\n  setCode: string;\n  setData: Set;\n  cards: CardData[];\n}\n\nexport const getCardsData = (state: RootState) => state.cardsData;\n\nexport const getCardsDataEntities = createSelector(\n  getCardsData,\n  (cardsData) => {\n    return { ...cardsData.entities, ...cardsData.encounterEntities };\n  }\n);\n\nexport const getCardsDataHeroEntities = createSelector(\n  getCardsData,\n  (cardsData) => {\n    return cardsData.entities;\n  }\n);\n\nexport const getCardsDataEncounterEntities = createSelector(\n  getCardsData,\n  (cardsData) => {\n    return cardsData.encounterEntities;\n  }\n);\n\nexport const getCardsDataSetData = createSelector(getCardsData, (cardsData) => {\n  return cardsData.setData;\n});\n\nexport const getCardsDataEncounterEntitiesBySetCode = createSelector(\n  getCardsDataEncounterEntities,\n  getCardsDataSetData,\n  (encounterEntities, setData): IEncounterEntity[] => {\n    const setTypesEncounters: { [key: string]: CardData[] } = {};\n\n    Object.values(encounterEntities).forEach((encounterCard) => {\n      const setCode = encounterCard.set_code || \"unknown\";\n      if (!!setTypesEncounters[setCode]) {\n        setTypesEncounters[setCode].push(encounterCard);\n      } else {\n        setTypesEncounters[setCode] = [encounterCard];\n      }\n    });\n\n    return Object.entries(setTypesEncounters)\n      .map(([key, value]) => ({\n        setCode: key,\n        setData: setData[key],\n        cards: value,\n      }))\n      .filter(\n        (set) =>\n          set.setData.setTypeCode !== \"nemesis\" &&\n          set.setData.setTypeCode !== \"hero\"\n      )\n      .sort((a, b) => (a.setData.name > b.setData.name ? 1 : -1));\n  }\n);\n","import { connect } from \"react-redux\";\nimport EncounterLoader from \"./EncounterLoader\";\nimport { getCardsDataEncounterEntitiesBySetCode } from \"./features/cards-data/cards-data.selectors\";\n\nimport { RootState } from \"./store/rootReducer\";\n\nconst mapStateToProps = (state: RootState) => {\n  return {\n    encounterData: getCardsDataEncounterEntitiesBySetCode(state),\n  };\n};\n\nconst EncounterLoaderContainer = connect(mapStateToProps, {})(EncounterLoader);\n\nexport default EncounterLoaderContainer;\n","import { Vector2d } from \"konva/types/types\";\n\nexport const getDistance = (point1: Vector2d, point2: Vector2d): number => {\n  const deltaX = point1.x - point2.x;\n  const deltaY = point1.y - point2.y;\n  return Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n};\n\nexport const getCenter = (p1: Vector2d, p2: Vector2d) => {\n  return {\n    x: (p1.x + p2.x) / 2,\n    y: (p1.y + p2.y) / 2,\n  };\n};\n","import { RootState } from \"./rootReducer\";\n\nexport const loadState = (key: string) => {\n  try {\n    const serializedState = localStorage.getItem(key);\n    if (serializedState === null) {\n      return {};\n    }\n    const baseState = JSON.parse(serializedState || \"{}\");\n\n    return baseState.present ?? baseState;\n  } catch (err) {\n    console.error(\"problem parsing\");\n    return {};\n  }\n};\n\nexport const saveState = (state: RootState) => {\n  const blacklistStateKeys = [\"cardsData\"];\n  try {\n    Object.entries(state).forEach(([key, value]) => {\n      if (!blacklistStateKeys.includes(key)) {\n        const serializedState = JSON.stringify(value);\n        localStorage.setItem(key, serializedState);\n      }\n    });\n  } catch {\n    // ignore write errors\n    console.error(\"Error writing state to local storage\");\n  }\n};\n","import { loadState } from \"../../store/localStorage\";\nimport { CounterTokenType, StatusTokenType } from \"./cards.slice\";\n\nexport interface ICardStack {\n  controlledBy: string;\n  dragging: boolean;\n  shuffling: boolean;\n  exhausted: boolean;\n  faceup: boolean;\n  fill: string;\n  id: string;\n  selected: boolean;\n  x: number;\n  y: number;\n  cardStack: ICardDetails[];\n  statusTokens: {\n    [K in StatusTokenType]: boolean;\n  };\n  counterTokens: {\n    [K in CounterTokenType]: number;\n  };\n}\n\nexport interface ICardDetails {\n  jsonId: string;\n}\n\nexport interface ICardsState {\n  cards: ICardStack[];\n  ghostCards: ICardStack[];\n  dropTargetCards: { [key: string]: ICardStack | null };\n  panMode: boolean;\n}\n\nconst localStorageState: ICardsState = loadState(\"liveState\")?.cards ?? {};\n\n// Make sure initially, none of the cards are \"owned\" / \"selected\" / \"shuffling\"\nif (!!localStorageState.cards) {\n  localStorageState.cards.forEach((c) => {\n    c.controlledBy = \"\";\n    c.selected = false;\n    c.shuffling = false;\n  });\n}\n\nconst defaultState: ICardsState = {\n  cards: [],\n  ghostCards: [],\n  dropTargetCards: {},\n  panMode: true,\n};\n\nexport const initialState: ICardsState = {\n  ...defaultState,\n  ...localStorageState,\n};\n","import { createSlice, PayloadAction, CaseReducer } from \"@reduxjs/toolkit\";\nimport { getDistance } from \"../../utilities/geo\";\nimport {\n  initialState,\n  ICardsState,\n  ICardStack,\n  ICardDetails,\n} from \"./initialState\";\nimport { fetchDecklistById } from \"./cards.thunks\";\nimport { cardConstants } from \"../../constants/card-constants\";\nimport { receiveRemoteGameState, resetApp } from \"../../store/global.actions\";\nimport {\n  addCardStackWithId,\n  drawCardsOutOfCardStackWithIds,\n  pullCardOutOfCardStackWithId,\n  replaceCardStack,\n  setStackShuffling,\n  startCardMoveWithSplitStackId,\n} from \"./cards.actions\";\n\nconst CARD_DROP_TARGET_DISTANCE = 30;\n\nexport enum StatusTokenType {\n  Stunned = \"stunned\",\n  Confused = \"confused\",\n  Tough = \"tough\",\n}\n\nexport enum CounterTokenType {\n  Damage = \"damage\",\n  Threat = \"threat\",\n  Generic = \"generic\",\n}\n\n// Helper methods\nconst getCardStackWithId = (\n  state: ICardsState,\n  id: string\n): ICardStack | undefined => {\n  return state.cards.find((card) => card.id === id);\n};\n\nconst mutateCardWithId = (\n  state: ICardsState,\n  id: string,\n  ref: string,\n  callback: (card: ICardStack) => void\n) => {\n  const cardToUpdate = getCardStackWithId(state, id);\n  if (\n    cardToUpdate &&\n    (cardToUpdate.controlledBy === \"\" || cardToUpdate.controlledBy === ref)\n  ) {\n    callback(cardToUpdate);\n  }\n};\n\nconst foreachSelectedAndControlledCard = (\n  state: ICardsState,\n  actorRef: string,\n  callback: (card: ICardStack) => void\n) => {\n  state.cards\n    .filter((card) => card.selected && card.controlledBy === actorRef)\n    .forEach((card) => callback(card));\n};\n\nconst foreachUnselectedCard = (\n  state: ICardsState,\n  callback: (card: ICardStack) => void\n) => {\n  state.cards\n    .filter((card) => !card.selected)\n    .forEach((card) => callback(card));\n};\n\n// Reducers\nconst selectCardReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{ id: string; unselectOtherCards: boolean }>\n> = (state, action) => {\n  if (action.payload.unselectOtherCards) {\n    unselectAllCardsReducer(state, action);\n  }\n\n  mutateCardWithId(\n    state,\n    action.payload.id,\n    (action as any).ACTOR_REF,\n    (card) => {\n      card.selected = true;\n      card.controlledBy = (action as any).ACTOR_REF;\n    }\n  );\n};\n\nconst unselectCardReducer: CaseReducer<ICardsState, PayloadAction<string>> = (\n  state,\n  action\n) => {\n  mutateCardWithId(state, action.payload, (action as any).ACTOR_REF, (card) => {\n    card.selected = false;\n    card.controlledBy = \"\";\n  });\n};\n\nconst toggleSelectCardReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<string>\n> = (state, action) => {\n  mutateCardWithId(state, action.payload, (action as any).ACTOR_REF, (card) => {\n    card.selected = !card.selected;\n    if (!card.selected) {\n      card.controlledBy = \"\";\n    } else {\n      card.controlledBy = (action as any).ACTOR_REF;\n    }\n  });\n};\n\nconst exhaustCardReducer: CaseReducer<ICardsState, PayloadAction<string>> = (\n  state,\n  action\n) => {\n  state.cards\n    .filter(\n      (card) =>\n        card.controlledBy === (action as any).ACTOR_REF &&\n        (card.id === action.payload || card.selected)\n    )\n    .forEach((card) => {\n      card.exhausted = !card.exhausted;\n    });\n};\n\nconst cardMoveReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{ id: string; dx: number; dy: number }>\n> = (state, action) => {\n  const movedCards: ICardStack[] = [];\n\n  let primaryCard: ICardStack | null = null;\n\n  state.cards\n    .filter(\n      (card) =>\n        card.id === action.payload.id ||\n        (card.selected && card.controlledBy === (action as any).ACTOR_REF)\n    )\n    .forEach((card) => {\n      if (card.id === action.payload.id) {\n        primaryCard = card;\n      }\n\n      card.x += action.payload.dx;\n      card.y += action.payload.dy;\n\n      movedCards.push(card);\n    });\n\n  // go through and find if any unselected cards are potential drop targets\n  // If so, get the closest one. But only if the card is owned / controlled by us\n  const possibleDropTargets: { distance: number; card: ICardStack }[] = [];\n  if (\n    !!primaryCard &&\n    (primaryCard as ICardStack).controlledBy === (action as any).ACTOR_REF\n  ) {\n    foreachUnselectedCard(state, (card) => {\n      const distance = getDistance(\n        { x: card.x, y: card.y },\n        !!primaryCard ? { x: primaryCard.x, y: primaryCard.y } : { x: 0, y: 0 }\n      );\n      if (distance < CARD_DROP_TARGET_DISTANCE) {\n        possibleDropTargets.push({\n          distance,\n          card,\n        });\n      }\n    });\n  }\n\n  state.dropTargetCards[(action as any).ACTOR_REF] =\n    possibleDropTargets.sort((c1, c2) => c1.distance - c2.distance)[0]?.card ??\n    null;\n\n  // put the moved cards at the end. TODO: we could just store the move order or move time\n  // or something, and the array could be a selector\n  movedCards.forEach((movedCard) => {\n    state.cards.push(state.cards.splice(state.cards.indexOf(movedCard), 1)[0]);\n  });\n};\n\nconst endCardMoveReducer: CaseReducer<ICardsState, PayloadAction<string>> = (\n  state,\n  action\n) => {\n  let dropTargetCards: ICardDetails[] = [];\n  state.cards\n    .filter(\n      (card) =>\n        card.id === action.payload ||\n        (card.selected && card.controlledBy === (action as any).ACTOR_REF)\n    )\n    .forEach((card) => {\n      card.dragging = false;\n\n      if (!!state.dropTargetCards[(action as any).ACTOR_REF]) {\n        // Add the cards to the drop Target card stack\n        dropTargetCards = dropTargetCards.concat(card.cardStack);\n      }\n    });\n\n  // Now, if there was a drop target card, remove all those cards from the state\n  if (!!state.dropTargetCards[(action as any).ACTOR_REF]) {\n    state.cards = state.cards.filter(\n      (card) =>\n        !(\n          card.id === action.payload ||\n          (card.selected && card.controlledBy === (action as any).ACTOR_REF)\n        )\n    );\n\n    const dropTargetCard = state.cards.find(\n      (card) => card.id === state.dropTargetCards[(action as any).ACTOR_REF]?.id\n    );\n    if (!!dropTargetCard && dropTargetCards.length > 0) {\n      // add the cards we've collected to the top of the stack\n      dropTargetCard.cardStack = dropTargetCards.concat(\n        dropTargetCard.cardStack\n      );\n    }\n  }\n\n  state.ghostCards = [];\n  state.dropTargetCards[(action as any).ACTOR_REF] = null;\n};\n\nconst selectMultipleCardsReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{ ids: string[] }>\n> = (state, action) => {\n  action.payload.ids\n    .map((id) => state.cards.find((card) => card.id === id))\n    .forEach((card) => {\n      if (\n        card &&\n        (card.controlledBy === \"\" ||\n          card.controlledBy === (action as any).ACTOR_REF)\n      ) {\n        card.selected = true;\n        card.controlledBy = (action as any).ACTOR_REF;\n      }\n    });\n};\n\nconst unselectAllCardsReducer: CaseReducer<ICardsState, PayloadAction<any>> = (\n  state,\n  action\n) => {\n  state.cards\n    .filter(\n      (card) =>\n        card.controlledBy === \"\" ||\n        card.controlledBy === (action as any).ACTOR_REF\n    )\n    .forEach((card) => {\n      card.selected = false;\n      card.controlledBy = \"\";\n    });\n};\n\nconst togglePanModeReducer: CaseReducer<ICardsState> = (state) => {\n  state.panMode = !state.panMode;\n};\n\nconst flipCardsReducer: CaseReducer<ICardsState> = (state, action) => {\n  state.cards\n    .filter(\n      (card) =>\n        card.selected &&\n        (card.controlledBy === \"\" ||\n          card.controlledBy === (action as any).ACTOR_REF)\n    )\n    .forEach((card) => {\n      card.faceup = !card.faceup;\n      card.cardStack = card.cardStack.reverse();\n    });\n};\n\nconst resetCardsReducer: CaseReducer<ICardsState> = (state) => {\n  state.cards = [];\n};\n\nconst toggleTokenReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{ id: string; tokenType: StatusTokenType; value: boolean }>\n> = (state, action) => {\n  const cardToToggle = state.cards.find((c) => c.id === action.payload.id);\n  if (!!cardToToggle) {\n    cardToToggle.statusTokens[action.payload.tokenType] = action.payload.value;\n  }\n};\n\nconst adjustCounterTokenReducer: CaseReducer<\n  ICardsState,\n  PayloadAction<{\n    id: string;\n    tokenType: CounterTokenType;\n    delta?: number;\n    value?: number;\n  }>\n> = (state, action) => {\n  const cardToToggle = state.cards.find((c) => c.id === action.payload.id);\n  if (!!cardToToggle) {\n    if (action.payload.value !== undefined) {\n      cardToToggle.counterTokens[action.payload.tokenType] =\n        action.payload.value;\n    } else if (action.payload.delta !== undefined) {\n      cardToToggle.counterTokens[action.payload.tokenType] +=\n        action.payload.delta;\n    }\n    if (cardToToggle.counterTokens[action.payload.tokenType] < 0) {\n      cardToToggle.counterTokens[action.payload.tokenType] = 0;\n    }\n  }\n};\n// Selectors\n\n// slice\nconst cardsSlice = createSlice({\n  name: \"cards\",\n  initialState: initialState,\n  reducers: {\n    selectCard: selectCardReducer,\n    unselectCard: unselectCardReducer,\n    toggleSelectCard: toggleSelectCardReducer,\n    exhaustCard: exhaustCardReducer,\n    cardMove: cardMoveReducer,\n    endCardMove: endCardMoveReducer,\n    selectMultipleCards: selectMultipleCardsReducer,\n    unselectAllCards: unselectAllCardsReducer,\n    togglePanMode: togglePanModeReducer,\n    flipCards: flipCardsReducer,\n    resetCards: resetCardsReducer,\n    toggleToken: toggleTokenReducer,\n    adjustCounterToken: adjustCounterTokenReducer,\n  },\n  extraReducers: (builder) => {\n    builder.addCase(receiveRemoteGameState, (state, action) => {\n      // TODO: find a way to keep this automatic\n      state.cards = action.payload.liveState.present.cards.cards;\n      state.ghostCards = action.payload.liveState.present.cards.ghostCards;\n    });\n\n    builder.addCase(replaceCardStack, (state, action) => {\n      const cardToReplaceStack = state.cards.find(\n        (c) => c.id === action.payload.id\n      );\n      if (!!cardToReplaceStack) {\n        cardToReplaceStack.cardStack = action.payload.newStack;\n      }\n    });\n\n    builder.addCase(resetApp, (state) => {\n      state.cards = [];\n      // state.previewCard = null;\n      state.dropTargetCards = {};\n      state.ghostCards = [];\n      state.panMode = true;\n    });\n\n    builder.addCase(addCardStackWithId, (state, action) => {\n      const newStack: ICardStack = {\n        controlledBy: \"\",\n        x: action.payload.position.x,\n        y: action.payload.position.y,\n        dragging: false,\n        shuffling: false,\n        exhausted: false,\n        faceup: true,\n        fill: \"red\",\n        id: action.payload.id,\n        cardStack: action.payload.cardJsonIds.map((jsonId) => ({\n          jsonId,\n        })),\n        selected: false,\n        statusTokens: {\n          stunned: false,\n          confused: false,\n          tough: false,\n        },\n        counterTokens: {\n          damage: 0,\n          threat: 0,\n          generic: 0,\n        },\n      };\n\n      state.cards.push(newStack);\n    });\n\n    builder.addCase(pullCardOutOfCardStackWithId, (state, action) => {\n      const cardStackToUse = state.cards.find(\n        (c) => c.id === action.payload.cardStackId\n      );\n      if (!!cardStackToUse && cardStackToUse.cardStack.length > 1) {\n        const newCardStack: ICardDetails[] = [\n          { jsonId: action.payload.jsonId },\n        ];\n        const newCard = Object.assign({}, cardStackToUse, {\n          cardStack: newCardStack,\n        });\n        newCard.id = action.payload.id;\n        newCard.selected = true;\n        newCard.controlledBy = (action as any).ACTOR_REF;\n        newCard.x = newCard.x + cardConstants.CARD_WIDTH + 5;\n\n        // Find the first instance of the card with the json id. Note that because there\n        // might be multiple cards with the same json id, we can't just do a filter\n        const cardIndexToRemove = cardStackToUse.cardStack.findIndex(\n          (c) => c.jsonId === action.payload.jsonId\n        );\n\n        if (cardIndexToRemove !== -1) {\n          cardStackToUse.cardStack.splice(cardIndexToRemove, 1);\n        }\n\n        cardStackToUse.selected = false;\n        cardStackToUse.controlledBy = \"\";\n\n        state.cards.push(newCard);\n      }\n    });\n\n    builder.addCase(startCardMoveWithSplitStackId, (state, action) => {\n      // first, if the card moving isn't currently selected, clear all _our_ selected cards\n      const cardToStartMoving = getCardStackWithId(state, action.payload.id);\n      if (cardToStartMoving && !cardToStartMoving.selected) {\n        state.cards = state.cards.map((card) => {\n          if (\n            card.controlledBy === \"\" ||\n            card.controlledBy === (action as any).ACTOR_REF\n          ) {\n            card.selected = card.id === action.payload.id;\n            if (card.selected) {\n              card.controlledBy = (action as any).ACTOR_REF;\n            } else {\n              card.controlledBy = \"\";\n            }\n          }\n          return card;\n        });\n      }\n\n      // If we are splitting, make a new stack of cards\n      if (action.payload.splitTopCard) {\n        const cardToMove = state.cards.find((c) => c.id === action.payload.id);\n\n        if (!cardToMove) {\n          throw new Error(\"Expected to find card\");\n        }\n\n        cardToMove.selected = false;\n        cardToMove.controlledBy = \"\";\n\n        const topCard = cardToMove.cardStack.shift();\n        const newCard = Object.assign({}, cardToMove, {\n          selected: true,\n          controlledBy: (action as any).ACTOR_REF,\n          dragging: true,\n          cardStack: [topCard],\n        });\n\n        cardToMove.id = action.payload.splitCardId;\n\n        state.cards.push(newCard);\n      }\n\n      // Now all selected cards should be put into ghost cards, unless we are splitting the top card\n      state.ghostCards = [];\n\n      if (!action.payload.splitTopCard) {\n        foreachSelectedAndControlledCard(\n          state,\n          (action as any).ACTOR_REF,\n          (card) => {\n            card.dragging = true;\n            state.ghostCards.push(Object.assign({}, card));\n          }\n        );\n      }\n\n      //Finally, if we have a preview card, clear it\n      // state.previewCard = null;\n    });\n\n    builder.addCase(drawCardsOutOfCardStackWithIds, (state, action) => {\n      if (action.payload.numberToDraw !== action.payload.idsToUse.length) {\n        throw new Error(\"Did not receive the expected number of ids\");\n      }\n\n      // First, unselect everything else of ours\n      unselectAllCardsReducer(state, (action as unknown) as any);\n\n      // Get the cardstack in question\n      let cardStackToUse = state.cards.find(\n        (c) => c.id === action.payload.cardStackId\n      );\n\n      if (!cardStackToUse) {\n        throw new Error(\n          `Couldn't find card stack with id ${action.payload.cardStackId}`\n        );\n      }\n\n      const sourceCardStackId = cardStackToUse.id;\n\n      //Next, for each card we should draw, remove it from the stack and make a new stack, which should be selected\n      for (let index = 0; index < action.payload.numberToDraw; index++) {\n        if (!!cardStackToUse) {\n          const topCardDetails = cardStackToUse.cardStack.shift();\n          if (!topCardDetails) {\n            throw new Error(\"Expected to find a top card, but didn't\");\n          }\n          const newCardStack: ICardDetails[] = [\n            { jsonId: topCardDetails.jsonId },\n          ];\n          const newCard = Object.assign({}, cardStackToUse, {\n            cardStack: newCardStack,\n          });\n          newCard.id = action.payload.idsToUse[index];\n          newCard.selected = true;\n          newCard.controlledBy = (action as any).ACTOR_REF;\n          newCard.faceup = true;\n          newCard.x = newCard.x + (cardConstants.CARD_WIDTH + 5) * (index + 1);\n          newCard.y += cardConstants.CARD_HEIGHT;\n\n          if (cardStackToUse.cardStack.length === 0) {\n            // we went through all the cards, remove the original card\n            state.cards = state.cards.filter((c) => c.id !== sourceCardStackId);\n            cardStackToUse = undefined;\n          }\n\n          state.cards.push(newCard);\n        }\n      }\n    });\n\n    builder.addCase(setStackShuffling, (state, action) => {\n      // get the stack to update\n      const stackToUpdate = state.cards.find((c) => c.id === action.payload.id);\n\n      if (!!stackToUpdate) {\n        stackToUpdate.shuffling = action.payload.shuffling;\n      }\n    });\n\n    builder.addCase(fetchDecklistById.fulfilled, (state, action) => {\n      console.log(\"got decklist\");\n      console.log(action);\n\n      const heroCard: ICardStack = {\n        controlledBy: (action as any).ACTOR_REF,\n        selected: true,\n        x: action.payload.position.x,\n        y: action.payload.position.y,\n        dragging: false,\n        shuffling: false,\n        exhausted: false,\n        faceup: true,\n        fill: \"red\",\n        id: action.payload.heroId,\n        cardStack: [\n          { jsonId: action.payload.data.investigator_code },\n          ...action.payload.extraHeroCards,\n        ],\n        statusTokens: {\n          stunned: false,\n          confused: false,\n          tough: false,\n        },\n        counterTokens: {\n          damage: 0,\n          threat: 0,\n          generic: 0,\n        },\n      };\n\n      let mainDeckStack: ICardDetails[] = [];\n      Object.entries(action.payload.data.slots).forEach(([key, value]) => {\n        const cardDetails: ICardDetails[] = Array.from(Array(value).keys()).map(\n          (): ICardDetails => ({ jsonId: key })\n        );\n        mainDeckStack = mainDeckStack.concat(cardDetails);\n      });\n\n      const cardPadding = cardConstants.CARD_WIDTH + 10;\n\n      const newDeck: ICardStack = {\n        controlledBy: (action as any).ACTOR_REF,\n        selected: true,\n        x: action.payload.position.x + cardPadding,\n        y: action.payload.position.y,\n        dragging: false,\n        shuffling: false,\n        exhausted: false,\n        faceup: true,\n        fill: \"red\",\n        id: action.payload.dataId,\n        cardStack: mainDeckStack,\n        statusTokens: {\n          stunned: false,\n          confused: false,\n          tough: false,\n        },\n        counterTokens: {\n          damage: 0,\n          threat: 0,\n          generic: 0,\n        },\n      };\n\n      const encounterDeck: ICardStack = {\n        controlledBy: (action as any).ACTOR_REF,\n        selected: true,\n        x: action.payload.position.x + cardPadding * 2,\n        y: action.payload.position.y,\n        dragging: false,\n        shuffling: false,\n        exhausted: false,\n        faceup: true,\n        fill: \"red\",\n        id: action.payload.encounterDeckId,\n        cardStack: action.payload.relatedEncounterDeck.map((jsonId) => ({\n          jsonId,\n        })),\n        statusTokens: {\n          stunned: false,\n          confused: false,\n          tough: false,\n        },\n        counterTokens: {\n          damage: 0,\n          threat: 0,\n          generic: 0,\n        },\n      };\n\n      const obligationDeck: ICardStack = {\n        controlledBy: (action as any).ACTOR_REF,\n        selected: true,\n        x: action.payload.position.x + cardPadding * 3,\n        y: action.payload.position.y,\n        dragging: false,\n        shuffling: false,\n        exhausted: false,\n        faceup: true,\n        fill: \"red\",\n        id: action.payload.obligationDeckId,\n        cardStack: action.payload.relatedObligationDeck.map((jsonId) => ({\n          jsonId,\n        })),\n        statusTokens: {\n          stunned: false,\n          confused: false,\n          tough: false,\n        },\n        counterTokens: {\n          damage: 0,\n          threat: 0,\n          generic: 0,\n        },\n      };\n\n      state.cards.push(heroCard, newDeck, encounterDeck, obligationDeck);\n    });\n  },\n});\n\nexport const {\n  selectCard,\n  unselectCard,\n  toggleSelectCard,\n  exhaustCard,\n  cardMove,\n  endCardMove,\n  selectMultipleCards,\n  unselectAllCards,\n  togglePanMode,\n  flipCards,\n  resetCards,\n  toggleToken,\n  adjustCounterToken,\n} = cardsSlice.actions;\n\nexport default cardsSlice.reducer;\n","import { createAction } from \"@reduxjs/toolkit\";\nimport { Vector2d } from \"konva/types/types\";\nimport { ICardDetails } from \"./initialState\";\n\nexport interface AddCardStackWithIdPayload {\n  cardJsonIds: string[];\n  position: Vector2d;\n  id: string;\n}\n\nexport interface PullCardOutOfCardStackWithIdPayload {\n  cardStackId: string;\n  jsonId: string;\n  pos: Vector2d;\n  id: string;\n}\n\nexport interface StartCardMoveWithSplitStackIdPayload {\n  id: string;\n  splitTopCard: boolean;\n  splitCardId: string;\n}\n\nexport interface DrawCardsOutOfCardStackWithIdsPayload {\n  cardStackId: string;\n  numberToDraw: number;\n  idsToUse: string[];\n}\n\nexport interface ReplaceCardStackPayload {\n  id: string;\n  newStack: ICardDetails[];\n}\n\nexport const addCardStackWithId = createAction<AddCardStackWithIdPayload>(\n  \"addCardStackWithId\"\n);\n\nexport const pullCardOutOfCardStackWithId = createAction<PullCardOutOfCardStackWithIdPayload>(\n  \"pullCardOutOfCardStackWithId\"\n);\n\nexport const drawCardsOutOfCardStackWithIds = createAction<DrawCardsOutOfCardStackWithIdsPayload>(\n  \"drawCardsOutOfCardStackWithIds\"\n);\n\nexport const startCardMoveWithSplitStackId = createAction<StartCardMoveWithSplitStackIdPayload>(\n  \"startCardMoveWithSplitStackId\"\n);\n\nexport const replaceCardStack = createAction<ReplaceCardStackPayload>(\n  \"replaceCardStack\"\n);\n\nexport const setStackShuffling = createAction<{\n  id: string;\n  shuffling: boolean;\n}>(\"setStackShuffling\");\n","import { ICardDetails } from \"../features/cards/initialState\";\n\n// For some reason, the codes from marvelcdb and the images from cardgamedb can be off\nexport const CARD_PACK_REMAPPING: { [key: string]: string } = {\n  bkw: \"07\",\n  cap: \"04\",\n  drs: \"08\",\n  hlk: \"09\",\n  trors: \"10\",\n  twc: \"03\",\n};\n\n// export const EXTRA_CARDS: { [key: string]: { [key: string]: number } } = {\n//   doctor_strange: {\n//     \"09032\": 1,\n//     \"09033\": 1,\n//     \"09034\": 1,\n//     \"09035\": 1,\n//     \"09036\": 1,\n//   },\n//   ant: {\n//     \"12001c\": 1,\n//   },\n// };\n\nexport const EXTRA_CARDS: { [key: string]: ICardDetails[] } = {\n  doctor_strange: [\n    { jsonId: \"09032\" },\n    { jsonId: \"09033\" },\n    { jsonId: \"09034\" },\n    { jsonId: \"09035\" },\n    { jsonId: \"09036\" },\n  ],\n  ant: [{ jsonId: \"12001c\" }],\n  wsp: [{ jsonId: \"13001c\" }],\n};\n","import { Action, createAsyncThunk, ThunkAction } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport { Vector2d } from \"konva/types/types\";\nimport { RootState } from \"../../store/rootReducer\";\nimport {\n  getCardsDataEncounterEntities,\n  getCardsDataHeroEntities,\n} from \"../cards-data/cards-data.selectors\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport {\n  addCardStackWithId,\n  drawCardsOutOfCardStackWithIds,\n  pullCardOutOfCardStackWithId,\n  replaceCardStack,\n  setStackShuffling,\n  startCardMoveWithSplitStackId,\n} from \"./cards.actions\";\nimport { ICardDetails, ICardStack } from \"./initialState\";\nimport { getCards } from \"./cards.selectors\";\nimport { EXTRA_CARDS } from \"../../constants/card-pack-mapping\";\nimport { myPeerRef } from \"../../constants/app-constants\";\n\ninterface AddCardStackPayload {\n  cardJsonIds: string[];\n  position: Vector2d;\n}\n\nexport interface PullCardOutOfCardStackPayload {\n  cardStackId: string;\n  jsonId: string;\n  pos: Vector2d;\n}\n\nexport interface StartCardMovePayload {\n  id: string;\n  splitTopCard: boolean;\n}\n\nexport interface DrawCardsOutOfCardStackPayload {\n  cardStackId: string;\n  numberToDraw: number;\n}\n\nexport const shuffleStack = (\n  id?: string\n): ThunkAction<void, RootState, unknown, Action<string>> => (\n  dispatch,\n  getState\n) => {\n  const cardsState = getCards(getState());\n  const stacksToShuffle = !!id\n    ? [cardsState.cards.find((c) => c.id === id)]\n    : cardsState.cards.filter(\n        (c) => c.selected && c.controlledBy === myPeerRef\n      );\n\n  stacksToShuffle\n    .filter((s): s is ICardStack => !!s && s.cardStack.length > 1)\n    .forEach((stackToShuffle) => {\n      dispatch(setStackShuffling({ id: stackToShuffle.id, shuffling: true }));\n      const shuffledStack = shuffle(stackToShuffle.cardStack);\n      dispatch(\n        replaceCardStack({ id: stackToShuffle.id, newStack: shuffledStack })\n      );\n\n      // We have to do a setTimeout here, because if we do it in this event loop,\n      // the overall change for this card is nothing for the shuffling param\n      setTimeout(() => {\n        dispatch(\n          setStackShuffling({ id: stackToShuffle.id, shuffling: false })\n        );\n      });\n    });\n};\n\nexport const addCardStack = (\n  payload: AddCardStackPayload\n): ThunkAction<void, RootState, unknown, Action<string>> => (dispatch) => {\n  const payloadWithId = {\n    ...payload,\n    id: uuidv4(),\n  };\n  dispatch(addCardStackWithId(payloadWithId));\n};\n\nexport const pullCardOutOfCardStack = (\n  payload: PullCardOutOfCardStackPayload\n): ThunkAction<void, RootState, unknown, Action<string>> => (dispatch) => {\n  const payloadWithId = {\n    ...payload,\n    id: uuidv4(),\n  };\n  dispatch(pullCardOutOfCardStackWithId(payloadWithId));\n};\n\nexport const startCardMove = (\n  payload: StartCardMovePayload\n): ThunkAction<void, RootState, unknown, Action<string>> => (dispatch) => {\n  const payloadWithId = {\n    ...payload,\n    splitCardId: uuidv4(),\n  };\n  dispatch(startCardMoveWithSplitStackId(payloadWithId));\n};\n\nexport const drawCardsOutOfCardStack = (\n  payload: DrawCardsOutOfCardStackPayload\n): ThunkAction<void, RootState, unknown, Action<string>> => (dispatch) => {\n  const possibleIds = Array.from({ length: payload.numberToDraw }).map((_i) =>\n    uuidv4()\n  );\n  const payloadWithIds = {\n    ...payload,\n    idsToUse: possibleIds,\n  };\n  dispatch(drawCardsOutOfCardStackWithIds(payloadWithIds));\n};\n\nexport const fetchDecklistById = createAsyncThunk(\n  \"decklist/fetchByIdStatus\",\n  async (payload: { decklistId: number; position: Vector2d }, thunkApi) => {\n    const response = await axios.get(\n      `https://marvelcdb.com/api/public/decklist/${payload.decklistId}`\n    );\n    const state: RootState = thunkApi.getState() as RootState;\n    const heroCardsData = getCardsDataHeroEntities(state);\n    const heroSet = heroCardsData[response.data.investigator_code];\n    const heroSetCode = heroSet.set_code;\n    const encounterCardsData = getCardsDataEncounterEntities(state);\n\n    const heroObligationDeck = Object.entries(encounterCardsData)\n      .filter(\n        ([_key, value]) =>\n          (value.set_code === `${heroSetCode}` ||\n            value.set_code === `${heroSetCode}_nemesis`) &&\n          value.type_code === \"obligation\"\n      )\n      .map(([key, _value]) => key);\n\n    // get the encounter cards for this deck\n    const heroEncounterDeckData = Object.values(encounterCardsData).filter(\n      (value) =>\n        value.set_code === `${heroSetCode}_nemesis` &&\n        value.type_code !== \"obligation\"\n    );\n\n    let heroEncounterDeck: string[] = [];\n    heroEncounterDeckData.forEach((cd) => {\n      heroEncounterDeck = heroEncounterDeck.concat(\n        Array.from({ length: cd.quantity }).map((_i) => cd.code)\n      );\n    });\n\n    // check to see if there are any special extra cards for this hero\n    const extraCards = EXTRA_CARDS[heroSetCode ?? \"\"] ?? [];\n\n    // response.data.slots = { ...extraCards, ...response.data.slots };\n\n    return {\n      position: payload.position,\n      heroId: uuidv4(),\n      data: response.data,\n      dataId: uuidv4(),\n      extraHeroCards: extraCards,\n      relatedEncounterDeck: heroEncounterDeck,\n      encounterDeckId: uuidv4(),\n      relatedObligationDeck: heroObligationDeck,\n      obligationDeckId: uuidv4(),\n    };\n  }\n);\n\nconst shuffle = (array: ICardDetails[]): ICardDetails[] => {\n  const returnArray = JSON.parse(JSON.stringify(array));\n  var currentIndex = returnArray.length,\n    temporaryValue,\n    randomIndex;\n\n  // While there remain elements to shuffle...\n  while (0 !== currentIndex) {\n    // Pick a remaining element...\n    randomIndex = Math.floor(Math.random() * currentIndex);\n    currentIndex -= 1;\n\n    // And swap it with the current element.\n    temporaryValue = returnArray[currentIndex];\n    returnArray[currentIndex] = returnArray[randomIndex];\n    returnArray[randomIndex] = temporaryValue;\n  }\n\n  return returnArray;\n};\n","import { createAction } from \"@reduxjs/toolkit\";\nimport { RootState } from \"./rootReducer\";\n\nexport const resetApp = createAction(\"resetAction\");\n\nexport const receiveRemoteGameState = createAction<RootState>(\n  \"receiveRemoteGameState\"\n);\n","import { Vector2d } from \"konva/types/types\";\nimport * as React from \"react\";\nimport { Component } from \"react\";\nimport \"./TopLayer.scss\";\n\ninterface IProps {\n  position: Vector2d;\n  completed: () => void;\n}\n\nclass TopLayer extends Component<IProps> {\n  render() {\n    const containerStyle: React.CSSProperties = {\n      top: `${this.props.position.y + 8}px`,\n      left: `${this.props.position.x + 8}px`,\n    };\n    return (\n      <div\n        id=\"top-layer\"\n        onClick={this.props.completed}\n        onContextMenu={this.preventDefault}\n      >\n        <div\n          className=\"top-layer-content-wrapper\"\n          style={containerStyle}\n          onContextMenu={this.preventDefault}\n          onClick={this.handleClick}\n        >\n          {this.props.children}\n        </div>\n      </div>\n    );\n  }\n\n  private handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    event.stopPropagation();\n    this.props.completed();\n  };\n\n  private preventDefault = (\n    event: React.MouseEvent<HTMLElement, MouseEvent>\n  ) => {\n    event.preventDefault();\n  };\n}\n\nexport default TopLayer;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport Autocomplete from \"@material-ui/lab/Autocomplete\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { CardData } from \"./external-api/marvel-card-data\";\nimport { ICardData } from \"./features/cards-data/initialState\";\nimport { ICardStack } from \"./features/cards/initialState\";\nimport { AutocompleteHighlightChangeReason } from \"@material-ui/lab/useAutocomplete\";\ninterface IProps {\n  cardsDataEntities: ICardData;\n  card: ICardStack;\n  cardSelected: (jsonId: string) => void;\n  preview: (jsonId: string) => void;\n  clearPreview: () => void;\n}\n\nclass CardStackCardSelector extends Component<IProps> {\n  private cardsDataInStack: CardData[] = [];\n\n  constructor(props: IProps) {\n    super(props);\n    this.cardsDataInStack = props.card.cardStack.map((c) => {\n      return this.props.cardsDataEntities[c.jsonId];\n    });\n  }\n\n  componentWillUnmount() {\n    this.props.clearPreview();\n  }\n\n  render() {\n    return (\n      <div onClick={this.cancelBubble} onKeyPress={this.cancelBubble}>\n        <Autocomplete\n          id=\"cardstack-card-selector-combobox\"\n          options={this.cardsDataInStack}\n          getOptionLabel={(option) => option.name}\n          style={{ width: 300 }}\n          onChange={this.handleSelected}\n          onHighlightChange={this.handleHighlightChange}\n          renderInput={(params) => (\n            <TextField {...params} label=\"Find Card...\" variant=\"outlined\" />\n          )}\n        />\n      </div>\n    );\n  }\n\n  private handleHighlightChange = (\n    _event: any,\n    option: CardData | null,\n    reason: AutocompleteHighlightChangeReason\n  ) => {\n    if (!option) {\n      this.props.clearPreview();\n    } else {\n      this.props.preview(option.code);\n    }\n  };\n\n  private handleSelected = (_event: any, value: CardData | null) => {\n    this.props.clearPreview();\n    if (!!value && !!this.props.cardSelected) {\n      this.props.cardSelected(value.code);\n    }\n  };\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n}\n\nexport default CardStackCardSelector;\n","import { Vector2d } from \"konva/types/types\";\nimport { myPeerRef, PlayerColor } from \"../../constants/app-constants\";\nimport { loadState } from \"../../store/localStorage\";\n\nexport interface IPreviewCard {\n  id: string;\n}\n\nexport interface IGameState {\n  stageZoom: Vector2d;\n  stagePosition: Vector2d;\n  playerColors: { [key: string]: PlayerColor };\n  peerId: string;\n  previewCard: IPreviewCard | null;\n  menuPreviewCardJsonId: string | null;\n}\n\nconst localStorageState: IGameState = loadState(\"game\");\nlocalStorageState.playerColors = {};\nlocalStorageState.playerColors[myPeerRef] = \"red\";\nlocalStorageState.peerId = \"\";\nlocalStorageState.previewCard = null;\nlocalStorageState.menuPreviewCardJsonId = null;\n\nconst defaultState: IGameState = {\n  playerColors: {},\n  stageZoom: { x: 0.5, y: 0.5 },\n  stagePosition: { x: 0, y: 0 },\n  peerId: \"\",\n  previewCard: null,\n  menuPreviewCardJsonId: null,\n};\nexport const initialState: IGameState = {\n  ...defaultState,\n  ...localStorageState,\n};\n","import { CaseReducer, createSlice, PayloadAction } from \"@reduxjs/toolkit\";\nimport { Vector2d } from \"konva/types/types\";\nimport { PlayerColor } from \"../../constants/app-constants\";\nimport { resetApp } from \"../../store/global.actions\";\nimport { IGameState, initialState } from \"./initialState\";\n\n// Reducers\nconst updateZoomReducer: CaseReducer<IGameState, PayloadAction<Vector2d>> = (\n  state,\n  action\n) => {\n  state.stageZoom = action.payload;\n  return state;\n};\n\nconst updatePositionReducer: CaseReducer<\n  IGameState,\n  PayloadAction<Vector2d>\n> = (state, action) => {\n  state.stagePosition = action.payload;\n  return state;\n};\n\nconst connectToRemoteGameReducer: CaseReducer<\n  IGameState,\n  PayloadAction<string>\n> = () => {};\n\nconst setPlayerColorReducer: CaseReducer<\n  IGameState,\n  PayloadAction<{ ref: string; color: PlayerColor }>\n> = (state, action) => {\n  state.playerColors[action.payload.ref] = action.payload.color;\n};\n\nconst setPeerIdReducer: CaseReducer<IGameState, PayloadAction<string>> = (\n  state,\n  action\n) => {\n  state.peerId = action.payload;\n};\n\nconst setPreviewCardIdReducer: CaseReducer<\n  IGameState,\n  PayloadAction<string>\n> = (state, action) => {\n  if (!state.previewCard) {\n    state.previewCard = { id: action.payload };\n  } else if (state.previewCard.id !== action.payload) {\n    state.previewCard.id = action.payload;\n  }\n};\n\nconst clearPreviewCardReducer: CaseReducer<IGameState> = (state) => {\n  state.previewCard = null;\n};\n\nconst setMenuPreviewCardJsonIdReducer: CaseReducer<\n  IGameState,\n  PayloadAction<string>\n> = (state, action) => {\n  state.menuPreviewCardJsonId = action.payload;\n};\n\nconst clearMenuPreviewCardJsonIdReducer: CaseReducer<IGameState> = (state) => {\n  state.menuPreviewCardJsonId = null;\n};\n\nconst requestResyncReducer: CaseReducer<IGameState> = () => {};\n\n// slice\nconst gameSlice = createSlice({\n  name: \"game\",\n  initialState: initialState,\n  reducers: {\n    updateZoom: updateZoomReducer,\n    updatePosition: updatePositionReducer,\n    connectToRemoteGame: connectToRemoteGameReducer,\n    setPlayerColor: setPlayerColorReducer,\n    setPeerId: setPeerIdReducer,\n    requestResync: requestResyncReducer,\n    setPreviewCardId: setPreviewCardIdReducer,\n    clearPreviewCard: clearPreviewCardReducer,\n    setMenuPreviewCardJsonId: setMenuPreviewCardJsonIdReducer,\n    clearMenuPreviewCardJsonId: clearMenuPreviewCardJsonIdReducer,\n  },\n  extraReducers: (builder) => {\n    builder.addCase(resetApp, (state, action) => {\n      state.stagePosition = { x: 0, y: 0 };\n      state.stageZoom = { x: 0.5, y: 0.5 };\n      state.previewCard = null;\n    });\n  },\n});\n\nexport const {\n  updateZoom,\n  updatePosition,\n  connectToRemoteGame,\n  setPlayerColor,\n  setPeerId,\n  requestResync,\n  setPreviewCardId,\n  clearPreviewCard,\n  setMenuPreviewCardJsonId,\n  clearMenuPreviewCardJsonId,\n} = gameSlice.actions;\n\nexport default gameSlice.reducer;\n","import { connect } from \"react-redux\";\nimport CardStackCardSelector from \"./CardStackCardSelector\";\nimport { getCardsDataEntities } from \"./features/cards-data/cards-data.selectors\";\nimport {\n  clearMenuPreviewCardJsonId,\n  setMenuPreviewCardJsonId,\n} from \"./features/game/game.slice\";\n\nimport { RootState } from \"./store/rootReducer\";\n\nconst mapStateToProps = (state: RootState) => {\n  return {\n    cardsDataEntities: getCardsDataEntities(state),\n  };\n};\n\nconst CardStackCardSelectorContainer = connect(mapStateToProps, {\n  preview: setMenuPreviewCardJsonId,\n  clearPreview: clearMenuPreviewCardJsonId,\n})(CardStackCardSelector);\n\nexport default CardStackCardSelectorContainer;\n","import { Component } from \"react\";\nimport * as React from \"react\";\nimport { Vector2d } from \"konva/types/types\";\nimport { Group, Rect, Text } from \"react-konva\";\nimport { KonvaEventObject } from \"konva/types/Node\";\n\ninterface IProps {\n  id: string;\n  pos: Vector2d;\n  value: number;\n  updateCounterValueBy: (amount: number) => void;\n  handleContextMenu: (event: KonvaEventObject<PointerEvent>) => void;\n  onDragEnd: (event: KonvaEventObject<DragEvent>) => void;\n}\n\nclass Counter extends Component<IProps> {\n  private touchTimer: any = null;\n\n  render() {\n    return (\n      <Group\n        x={this.props.pos.x}\n        y={this.props.pos.y}\n        draggable={true}\n        onContextMenu={this.props.handleContextMenu}\n        onDragEnd={this.props.onDragEnd}\n        onTouchStart={this.handleTouchStart}\n        onTouchMove={this.handleTouchMove}\n        onTouchEnd={this.handleTouchEnd}\n      >\n        <Rect cornerRadius={30} width={200} height={100} fill={\"red\"}></Rect>\n        <Text\n          width={200}\n          height={100}\n          fontSize={36}\n          text={`${this.props.value}`}\n          align={\"center\"}\n          verticalAlign={\"middle\"}\n        ></Text>\n        <Text\n          x={10}\n          y={25}\n          width={50}\n          height={50}\n          fontSize={36}\n          text={`-`}\n          align={\"center\"}\n          verticalAlign={\"middle\"}\n          onClick={this.handleDecrement}\n          onTap={this.handleDecrement}\n        ></Text>\n        <Text\n          x={140}\n          y={25}\n          width={50}\n          height={50}\n          fontSize={36}\n          text={`+`}\n          align={\"center\"}\n          verticalAlign={\"middle\"}\n          onClick={this.handleIncrement}\n          onTap={this.handleIncrement}\n        ></Text>\n      </Group>\n    );\n  }\n\n  private handleDecrement = () => {\n    this.props.updateCounterValueBy(-1);\n  };\n\n  private handleIncrement = () => {\n    this.props.updateCounterValueBy(1);\n  };\n\n  private handleTouchStart = (event: KonvaEventObject<TouchEvent>) => {\n    event.cancelBubble = true;\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n\n    this.touchTimer = setTimeout(() => {\n      this.props.handleContextMenu(\n        (event as unknown) as KonvaEventObject<PointerEvent>\n      );\n    }, 750);\n  };\n\n  private handleTouchMove = (event: KonvaEventObject<TouchEvent>) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n  };\n\n  private handleTouchEnd = (event: KonvaEventObject<TouchEvent>) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n  };\n}\n\nexport default Counter;\n","import { Component } from \"react\";\nimport * as React from \"react\";\ninterface IProps {\n  connect: (peerId: string) => void;\n}\n\nclass PeerConnector extends Component<IProps> {\n  public inputRef: HTMLInputElement | null = null;\n\n  render() {\n    return (\n      <div onClick={this.cancelBubble} onKeyPress={this.cancelBubble}>\n        <input\n          ref={(ref) => {\n            if (!ref) return;\n            this.inputRef = ref;\n          }}\n        ></input>\n        <button onClick={this.connect}>Connect</button>\n      </div>\n    );\n  }\n\n  private connect = (_event: any) => {\n    console.log(\"connecting with peer id \" + this.inputRef?.value);\n\n    this.props.connect(this.inputRef?.value || \"\");\n  };\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n}\n\nexport default PeerConnector;\n","export const MISSING_CARD_IMAGE_MAP: { [key: string]: string } = {\n  \"02001a\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"8665869b-fae4-494e-91d1-1e8c308220c2\" +\n    \".jpg\",\n\n  \"02001b\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"8665869b-fae4-494e-91d1-1e8c308220c2\" +\n    \".b.jpg\",\n\n  \"02002a\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"cfd051be-4ade-4cf8-b575-4b673cfa9a92\" +\n    \".jpg\",\n\n  \"02002b\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"cfd051be-4ade-4cf8-b575-4b673cfa9a92\" +\n    \".b.jpg\",\n\n  \"02003a\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"b16187a4-3f29-4a4b-8b66-6e8c7524c402\" +\n    \".jpg\",\n\n  \"02003b\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"b16187a4-3f29-4a4b-8b66-6e8c7524c402\" +\n    \".b.jpg\",\n\n  \"02004\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"b35084d9-3a2b-418c-b1a4-e4929de16a2c\" +\n    \".jpg\",\n\n  \"02004_double_sided_back\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"b35084d9-3a2b-418c-b1a4-e4929de16a2c\" +\n    \".b.jpg\",\n\n  \"02005\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"1eae757a-25b2-4b29-a8e7-f43b12c531b0\" +\n    \".jpg\",\n\n  \"02005_double_sided_back\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"1eae757a-25b2-4b29-a8e7-f43b12c531b0\" +\n    \".b.jpg\",\n\n  \"02006a\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"0a59161d-7db6-4328-9eeb-1906ce8715a5\" +\n    \".jpg\",\n\n  \"02006b\":\n    process.env.PUBLIC_URL +\n    \"/images/cards/\" +\n    \"0a59161d-7db6-4328-9eeb-1906ce8715a5\" +\n    \".b.jpg\",\n  \"12020\": \"https://lcgcdn.s3.amazonaws.com/mc/MC13en_20.jpg\",\n  \"14001a\": \"https://marvelcdb.com/bundles/cards/14001a.jpg\",\n  \"14001b\": process.env.PUBLIC_URL + \"/images/missing/qsv.b.jpg\",\n};\n","import * as React from \"react\";\nimport { Component } from \"react\";\nimport { CounterTokenType } from \"./features/cards/cards.slice\";\nimport TextField from \"@material-ui/core/TextField\";\nimport Button from \"@material-ui/core/Button\";\n\ninterface IProps {\n  id: string;\n  tokenType: CounterTokenType;\n  updated: (payload: {\n    id: string;\n    tokenType: CounterTokenType;\n    value: number;\n  }) => void;\n}\n\nclass TokenValueModifier extends Component<IProps> {\n  inputValue: string = \"0\";\n\n  private focusInputField = (input: any) => {\n    if (input) {\n      setTimeout(() => {\n        input.querySelector(\"input\").focus();\n      }, 100);\n    }\n  };\n\n  render() {\n    return (\n      <div\n        onClick={this.cancelBubble}\n        onKeyPress={this.cancelBubble}\n        className=\"token-field-row\"\n      >\n        <TextField\n          ref={this.focusInputField}\n          onKeyPress={this.handleKeyPress}\n          variant=\"outlined\"\n          type=\"number\"\n          onChange={(event) => {\n            this.inputValue = event.target.value;\n          }}\n        ></TextField>\n        <Button\n          onClick={this.handleClick}\n          style={{ height: \"56px\", marginLeft: \"5px\" }}\n          variant=\"outlined\"\n          color=\"primary\"\n        >\n          Set\n        </Button>\n      </div>\n    );\n  }\n\n  private handleKeyPress = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    const code = event.key.toLocaleLowerCase();\n    if (code === \"enter\") {\n      this.complete(+this.inputValue);\n    }\n  };\n\n  private handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    this.complete(+this.inputValue);\n  };\n\n  private complete = (newValue: number) => {\n    this.props.updated({\n      id: this.props.id,\n      tokenType: this.props.tokenType,\n      value: newValue,\n    });\n  };\n\n  // private preventDefault = (\n  //   event: React.MouseEvent<HTMLElement, MouseEvent>\n  // ) => {\n  //   event.preventDefault();\n  // };\n\n  private cancelBubble = (event: React.SyntheticEvent) => {\n    event.stopPropagation();\n  };\n}\n\nexport default TokenValueModifier;\n","export default __webpack_public_path__ + \"static/media/background.71176d34.png\";","export default __webpack_public_path__ + \"static/media/first_player_token.aaf9d607.png\";","import { Component } from \"react\";\nimport * as React from \"react\";\nimport { Rect } from \"react-konva\";\nimport firstPlayerToken from \"./images/first_player_token.png\";\nimport { Vector2d } from \"konva/types/types\";\nimport { KonvaEventObject } from \"konva/types/Node\";\n\ninterface IProps {\n  pos: Vector2d;\n  updatePos: (newPos: Vector2d) => void;\n}\n\ninterface IState {\n  img: HTMLImageElement | null;\n}\n\nclass FirstPlayerToken extends Component<IProps, IState> {\n  constructor(props: IProps) {\n    super(props);\n\n    this.state = {\n      img: null,\n    };\n  }\n\n  public componentDidMount() {\n    const image = new Image();\n    image.onload = () => {\n      this.setState({\n        img: image,\n      });\n    };\n    image.src = firstPlayerToken;\n  }\n\n  render() {\n    return (\n      <Rect\n        x={this.props.pos.x}\n        y={this.props.pos.y}\n        draggable={true}\n        onDragEnd={this.handleDragEnd}\n        width={this.state.img?.naturalWidth ?? 0}\n        height={this.state.img?.naturalHeight ?? 0}\n        fillPatternImage={this.state.img ?? undefined}\n      ></Rect>\n    );\n  }\n\n  private handleDragEnd = (event: KonvaEventObject<DragEvent>) => {\n    this.props.updatePos({\n      x: event.target.x(),\n      y: event.target.y(),\n    });\n  };\n}\n\nexport default FirstPlayerToken;\n","import { createAction } from \"@reduxjs/toolkit\";\nimport { Vector2d } from \"konva/types/types\";\n\nexport interface AddNewCounterWithIdPayload {\n  pos: Vector2d;\n  id: string;\n}\n\nexport const addNewCounterWithId = createAction<AddNewCounterWithIdPayload>(\n  \"addNewCounterWithId\"\n);\n","import { Vector2d } from \"konva/types/types\";\nimport { loadState } from \"../../store/localStorage\";\n\nexport interface ICountersState {\n  counters: ICounter[];\n  firstPlayerCounterPosition: Vector2d;\n}\n\nexport interface ICounter {\n  id: string;\n  position: Vector2d;\n  value: number;\n}\n\nconst localStorageState: ICountersState =\n  loadState(\"liveState\")?.counters ?? {};\n\nconst defaultState: ICountersState = {\n  counters: [],\n  firstPlayerCounterPosition: { x: 0, y: 0 },\n};\nexport const initialState: ICountersState = {\n  ...defaultState,\n  ...localStorageState,\n};\n","import { CaseReducer, createSlice, PayloadAction } from \"@reduxjs/toolkit\";\nimport { Vector2d } from \"konva/types/types\";\nimport { receiveRemoteGameState, resetApp } from \"../../store/global.actions\";\nimport { addNewCounterWithId } from \"./counters.actions\";\nimport { ICountersState, initialState } from \"./initialState\";\n\n// Reducers\nconst updateCounterValueReducer: CaseReducer<\n  ICountersState,\n  PayloadAction<{ id: string; delta: number }>\n> = (state, action) => {\n  const counter = state.counters.find((c) => c.id === action.payload.id);\n  if (!!counter) {\n    counter.value += action.payload.delta;\n    if (counter.value < 0) {\n      counter.value = 0;\n    }\n  }\n};\n\nconst removeCounterReducer: CaseReducer<\n  ICountersState,\n  PayloadAction<string>\n> = (state, action) => {\n  state.counters = state.counters.filter((c) => c.id !== action.payload);\n};\n\nconst moveCounterReducer: CaseReducer<\n  ICountersState,\n  PayloadAction<{ id: string; newPos: Vector2d }>\n> = (state, action) => {\n  const counter = state.counters.find((c) => c.id === action.payload.id);\n  if (!!counter) {\n    counter.position = {\n      x: action.payload.newPos.x,\n      y: action.payload.newPos.y,\n    };\n  }\n};\n\nconst moveFirstPlayerCounterReducer: CaseReducer<\n  ICountersState,\n  PayloadAction<Vector2d>\n> = (state, action) => {\n  state.firstPlayerCounterPosition = {\n    x: action.payload.x,\n    y: action.payload.y,\n  };\n};\n\n// slice\nconst countersSlice = createSlice({\n  name: \"counters\",\n  initialState: initialState,\n  reducers: {\n    updateCounterValue: updateCounterValueReducer,\n    removeCounter: removeCounterReducer,\n    moveCounter: moveCounterReducer,\n    moveFirstPlayerCounter: moveFirstPlayerCounterReducer,\n  },\n  extraReducers: (builder) => {\n    builder.addCase(receiveRemoteGameState, (state, action) => {\n      state.counters = action.payload.liveState.present.counters.counters;\n      state.firstPlayerCounterPosition =\n        action.payload.liveState.present.counters.firstPlayerCounterPosition;\n    });\n\n    builder.addCase(resetApp, (state, action) => {\n      state.counters = [];\n      state.firstPlayerCounterPosition = { x: 0, y: 0 };\n    });\n\n    builder.addCase(addNewCounterWithId, (state, action) => {\n      state.counters.push({\n        id: action.payload.id,\n        position: action.payload.pos,\n        value: 0,\n      });\n    });\n  },\n});\n\nexport const {\n  updateCounterValue,\n  removeCounter,\n  moveCounter,\n  moveFirstPlayerCounter,\n} = countersSlice.actions;\n\nexport default countersSlice.reducer;\n","import { createSelector } from \"@reduxjs/toolkit\";\nimport { RootState } from \"../../store/rootReducer\";\n\nexport const getCounters = (state: RootState) =>\n  state.liveState.present.counters;\n\nexport const getCurrentCounters = createSelector(getCounters, (counters) => {\n  return counters.counters;\n});\n\nexport const getFirstPlayerTokenPos = createSelector(\n  getCounters,\n  (counters) => counters.firstPlayerCounterPosition\n);\n","import { connect } from \"react-redux\";\nimport FirstPlayerToken from \"./FirstPlayerToken\";\nimport { moveFirstPlayerCounter } from \"./features/counters/counters.slice\";\nimport { RootState } from \"./store/rootReducer\";\nimport { getFirstPlayerTokenPos } from \"./features/counters/counters.selectors\";\n\nconst mapStateToProps = (state: RootState) => {\n  return {\n    pos: getFirstPlayerTokenPos(state),\n  };\n};\n\nconst FirstPlayerTokenContainer = connect(mapStateToProps, {\n  updatePos: moveFirstPlayerCounter,\n})(FirstPlayerToken);\n\nexport default FirstPlayerTokenContainer;\n","import { ReactReduxContext, Provider } from \"react-redux\";\nimport * as Intersects from \"intersects\";\nimport Konva from \"konva\";\nimport { KonvaEventObject } from \"konva/types/Node\";\nimport { Vector2d } from \"konva/types/types\";\nimport * as React from \"react\";\nimport { Component } from \"react\";\nimport { Layer, Rect, Stage } from \"react-konva\";\nimport \"./App.scss\";\nimport Card, { HORIZONTAL_TYPE_CODES } from \"./Card\";\nimport { cardConstants } from \"./constants/card-constants\";\nimport ContextMenu, { ContextMenuItem } from \"./ContextMenu\";\nimport DeckLoader from \"./DeckLoader\";\nimport EncounterLoaderContainer from \"./EncounterLoaderContainer\";\nimport { ICardData } from \"./features/cards-data/initialState\";\nimport {\n  CounterTokenType,\n  StatusTokenType,\n} from \"./features/cards/cards.slice\";\nimport { ICardsState, ICardStack } from \"./features/cards/initialState\";\nimport { IGameState } from \"./features/game/initialState\";\nimport TopLayer from \"./TopLayer\";\nimport { getCenter, getDistance } from \"./utilities/geo\";\nimport CardStackCardSelectorContainer from \"./CardStackCardSelectorContainer\";\nimport Counter from \"./Counter\";\nimport PeerConnector from \"./PeerConnector\";\nimport { myPeerRef, PlayerColor } from \"./constants/app-constants\";\nimport { ICounter } from \"./features/counters/initialState\";\nimport { MISSING_CARD_IMAGE_MAP } from \"./constants/card-missing-image-map\";\nimport { CardData } from \"./external-api/marvel-card-data\";\nimport { CARD_PACK_REMAPPING } from \"./constants/card-pack-mapping\";\nimport { DrawCardsOutOfCardStackPayload } from \"./features/cards/cards.thunks\";\nimport TokenValueModifier from \"./TokenValueModifier\";\nimport playmat from \"./images/background.png\";\nimport FirstPlayerTokenContainer from \"./FirstPlayerTokenContainer\";\n\nconst SCALE_BY = 1.02;\n\ninterface IProps {\n  cards: ICardsState;\n  cardsData: ICardData;\n  gameState: IGameState;\n  panMode: boolean;\n  playerColors: { [key: string]: PlayerColor };\n  menuPreviewCard: ICardStack | null;\n  cardMove: (info: { id: string; dx: number; dy: number }) => void;\n  endCardMove: (id: string) => void;\n  exhaustCard: (id: string) => void;\n  selectCard: (payload: { id: string; unselectOtherCards: boolean }) => void;\n  unselectCard: (id: string) => void;\n  toggleSelectCard: (id: string) => void;\n  startCardMove: (payload: { id: string; splitTopCard: boolean }) => void;\n  unselectAllCards: (payload?: any) => void;\n  selectMultipleCards: (cards: { ids: string[] }) => void;\n  setPreviewCardId: (id: string) => void;\n  clearPreviewCard: () => void;\n  togglePanMode: () => void;\n  flipCards: () => void;\n  loadCardsData: () => void;\n  shuffleStack: (id?: string) => void;\n  fetchDecklistById: (payload: {\n    decklistId: number;\n    position: Vector2d;\n  }) => void;\n  updateZoom: (zoom: Vector2d) => void;\n  updatePosition: (pos: Vector2d) => void;\n  resetApp: () => void;\n  addCardStack: (payload: {\n    cardJsonIds: string[];\n    position: Vector2d;\n  }) => void;\n  toggleToken: (payload: {\n    id: string;\n    tokenType: StatusTokenType;\n    value: boolean;\n  }) => void;\n  adjustCounterToken: (payload: {\n    id: string;\n    tokenType: CounterTokenType;\n    delta?: number;\n    value?: number;\n  }) => void;\n  pullCardOutOfCardStack: (payload: {\n    cardStackId: string;\n    jsonId: string;\n    pos: Vector2d;\n  }) => void;\n  addNewCounter: (pos: Vector2d) => void;\n  updateCounterValue: (payload: { id: string; delta: number }) => void;\n  removeCounter: (id: string) => void;\n  moveCounter: (payload: { id: string; newPos: Vector2d }) => void;\n  connectToRemoteGame: (peerId: string) => void;\n  undo: () => void;\n  redo: () => void;\n  counters: ICounter[];\n  requestResync: () => void;\n  peerId: string;\n  dropTargetCardsById: {\n    [key: string]: { ownerRef: string; card: ICardStack | null };\n  };\n  drawCardsOutOfCardStack: (payload: DrawCardsOutOfCardStackPayload) => void;\n}\n\ninterface IState {\n  drewASelectionRect: boolean;\n  selectRect: {\n    height: number;\n    width: number;\n  };\n  selectStartPos: {\n    x: number;\n    y: number;\n  };\n  selecting: boolean;\n  showContextMenu: boolean;\n  contextMenuPosition: Vector2d | null;\n  contextMenuItems: ContextMenuItem[];\n  showDeckImporter: boolean;\n  deckImporterPosition: Vector2d | null;\n  showEncounterImporter: boolean;\n  encounterImporterPosition: Vector2d | null;\n  showCardSearch: boolean;\n  cardSearchPosition: Vector2d | null;\n  cardStackForSearching: ICardStack | null;\n  showPeerConnector: boolean;\n  peerConnectorPosition: Vector2d | null;\n  showTokenValueModifier: boolean;\n  tokenValueModifierProps: { id: string; tokenType: CounterTokenType } | null;\n  tokenValueModifierPosition: Vector2d | null;\n  playmatImage: HTMLImageElement | null;\n}\nclass App extends Component<IProps, IState> {\n  public stage: Konva.Stage | null = null;\n\n  private touchTimer: any = null;\n\n  private lastCenter: Vector2d | null = null;\n  private lastDist: number = 0;\n\n  constructor(props: IProps) {\n    super(props);\n\n    if (!!Konva) {\n      Konva.hitOnDragEnabled = true;\n    }\n\n    this.state = {\n      drewASelectionRect: false,\n      selectRect: {\n        height: 0,\n        width: 0,\n      },\n      selectStartPos: {\n        x: 0,\n        y: 0,\n      },\n      selecting: false,\n      showContextMenu: false,\n      contextMenuPosition: null,\n      contextMenuItems: [],\n      showDeckImporter: false,\n      deckImporterPosition: null,\n      showEncounterImporter: false,\n      encounterImporterPosition: null,\n      showCardSearch: false,\n      cardSearchPosition: null,\n      cardStackForSearching: null,\n      showPeerConnector: false,\n      peerConnectorPosition: null,\n      showTokenValueModifier: false,\n      tokenValueModifierProps: null,\n      tokenValueModifierPosition: null,\n      playmatImage: null,\n    };\n  }\n\n  public componentDidMount() {\n    const image = new Image();\n    image.onload = () => {\n      this.setState({\n        playmatImage: image,\n      });\n    };\n    image.src = playmat;\n    this.props.loadCardsData();\n  }\n\n  public render() {\n    const staticCards = this.props.cards.cards\n      .filter((card) => !card.dragging)\n      .map((card) => {\n        return (\n          <Card\n            code={this.getCardCode(card)}\n            name={this.getCardName(card)}\n            selectedColor={\n              this.props.playerColors[card.controlledBy] ?? \"black\"\n            }\n            controlledBy={card.controlledBy}\n            key={card.id}\n            id={card.id}\n            x={card.x}\n            y={card.y}\n            exhausted={card.exhausted}\n            fill={card.fill}\n            selected={card.selected}\n            dropTargetColor={\n              this.props.playerColors[\n                this.props.dropTargetCardsById[card.id]?.ownerRef\n              ] ?? \"\"\n            }\n            dragging={card.dragging}\n            shuffling={card.shuffling}\n            handleDragStart={this.handleCardDragStart}\n            handleDragMove={this.props.cardMove}\n            handleDragEnd={this.props.endCardMove}\n            handleDoubleClick={this.handleSelectAndExhaust}\n            handleClick={this.handleCardClick(card)}\n            handleHover={this.props.setPreviewCardId}\n            handleHoverLeave={this.props.clearPreviewCard}\n            handleContextMenu={this.handleCardContextMenu}\n            imgUrls={this.getImgUrls(card)}\n            typeCode={this.getCardType(card)}\n            faceup={card.faceup}\n            numCardsInStack={card.cardStack.length}\n            cardState={{\n              stunned: card.statusTokens.stunned,\n              confused: card.statusTokens.confused,\n              tough: card.statusTokens.tough,\n              tokens: { damage: 0, threat: 0, generic: 0 },\n            }}\n          />\n        );\n      });\n\n    const ghostCards = this.props.cards.ghostCards.map((card) => {\n      return (\n        <Card\n          name={this.getCardName(card)}\n          code={this.getCardCode(card)}\n          selectedColor={this.props.playerColors[card.controlledBy] ?? \"black\"}\n          controlledBy={card.controlledBy}\n          key={`ghost${card.id}`}\n          id={card.id}\n          x={card.x}\n          y={card.y}\n          exhausted={card.exhausted}\n          fill={card.fill}\n          selected={false}\n          dragging={false}\n          shuffling={false}\n          imgUrls={this.getImgUrls(card)}\n          typeCode={this.getCardType(card)}\n          faceup={card.faceup}\n          isGhost={true}\n        />\n      );\n    });\n\n    const movingCards = this.props.cards.cards\n      .filter((card) => card.dragging)\n      .map((card) => {\n        return (\n          <Card\n            name={this.getCardName(card)}\n            code={this.getCardCode(card)}\n            selectedColor={\n              this.props.playerColors[card.controlledBy] ?? \"black\"\n            }\n            controlledBy={card.controlledBy}\n            key={card.id}\n            id={card.id}\n            x={card.x}\n            y={card.y}\n            exhausted={card.exhausted}\n            fill={card.fill}\n            selected={card.selected}\n            dragging={card.dragging}\n            shuffling={card.shuffling}\n            handleDragStart={this.handleCardDragStart}\n            handleDragMove={this.props.cardMove}\n            handleDragEnd={this.props.endCardMove}\n            imgUrls={this.getImgUrls(card)}\n            typeCode={this.getCardType(card)}\n            faceup={card.faceup}\n            numCardsInStack={card.cardStack.length}\n          />\n        );\n      });\n\n    const iAmDragging = this.props.cards.cards.some(\n      (c) => c.dragging && c.controlledBy === myPeerRef\n    );\n\n    const possiblePreviewCards = !!this.props.menuPreviewCard\n      ? [this.props.menuPreviewCard]\n      : this.props.cards.cards.filter(\n          (card) =>\n            !!this.props.gameState.previewCard &&\n            card.id === this.props.gameState.previewCard.id\n        );\n\n    const previewCards = this.stage\n      ? possiblePreviewCards\n          .filter((_card) => !this.state.selecting && !iAmDragging)\n          .map((card) => {\n            const isHorizontal = HORIZONTAL_TYPE_CODES.includes(\n              this.getCardType(card)\n            );\n            const imgUrls = this.getImgUrls(card);\n            const rawPos = this.getRawPreviewCardPosition(isHorizontal);\n            const previewPos = this.getRelativePositionFromTarget(\n              this.stage,\n              rawPos\n            );\n\n            return imgUrls.some(\n              (url) => url.indexOf(\"card_back\") !== -1\n            ) ? null : (\n              <Card\n                name={this.getCardName(card)}\n                code={this.getCardCode(card)}\n                selectedColor={\n                  this.props.playerColors[card.controlledBy] ?? \"black\"\n                }\n                controlledBy={card.controlledBy}\n                key={`preview${card.id}`}\n                id={card.id}\n                x={previewPos.x}\n                y={previewPos.y}\n                exhausted={isHorizontal}\n                fill={card.fill}\n                selected={false}\n                dragging={false}\n                shuffling={false}\n                imgUrls={imgUrls}\n                typeCode={this.getCardType(card)}\n                faceup={card.faceup}\n                height={\n                  cardConstants.CARD_PREVIEW_HEIGHT /\n                  this.props.gameState.stageZoom.y\n                }\n                width={\n                  cardConstants.CARD_PREVIEW_WIDTH /\n                  this.props.gameState.stageZoom.x\n                }\n              />\n            );\n          })\n          .filter((c): c is JSX.Element => c !== null)\n      : [];\n\n    return (\n      <div\n        className=\"play-area\"\n        tabIndex={1}\n        onKeyDown={this.handleKeyDown}\n        onKeyPress={this.handleKeyPress}\n      >\n        {this.renderEmptyMessage()}\n        {this.renderContextMenu()}\n        {this.renderDeckImporter()}\n        {this.renderEncounterImporter()}\n        {this.renderCardSearch()}\n        {this.renderPeerConnector()}\n        {this.renderTokenModifier()}\n        <ReactReduxContext.Consumer>\n          {({ store }) => (\n            <Stage\n              ref={(ref) => {\n                if (!ref) return;\n\n                this.stage = ref;\n              }}\n              x={this.props.gameState.stagePosition.x}\n              y={this.props.gameState.stagePosition.y}\n              width={window.innerWidth}\n              height={window.innerHeight}\n              onClick={this.handleStageClickOrTap}\n              onTap={this.handleStageClickOrTap}\n              onMouseDown={\n                this.props.panMode ? this.noOp : this.handleMouseDown\n              }\n              onMouseUp={this.props.panMode ? this.noOp : this.handleMouseUp}\n              onMouseMove={\n                this.props.panMode ? this.noOp : this.handleMouseMove\n              }\n              onTouchStart={this.handleTouchStart}\n              onTouchMove={this.handleTouchMove}\n              onTouchEnd={this.handleTouchEnd}\n              onContextMenu={this.handleContextMenu}\n              scale={this.props.gameState.stageZoom}\n              onWheel={this.handleWheel}\n              draggable={this.props.panMode}\n              onDragMove={this.noOp}\n              onDragEnd={this.noOp}\n              preventDefault={true}\n            >\n              <Provider store={store}>\n                <Layer>\n                  <Rect\n                    scale={{ x: 2.25, y: 2.25 }}\n                    width={this.state.playmatImage?.naturalWidth ?? 0}\n                    height={this.state.playmatImage?.naturalHeight ?? 0}\n                    fillPatternImage={this.state.playmatImage ?? undefined}\n                  ></Rect>\n                </Layer>\n                <Layer>\n                  {this.props.counters.map((counter) => (\n                    <Counter\n                      key={`${counter.id}-counter`}\n                      id={counter.id}\n                      pos={counter.position}\n                      value={counter.value}\n                      updateCounterValueBy={this.handleCounterValueUpdate(\n                        counter.id\n                      )}\n                      handleContextMenu={this.handleCounterContextMenu(\n                        counter.id\n                      )}\n                      onDragEnd={this.handleCounterDrag(counter.id)}\n                    ></Counter>\n                  ))}\n                </Layer>\n                <Layer preventDefault={true}>\n                  {staticCards\n                    .concat(ghostCards)\n                    .concat(movingCards)\n                    .concat(previewCards)}\n                </Layer>\n                <Layer>\n                  <FirstPlayerTokenContainer></FirstPlayerTokenContainer>\n                </Layer>\n                <Layer>\n                  <Rect\n                    x={this.state.selectStartPos.x}\n                    y={this.state.selectStartPos.y}\n                    width={this.state.selectRect.width}\n                    height={this.state.selectRect.height}\n                    stroke=\"black\"\n                  />\n                </Layer>\n              </Provider>\n            </Stage>\n          )}\n        </ReactReduxContext.Consumer>\n      </div>\n    );\n  }\n\n  private handleCounterValueUpdate = (id: string) => (delta: number) => {\n    this.props.updateCounterValue({ id, delta });\n  };\n\n  private handleCounterDrag = (id: string) => (\n    event: KonvaEventObject<DragEvent>\n  ) => {\n    this.props.moveCounter({\n      id,\n      newPos: {\n        x: event.target.x(),\n        y: event.target.y(),\n      },\n    });\n  };\n\n  private noOp = () => {};\n\n  private renderEmptyMessage = () => {\n    if (this.props.cards.cards.length > 0) return null;\n\n    return (\n      <div>\n        Right click and select 'Load Deck ID' to load a deck from marvelcdb.com\n      </div>\n    );\n  };\n\n  private renderContextMenu = () => {\n    if (!this.state.showContextMenu) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.contextMenuPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing context menu position\");\n    }\n\n    return (\n      <ContextMenu\n        position={{\n          x: containerRect.left + pointerPosition.x,\n          y: containerRect.top + pointerPosition.y,\n        }}\n        items={this.state.contextMenuItems}\n        hideContextMenu={() => this.clearContextMenu()}\n      ></ContextMenu>\n    );\n  };\n\n  private renderDeckImporter = () => {\n    if (!this.state.showDeckImporter) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.deckImporterPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing deck importer position\");\n    }\n\n    return (\n      <TopLayer\n        position={{\n          x: containerRect.left + pointerPosition.x,\n          y: containerRect.top + pointerPosition.y,\n        }}\n        completed={this.clearDeckImporter}\n      >\n        <DeckLoader\n          loadDeckId={this.handleImportDeck(\n            this.getRelativePositionFromTarget(this.stage)\n          )}\n        />\n      </TopLayer>\n    );\n  };\n\n  private renderEncounterImporter = () => {\n    if (!this.state.showEncounterImporter) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.encounterImporterPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing deck importer position\");\n    }\n\n    const pos = {\n      x: containerRect.left + pointerPosition.x,\n      y: containerRect.top + pointerPosition.y,\n    };\n\n    return (\n      <TopLayer position={pos} completed={this.clearEncounterImporter}>\n        <EncounterLoaderContainer\n          loadCards={this.handleLoadEncounter(\n            this.getRelativePositionFromTarget(this.stage)\n          )}\n        />\n      </TopLayer>\n    );\n  };\n\n  private renderCardSearch = () => {\n    if (!this.state.showCardSearch) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.cardSearchPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing card search position\");\n    }\n\n    const pos = {\n      x: containerRect.left + pointerPosition.x,\n      y: containerRect.top + pointerPosition.y,\n    };\n\n    return !!this.state.cardStackForSearching ? (\n      <TopLayer position={pos} completed={this.clearCardSearch}>\n        <CardStackCardSelectorContainer\n          card={this.state.cardStackForSearching}\n          cardSelected={this.handleCardSelectedFromCardStack(\n            this.state.cardStackForSearching.id,\n            pos\n          )}\n        />\n      </TopLayer>\n    ) : null;\n  };\n\n  private renderPeerConnector = () => {\n    if (!this.state.showPeerConnector) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.peerConnectorPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing peer connector position\");\n    }\n\n    const pos = {\n      x: containerRect.left + pointerPosition.x,\n      y: containerRect.top + pointerPosition.y,\n    };\n\n    return !!this.state.showPeerConnector ? (\n      <TopLayer position={pos} completed={this.clearPeerConnector}>\n        <PeerConnector connect={this.handlePeerConnect}></PeerConnector>\n      </TopLayer>\n    ) : null;\n  };\n\n  private renderTokenModifier = () => {\n    if (!this.state.showTokenValueModifier) return null;\n\n    const containerRect = this.stage?.container().getBoundingClientRect();\n    const pointerPosition = this.state.tokenValueModifierPosition;\n    if (!containerRect || !pointerPosition) {\n      throw new Error(\"Problem computing token Modifier position\");\n    }\n\n    const pos = {\n      x: containerRect.left + pointerPosition.x,\n      y: containerRect.top + pointerPosition.y,\n    };\n\n    return !!this.state.showTokenValueModifier &&\n      !!this.state.tokenValueModifierProps ? (\n      <TopLayer position={pos} completed={this.clearTokenValueModifier}>\n        <TokenValueModifier\n          id={this.state.tokenValueModifierProps.id}\n          tokenType={this.state.tokenValueModifierProps.tokenType}\n          updated={(payload) => {\n            this.props.adjustCounterToken(payload);\n            this.clearTokenValueModifier();\n          }}\n        ></TokenValueModifier>\n      </TopLayer>\n    ) : null;\n  };\n\n  private handleLoadEncounter = (position: Vector2d) => (cards: string[]) => {\n    this.clearEncounterImporter();\n    this.props.addCardStack({ position, cardJsonIds: cards });\n  };\n\n  private handleImportDeck = (position: Vector2d) => (id: number) => {\n    this.clearDeckImporter();\n    this.props.fetchDecklistById({ decklistId: id, position });\n  };\n\n  private handlePeerConnect = (peerId: string) => {\n    this.clearPeerConnector();\n    this.props.connectToRemoteGame(peerId);\n  };\n\n  private handleCardSelectedFromCardStack = (\n    cardStackId: string,\n    pos: Vector2d\n  ) => (jsonId: string) => {\n    this.clearCardSearch();\n    this.props.pullCardOutOfCardStack({ cardStackId, jsonId, pos });\n  };\n\n  private clearContextMenu = () => {\n    this.setState({\n      showContextMenu: false,\n      contextMenuPosition: null,\n      contextMenuItems: [],\n    });\n  };\n\n  private clearDeckImporter = () => {\n    this.setState({\n      showDeckImporter: false,\n      deckImporterPosition: null,\n    });\n  };\n\n  private clearTokenValueModifier = () => {\n    this.setState({\n      showTokenValueModifier: false,\n      tokenValueModifierProps: null,\n      tokenValueModifierPosition: null,\n    });\n  };\n\n  private clearEncounterImporter = () => {\n    this.setState({\n      showEncounterImporter: false,\n      encounterImporterPosition: null,\n    });\n  };\n\n  private clearCardSearch = () => {\n    this.setState({\n      showCardSearch: false,\n      cardSearchPosition: null,\n      cardStackForSearching: null,\n    });\n  };\n\n  private clearPeerConnector = () => {\n    this.setState({\n      showPeerConnector: false,\n      peerConnectorPosition: null,\n    });\n  };\n\n  private handleStageClickOrTap = (event: KonvaEventObject<MouseEvent>) => {\n    if (this.state.showContextMenu) {\n      return;\n    }\n    const mousePos = this.getRelativePositionFromTarget(this.stage);\n    if (\n      this.props.panMode ||\n      getDistance(this.state.selectStartPos, mousePos) < 30\n    ) {\n      this.props.unselectAllCards();\n    }\n  };\n\n  private handleWheel = (event: KonvaEventObject<WheelEvent>) => {\n    event.evt.preventDefault();\n\n    if (!this.stage) return;\n\n    var oldScale = this.props.gameState.stageZoom.x;\n\n    const pointer = this.stage.getPointerPosition() ?? { x: 0, y: 0 };\n\n    const mousePointTo = {\n      x: (pointer.x - this.stage.x()) / oldScale,\n      y: (pointer.y - this.stage.y()) / oldScale,\n    };\n\n    const newScale =\n      event.evt.deltaY < 0 ? oldScale * SCALE_BY : oldScale / SCALE_BY;\n\n    this.props.updateZoom({ x: newScale, y: newScale });\n\n    const newPos = {\n      x: pointer.x - mousePointTo.x * newScale,\n      y: pointer.y - mousePointTo.y * newScale,\n    };\n\n    this.props.updatePosition(newPos);\n  };\n\n  private handleCounterContextMenu = (counterId: string) => (\n    event: KonvaEventObject<PointerEvent>\n  ) => {\n    event.evt.preventDefault();\n    event.cancelBubble = true;\n\n    const menuItems = [\n      {\n        label: \"Remove\",\n        action: () => {\n          this.props.removeCounter(counterId);\n        },\n      },\n    ];\n\n    this.setState({\n      showContextMenu: true,\n      contextMenuPosition: this.stage?.getPointerPosition() ?? null,\n      contextMenuItems: menuItems,\n    });\n  };\n\n  private handleCardContextMenu = (\n    cardId: string,\n    event: KonvaEventObject<PointerEvent>\n  ) => {\n    event.evt.preventDefault();\n    event.cancelBubble = true;\n\n    // We want to unselect all the other cards if the card isn't actively selected\n    const cardStack = this.props.cards.cards.find((c) => c.id === cardId);\n\n    // Next, select the card that was right-clicked\n    this.props.selectCard({\n      id: cardId,\n      unselectOtherCards: !!cardStack ? !cardStack.selected : true,\n    });\n\n    const card = this.props.cards.cards.find((c) => c.id === cardId);\n    const numCardsInStack = card?.cardStack?.length || 0;\n    const currentStatusTokens = card?.statusTokens || {\n      stunned: false,\n      confused: false,\n      tough: false,\n    };\n\n    const menuItems = [\n      {\n        label: \"Flip\",\n        action: () => {\n          this.props.flipCards();\n        },\n      },\n    ];\n\n    if (numCardsInStack > 1) {\n      menuItems.push({\n        label: \"Shuffle\",\n        action: () => {\n          this.props.shuffleStack();\n        },\n      });\n\n      menuItems.push({\n        label: \"Find Specific Card\",\n        action: () => {\n          if (!!card) {\n            this.setState({\n              showCardSearch: true,\n              cardSearchPosition: this.stage?.getPointerPosition() ?? null,\n              cardStackForSearching: card,\n            });\n          }\n        },\n      });\n    }\n\n    menuItems.push({\n      label: !!currentStatusTokens.stunned ? \"Remove Stun\" : \"Stun\",\n      action: () => {\n        this.props.toggleToken({\n          id: card?.id || \"\",\n          tokenType: StatusTokenType.Stunned,\n          value: !currentStatusTokens.stunned,\n        });\n      },\n    });\n\n    menuItems.push({\n      label: !!currentStatusTokens.confused ? \"Remove Confused\" : \"Confuse\",\n      action: () => {\n        this.props.toggleToken({\n          id: card?.id || \"\",\n          tokenType: StatusTokenType.Confused,\n          value: !currentStatusTokens.confused,\n        });\n      },\n    });\n\n    menuItems.push({\n      label: !!currentStatusTokens.tough ? \"Remove Tough\" : \"Tough\",\n      action: () => {\n        this.props.toggleToken({\n          id: card?.id || \"\",\n          tokenType: StatusTokenType.Tough,\n          value: !currentStatusTokens.tough,\n        });\n      },\n    });\n\n    menuItems.push({\n      label: \"Set Damage\",\n      action: () => {\n        this.setState({\n          showContextMenu: false,\n          contextMenuItems: [],\n          contextMenuPosition: null,\n\n          showTokenValueModifier: true,\n          tokenValueModifierProps: {\n            id: card?.id || \"\",\n            tokenType: CounterTokenType.Damage,\n          },\n          tokenValueModifierPosition: this.stage?.getPointerPosition() ?? null,\n        });\n      },\n    });\n\n    menuItems.push({\n      label: \"Set Threat\",\n      action: () => {\n        this.setState({\n          showContextMenu: false,\n          contextMenuItems: [],\n          contextMenuPosition: null,\n\n          showTokenValueModifier: true,\n          tokenValueModifierProps: {\n            id: card?.id || \"\",\n            tokenType: CounterTokenType.Threat,\n          },\n          tokenValueModifierPosition: this.stage?.getPointerPosition() ?? null,\n        });\n      },\n    });\n\n    menuItems.push({\n      label: \"Set Generic Tokens\",\n      action: () => {\n        this.setState({\n          showContextMenu: false,\n          contextMenuItems: [],\n          contextMenuPosition: null,\n\n          showTokenValueModifier: true,\n          tokenValueModifierProps: {\n            id: card?.id || \"\",\n            tokenType: CounterTokenType.Generic,\n          },\n          tokenValueModifierPosition: this.stage?.getPointerPosition() ?? null,\n        });\n      },\n    });\n\n    menuItems.push({\n      label: \"Remove All Tokens\",\n      action: () => {\n        this.props.adjustCounterToken({\n          id: card?.id || \"\",\n          tokenType: CounterTokenType.Damage,\n          value: 0,\n        });\n\n        this.props.adjustCounterToken({\n          id: card?.id || \"\",\n          tokenType: CounterTokenType.Threat,\n          value: 0,\n        });\n\n        this.props.adjustCounterToken({\n          id: card?.id || \"\",\n          tokenType: CounterTokenType.Generic,\n          value: 0,\n        });\n      },\n    });\n\n    this.setState({\n      showContextMenu: true,\n      contextMenuPosition: this.stage?.getPointerPosition() ?? null,\n      contextMenuItems: menuItems,\n    });\n  };\n\n  private handleCardClick = (card: ICardStack) => (\n    cardId: string,\n    event: KonvaEventObject<MouseEvent>\n  ) => {\n    // Here check if modifier held down\n    const modifierKeyHeld =\n      event.evt.shiftKey || event.evt.metaKey || event.evt.ctrlKey;\n\n    if (card.selected && modifierKeyHeld) {\n      this.props.toggleSelectCard(cardId);\n    } else {\n      this.props.selectCard({\n        id: cardId,\n        unselectOtherCards: !modifierKeyHeld,\n      });\n    }\n  };\n\n  private handleSelectAndExhaust = (\n    cardId: string,\n    event: KonvaEventObject<MouseEvent>\n  ) => {\n    // Here check if modifier held down\n    const modifierKeyHeld =\n      event.evt.shiftKey || event.evt.metaKey || event.evt.ctrlKey;\n    this.props.selectCard({ id: cardId, unselectOtherCards: !modifierKeyHeld });\n    this.props.exhaustCard(cardId);\n  };\n\n  private handleCardDragStart = (\n    cardId: string,\n    event: KonvaEventObject<DragEvent>\n  ) => {\n    let splitTopCard = false;\n    // If multiple things are selected, you can't pull something off the top of a stack,\n    // so just do a normal drag\n    const multipleSelected =\n      this.props.cards.cards.filter(\n        (c) => c.selected && c.controlledBy === myPeerRef\n      ).length > 1;\n\n    if (!multipleSelected) {\n      const draggingCard = this.props.cards.cards.find((c) => c.id === cardId);\n      const hasStack = (draggingCard?.cardStack || []).length > 1;\n      if (!!draggingCard && hasStack) {\n        // Check if we're dragging in the upper right corner of the card\n        const upperRightPoint = {\n          x: draggingCard.x + cardConstants.CARD_WIDTH / 2,\n          y: draggingCard.y - cardConstants.CARD_HEIGHT / 2,\n        };\n        const distance = getDistance(\n          upperRightPoint,\n          this.getRelativePositionFromTarget(this.stage)\n        );\n        if (distance < 50) {\n          splitTopCard = true;\n        }\n      }\n    }\n\n    this.props.startCardMove({ id: cardId, splitTopCard });\n  };\n\n  private handleKeyPress = (event: React.KeyboardEvent<HTMLElement>) => {\n    const code = event.key.toLocaleLowerCase();\n    const intCode = parseInt(code);\n    if (code === \"p\") {\n      this.props.togglePanMode();\n    } else if (code === \"f\") {\n      this.props.flipCards();\n    } else if (code === \"s\") {\n      this.props.shuffleStack();\n    } else if (!Number.isNaN(intCode)) {\n      // First, get the selected card stack\n      const mySelectedCards = this.props.cards.cards.filter(\n        (c) => c.selected && c.controlledBy === myPeerRef\n      );\n      if (mySelectedCards.length !== 1) {\n        console.log(\n          \"will not be drawing any cards because the number of selected stacks is \" +\n            mySelectedCards.length\n        );\n      } else {\n        this.props.drawCardsOutOfCardStack({\n          cardStackId: mySelectedCards[0].id,\n          numberToDraw: intCode,\n        });\n      }\n    }\n  };\n\n  private handleKeyDown = (event: React.KeyboardEvent<HTMLElement>) => {\n    if (\n      event.shiftKey &&\n      (event.ctrlKey || event.metaKey) &&\n      event.key === \"z\"\n    ) {\n      this.props.redo();\n    } else if ((event.ctrlKey || event.metaKey) && event.key === \"z\") {\n      event.preventDefault();\n      this.props.undo();\n    }\n  };\n\n  private getRawPreviewCardPosition = (horizontal: boolean): Vector2d => {\n    const pointerPos = this.stage?.getPointerPosition() ?? { x: 0, y: 0 };\n    const screenMidPointX = window.innerWidth / 2;\n\n    const widthToUse = horizontal\n      ? cardConstants.CARD_PREVIEW_HEIGHT\n      : cardConstants.CARD_PREVIEW_WIDTH;\n    const heightToUse = horizontal\n      ? cardConstants.CARD_PREVIEW_WIDTH\n      : cardConstants.CARD_PREVIEW_HEIGHT;\n\n    return pointerPos.x < screenMidPointX\n      ? {\n          x: window.innerWidth - widthToUse / 2,\n          y: heightToUse / 2,\n        }\n      : {\n          x: widthToUse / 2,\n          y: heightToUse / 2,\n        };\n  };\n\n  private getRelativePositionFromTarget = (\n    target: any,\n    posParam?: Vector2d\n  ) => {\n    const transform = target.getAbsoluteTransform().copy();\n    transform.invert();\n    let pos = posParam || target.getPointerPosition();\n    return transform.point(pos) as Vector2d;\n  };\n\n  private handleMouseDown = (event: KonvaEventObject<MouseEvent>) => {\n    if (event.evt.button === 0) {\n      // Only do something if it's the primary button (not a right-click)\n      const pos = this.getRelativePositionFromTarget(this.stage);\n\n      this.setState({\n        selectStartPos: {\n          x: pos.x,\n          y: pos.y,\n        },\n        selecting: true,\n      });\n    }\n\n    return false;\n  };\n\n  private getSelectionRectInfo = () => {\n    const selectStartPos = this.state.selectStartPos;\n    const selectRect = this.state.selectRect;\n    return {\n      height: Math.abs(selectRect.height),\n      width: Math.abs(selectRect.width),\n      x:\n        selectRect.width < 0\n          ? selectStartPos.x + selectRect.width\n          : selectStartPos.x,\n      y:\n        selectRect.height < 0\n          ? selectStartPos.y + selectRect.height\n          : selectStartPos.y,\n    };\n  };\n\n  private handleMouseUp = () => {\n    // if we were selecting, check for intersection\n    if (this.state.drewASelectionRect) {\n      const selectRect = this.getSelectionRectInfo();\n      const selectedCards: any[] = this.props.cards.cards.reduce<ICardStack[]>(\n        (currSelectedCards, card) => {\n          const intersects = Intersects.boxBox(\n            selectRect.x,\n            selectRect.y,\n            selectRect.width,\n            selectRect.height,\n            card.x - 50,\n            card.y - 75,\n            cardConstants.CARD_WIDTH,\n            cardConstants.CARD_HEIGHT\n          );\n\n          if (intersects) {\n            currSelectedCards.push(card);\n          }\n\n          return currSelectedCards;\n        },\n        []\n      );\n\n      this.props.selectMultipleCards({\n        ids: selectedCards.map((card) => card.id),\n      });\n    }\n\n    this.setState({\n      drewASelectionRect: false,\n      selectRect: {\n        height: 0,\n        width: 0,\n      },\n      selecting: false,\n    });\n\n    return false;\n  };\n\n  private handleTouchStart = (event: any) => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n\n    this.touchTimer = setTimeout(() => {\n      this.handleContextMenu(event);\n    }, 750);\n  };\n\n  private handleTouchMove = (e: any) => {\n    e.evt.preventDefault();\n\n    var touch1 = e.evt.touches[0];\n    var touch2 = e.evt.touches[1];\n\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n\n    if (touch1 && touch2) {\n      this.handleMultiTouch(touch1, touch2);\n    } else if (!this.props.panMode) {\n      this.handleMouseMove(e);\n    }\n  };\n\n  private handleMultiTouch = (touch1: any, touch2: any) => {\n    if (!this.stage) {\n      return;\n    }\n    // if the stage was under Konva's drag&drop\n    // we need to stop it, and implement our own pan logic with two pointers\n    if (this.stage.isDragging()) {\n      this.stage.stopDrag();\n    }\n\n    const p1 = {\n      x: touch1.clientX,\n      y: touch1.clientY,\n    };\n    const p2 = {\n      x: touch2.clientX,\n      y: touch2.clientY,\n    };\n\n    if (!this.lastCenter) {\n      this.lastCenter = getCenter(p1, p2);\n      return;\n    }\n    const newCenter = getCenter(p1, p2);\n\n    const dist = getDistance(p1, p2);\n\n    if (!this.lastDist) {\n      this.lastDist = dist;\n    }\n\n    // local coordinates of center point\n    const pointTo = {\n      x: (newCenter.x - this.stage.x()) / this.props.gameState.stageZoom.x,\n      y: (newCenter.y - this.stage.y()) / this.props.gameState.stageZoom.y,\n    };\n\n    const scale = this.props.gameState.stageZoom.x * (dist / this.lastDist);\n    this.props.updateZoom({ x: scale, y: scale });\n\n    // calculate new position of the stage\n    const dx = newCenter.x - this.lastCenter.x;\n    const dy = newCenter.y - this.lastCenter.y;\n\n    const newPos = {\n      x: newCenter.x - pointTo.x * scale + dx,\n      y: newCenter.y - pointTo.y * scale + dy,\n    };\n\n    this.props.updatePosition(newPos);\n\n    this.lastDist = dist;\n    this.lastCenter = newCenter;\n  };\n\n  private handleTouchEnd = (event: any) => {\n    this.lastDist = 0;\n    this.lastCenter = null;\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n  };\n\n  private handleMouseMove = (event: any) => {\n    if (this.state.selecting) {\n      const pos = this.getRelativePositionFromTarget(event.currentTarget);\n      this.setState({\n        drewASelectionRect: true,\n        selectRect: {\n          height: pos.y - this.state.selectStartPos.y,\n          width: pos.x - this.state.selectStartPos.x,\n        },\n      });\n    }\n    event.cancelBubble = true;\n  };\n\n  private handleContextMenu = (event: KonvaEventObject<PointerEvent>): void => {\n    if (!!this.touchTimer) {\n      clearTimeout(this.touchTimer);\n      this.touchTimer = null;\n    }\n    event.evt.preventDefault();\n    event.cancelBubble = true;\n\n    const menuItems = [\n      {\n        label: \"Undo\",\n        action: this.props.undo,\n      },\n      {\n        label: \"Redo\",\n        action: this.props.redo,\n      },\n      {\n        label: \"Load Deck ID\",\n        action: () => {\n          this.setState({\n            showDeckImporter: true,\n            deckImporterPosition: this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      },\n      {\n        label: \"Load Encounter\",\n        action: () => {\n          this.setState({\n            showEncounterImporter: true,\n            encounterImporterPosition: this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      },\n      {\n        label: \"Create new counter\",\n        action: () => {\n          this.props.addNewCounter(\n            this.getRelativePositionFromTarget(this.stage) ?? { x: 0, y: 0 }\n          );\n        },\n      },\n      { label: \"Reset Game\", action: this.props.resetApp },\n      {\n        label: \"Connect to Remote Game\",\n        action: () => {\n          this.setState({\n            showPeerConnector: true,\n            peerConnectorPosition: this.stage?.getPointerPosition() ?? null,\n          });\n        },\n      },\n      {\n        label: \"Request resync from Remote Game\",\n        action: this.props.requestResync,\n      },\n      {\n        label: `Peer id is ${this.props.peerId}`,\n        action: () => {},\n      },\n    ];\n\n    this.setState({\n      showContextMenu: true,\n      contextMenuPosition: this.stage?.getPointerPosition() ?? null,\n      contextMenuItems: menuItems,\n    });\n  };\n\n  private getCardType = (card: ICardStack): string => {\n    if (Object.keys(this.props.cardsData).length === 0) return \"\";\n\n    const cardData = this.props.cardsData[card.cardStack[0].jsonId];\n\n    return cardData?.type_code ?? \"\";\n  };\n\n  private getCardName = (card: ICardStack) => {\n    const cardInQuestion = card.faceup\n      ? card.cardStack[0]\n      : card.cardStack[card.cardStack.length - 1];\n    return this.props.cardsData[cardInQuestion.jsonId]?.name ?? \"\";\n  };\n\n  private getCardCode = (card: ICardStack) => {\n    const cardInQuestion = card.faceup\n      ? card.cardStack[0]\n      : card.cardStack[card.cardStack.length - 1];\n    return (\n      this.props.cardsData[cardInQuestion.jsonId]?.code ??\n      `code missing for ${cardInQuestion.jsonId}`\n    );\n  };\n\n  private checkMissingImageMap(code: string): string | null {\n    return MISSING_CARD_IMAGE_MAP[code] ?? null;\n  }\n\n  private generateLCGCDNImageUrl(card: CardData, faceup: boolean): string {\n    if (!card) {\n      return `https://lcgcdn.s3.amazonaws.com/mc/NOPE.jpg`;\n    }\n\n    // get the first two digits\n    let codeToUse = card.code;\n\n    if (!faceup && !!card.back_link) {\n      codeToUse = card.back_link;\n    }\n\n    const groupCode =\n      CARD_PACK_REMAPPING[card.pack_code] ?? codeToUse.substring(0, 2);\n    let cardCode = codeToUse.substring(2);\n\n    //trim leading \"0\" chars\n    while (cardCode[0] === \"0\") {\n      cardCode = cardCode.substring(1);\n    }\n\n    cardCode = cardCode.toLocaleUpperCase();\n\n    let cardSuffix = \"\";\n\n    if (!!card.double_sided) {\n      cardSuffix = faceup ? \"A\" : \"B\";\n    }\n\n    return `https://lcgcdn.s3.amazonaws.com/mc/MC${groupCode}en_${cardCode}${cardSuffix}.jpg`;\n  }\n\n  private getImgUrls = (card: ICardStack): string[] => {\n    if (Object.keys(this.props.cardsData).length === 0) return [];\n\n    let urls: string[] = [];\n\n    const topCardData = this.props.cardsData[card.cardStack[0].jsonId];\n\n    if (!topCardData) {\n      return [`https://lcgcdn.s3.amazonaws.com/mc/NOPE.jpg`];\n    }\n\n    let cardData: CardData | null = topCardData;\n\n    if (!card.faceup) {\n      if (!!topCardData.back_link || !!topCardData.double_sided) {\n        urls = [\n          this.generateLCGCDNImageUrl(topCardData, card.faceup),\n          // `https://marvelcdb.com/bundles/cards/${bottomCardData.back_link}.png`,\n          // `https://marvelcdb.com/bundles/cards/${bottomCardData.back_link}.jpg`,\n          // process.env.PUBLIC_URL +\n          //   \"/images/cards/\" +\n          //   bottomCardData.octgn_id +\n          //   \".b.jpg\",\n        ];\n      } else {\n        cardData = null;\n        urls = [\n          topCardData.faction_code === \"encounter\"\n            ? process.env.PUBLIC_URL +\n              \"/images/standard/encounter_card_back.png\"\n            : process.env.PUBLIC_URL + \"/images/standard/card_back.png\",\n        ];\n      }\n    } else {\n      urls = [\n        this.generateLCGCDNImageUrl(topCardData, card.faceup),\n        // `https://marvelcdb.com/bundles/cards/${topCardData.code}.png`,\n        // `https://marvelcdb.com/bundles/cards/${topCardData.code}.jpg`,\n        // process.env.PUBLIC_URL +\n        //   \"/images/cards/\" +\n        //   topCardData.octgn_id +\n        //   \".jpg\",\n      ];\n    }\n\n    let codeForMissingCheck = \"\";\n\n    if (!!cardData) {\n      if (card.faceup) {\n        codeForMissingCheck = cardData.code;\n      } else {\n        if (!!cardData.back_link) {\n          codeForMissingCheck = cardData.back_link;\n        } else if (cardData.double_sided) {\n          codeForMissingCheck = `${cardData.code}_double_sided_back`;\n        }\n      }\n    }\n\n    const missingImageOverride = !!cardData\n      ? this.checkMissingImageMap(codeForMissingCheck)\n      : null;\n\n    if (!!missingImageOverride) {\n      urls.unshift(missingImageOverride);\n    }\n\n    return urls;\n  };\n}\n\nexport default App;\n","import { createSlice, CaseReducer } from \"@reduxjs/toolkit\";\nimport { initialState, ICardsDataState } from \"./initialState\";\n\nimport * as PackData from \"../../external/generated/packs\";\nimport { CardData } from \"../../external-api/marvel-card-data\";\nimport SetData from \"../../external/marvelsdb-json-data/sets.json\";\n\n// Reducers\nconst loadCardsDataReducer: CaseReducer<ICardsDataState> = (state) => {\n  //This reducer is only intended to be called a single time each load.\n  state.entities = {};\n  state.encounterEntities = {};\n  const heroPacks = Object.entries(PackData)\n    .filter(([key, value]) => !key.includes(\"_encounter\"))\n    .map(([key, value]) => value);\n\n  const encounterPacks = Object.entries(PackData)\n    .filter(([key, value]) => key.includes(\"_encounter\"))\n    .map(([key, value]) => value);\n\n  heroPacks.forEach((pack) =>\n    pack.forEach((card: CardData) => {\n      if (state.entities[card.code]) {\n        console.error(\"Found multiple cards with code \" + card.code);\n      }\n\n      // if (!card.octgn_id) {\n      //   console.error(`Card ${card.code} had no octgn_id!`);\n      // }\n\n      state.entities[card.code] = card;\n    })\n  );\n\n  encounterPacks.forEach((pack) =>\n    pack.forEach((card: CardData) => {\n      if (state.encounterEntities[card.code]) {\n        console.error(\"Found multiple cards with code \" + card.code);\n      }\n\n      // if (!card.octgn_id) {\n      //   console.error(`Card ${card.code}: ${card.name} had no octgn_id!`);\n      // }\n\n      state.encounterEntities[card.code] = card;\n    })\n  );\n\n  SetData.forEach((set) => {\n    state.setData[set.code] = {\n      name: set.name,\n      setTypeCode: set.card_set_type_code,\n    };\n  });\n\n  return state;\n};\n\n// slice\nconst cardsDataSlice = createSlice({\n  name: \"cardsData\",\n  initialState: initialState,\n  reducers: {\n    loadCardsData: loadCardsDataReducer,\n  },\n});\n\nexport const { loadCardsData } = cardsDataSlice.actions;\n\nexport default cardsDataSlice.reducer;\n","import { CardData } from \"../../external-api/marvel-card-data\";\n\nexport interface ICardData {\n  [key: string]: CardData;\n}\n\nexport interface Set {\n  name: string;\n  setTypeCode: string;\n}\n\nexport interface ISetData {\n  [key: string]: Set;\n}\n\nexport interface ICardsDataState {\n  entities: ICardData;\n  encounterEntities: ICardData;\n  setData: ISetData;\n}\n\nexport const initialState: ICardsDataState = {\n  entities: {},\n  encounterEntities: {},\n  setData: {},\n};\n","import { createSelector } from \"@reduxjs/toolkit\";\nimport { RootState } from \"../../store/rootReducer\";\nimport { ICardStack } from \"../cards/initialState\";\n\nexport const getGame = (state: RootState) => state.game;\n\nexport const getCurrentZoom = createSelector(getGame, (game) => {\n  return game.stageZoom;\n});\n\nexport const getPlayerColors = createSelector(getGame, (game) => {\n  return game.playerColors;\n});\n\nexport const getPeerId = createSelector(getGame, (game) => game.peerId);\n\nexport const getMenuPreviewCard = createSelector(getGame, (game) => {\n  if (!game.menuPreviewCardJsonId) return null;\n\n  const menuPreviewCard: ICardStack = {\n    id: \"menu-preview-card\",\n    controlledBy: \"\",\n    exhausted: false,\n    faceup: true,\n    fill: \"gray\",\n    x: 0,\n    y: 0,\n    statusTokens: {\n      stunned: false,\n      confused: false,\n      tough: false,\n    },\n    counterTokens: {\n      damage: 0,\n      threat: 0,\n      generic: 0,\n    },\n    selected: false,\n    dragging: false,\n    shuffling: false,\n    cardStack: [{ jsonId: game.menuPreviewCardJsonId }],\n  };\n\n  return menuPreviewCard;\n});\n","import { connect } from \"react-redux\";\nimport { ActionCreators } from \"redux-undo\";\nimport App from \"./App\";\nimport { getCardsDataEntities } from \"./features/cards-data/cards-data.selectors\";\nimport { loadCardsData } from \"./features/cards-data/cards-data.slice\";\nimport {\n  getCards,\n  getDropTargetCardsById,\n  getPanMode,\n  // shouldShowPreview,\n} from \"./features/cards/cards.selectors\";\nimport {\n  adjustCounterToken,\n  cardMove,\n  endCardMove,\n  exhaustCard,\n  flipCards,\n  // hoverCard,\n  // hoverLeaveCard,\n  selectCard,\n  selectMultipleCards,\n  togglePanMode,\n  toggleSelectCard,\n  toggleToken,\n  unselectAllCards,\n  unselectCard,\n} from \"./features/cards/cards.slice\";\nimport {\n  addCardStack,\n  fetchDecklistById,\n  pullCardOutOfCardStack,\n  startCardMove,\n  shuffleStack,\n  drawCardsOutOfCardStack,\n} from \"./features/cards/cards.thunks\";\nimport {\n  getGame,\n  getMenuPreviewCard,\n  getPeerId,\n  getPlayerColors,\n} from \"./features/game/game.selectors\";\nimport {\n  connectToRemoteGame,\n  updatePosition,\n  updateZoom,\n  requestResync,\n  setPreviewCardId,\n  clearPreviewCard,\n} from \"./features/game/game.slice\";\n\nimport {\n  moveCounter,\n  removeCounter,\n  updateCounterValue,\n} from \"./features/counters/counters.slice\";\nimport { addNewCounter } from \"./features/counters/counters.thunks\";\nimport { resetApp } from \"./store/global.actions\";\nimport { RootState } from \"./store/rootReducer\";\nimport { getCurrentCounters } from \"./features/counters/counters.selectors\";\n\nconst mapStateToProps = (state: RootState) => {\n  return {\n    playerColors: getPlayerColors(state),\n    cards: getCards(state),\n    cardsData: getCardsDataEntities(state),\n    // showPreview: shouldShowPreview(state),\n    panMode: getPanMode(state),\n    gameState: getGame(state),\n    counters: getCurrentCounters(state),\n    peerId: getPeerId(state),\n    dropTargetCardsById: getDropTargetCardsById(state),\n    menuPreviewCard: getMenuPreviewCard(state),\n  };\n};\n\nconst AppContainer = connect(mapStateToProps, {\n  cardMove,\n  endCardMove,\n  exhaustCard,\n  loadCardsData,\n  selectCard,\n  unselectCard,\n  toggleSelectCard,\n  selectMultipleCards,\n  startCardMove,\n  unselectAllCards,\n  // hoverCard,\n  // hoverLeaveCard,\n  togglePanMode,\n  flipCards,\n  shuffleStack,\n  fetchDecklistById,\n  updateZoom,\n  updatePosition,\n  resetApp,\n  addCardStack,\n  toggleToken,\n  adjustCounterToken,\n  pullCardOutOfCardStack,\n  addNewCounter,\n  updateCounterValue,\n  removeCounter,\n  moveCounter,\n  connectToRemoteGame,\n  requestResync,\n  undo: ActionCreators.undo,\n  redo: ActionCreators.redo,\n  drawCardsOutOfCardStack,\n  setPreviewCardId,\n  clearPreviewCard,\n})(App);\n\nexport default AppContainer;\n","import { Vector2d } from \"konva/types/types\";\nimport { Action } from \"redux\";\nimport { ThunkAction } from \"redux-thunk\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { RootState } from \"../../store/rootReducer\";\nimport { addNewCounterWithId } from \"./counters.actions\";\n\nexport const addNewCounter = (\n  pos: Vector2d\n): ThunkAction<void, RootState, unknown, Action<string>> => (dispatch) => {\n  const payloadWithId = {\n    pos,\n    id: uuidv4(),\n  };\n  dispatch(addNewCounterWithId(payloadWithId));\n};\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { \"Service-Worker\": \"script\" },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import { combineReducers } from \"redux\";\nimport undoable, { excludeAction, groupByActionTypes } from \"redux-undo\";\nimport cardsData from \"../features/cards-data/cards-data.slice\";\nimport { startCardMoveWithSplitStackId } from \"../features/cards/cards.actions\";\nimport cards, { cardMove } from \"../features/cards/cards.slice\";\nimport game, {\n  clearPreviewCard,\n  setPreviewCardId,\n} from \"../features/game/game.slice\";\n\nimport counters, { moveCounter } from \"../features/counters/counters.slice\";\n\nconst undoableState = combineReducers({\n  counters,\n  cards,\n});\n\nconst rootReducer = combineReducers({\n  game,\n  cardsData,\n  liveState: undoable(undoableState, {\n    limit: 20,\n    groupBy: groupByActionTypes([moveCounter.type]),\n    filter: excludeAction([\n      startCardMoveWithSplitStackId.type,\n      cardMove.type,\n      setPreviewCardId.type,\n      clearPreviewCard.type,\n    ]),\n  }),\n});\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","import Peer from \"peerjs\";\nimport { myPeerRef } from \"../constants/app-constants\";\nimport { togglePanMode } from \"../features/cards/cards.slice\";\nimport {\n  clearPreviewCard,\n  connectToRemoteGame,\n  requestResync,\n  setPeerId,\n  setPlayerColor,\n  setPreviewCardId,\n  updatePosition,\n  updateZoom,\n} from \"../features/game/game.slice\";\nimport { receiveRemoteGameState } from \"./global.actions\";\n\nconst DEBUG = false;\n\nconst blacklistRemoteActions = {\n  [connectToRemoteGame.type]: true,\n  [updatePosition.type]: true,\n  [updateZoom.type]: true,\n  [setPreviewCardId.type]: true,\n  [clearPreviewCard.type]: true,\n  [togglePanMode.type]: true,\n  [receiveRemoteGameState.type]: true,\n  [requestResync.type]: true,\n};\n\nconst log = (...args: any[]) => {\n  if (DEBUG) {\n    console.log(args[0], args[1]);\n  }\n};\n\nconst setupConnection = (conn: any, storeAPI: any) => {\n  conn.on(\"data\", (data: any) => {\n    if (!data.INITIAL_STATE_MSG) {\n      if (!!data.RESYNC) {\n        log(\"received request for resync\");\n        conn.send({\n          INITIAL_STATE_MSG: true,\n          state: storeAPI.getState(),\n        });\n      } else {\n        log(\"recieved remote action\", data);\n        data.REMOTE_ACTION = true;\n        log(\"dispatching remote action\", data);\n        storeAPI.dispatch(data);\n      }\n    } else {\n      console.log(\"going to replace (most of) state with\", data.state);\n      setTimeout(() => {\n        storeAPI.dispatch(receiveRemoteGameState(data.state));\n      }, 0);\n    }\n  });\n};\n\nexport const peerJSMiddleware = (storeAPI: any) => {\n  const cgpPeer = new Peer(undefined, {\n    debug: 0,\n    config: {\n      iceServers: [\n        { urls: \"stun:stun.l.google.com:19302\" },\n        {\n          urls: \"turn:numb.viagenie.ca\",\n          username: \"webrtc@live.com\",\n          credential: \"muazkh\",\n        },\n      ],\n    },\n  });\n  let activeCon: Peer.DataConnection;\n\n  cgpPeer.on(\"error\", (err) => {\n    console.error(\"*****************Server error\");\n    console.error(err);\n  });\n\n  cgpPeer.on(\"disconnected\", () => {\n    console.log(\"****Peer server connection disconnected\");\n  });\n\n  cgpPeer.on(\"open\", (id) => {\n    console.log(\"My peer ID is: \" + id);\n    storeAPI.dispatch(setPeerId(id));\n\n    //look for query param\n    const remoteParamArray = window.location.href.split(\"remote=\");\n    if (remoteParamArray.length > 1) {\n      const remoteId = remoteParamArray[1].split(\"&\")[0];\n      console.log(\"FOUND QUERY PARAM. Going to connect to peer \" + remoteId);\n      activeCon = cgpPeer.connect(remoteId, {\n        metadata: { ref: myPeerRef },\n      });\n      setupConnection(activeCon, storeAPI);\n    }\n  });\n\n  cgpPeer.on(\"connection\", (conn) => {\n    console.log(\"Connection received!\");\n    activeCon = conn;\n    setupConnection(activeCon, storeAPI);\n\n    activeCon.on(\"open\", () => {\n      console.log(\"connection ready for data\");\n      log(\"going to send initial state\", storeAPI.getState());\n      activeCon.send({\n        INITIAL_STATE_MSG: true,\n        state: storeAPI.getState(),\n      });\n      // TODO: more complicated logic to handle multiple connections. Right now\n      // this just changes the connecting client to blue\n      const setPlayerColorAction = setPlayerColor({\n        ref: activeCon.metadata.ref,\n        color: \"blue\",\n      });\n      activeCon.send(setPlayerColorAction);\n      activeCon.send(\n        setPlayerColor({\n          ref: myPeerRef,\n          color: \"red\",\n        })\n      );\n      storeAPI.dispatch(setPlayerColorAction);\n    });\n\n    activeCon.on(\"error\", (err) => {\n      console.error(\"****************Connection error:\", err);\n    });\n\n    activeCon.on(\"close\", () => {\n      console.log(\"******connection closed for ref \" + activeCon.metadata.ref);\n    });\n\n    activeCon.peerConnection.onconnectionstatechange = (ev: Event) => {\n      console.log(`connection state changed`);\n      console.log(ev);\n      console.log(activeCon.peerConnection.connectionState);\n      if (\n        activeCon.peerConnection.connectionState === \"closed\" ||\n        activeCon.peerConnection.connectionState === \"disconnected\"\n      ) {\n        console.log(\n          \"CLEARING CLIENT OWNED CARDS for \" + activeCon.metadata.ref\n        );\n      }\n    };\n  });\n  return (next: any) => (action: any) => {\n    log(\"received local action\", action);\n\n    // If this isn't a REMOTE action, add our ref onto it\n    if (!action.REMOTE_ACTION) {\n      action.ACTOR_REF = myPeerRef;\n    } else if (!action.ACTOR_REF) {\n      console.error(`Received a REMOTE action without an ACTOR_REF:`);\n      console.log(action);\n    }\n\n    if (action.type === connectToRemoteGame.type) {\n      console.log(\"going to connect to peer \" + action.payload);\n      activeCon = cgpPeer.connect(action.payload, {\n        metadata: { ref: myPeerRef },\n      });\n      setupConnection(activeCon, storeAPI);\n    } else if (action.type === requestResync.type) {\n      if (!!activeCon) {\n        activeCon.send({ RESYNC: true });\n      }\n    }\n\n    if (\n      !action.REMOTE_ACTION &&\n      !!activeCon &&\n      !blacklistRemoteActions[action.type]\n    ) {\n      log(\"going to send action to peer!\");\n      activeCon.send(action);\n    }\n\n    return next(action);\n  };\n};\n","import throttle from \"lodash.throttle\";\nimport {\n  configureStore as rtkConfigureStore,\n  getDefaultMiddleware,\n} from \"@reduxjs/toolkit\";\nimport rootReducer from \"./rootReducer\";\nimport { saveState } from \"./localStorage\";\nimport { peerJSMiddleware } from \"./peer-js-redux-middleware\";\n\nconst customizedMiddleware = getDefaultMiddleware({\n  thunk: true,\n  immutableCheck: false,\n  serializableCheck: false,\n}).concat(peerJSMiddleware);\n\nexport default function configureStore() {\n  console.log(\"configuring store. NODE_ENV is \" + process.env.NODE_ENV);\n  const store = rtkConfigureStore({\n    reducer: rootReducer,\n    middleware: customizedMiddleware,\n    devTools: process.env.NODE_ENV !== \"production\",\n  });\n\n  store.subscribe(\n    throttle(() => {\n      saveState(store.getState());\n    }, 1000)\n  );\n\n  return store;\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.scss\";\nimport { Provider } from \"react-redux\";\nimport AppContainer from \"./AppContainer\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport configureStore from \"./store/configureStore\";\n\nconst store = configureStore();\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <AppContainer />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}